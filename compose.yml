services:
  influxdb:
    container_name: influxdb
    image: influxdb:latest
    restart: unless-stopped
    ports:
      - '8086:8086'
    env_file:
      - system.env
    networks:
      demo:
        ipv4_address: 192.168.10.13
  
  influxdb_cli:
    container_name: influxdb_cli
    links:
      - influxdb
    image: influxdb:latest
    volumes: 
      - ./monitor/templates:/home/templates:rw
    entrypoint: influx apply -o "lasse" -f /home/templates/template.yml -t "nlUwG8uHneAP2SVYWRqOk0OJ1p19H8ddKR9o292rEmk2ZMli33cO8WqndkM1IWgrNqbGmI7tia1X4AGb6PXWQQ==" --host=http://influxdb:8086 --force yes
    restart: on-failure:20
    depends_on:
      - influxdb
    networks:
      demo:
        ipv4_address: 192.168.10.14

  grafana:
    image: grafana/grafana-oss
    container_name: grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    user: "0"
    volumes:
      - ./monitor/grafana/grafana.db:/var/lib/grafana/grafana.db
    depends_on:
      - influxdb
    networks:
      demo:
        ipv4_address: 192.168.10.16
networks:
  demo:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.10.0/24
