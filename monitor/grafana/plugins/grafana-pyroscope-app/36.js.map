{"version":3,"file":"36.js","mappings":"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","sources":["webpack://grafana-pyroscope-app/./shared/infrastructure/react-query/queryClient.ts","webpack://grafana-pyroscope-app/./constants.ts","webpack://grafana-pyroscope-app/./version.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/getEnvironment.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/faro/faro-environments.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/faro/faro.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/logger.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/userStorage.ts","webpack://grafana-pyroscope-app/./shared/domain/noOp.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/http/HttpClientError.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/http/HttpClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/http/ApiClient.ts","webpack://grafana-pyroscope-app/./app/components/Onboarding/infrastructure/statsApiClient.ts","webpack://grafana-pyroscope-app/./app/components/Onboarding/domain/useOnboarding.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/infrastructure/useFetchTenantStats.ts","webpack://grafana-pyroscope-app/./shared/components/QueryAnalysisTooltip/QueryAnalysisTooltip.tsx","webpack://grafana-pyroscope-app/./shared/ui/PyroscopeLogo.tsx","webpack://grafana-pyroscope-app/./shared/ui/PluginInfo.tsx","webpack://grafana-pyroscope-app/./shared/ui/PageTitle.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/ui/EmptyLoadingPage.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/ui/StyledLink.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/ui/NoDataSourcePage.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/domain/useOnboardingModal.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/infrastructure/useFetchInstances.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/ui/OnboardingModal.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/ui/OnboardingPage.tsx","webpack://grafana-pyroscope-app/./app/components/Onboarding/Onboarding.tsx","webpack://grafana-pyroscope-app/./shared/components/Common/BackButton.tsx","webpack://grafana-pyroscope-app/./shared/domain/reportInteraction.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/useReportPageInitialized.ts","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/AdHocColums.tsx","webpack://grafana-pyroscope-app/./shared/domain/displayStatus.ts","webpack://grafana-pyroscope-app/./pages/AdHocView/infrastructure/adHocProfileClient.ts","webpack://grafana-pyroscope-app/./pages/AdHocView/infrastructure/helpers/stripBase64Prefix.ts","webpack://grafana-pyroscope-app/./pages/AdHocView/domain/useUploadFile.ts","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/AdHocFileDropZone.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/domain/accepted-file-types.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/infrastructure/flamegraphDotComApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/types.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/domain/getExportFilename.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/domain/useExportMenu.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/ExportMenu.tsx","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/components/ExportData.tsx","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/domain/flamebearerToDataFrameDTO.ts","webpack://grafana-pyroscope-app/./shared/components/FlameGraph/FlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/AdHocFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/AdHocProfileTypeSelector.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/AdHocSpinner.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/tabs/AdHocSingle.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/tabs/AdHocComparison.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/ui/AdHocTabs.tsx","webpack://grafana-pyroscope-app/./pages/AdHocView/AdHocView.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/GitHubCallbackView.tsx","webpack://grafana-pyroscope-app/./shared/domain/prepareHistoryEntry.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventTimeseriesDataReceived.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/types.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/DataSourceProxyClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/labels/http/LabelsApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/MemoryCacheClient.ts","webpack://grafana-pyroscope-app/./shared/types/helpers/invariant.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/AbstractRepository.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/labels/LabelsApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/labels/labelsRepository.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/areFiltersEqual.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/buildIsEmptyFilter.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/filtersToQuery.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/getLastFilter.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isMultipleValuesOperator.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isPartialFilter.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isSwitchingOperatorMode.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/queryToFilters.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/toggleCompleteFilters.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/actions.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/getFilterUnderEdition.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/guards.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/infrastructure/operatorsRepository.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isPrivateLabel.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/services.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/autoSuggestProxy.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/constants.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/helpers/isRegexOperator.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/idle.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/loadLabels.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/loadLabelValues.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/states/loadOperators.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/stateMachine.ts","webpack://grafana-pyroscope-app/./shared/domain/localeCompare.ts","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/MultipleEditionSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/inputs/SingleEditionInput.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/SingleEditionSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/ChicletAttributeOperator.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/ChicletAttributeOperatorValue.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/PartialChiclet.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/Chiclet.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/chiclets/ChicletsList.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/SingleSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/DisabledSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/selects/MultipleSelect.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/QueryBuilder.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/domain/useStateMachine.tsx","webpack://grafana-pyroscope-app/./shared/components/QueryBuilder/ui/hooks.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/profile-metrics/getProfileMetric.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/pyroscope-data-sources.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ProfileMetricVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ServiceNameVariable/ServiceNameVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ServiceNameVariable/domain/useBuildServiceNameOptions.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/useBuildPyroscopeQuery.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/ProfilesDataSourceVariable.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/FiltersVariable/filters-ops.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/FiltersVariable/FiltersVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/getSceneVariableValue.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/getColorByIndex.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/helpers/getSeriesLabelFieldName.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/helpers/getSeriesStatsValue.ts","webpack://grafana-pyroscope-app/./shared/domain/url-params/parseQuery.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/withPreventInvalidQuery.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/timeseries/buildTimeSeriesQueryRunner.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/infrastructure/data-transformations.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesBarGauge.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/formatSingleSeriesDisplayName.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesHistogram.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesTable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/computeRoundedTimeRange.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/labels/LabelsDataSource.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/helpers/getProfileMetricLabel.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesTimeseries/SceneTimeseriesMenu.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/getExploreUrl.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/useGetPluginExtensionLink.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneLabelValuesTimeseries/SceneLabelValuesTimeseries.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/helpers/vizPanelBuilder.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/ui/useMousePosition.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/ui/GrotNotFound.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/ui/EmptyState.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneEmptyState/SceneEmptyState.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneErrorState/SceneErrorState.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneQuickFilter.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/favorites/FavoritesDataSource.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/helpers/interpolateQueryRunnerVariables.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/actions/FavAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/domain/sortFavGridItems.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventExpandPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventSelectLabel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewServiceFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewServiceLabels.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewServiceProfiles.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/actions/SelectAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreAllServices/SceneExploreAllServices.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneDrawer.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/FavoriteVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreFavorites/SceneExploreFavorites.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/GroupByVariable/GroupBySelector.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/GroupByVariable/GroupByVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneMainServiceTimeseries.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/events/EventViewDiffFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventSelectForCompare.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneStatsPanel/ui/CompareAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneStatsPanel/ui/StatsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneStatsPanel/SceneStatsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/components/SceneLabelValuePanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/infrastructure/buildLabelValuesGridQueryRunner.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/components/SceneLabelValuesGrid/SceneLabelValuesGrid.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventClearLabelFromFilters.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventExcludeLabelFromFilters.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/events/EventIncludeLabelInFilters.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/actions/IncludeExcludeAction/ui/FilterButtons.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/domain/actions/IncludeExcludeAction/IncludeExcludeAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/ui/CompareControls.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/components/SceneGroupByLabels/SceneGroupByLabels.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceLabels/SceneExploreServiceLabels.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceProfileTypes/SceneExploreServiceProfileTypes.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/buildTimeRange.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/domain/variables/SpanSelectorVariable.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/formatSeriesToProfileMetrics.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/formatSeriesToServices.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/DataSourceProxyClientBuilder.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/formatSeriesResponse.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/SeriesApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/http/seriesRepository.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/series/SeriesDataSource.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventEnableSyncTimeRanges.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventSyncRefresh.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventSyncTimeRanges.ts","webpack://grafana-pyroscope-app/./shared/components/SceneTimePickerWithoutSync/SceneTimePickerWithoutSync.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/parseUrlParam.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/RangeAnnotation.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/components/SceneTimeRangeWithAnnotations.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/evaluateTimeRange.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/events/EventSwitchTimerangeSelectionMode.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/domain/actions/SwitchTimeRangeSelectionModeAction.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/infrastructure/buildCompareTimeSeriesQueryRunner.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/ui/colors.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneComparePanel/SceneComparePanel.tsx","webpack://grafana-pyroscope-app/./shared/domain/useToggleSidePanel.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/PluginSettings.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/settingsApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/useFetchPluginSettings.ts","webpack://grafana-pyroscope-app/./shared/ui/InlineBanner.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/DelayRender.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/PanelMenu.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/HoverWidget.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/TitleItem.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/PanelDescription.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/PanelStatus.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/GrafanaPanelBox/GrafanaPanelBox.tsx","webpack://grafana-pyroscope-app/./shared/ui/Panel/Panel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/AiButton/AIButton.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/AiButton/infrastructure/useFetchLlmPluginStatus.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/AiReply.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/components/FollowUpForm.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/domain/buildLlmPrompts.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/profiles/ProfileApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/SceneAiPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/infrastructure/useFetchDotProfiles.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/infrastructure/cleanupDotResponse.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneAiPanel/domain/useOpenAiChatCompletions.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/events/EventDiffAutoSelect.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/events/EventDiffChoosePreset.tsx","webpack://grafana-pyroscope-app/./shared/domain/url-params/useMaxNodesFromUrl.ts","webpack://grafana-pyroscope-app/./shared/domain/url-params/useUrlSearchParams.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/infrastructure/DiffProfileApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/infrastructure/useFetchDiffProfile.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/ui/MissingSelectionsBanner.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/SceneDiffFlameGraph/SceneDiffFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/GiveFeedbackButton.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/components/ScenePresetsPicker/ScenePresetsPicker.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/behaviours/syncYAxis.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/SceneExploreDiffFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/VcsClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/infrastructure/GitSessionCookie.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/infrastructure/GitSessionCookieManager.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/openLoginPopup.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/githubLogin.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/authFromUrl.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/usePollGitHubPopup.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/GitHubContext.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/infrastructure/PrivateVcsClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/GitHubContextProvider.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/generateNonce.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/domain/useGithubSessionCookie.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/domain/events/RemoveSpanSelector.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/settings/featureToggles.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/infrastructure/flame-graph/buildFlameGraphQueryRunner.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/recording-rules/recordingRulesApiClient.ts","webpack://grafana-pyroscope-app/./shared/infrastructure/recording-rules/useFetchRecordingRules.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneCreateMetricModal/domain/useCreateRecordingRule.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneCreateMetricModal/SceneCreateRecordingRuleModal.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/infrastructure/PprofRequest.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/infrastructure/PprofApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneExportMenu/domain/getExportFilename.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneExportMenu/infrastructure/flamegraphDotComApiClient.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneExportMenu/SceneExportMenu.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/useGitHubContext.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/useGitHubIntegration.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/buildStackTrace.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/domain/buildLlmSuggestionPrompts.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/domain/useAiSuggestionsPanel.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/domain/useOpenAiSuggestions.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/AiSuggestionsPanel/AiSuggestionsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/domain/annotateLines.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/domain/buildGithubUrlForFunction.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/domain/useCodeContainer.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/infrastructure/useFetchVCSFile.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/buildUnitFormatter.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/ui/Code.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/CodeContainer/CodeContainer.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubRepository.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/getCommitsWithSamples.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/isGitHubRepository.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/getRepositoryDetails.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/convertPprofToFunctionDetails.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/fetchCommitsInfo.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/helpers/getTotalSum.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/helpers/sortByTotal.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/infrastructure/useFetchFunctionsDetails.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/getRelativeTimeString.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/formatCommitDate.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/CommitOption.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/CommitOptionSelected.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/CommitSelect.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/GitHubIntegrationBanner.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/InlineSpinner.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/SceneFunctionDetailsPanel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/domain/formatFileName.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/SpanSelectorLabel.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/SceneFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneCreateMetricModal/domain/useMenuOption.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/SceneExploreServiceFlameGraph.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/domain/useHeader.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/domain/builsShareableUrl.ts","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/ui/ExplorationTypeSelector.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/components/Header.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/components/SceneProfilesExplorer/SceneProfilesExplorer.tsx","webpack://grafana-pyroscope-app/./pages/ProfilesExplorerView/ProfilesExplorerView.tsx","webpack://grafana-pyroscope-app/./pages/RecordingRulesView/DeleteRecordingRuleButton.tsx","webpack://grafana-pyroscope-app/./pages/RecordingRulesView/domain/useRecordingRulesView.ts","webpack://grafana-pyroscope-app/./pages/RecordingRulesView/RecordingRulesView.tsx","webpack://grafana-pyroscope-app/./pages/SettingsView/components/UISettingsView/domain/useUISettingsView.ts","webpack://grafana-pyroscope-app/./pages/SettingsView/components/UISettingsView/UISettingsView.tsx","webpack://grafana-pyroscope-app/./pages/SettingsView/domain/useSettingsExtensions.ts","webpack://grafana-pyroscope-app/./pages/SettingsView/domain/useSettingsView.ts","webpack://grafana-pyroscope-app/./pages/SettingsView/SettingsView.tsx","webpack://grafana-pyroscope-app/./app/Routes.tsx","webpack://grafana-pyroscope-app/./app/ui/ErrorPage.tsx","webpack://grafana-pyroscope-app/./app/App.tsx","webpack://grafana-pyroscope-app/./shared/infrastructure/tracking/faro/getFaroEnvironment.ts","webpack://grafana-pyroscope-app/./shims/react-use-useDebounce-default.js","webpack://grafana-pyroscope-app/./shims/react-use-usePrevious-default.js"],"sourcesContent":["import { QueryClient } from '@tanstack/react-query';\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      networkMode: 'always',\n      retry: false,\n      refetchOnWindowFocus: false,\n    },\n  },\n});\n","import plugin from './plugin.json';\n\nexport const PYROSCOPE_APP_ID = plugin.id;\n\nexport const PLUGIN_BASE_URL = `/a/${PYROSCOPE_APP_ID}`;\n\nexport enum ROUTES {\n  EXPLORE = '/explore',\n  ADHOC = '/ad-hoc',\n  SETTINGS = '/settings',\n  RECORDING_RULES = '/recording-rules',\n  GITHUB_CALLBACK = '/github/callback',\n}\n","export const GIT_COMMIT = '3f304991086d2bae305950d453e46625823349ff';\n","export type Environment = 'local' | 'dev' | 'ops' | 'prod';\n\nconst MATCHERS: Array<{ regExp: RegExp; environment: Environment }> = [\n  {\n    regExp: /localhost/,\n    environment: 'local',\n  },\n  {\n    regExp: /grafana-dev\\.net/,\n    environment: 'dev',\n  },\n  {\n    regExp: /grafana-ops\\.net/,\n    environment: 'ops',\n  },\n  {\n    regExp: /grafana\\.net/,\n    environment: 'prod',\n  },\n];\n\nexport function getEnvironment(): Environment | null {\n  if (!window?.location?.host) {\n    return null;\n  }\n\n  const found = MATCHERS.find(({ regExp }) => regExp.test(window.location.host));\n\n  return found ? found.environment : null;\n}\n","import { Environment } from '../getEnvironment';\nimport { FaroEnvironment } from './getFaroEnvironment';\n\nexport const FARO_ENVIRONMENTS = new Map<Environment, FaroEnvironment>([\n  // Uncomment this map entry to test from your local machine\n  // [\n  //   'local',\n  //   {\n  //     environment: 'local',\n  //     appName: 'grafana-pyroscope-local',\n  //     faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/d6ca259b3387e6ddd641973d0fad3ed0',\n  //   },\n  // ],\n  // Always keep the options below\n  [\n    'dev',\n    {\n      environment: 'dev',\n      appName: 'grafana-pyroscope-dev',\n      faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/48e03a2647389f2f6494af7f975b4084',\n    },\n  ],\n  [\n    'ops',\n    {\n      environment: 'ops',\n      appName: 'grafana-pyroscope-ops',\n      faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/b5cfd5eeb412cf5e74bd828b4ddd17ff',\n    },\n  ],\n  [\n    'prod',\n    {\n      environment: 'prod',\n      appName: 'grafana-pyroscope-prod',\n      faroUrl: 'https://faro-collector-ops-eu-south-0.grafana-ops.net/collect/6cbe17b3af4b72ce5936bf4d15a5c393',\n    },\n  ],\n]);\n","import { Faro, getWebInstrumentations, initializeFaro } from '@grafana/faro-web-sdk';\nimport { config } from '@grafana/runtime';\n\nimport { PLUGIN_BASE_URL, PYROSCOPE_APP_ID } from '../../../../constants';\nimport { GIT_COMMIT } from '../../../../version';\nimport { getFaroEnvironment } from './getFaroEnvironment';\n\nlet faro: Faro | null = null;\n\nexport const getFaro = () => faro;\nexport const setFaro = (instance: Faro | null) => (faro = instance);\n\nexport function initFaro() {\n  if (getFaro()) {\n    return;\n  }\n\n  const faroEnvironment = getFaroEnvironment();\n  if (!faroEnvironment) {\n    return;\n  }\n\n  const { environment, faroUrl, appName } = faroEnvironment;\n\n  const { apps, bootData, buildInfo } = config;\n\n  const appRelease = apps[PYROSCOPE_APP_ID].version;\n  const userEmail = bootData.user.email;\n  const grafanaVersion = `v${buildInfo.version} (${buildInfo.edition})`;\n\n  setFaro(\n    initializeFaro({\n      url: faroUrl,\n      app: {\n        name: appName,\n        release: appRelease,\n        version: GIT_COMMIT,\n        environment,\n        namespace: grafanaVersion, // :man_shrug:\n      },\n      user: {\n        email: userEmail,\n      },\n      instrumentations: [\n        ...getWebInstrumentations({\n          captureConsole: false,\n        }),\n      ],\n      isolate: true,\n      beforeSend: (event) => {\n        if ((event.meta.page?.url ?? '').includes(PLUGIN_BASE_URL)) {\n          event.meta.view = {\n            name: new URLSearchParams(event.meta.page?.url).get('explorationType') || '',\n          };\n\n          return event;\n        }\n\n        return null;\n      },\n    })\n  );\n}\n","import { LogLevel } from '@grafana/faro-web-sdk';\nimport { getFaro } from '@shared/infrastructure/tracking/faro/faro';\n\nimport { Environment, getEnvironment } from './getEnvironment';\n\nexport type ErrorContext = Record<string, string>;\n\nexport class Logger {\n  #environment: Environment | null;\n\n  constructor() {\n    this.#environment = getEnvironment();\n  }\n\n  #callConsole(methodName: 'trace' | 'debug' | 'info' | 'log' | 'warn' | 'error', args: any[]) {\n    // silence console in production\n    if (this.#environment !== 'prod') {\n      console[methodName](...args); // eslint-disable-line no-console\n    }\n  }\n\n  trace() {\n    this.#callConsole('trace', []);\n\n    getFaro()?.api.pushLog([], {\n      level: LogLevel.TRACE,\n    });\n  }\n\n  debug(...args: any) {\n    this.#callConsole('debug', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.DEBUG,\n    });\n  }\n\n  info(...args: any) {\n    this.#callConsole('info', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.INFO,\n    });\n  }\n\n  log(...args: any) {\n    this.#callConsole('log', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.LOG,\n    });\n  }\n\n  warn(...args: any) {\n    this.#callConsole('warn', args);\n\n    getFaro()?.api.pushLog(args, {\n      level: LogLevel.WARN,\n    });\n  }\n\n  error(error: Error, context?: ErrorContext) {\n    this.#callConsole('error', [error]);\n\n    if (context) {\n      this.#callConsole('error', ['Error context', context]);\n    }\n\n    // does not report an error, but an exception ;)\n    getFaro()?.api.pushError(error, {\n      context,\n    });\n  }\n}\n\nexport const logger = new Logger();\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\nimport plugin from '../../plugin.json';\n\nclass UserStorage {\n  #storage: Storage = window.localStorage;\n\n  KEYS = {\n    SETTINGS: `${plugin.id}.userSettings`,\n    GITHUB_INTEGRATION: `${plugin.id}.gitHubIntegration`,\n    PROFILES_EXPLORER: `${plugin.id}.profilesExplorer`,\n  };\n\n  has(itemName: string): boolean {\n    return this.#storage.hasOwnProperty(itemName);\n  }\n\n  get(itemName: string): null | any {\n    if (!this.has(itemName)) {\n      return null;\n    }\n\n    try {\n      return JSON.parse(this.#storage.getItem(itemName) as string);\n    } catch (error) {\n      logger.error(error as Error, { info: `Error parsing JSON for storage item \"${itemName}\"!` });\n      return null;\n    }\n  }\n\n  set(itemName: string, value: any): void {\n    try {\n      this.#storage.setItem(itemName, JSON.stringify(value));\n    } catch (error) {\n      logger.error(error as Error, { info: `Error setting storage item \"${itemName}\"!` });\n    }\n  }\n}\n\nexport const userStorage = new UserStorage();\n","export const noOp = () => {};\n","export class HttpClientError extends Error {\n  response: Response;\n  reason?: any;\n\n  constructor(response: Response, responseJson?: Record<string, any>) {\n    let message = `HTTP ${response.status} (${response.statusText || '?'})`;\n\n    if (responseJson?.message) {\n      message = `${message} → ${responseJson.message}`;\n    }\n\n    super(message);\n\n    this.response = response;\n  }\n}\n","import { noOp } from '@shared/domain/noOp';\n\nimport { HttpClientError } from './HttpClientError';\n\nexport class HttpClient {\n  baseUrl = '';\n  defaultHeaders = {};\n  abortController?: AbortController | null = null;\n\n  constructor(baseUrl: string, defaultHeaders: Record<string, string> = {}) {\n    this.baseUrl = baseUrl;\n    this.defaultHeaders = Object.freeze(defaultHeaders);\n  }\n\n  async fetch(pathname: string, options?: RequestInit) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n\n    const fullUrl = `${this.baseUrl}${pathname}`;\n    const headers = { ...this.defaultHeaders, ...options?.headers };\n    const fullOptions = {\n      signal, // we allow signal to be passed as an option\n      ...options,\n      headers,\n    };\n\n    let response;\n\n    try {\n      response = await fetch(fullUrl, fullOptions);\n\n      if (!response.ok) {\n        throw new HttpClientError(response, await response.json().catch(noOp));\n      }\n    } catch (error) {\n      if (this.isAbortError(error)) {\n        (error as any).reason = options?.signal?.reason || signal.reason;\n      }\n\n      throw error;\n    } finally {\n      this.abortController = null;\n    }\n\n    return response;\n  }\n\n  abort(reason?: any) {\n    if (this.abortController) {\n      this.abortController.abort(reason);\n    }\n  }\n\n  isAbortError(error: unknown) {\n    return error instanceof DOMException && error.name === 'AbortError';\n  }\n}\n","import { DataSourceInstanceSettings, DataSourceJsonData } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { logger } from '../tracking/logger';\nimport { userStorage } from '../userStorage';\nimport { HttpClient } from './HttpClient';\n\nconst PYROSCOPE_DATA_SOURCES_TYPE = 'grafana-pyroscope-datasource';\nconst PYROSCOPE_URL_SEARCH_PARAM_NAME = 'var-dataSource'; // matches with the Scenes library\n\ntype CustomDataSourceJsonData = { overridesDefault: boolean };\ntype CustomDataSourceInstanceSettings = DataSourceInstanceSettings<DataSourceJsonData & CustomDataSourceJsonData>;\n\n/**\n * An HTTP client ready to fetch data from the plugin's backend\n */\nexport class ApiClient extends HttpClient {\n  static getPyroscopeDataSources() {\n    return Object.values(config.datasources).filter((ds) => ds.type === PYROSCOPE_DATA_SOURCES_TYPE);\n  }\n\n  static selectDefaultDataSource() {\n    const pyroscopeDataSources = ApiClient.getPyroscopeDataSources() as CustomDataSourceInstanceSettings[];\n\n    const uidFromUrl = new URL(window.location.href).searchParams.get(PYROSCOPE_URL_SEARCH_PARAM_NAME);\n    const uidFromLocalStorage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER)?.dataSource;\n\n    const defaultDataSource =\n      pyroscopeDataSources.find((ds) => ds.uid === uidFromUrl) ||\n      pyroscopeDataSources.find((ds) => ds.uid === uidFromLocalStorage) ||\n      pyroscopeDataSources.find((ds) => ds.jsonData.overridesDefault) ||\n      pyroscopeDataSources.find((ds) => ds.isDefault) ||\n      pyroscopeDataSources[0];\n\n    if (!defaultDataSource) {\n      logger.warn(\n        'Cannot find any Pyroscope data source! Please add and configure a Pyroscope data source to your Grafana instance.'\n      );\n\n      // because we instantiate most of our API clients before exporting them,\n      // we have to return a dummy data source to prevent the whole app to fail\n      return { uid: 'no-data-source-configured' };\n    }\n\n    return defaultDataSource;\n  }\n\n  static getBaseUrl() {\n    const pyroscopeDataSource = ApiClient.selectDefaultDataSource();\n\n    let appSubUrl = config.appSubUrl || '';\n    if (appSubUrl.at(-1) !== '/') {\n      // ensures that the API pathname is appended correctly (appUrl seems to always have it but better to be extra careful)\n      appSubUrl += '/';\n    }\n\n    return `${appSubUrl}api/datasources/proxy/uid/${pyroscopeDataSource.uid}`;\n  }\n\n  constructor() {\n    super(ApiClient.getBaseUrl().toString(), {\n      'content-type': 'application/json',\n      'X-Grafana-Org-Id': String(config.bootData?.user?.orgId || ''),\n    });\n  }\n}\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\n\nexport type Stats = {\n  hasIngestedData: boolean;\n  oldestProfileTime: number;\n  newestProfileTime: number;\n};\n\nclass StatsApiClient extends ApiClient {\n  async get(): Promise<Stats> {\n    const response = await this.fetch('/querier.v1.QuerierService/GetProfileStats', {\n      method: 'POST',\n      body: JSON.stringify({}),\n    });\n\n    const json = await response.json();\n\n    return {\n      hasIngestedData: json.dataIngested,\n      oldestProfileTime: Number(json.oldestProfileTime),\n      newestProfileTime: Number(json.newestProfileTime),\n    };\n  }\n}\n\nexport const statsApiClient = new StatsApiClient();\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useState } from 'react';\n\nimport { useFetchTenantStats } from '../infrastructure/useFetchTenantStats';\n\nexport function useOnboarding(): DomainHookReturnValue {\n  const [isModalClosed, setIsModalClosed] = useState(false);\n\n  const pyroscopeDataSourcesCount = ApiClient.getPyroscopeDataSources().length;\n  const { isFetching, error, stats } = useFetchTenantStats({ enabled: pyroscopeDataSourcesCount > 0 });\n  const hasNoUserData = !isFetching && !stats?.hasIngestedData;\n\n  return {\n    data: {\n      shouldShowLoadingPage: !error && isFetching,\n      shouldShowOnboardingPage: (error || !pyroscopeDataSourcesCount || hasNoUserData) && !isModalClosed,\n      shouldShowNoDataSourceBanner: !pyroscopeDataSourcesCount,\n    },\n    actions: {\n      closeModal() {\n        setIsModalClosed(true);\n      },\n    },\n  };\n}\n","import { useQuery } from '@tanstack/react-query';\n\nimport { Stats, statsApiClient } from './statsApiClient';\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: Error | null;\n  stats?: Stats;\n  refetch: () => void;\n};\n\nexport function useFetchTenantStats({ enabled }: { enabled: boolean }): FetchResponse {\n  const { isFetching, error, data, refetch } = useQuery({\n    enabled,\n    placeholderData: () => ({ hasIngestedData: true, oldestProfileTime: 0, newestProfileTime: 0 }),\n    queryKey: ['tenant-stats'],\n    queryFn: () => {\n      statsApiClient.abort();\n\n      return statsApiClient.get();\n    },\n  });\n\n  return {\n    isFetching,\n    error: statsApiClient.isAbortError(error) ? null : error,\n    stats: data,\n    refetch,\n  };\n}\n","import { css } from '@emotion/css';\nimport { formattedValueToString, getValueFormat, GrafanaTheme2 } from '@grafana/data';\nimport { Divider, IconButton, styleMixins, Toggletip, useStyles2 } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { QueryAnalysisResult } from './domain/QueryAnalysis';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  row: css({\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'flex-start',\n  }),\n  headerColumn: css({\n    display: 'flex',\n    flexDirection: 'column',\n    minWidth: '120px',\n    alignItems: 'start',\n  }),\n  column: css({\n    display: 'flex',\n    flexDirection: 'column',\n    minWidth: '120px',\n    alignItems: 'end',\n  }),\n  tooltip: css({\n    display: 'flex',\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n  contentWithIcon: css({\n    display: 'none',\n\n    [`@media ${styleMixins.mediaUp(theme.v1.breakpoints.sm)}`]: {\n      display: 'block',\n    },\n  }),\n});\n\ntype QueryAnalysisTooltipProps = {\n  data: QueryAnalysisResult;\n};\n\nconst formatSize = (size: number) => formattedValueToString(getValueFormat('decbytes')(size));\n\nconst formatCount = (count: number) => formattedValueToString(getValueFormat('short')(count));\n\nexport function QueryAnalysisTooltip(props: QueryAnalysisTooltipProps) {\n  const styles = useStyles2(getStyles);\n  const { data } = props;\n  const totalBytesInTimeRange = formatSize(data.queryImpact.totalBytesInTimeRange);\n\n  const queryAnalysisTooltip = useMemo(() => {\n    return (\n      <div data-testid=\"queryAnalysis-popup\">\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Data in time range</div>\n          <div className={styles.column}>{totalBytesInTimeRange}</div>\n          <div className={styles.column}>&nbsp;</div>\n        </div>\n        {data.queryImpact.totalQueriedSeries !== undefined && (\n          <div className={styles.row}>\n            <div className={styles.headerColumn}>Series in query</div>\n            <div className={styles.column}>{formatCount(data.queryImpact.totalQueriedSeries)}</div>\n            <div className={styles.column}>&nbsp;</div>\n          </div>\n        )}\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Deduplication</div>\n          <div className={styles.column}>{data.queryImpact.deduplicationNeeded ? 'yes' : 'no'}</div>\n          <div className={styles.column}>&nbsp;</div>\n        </div>\n        <Divider />\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>&nbsp;</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              <strong>{s.componentType}</strong>\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Replicas</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {s.componentCount || '/'}\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Blocks</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {formatCount(s.blockCount) || '/'}\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Series</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {formatCount(s.seriesCount) || '/'}\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Profiles</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {formatCount(s.profileCount) || '/'}\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Samples</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {formatCount(s.sampleCount) || '/'}\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>&nbsp;</div>\n          <div className={styles.column}>&nbsp;</div>\n          <div className={styles.column}>&nbsp;</div>\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Index Store</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {formatSize(s.indexBytes) || '/'}\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Profiles Store</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {formatSize(s.profileBytes) || '/'}\n            </div>\n          ))}\n        </div>\n        <div className={styles.row}>\n          <div className={styles.headerColumn}>Symbols Store</div>\n          {data.queryScopes.map((s, i) => (\n            <div key={i} className={styles.column}>\n              {formatSize(s.symbolBytes) || '/'}\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }, [data, styles, totalBytesInTimeRange]);\n\n  return (\n    <>\n      {data.queryImpact.totalBytesInTimeRange !== undefined ? (\n        <Toggletip content={queryAnalysisTooltip} fitContent={true}>\n          <div className={styles.tooltip} data-testid=\"queryAnalysis-tooltip\">\n            <span className={styles.contentWithIcon}>Stored data in time range: {totalBytesInTimeRange}</span>\n            &nbsp;\n            <IconButton name=\"database\" aria-label=\"Query info\" />\n          </div>\n        </Toggletip>\n      ) : null}\n    </>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype PyroscopeLogoProps = {\n  size: 'small' | 'large';\n};\n\nfunction PyroscopeLogoComponent({ size }: PyroscopeLogoProps) {\n  const styles = useStyles2(getStyles);\n  return <img className={cx(styles.logo, size)} src=\"public/plugins/grafana-pyroscope-app/img/logo.svg\" />;\n}\n\nexport const PyroscopeLogo = React.memo(PyroscopeLogoComponent);\n\nconst getStyles = () => ({\n  logo: css`\n    &.small {\n      width: 16px;\n      height: 16px;\n      margin-right: 4px;\n      position: relative;\n      top: -2px;\n    }\n\n    &.large {\n      width: 40px;\n      height: 40px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, usePluginContext } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Dropdown, IconButton, Menu, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GIT_COMMIT } from '../../version';\nimport { PyroscopeLogo } from './PyroscopeLogo';\n\nconst pluginCommitSha: string = GIT_COMMIT;\nconst pluginCommitURL = `https://github.com/grafana/profiles-drilldown/commit/${pluginCommitSha}`;\n\nconst { buildInfo: grafanaBuildInfo } = config;\n\nfunction InfoMenuHeader() {\n  const styles = useStyles2(getStyles);\n\n  const {\n    meta: {\n      info: { version, updated },\n    },\n  } = usePluginContext() || { meta: { info: { version: '?.?.?', updated: '?' } } };\n\n  return (\n    <div className={styles.menuHeader}>\n      <h5>\n        <PyroscopeLogo size=\"small\" />\n        Grafana Profiles Drilldown v{version}\n      </h5>\n      <div className={styles.subTitle}>Last update: {updated}</div>\n    </div>\n  );\n}\n\nfunction InfoMenu() {\n  const isDev = pluginCommitSha === 'dev';\n  const shortCommitSha = isDev ? pluginCommitSha : pluginCommitSha.slice(0, 8);\n\n  return (\n    <Menu header={<InfoMenuHeader />}>\n      <Menu.Item\n        label={`Commit SHA: ${shortCommitSha}`}\n        icon=\"github\"\n        onClick={() => window.open(pluginCommitURL)}\n        disabled={isDev}\n      />\n      <Menu.Item\n        label=\"Changelog\"\n        icon=\"list-ul\"\n        onClick={() => window.open('https://github.com/grafana/profiles-drilldown/blob/main/CHANGELOG.md')}\n      />\n      <Menu.Item\n        label=\"Contribute\"\n        icon=\"external-link-alt\"\n        onClick={() => window.open('https://github.com/grafana/profiles-drilldown/blob/main/docs/CONTRIBUTING.md')}\n      />\n      <Menu.Item\n        label=\"Documentation\"\n        icon=\"document-info\"\n        onClick={() => window.open('https://grafana.com/docs/grafana/latest/explore/simplified-exploration/profiles')}\n      />\n      <Menu.Item\n        label=\"Report an issue\"\n        icon=\"bug\"\n        onClick={() => window.open('https://github.com/grafana/profiles-drilldown/issues/new?template=bug_report.md')}\n      />\n      <Menu.Divider />\n      <Menu.Item\n        label={`Grafana ${grafanaBuildInfo.edition} v${grafanaBuildInfo.version} (${grafanaBuildInfo.env})`}\n        icon=\"github\"\n        onClick={() => window.open(`https://github.com/grafana/grafana/commit/${grafanaBuildInfo.commit}`)}\n      />\n    </Menu>\n  );\n}\n\nexport function PluginInfo() {\n  return (\n    <Dropdown overlay={() => <InfoMenu />} placement=\"bottom-end\">\n      <IconButton name=\"info-circle\" aria-label=\"Plugin info\" title=\"Plugin info\" />\n    </Dropdown>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  menuHeader: css`\n    padding: ${theme.spacing(0.5, 1)};\n    white-space: nowrap;\n  `,\n  subTitle: css`\n    color: ${theme.colors.text.secondary};\n    font-size: ${theme.typography.bodySmall.fontSize};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Stack, useStyles2 } from '@grafana/ui';\nimport { QueryAnalysisResult } from '@shared/components/QueryAnalysisTooltip/domain/QueryAnalysis';\nimport { QueryAnalysisTooltip } from '@shared/components/QueryAnalysisTooltip/QueryAnalysisTooltip';\nimport React, { memo, ReactNode } from 'react';\nimport { Helmet } from 'react-helmet';\n\nimport { PluginInfo } from './PluginInfo';\nimport { PyroscopeLogo } from './PyroscopeLogo';\n\ntype PageTitleProps = {\n  title: ReactNode;\n  queryAnalysis?: QueryAnalysisResult;\n};\n\nfunction PageTitleComponent({ title, queryAnalysis }: PageTitleProps) {\n  const styles = useStyles2(getStyles);\n  const fullTitle = typeof title === 'string' ? `${title} | Pyroscope` : 'Pyroscope';\n\n  return (\n    <>\n      <Helmet>\n        <title>{fullTitle}</title>\n      </Helmet>\n      <div className={styles.titleContainer}>\n        <Stack justifyContent=\"space-between\">\n          <div>\n            <PyroscopeLogo size=\"large\" />\n            <h1 className={styles.title} data-testid=\"page-title\">\n              {title}\n            </h1>\n          </div>\n          <div className={styles.infoArea}>\n            <PluginInfo />\n            {queryAnalysis ? <QueryAnalysisTooltip data={queryAnalysis} /> : null}\n          </div>\n        </Stack>\n      </div>\n    </>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  titleContainer: css`\n    height: ${theme.spacing(5)};\n    line-height: ${theme.spacing(5)};\n    margin-bottom: ${theme.spacing(3)};\n  `,\n  title: css`\n    font-size: ${theme.typography.h2.fontSize};\n    display: inline-block;\n    margin: 0;\n    position: relative;\n    top: 10px;\n    left: ${theme.spacing(1)};\n  `,\n  infoArea: css`\n    align-self: end;\n    margin-bottom: 0;\n    line-height: 20px;\n    text-align: right;\n  `,\n});\n\nexport const PageTitle = memo(PageTitleComponent);\n","import { PageLayoutType } from '@grafana/data';\nimport { PluginPage } from '@grafana/runtime';\nimport { Icon } from '@grafana/ui';\nimport { PageTitle } from '@shared/ui/PageTitle';\nimport React from 'react';\n\nexport function EmptyLoadingPage() {\n  return (\n    <PluginPage layout={PageLayoutType.Canvas}>\n      <PageTitle\n        title={\n          <span>\n            Loading... <Icon name=\"fa fa-spinner\" />\n          </span>\n        }\n      />\n    </PluginPage>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  link: css`\n    color: ${theme.colors.text.link};\n    &:hover {\n      text-decoration: underline;\n    }\n  `,\n});\n\nexport function StyledLink({ href, children }: { href: string; children: React.ReactNode }) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <a className={styles.link} href={href} target=\"_blank\" rel=\"noreferrer\">\n      {children} {<Icon name=\"external-link-alt\" />}\n    </a>\n  );\n}\n","import { PageLayoutType } from '@grafana/data';\nimport { PluginPage } from '@grafana/runtime';\nimport { Alert } from '@grafana/ui';\nimport { PageTitle } from '@shared/ui/PageTitle';\nimport React from 'react';\n\nimport { StyledLink } from './StyledLink';\n\nexport function NoDataSourcePage() {\n  return (\n    <PluginPage layout={PageLayoutType.Canvas}>\n      <PageTitle title=\"Grafana Profiles Drilldown\" />\n\n      <Alert severity=\"error\" title=\"Missing Pyroscope data source!\">\n        This plugin requires a Pyroscope data source. Please{' '}\n        <StyledLink href=\"/connections/datasources/new\">add and configure a Pyroscope data source</StyledLink> to your\n        Grafana instance.\n      </Alert>\n    </PluginPage>\n  );\n}\n","import { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useState } from 'react';\n\nimport { useFetchInstances } from '../infrastructure/useFetchInstances';\n\nexport function useOnboardingModal(): DomainHookReturnValue {\n  const { instances } = useFetchInstances();\n\n  const [settingsUrl, setSettingsUrl] = useState('https://grafana.com/auth/sign-in/');\n  const isCloud = /grafana(-dev|-ops)?\\.net/.test(window.location.host);\n\n  if (instances && instances.orgSlug && instances.hpInstanceId) {\n    const newSettingsUrl = `https://grafana.com/orgs/${instances.orgSlug}/hosted-profiles/${instances.hpInstanceId}`;\n\n    if (settingsUrl !== newSettingsUrl) {\n      setSettingsUrl(newSettingsUrl);\n    }\n  }\n\n  return {\n    data: {\n      settingsUrl,\n      isCloud,\n    },\n    actions: {},\n  };\n}\n","import { useQuery } from '@tanstack/react-query';\n\nexport function useFetchInstances() {\n  const { isFetching, error, data } = useQuery({\n    queryKey: ['instances'],\n    queryFn: () =>\n      fetch('/api/plugin-proxy/cloud-home-app/grafanacom-api/instances').then((response) => response.json()),\n  });\n\n  return {\n    isFetching,\n    error,\n    instances: data,\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport DecreaseLatency from '@img/decrease-latency.png';\nimport HeroImage from '@img/hero-image.png';\nimport ReduceCosts from '@img/reduce-costs.png';\nimport ResolveIncidents from '@img/resolve-incidents.png';\nimport React from 'react';\n\nimport { useOnboardingModal } from '../domain/useOnboardingModal';\nimport { StyledLink } from './StyledLink';\n\n/** This was extracted from the former `styles.module.scss` */\n// TODO Use more spacial and color parameters from `theme`\nconst getStyles = (theme: GrafanaTheme2) => ({\n  onboardingRow: css`\n    background: ${theme.colors.background.secondary};\n    display: flex;\n    margin-top: 16px;\n    gap: 20px;\n    padding: 20px;\n    margin-bottom: 2.5rem;\n  `,\n  onboardingParagraph: css`\n    padding: 20px 64px;\n    text-align: center;\n    line-height: 2;\n    flex: 1;\n    margin: 0;\n  `,\n  onboardingPanel: css`\n    flex: 1;\n    display: flex;\n    flex-flow: column wrap;\n    -webkit-box-align: center;\n    align-items: center;\n    margin-top: 16px;\n    text-align: center;\n  `,\n  onboardingPanelHeader: css`\n    line-height: 1.5;\n    margin-bottom: 1em;\n  `,\n  onboardingPanelImage: css`\n    width: 5rem;\n    margin-bottom: 1em;\n  `,\n  hero: css`\n    display: flex;\n    flex-direction: row;\n  `,\n  heroTitles: css`\n    flex: 1;\n  `,\n  heroImage: css`\n    width: 40%;\n    margin-left: 16px;\n    margin-top: 16px;\n    margin-bottom: 16px;\n    border-radius: 3px;\n  `,\n  onboardingPanelNumber: css`\n    color: rgb(236, 109, 19);\n    text-align: center;\n    display: grid;\n    place-items: center;\n    background-image: linear-gradient(135deg, currentcolor, 75%, rgb(204, 204, 220));\n    border-radius: 100%;\n    font-size: 2.5rem;\n    line-height: 5rem;\n    height: 5rem;\n    width: 5rem;\n    margin-bottom: 1em;\n  `,\n  // TODO use theme.colors\n  color2: css`\n    color: rgb(190, 85, 190);\n  `,\n  // TODO use theme.colors\n  color3: css`\n    color: rgb(126, 108, 218);\n  `,\n  // FIXME use theme.colors\n  onboardingPanelNumberSpan: css`\n    color: rgb(220, 220, 220);\n  `,\n  onboardingPanelDescription: css`\n    text-align: justify;\n    text-align: center;\n    line-height: 1.66;\n    margin-top: 0;\n  `,\n  title: css`\n    margin-bottom: 0.5em;\n    line-height: 1.5;\n  `,\n  subtitle: css`\n    margin-bottom: 1em;\n    line-height: 1.5;\n    font-size: 1.25rem;\n  `,\n});\n\nexport function OnboardingModal() {\n  const styles = useStyles2(getStyles);\n  const { data } = useOnboardingModal();\n\n  return (\n    <div data-testid=\"onboarding-modal\">\n      <div className={styles.hero} data-testid=\"hero\">\n        <div className={styles.heroTitles}>\n          <h1 className={styles.title}>Welcome to Grafana Profiles Drilldown</h1>\n          <h2 className={styles.subtitle}>\n            Optimize infrastructure spend, simplify debugging, and enhance application performance\n          </h2>\n          {/* <Button>Continue to Pyroscope</Button> */}\n        </div>\n        <img src={HeroImage} className={styles.heroImage}></img>\n      </div>\n\n      <div data-testid=\"what-you-can-do\">\n        <h3>What You Can Do</h3>\n        <div className={styles.onboardingRow}>\n          <div className={styles.onboardingPanel}>\n            <img className={styles.onboardingPanelImage} src={ReduceCosts}></img>\n            <h3 className={styles.onboardingPanelHeader}>Reduce Costs</h3>\n            <p className={styles.onboardingPanelDescription}>\n              Spot CPU spikes, memory leaks, and other inefficiencies with code-level visibility into resource usage.\n              Teams can then optimize their code and lower infrastructure costs.\n            </p>\n          </div>\n          <div className={styles.onboardingPanel}>\n            <img className={styles.onboardingPanelImage} src={DecreaseLatency}></img>\n            <h3 className={styles.onboardingPanelHeader}>Decrease Latency</h3>\n            <p className={styles.onboardingPanelDescription}>\n              Maintain high speed and efficiency and improve application performance. In a competitive digital world,\n              decreasing latency translates to increasing revenue.\n            </p>\n          </div>\n          <div className={styles.onboardingPanel}>\n            <img className={styles.onboardingPanelImage} src={ResolveIncidents}></img>\n            <h3 className={styles.onboardingPanelHeader}>Resolve Incidents Faster</h3>\n            <p className={styles.onboardingPanelDescription}>\n              Cut down the mean time to resolution (MTTR) by correlating continuous profiling data with metrics, logs,\n              and traces to quickly identify the root cause of any issue.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div data-testid=\"how-to-get-started\">\n        <h3>How to Get Started</h3>\n        <div className={styles.onboardingRow}>\n          {data.isCloud ? (\n            <>\n              <div className={styles.onboardingPanel}>\n                <div className={styles.onboardingPanelNumber}>\n                  <span className={styles.onboardingPanelNumberSpan}>1</span>\n                </div>\n                <h3 className={styles.onboardingPanelHeader}>Add Profiling to Your Application</h3>\n                <p className={styles.onboardingPanelDescription}>\n                  Use{' '}\n                  <StyledLink href=\"https://grafana.com/docs/pyroscope/latest/configure-client/grafana-alloy/\">\n                    Grafana Alloy\n                  </StyledLink>{' '}\n                  or{' '}\n                  <StyledLink href=\"https://grafana.com/docs/pyroscope/next/configure-client/language-sdks/\">\n                    Pyroscope SDKs\n                  </StyledLink>{' '}\n                  to push profiles from your applications to Grafana Cloud.\n                </p>\n              </div>\n              <div className={styles.onboardingPanel}>\n                <div className={cx(styles.onboardingPanelNumber, styles.color2)}>\n                  <span className={styles.onboardingPanelNumberSpan}>2</span>\n                </div>\n                <h3 className={styles.onboardingPanelHeader}>Configure Your Applications</h3>\n                <p className={styles.onboardingPanelDescription}>\n                  Go to <StyledLink href={data.settingsUrl}>Grafana Cloud Stack settings</StyledLink> to find your\n                  Grafana Cloud Credentials.\n                </p>\n              </div>\n              <div className={styles.onboardingPanel}>\n                <div className={cx(styles.onboardingPanelNumber, styles.color3)}>\n                  <span className={styles.onboardingPanelNumberSpan}>3</span>\n                </div>\n                <h3 className={styles.onboardingPanelHeader}>Start Getting Performance Insights</h3>\n                <p className={styles.onboardingPanelDescription}>\n                  Once you&apos;re done with initial setup, refresh this page to see your profiling data.\n                </p>\n              </div>\n            </>\n          ) : (\n            <>\n              <div className={styles.onboardingPanel}>\n                <div className={styles.onboardingPanelNumber}>\n                  <span className={styles.onboardingPanelNumberSpan}>1</span>\n                </div>\n                <h3 className={styles.onboardingPanelHeader}>Set Up Your Pyroscope Server</h3>\n                <p className={styles.onboardingPanelDescription}>\n                  Install <StyledLink href=\"https://grafana.com/docs/pyroscope/latest/\">Pyroscope Server</StyledLink> on\n                  your infrastructure. Or if you want to use a hosted service, go to{' '}\n                  <StyledLink href={data.settingsUrl}>Grafana Cloud Stack settings</StyledLink> to find your Grafana\n                  Cloud Credentials.\n                </p>\n              </div>\n              <div className={styles.onboardingPanel}>\n                <div className={cx(styles.onboardingPanelNumber, styles.color2)}>\n                  <span className={styles.onboardingPanelNumberSpan}>2</span>\n                </div>\n                <h3 className={styles.onboardingPanelHeader}>Configure Grafana</h3>\n                <p className={styles.onboardingPanelDescription}>\n                  Add a new <StyledLink href=\"/connections/datasources/new\">Pyroscope datasource</StyledLink>. Use your\n                  Pyroscope server URL and appropriate security credentials if you use Grafana Cloud Profiles.\n                </p>\n              </div>\n              <div className={styles.onboardingPanel}>\n                <div className={cx(styles.onboardingPanelNumber, styles.color3)}>\n                  <span className={styles.onboardingPanelNumberSpan}>3</span>\n                </div>\n                <h3 className={styles.onboardingPanelHeader}>Add Profiling to Your Application</h3>\n                <p className={styles.onboardingPanelDescription}>\n                  Use{' '}\n                  <StyledLink href=\"https://grafana.com/docs/pyroscope/latest/configure-client/grafana-alloy/\">\n                    Grafana Alloy\n                  </StyledLink>{' '}\n                  or{' '}\n                  <StyledLink href=\"https://grafana.com/docs/pyroscope/next/configure-client/language-sdks/\">\n                    Pyroscope SDKs\n                  </StyledLink>{' '}\n                  to push profiles from your applications to Grafana Cloud.\n                </p>\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n\n      {data.isCloud && (\n        <div data-testid=\"how-billing-works\">\n          <h3>How Billing Works</h3>\n          <div className={styles.onboardingRow}>\n            <p className={styles.onboardingParagraph}>\n              Usage of Grafana Cloud Profiles is subject to{' '}\n              <StyledLink href=\"https://grafana.com/pricing/\">Grafana Cloud Pricing</StyledLink> for Profiles.\n              <br></br>\n              For additional information, read the announcement&nbsp;\n              <StyledLink href=\"https://grafana.com/blog/2023/08/09/grafana-cloud-profiles-for-continuous-profiling/\">\n                blog post\n              </StyledLink>\n              .\n            </p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, PageLayoutType } from '@grafana/data';\nimport { PluginPage } from '@grafana/runtime';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { OnboardingModal } from './OnboardingModal';\n\ntype OnboardingPageProps = {\n  onCloseModal: () => void;\n};\n\n/** This was extracted from the former `styles.module.scss` */\n// TODO Use more spacial and color parameters from `theme`\nconst getStyles = (theme: GrafanaTheme2) => ({\n  onboardingPage: css`\n    padding: 16px;\n    margin: 64px;\n    position: relative;\n    background-color: ${theme.colors.background.primary};\n  `,\n  closeButton: css`\n    position: absolute;\n    top: -30px;\n    opacity: 0.8;\n    right: -32px;\n    border: none;\n    border-radius: 50%;\n    width: 40px;\n    height: 40px;\n    line-height: 40px;\n    display: block;\n    padding: 0;\n    margin: 0;\n    font-size: 22px;\n  `,\n});\n\nconst pageNav = { text: 'Onboarding' };\n\nexport function OnboardingPage({ onCloseModal }: OnboardingPageProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    // The use of `PluginPage` is to set a clear \"Onboarding\" breadcrumb\n    // Using `Custom` ensures that it takes up the whole page (and doesn't conflict with the other `PluginPage`)\n    <PluginPage pageNav={pageNav} layout={PageLayoutType.Custom}>\n      <div className={styles.onboardingPage}>\n        <button\n          className={styles.closeButton}\n          onClick={onCloseModal}\n          title=\"Close\"\n          data-testid=\"close-onboarding-modal\"\n        >\n          &times;\n        </button>\n        <OnboardingModal />\n      </div>\n    </PluginPage>\n  );\n}\n","import React from 'react';\n\nimport { useOnboarding } from './domain/useOnboarding';\nimport { EmptyLoadingPage } from './ui/EmptyLoadingPage';\nimport { NoDataSourcePage } from './ui/NoDataSourcePage';\nimport { OnboardingPage } from './ui/OnboardingPage';\n\ntype OnboardingProps = {\n  children: React.ReactNode;\n};\n\n/**\n * Displays an onboarding dialog instructing how to push data only when data is not present\n */\nexport function Onboarding({ children }: OnboardingProps) {\n  const { data, actions } = useOnboarding();\n\n  if (data.shouldShowLoadingPage) {\n    return <EmptyLoadingPage />;\n  }\n\n  if (data.shouldShowOnboardingPage) {\n    return <OnboardingPage onCloseModal={actions.closeModal} />;\n  }\n\n  if (data.shouldShowNoDataSourceBanner) {\n    return <NoDataSourcePage />;\n  }\n\n  return <>{children}</>;\n}\n","import { Button } from '@grafana/ui';\nimport React from 'react';\n\nexport function BackButton({ onClick }: { onClick?: () => void }) {\n  const callback = onClick ? onClick : () => history.back();\n  return (\n    <Button variant=\"secondary\" onClick={callback} aria-label=\"Back to Profiles Drilldown\">\n      Back to Profiles Drilldown\n    </Button>\n  );\n}\n","import { config, reportInteraction as grafanaReportInteraction } from '@grafana/runtime';\nimport { ScaleDistribution } from '@grafana/schema';\nimport { ActionType } from 'xstate';\n\nimport { PYROSCOPE_APP_ID, ROUTES } from '../../constants';\nimport { LayoutType } from '../../pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { PanelType } from '../../pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { GIT_COMMIT } from '../../version';\n\nexport type PageName = 'explore' | 'settings' | 'ad_hoc';\n\n// hey future dev: don't forget to add any new value to our features tracking dashboard!\nexport type Interactions = {\n  g_pyroscope_app_page_initialized: {\n    page: PageName;\n  };\n\n  g_pyroscope_app_ad_hoc_file_dropped: {\n    fileType: string;\n  };\n  g_pyroscope_app_ad_hoc_file_removed: {};\n  g_pyroscope_app_ad_hoc_profile_metric_selected: {};\n  g_pyroscope_app_ad_hoc_profile: {};\n  g_pyroscope_app_compare_link_clicked: {};\n  g_pyroscope_app_diff_auto_select_clicked: {};\n  g_pyroscope_app_diff_choose_preset_clicked: {};\n  g_pyroscope_app_diff_learn_how_clicked: {};\n  g_pyroscope_app_diff_preset_save_clicked: {};\n  g_pyroscope_app_diff_preset_selected: {\n    value: string;\n  };\n  g_pyroscope_app_exclude_action_clicked: {};\n  g_pyroscope_app_explain_flamegraph_clicked: {};\n  g_pyroscope_app_exploration_type_clicked: {\n    explorationType: string;\n  };\n  g_pyroscope_app_export_profile: {\n    format: 'png' | 'json' | 'pprof' | 'flamegraph.com';\n  };\n  g_pyroscope_app_fav_action_clicked: {\n    favAfterClick: boolean;\n  };\n  g_pyroscope_app_filters_changed: {\n    name: string;\n    count: number;\n    operators: string[];\n  };\n  g_pyroscope_app_function_details_clicked: {};\n  g_pyroscope_app_group_by_label_clicked: {};\n  g_pyroscope_app_hide_no_data_changed: {\n    hideNoData: 'on' | 'off';\n  };\n  g_pyroscope_app_include_action_clicked: {};\n  g_pyroscope_app_layout_changed: {\n    layout: LayoutType;\n  };\n  g_pyroscope_app_open_in_explore_clicked: {};\n  g_pyroscope_app_open_recording_rules_view: {};\n  g_pyroscope_app_optimize_code_clicked: {};\n  g_pyroscope_app_panel_type_changed: {\n    panelType: PanelType;\n  };\n  g_pyroscope_app_profile_metric_selected: {};\n  g_pyroscope_app_quick_filter_focused: {};\n  g_pyroscope_app_select_action_clicked: {\n    type: ActionType;\n  };\n  g_pyroscope_app_service_name_selected: {};\n  g_pyroscope_app_share_link_clicked: {};\n  g_pyroscope_app_timeseries_scale_changed: {\n    scale: ScaleDistribution;\n  };\n  g_pyroscope_app_upload_ad_hoc_clicked: {};\n  g_pyroscope_app_user_settings_clicked: {};\n};\n\nconst PROFILES_EXPLORER_PAGE_NAME = ROUTES.EXPLORE.slice(1);\n\nfunction getCurrentPage(): string {\n  const { pathname } = new URL(window.location.toString());\n  return pathname.split('/').pop() || '';\n}\n\nfunction getMetaProperties() {\n  const meta: Record<string, any> = {\n    // same naming as Faro (see src/shared/infrastructure/tracking/faro/faro.ts)\n    appRelease: config.apps[PYROSCOPE_APP_ID].version,\n    appVersion: GIT_COMMIT,\n    page: getCurrentPage(),\n  };\n\n  if (meta.page === PROFILES_EXPLORER_PAGE_NAME) {\n    // same naming as Faro (see src/shared/infrastructure/tracking/faro/faro.ts)\n    meta.view = new URLSearchParams(window.location.search).get('explorationType') || '';\n  }\n\n  return meta;\n}\n\nexport function reportInteraction<E extends keyof Interactions, P extends Interactions[E]>(\n  interactionName: E,\n  props?: P\n) {\n  grafanaReportInteraction(interactionName, {\n    props,\n    meta: getMetaProperties(),\n  });\n}\n","import { PageName, reportInteraction } from '@shared/domain/reportInteraction';\nimport { useEffect, useState } from 'react';\n\nexport function useReportPageInitialized(page: PageName) {\n  const [initialized, setInitialized] = useState(false);\n  useEffect(() => {\n    if (!initialized) {\n      setInitialized(true);\n      reportInteraction('g_pyroscope_app_page_initialized', { page });\n    }\n  }, [page, initialized]);\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    gap: ${theme.spacing(1)};\n    width: 100%;\n  `,\n  column: css`\n    width: 50%;\n  `,\n});\n\ntype AdHocColumnsProps = {\n  left: React.ReactNode;\n  right: React.ReactNode;\n};\n\nexport function AdHocColumns({ left, right }: AdHocColumnsProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.column}>{left}</div>\n      <div className={styles.column}>{right}</div>\n    </div>\n  );\n}\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nexport function displayError(error: Error, msgs: string[]) {\n  const context = msgs.reduce((acc, msg, i) => ({ ...acc, [`info${i + 1}`]: msg }), { handheldBy: 'displayError' });\n\n  logger.error(error, context);\n\n  getAppEvents().publish({\n    type: AppEvents.alertError.name,\n    payload: msgs,\n  });\n}\n\nexport function displayWarning(msgs: string[]) {\n  logger.warn(msgs);\n\n  getAppEvents().publish({\n    type: AppEvents.alertWarning.name,\n    payload: msgs,\n  });\n}\n\nexport function displaySuccess(msgs: string[]) {\n  getAppEvents().publish({\n    type: AppEvents.alertSuccess.name,\n    payload: msgs,\n  });\n}\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\n\nimport { AdHocProfile } from '../domain/AdHocProfile';\nimport { stripBase64Prefix } from './helpers/stripBase64Prefix';\n\nclass AdHocProfileClient extends ApiClient {\n  async get(profileId: string, profileType: string): Promise<AdHocProfile> {\n    const response = await this.fetch('/adhocprofiles.v1.AdHocProfileService/Get', {\n      method: 'POST',\n      body: JSON.stringify({\n        id: profileId,\n        profile_type: profileType,\n      }),\n    });\n\n    const json = await response.json();\n\n    return {\n      id: json.id,\n      name: json.name,\n      profileTypes: json.profileTypes,\n      profile: JSON.parse(json.flamebearerProfile),\n    };\n  }\n\n  async uploadSingle(file: File): Promise<AdHocProfile> {\n    const profile = await this._readProfileFile(file);\n\n    const response = await this.fetch('/adhocprofiles.v1.AdHocProfileService/Upload', {\n      method: 'POST',\n      body: JSON.stringify({\n        name: file.name,\n        profile,\n      }),\n    });\n\n    const json = await response.json();\n\n    return {\n      id: json.id,\n      name: file.name,\n      profileTypes: json.profileTypes,\n      // when the uploaded file contains multiple sample types, the 1st is always returned by the API\n      profile: JSON.parse(json.flamebearerProfile),\n    };\n  }\n\n  // TODO\n  async uploadDiff() {\n    return {\n      id: '?',\n      name: '??',\n      profileTypes: [],\n      profile: null,\n    };\n  }\n\n  async _readProfileFile(file: File): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const fileReader = new FileReader();\n\n      fileReader.addEventListener('load', () => {\n        try {\n          resolve(stripBase64Prefix(fileReader.result as string));\n        } catch (error) {\n          reject(error);\n        }\n      });\n\n      fileReader.addEventListener('error', (/*event: ProgressEvent<FileReader>*/) => {\n        // TODO: upgrade TS lib compiler option to support latest JS features\n        // See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error/cause\n        reject(new Error(`Error while reading file \"${file.name}\"!` /*, { cause: event }*/));\n      });\n\n      fileReader.readAsDataURL(file);\n    });\n  }\n}\n\nexport const adHocProfileClient = new AdHocProfileClient();\n","export function stripBase64Prefix(fileContent: string): string {\n  const [, base64Content] = fileContent.split(';base64,');\n\n  if (!base64Content) {\n    throw new Error('No content after stripping the base64 prefix.');\n  }\n\n  if (fileContent === base64Content) {\n    throw new Error('No base64 prefix?!');\n  }\n\n  return base64Content;\n}\n","import { SelectableValue } from '@grafana/data';\nimport { displayError } from '@shared/domain/displayStatus';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { adHocProfileClient } from '../infrastructure/adHocProfileClient';\nimport { AdHocProfile } from './AdHocProfile';\n\nconst DEFAULT_PROFILE_DATA: AdHocProfile = {\n  id: '',\n  name: '',\n  profileTypes: [],\n  profile: null,\n};\n\nexport function useUploadFile() {\n  const [isLoading, setIsLoading] = useState(false);\n  const [profileData, setProfileData] = useState(DEFAULT_PROFILE_DATA);\n\n  useEffect(() => {\n    return () => {\n      adHocProfileClient.abort();\n    };\n  }, []);\n\n  const removeFile = useCallback(() => {\n    adHocProfileClient.abort();\n\n    setIsLoading(false);\n    setProfileData(DEFAULT_PROFILE_DATA);\n  }, []);\n\n  const processFile = useCallback(\n    async (file: File) => {\n      removeFile();\n\n      try {\n        setIsLoading(true);\n\n        const data = await adHocProfileClient.uploadSingle(file);\n\n        setProfileData(data);\n      } catch (error) {\n        setProfileData(DEFAULT_PROFILE_DATA);\n\n        if (!adHocProfileClient.isAbortError(error)) {\n          displayError(error as Error, ['Error while uploading profile!', (error as Error).message]);\n        }\n      }\n\n      setIsLoading(false);\n    },\n    [removeFile]\n  );\n\n  const removeProfile = () => {\n    adHocProfileClient.abort();\n\n    setIsLoading(false);\n    setProfileData((prevData) => ({ ...prevData, profile: null }));\n  };\n\n  const selectProfileType = useCallback(\n    async (option: SelectableValue<string>) => {\n      const profileType = option.value;\n\n      if (!profileType || !profileData.id || !profileData.profileTypes.includes(profileType)) {\n        return;\n      }\n\n      removeProfile();\n\n      setIsLoading(true);\n\n      try {\n        const data = await adHocProfileClient.get(profileData.id, profileType);\n\n        setProfileData((prevData) => ({\n          ...prevData,\n          profile: data.profile,\n        }));\n      } catch (error) {\n        if (!adHocProfileClient.isAbortError(error)) {\n          displayError(error as Error, ['Error while fetching profile!', (error as Error).message]);\n        }\n      }\n\n      setIsLoading(false);\n    },\n    [profileData.id, profileData.profileTypes]\n  );\n\n  return {\n    processFile,\n    profileTypes: profileData.profileTypes,\n    selectProfileType,\n    profile: profileData.profile,\n    removeFile,\n    isLoading,\n  };\n}\n","import { DropzoneFile, FileDropzone } from '@grafana/ui';\nimport { displayError } from '@shared/domain/displayStatus';\nimport React, { useCallback } from 'react';\n\nimport { ACCEPTED_FILE_TYPES } from '../domain/accepted-file-types';\n\nconst options = {\n  accept: ACCEPTED_FILE_TYPES,\n  multiple: false,\n  // maxSize: 42, // TODO?\n  onError(error: Error) {\n    displayError(error, ['Error while uploading file!', error.toString()]);\n  },\n};\n\ntype AdHocFileDropZoneProps = {\n  onFileDropped: (file: File) => void;\n  onFileRemove: (file: DropzoneFile) => void;\n};\n\nexport function AdHocFileDropZone({ onFileDropped, onFileRemove }: AdHocFileDropZoneProps) {\n  const onDropAccepted = useCallback(\n    function (files: File[]) {\n      onFileDropped(files[0]);\n    },\n    [onFileDropped]\n  );\n\n  return (\n    <FileDropzone\n      options={{\n        ...options,\n        onDropAccepted,\n      }}\n      onFileRemove={onFileRemove}\n    />\n  );\n}\n","export const ACCEPTED_FILE_TYPES = {\n  'application/gzip': ['.gz'],\n  'application/json': ['.json'],\n  'application/proto': ['.pb', '.pprof'],\n};\n","import { HttpClient } from '@shared/infrastructure/http/HttpClient';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\ntype UploadResponse = {\n  key: string;\n  url: string;\n  subProfiles: any[]; // TODO: define them, what are they?\n};\n\nclass FlamegraphDotComApiClient extends HttpClient {\n  constructor() {\n    super('https://flamegraph.com/api', {\n      'content-type': 'application/json',\n    });\n  }\n\n  async upload(name: string, profile: FlamebearerProfile): Promise<UploadResponse> {\n    const response = await this.fetch('/upload/v1', {\n      method: 'POST',\n      body: JSON.stringify({\n        name,\n        profile: btoa(JSON.stringify(profile)),\n        fileTypeData: {\n          units: profile.metadata.units,\n          spyName: profile.metadata.spyName,\n        },\n        type: 'json',\n      }),\n    });\n\n    const json = await response.json();\n\n    return json;\n  }\n}\n\nexport const flamegraphDotComApiClient = new FlamegraphDotComApiClient();\n","export enum CompareTarget {\n  BASELINE = 'baseline',\n  COMPARISON = 'comparison',\n}\n","import { dateTimeParse, TimeRange } from '@grafana/data';\n\nimport { CompareTarget } from '../../../../../pages/ProfilesExplorerView/components/SceneExploreDiffFlameGraph/domain/types';\n\ntype DateParts = {\n  year: string;\n  month: string;\n  day: string;\n  hour: string;\n  minute: string;\n  second: string;\n};\n\nconst DATETIME_FORMATTER = new Intl.DateTimeFormat('fr-CA', {\n  year: 'numeric',\n  month: '2-digit',\n  day: '2-digit',\n  hour12: false,\n  hour: '2-digit',\n  minute: '2-digit',\n  second: '2-digit',\n});\n\nfunction format(date: Date): string {\n  const parts = DATETIME_FORMATTER.formatToParts(date).reduce((acc, { type, value }) => {\n    acc[type as keyof DateParts] = value;\n    return acc;\n  }, {} as DateParts);\n\n  return `${parts.year}-${parts.month}-${parts.day}_${parts.hour}${parts.minute}`;\n}\n\nfunction dateForExportFilename(timeRange: TimeRange) {\n  const from = new Date(Math.round(timeRange.from.unix() * 1000));\n  const to = new Date(Math.round(timeRange.to.unix() * 1000));\n\n  return `${format(from)}-to-${format(to)}`;\n}\n\nfunction getTimeRange(target: CompareTarget) {\n  const [fromKey, toKey] = target === CompareTarget.BASELINE ? ['diffFrom', 'diffTo'] : ['diffFrom-2', 'diffTo-2'];\n\n  const searchParams = new URLSearchParams(window.location.search);\n  const from = searchParams.get(fromKey) as string;\n  const to = searchParams.get(toKey) as string;\n\n  return {\n    raw: { from, to },\n    from: dateTimeParse(from),\n    to: dateTimeParse(to),\n  };\n}\n\nexport function getExportFilename(appName?: string) {\n  const timeRanges = [\n    'baseline',\n    dateForExportFilename(getTimeRange(CompareTarget.BASELINE)),\n    'comparison',\n    dateForExportFilename(getTimeRange(CompareTarget.COMPARISON)),\n  ];\n\n  return appName ? [appName, ...timeRanges].join('_') : ['flamegraph', ...timeRanges].join('_');\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport 'compression-streams-polyfill';\nimport saveAs from 'file-saver';\n\nimport { ExportDataProps } from '../ExportData';\nimport { flamegraphDotComApiClient } from '../infrastructure/flamegraphDotComApiClient';\nimport { getExportFilename } from './getExportFilename';\n\n/* Note: no pprof export, as the underlying API only accepts a single query (see PprofApiClient) */\nexport function useExportMenu({ profile, enableFlameGraphDotComExport }: ExportDataProps) {\n  const downloadPng = () => {\n    reportInteraction('g_pyroscope_app_export_profile', { format: 'png' });\n\n    const customExportName = getExportFilename(profile.metadata.appName);\n    const filename = `${customExportName}.png`;\n\n    // TODO use ref, this won't work for comparison side by side (??!)\n    const canvasElement = document.querySelector('canvas[data-testid=\"flameGraph\"]') as HTMLCanvasElement;\n\n    canvasElement.toBlob((blob) => {\n      if (!blob) {\n        const error = new Error('No Blob, the image cannot be created.');\n        displayError(error, ['Failed to export to png!', error.message]);\n        return;\n      }\n\n      saveAs(blob, filename);\n    }, 'image/png');\n  };\n\n  const downloadJson = () => {\n    reportInteraction('g_pyroscope_app_export_profile', { format: 'json' });\n\n    const customExportName = getExportFilename(profile.metadata.appName);\n    const filename = `${customExportName}.json`;\n    const dataStr = `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(profile))}`;\n\n    try {\n      saveAs(dataStr, filename);\n    } catch (error) {\n      displayError(error as Error, ['Failed to export to JSON!', (error as Error).message]);\n      return;\n    }\n  };\n\n  const uploadToFlamegraphDotCom = async () => {\n    reportInteraction('g_pyroscope_app_export_profile', { format: 'flamegraph.com' });\n\n    const customExportName = getExportFilename(profile.metadata.appName);\n\n    let response;\n\n    try {\n      response = await flamegraphDotComApiClient.upload(customExportName, profile);\n    } catch (error) {\n      displayError(error as Error, ['Failed to export to flamegraph.com!', (error as Error).message]);\n      return;\n    }\n\n    const dlLink = document.createElement('a');\n    dlLink.target = '_blank';\n    dlLink.href = response.url;\n    document.body.appendChild(dlLink);\n    dlLink.click();\n    document.body.removeChild(dlLink);\n  };\n\n  return {\n    data: {\n      shouldDisplayFlamegraphDotCom: Boolean(enableFlameGraphDotComExport),\n    },\n    actions: {\n      downloadPng,\n      downloadJson,\n      uploadToFlamegraphDotCom,\n    },\n  };\n}\n","import { Menu } from '@grafana/ui';\nimport React from 'react';\n\nimport { useExportMenu } from './domain/useExportMenu';\nimport { ExportDataProps } from './ExportData';\n\nexport function ExportMenu(props: ExportDataProps) {\n  const { actions } = useExportMenu(props);\n\n  return (\n    <Menu>\n      <Menu.Item label=\"png\" onClick={actions.downloadPng} />\n      <Menu.Item label=\"json\" onClick={actions.downloadJson} />\n    </Menu>\n  );\n}\n","import { Button, Dropdown } from '@grafana/ui';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\nimport React, { memo } from 'react';\n\nimport { ExportMenu } from './ExportMenu';\n\nexport type ExportDataProps = {\n  profile: FlamebearerProfile;\n  enableFlameGraphDotComExport?: boolean;\n};\n\nfunction ExportDataComponent(props: ExportDataProps) {\n  const { profile, enableFlameGraphDotComExport } = props;\n\n  return (\n    <Dropdown overlay={<ExportMenu profile={profile} enableFlameGraphDotComExport={enableFlameGraphDotComExport} />}>\n      <Button\n        icon=\"download-alt\"\n        size=\"sm\"\n        variant=\"secondary\"\n        fill=\"outline\"\n        aria-label=\"Export profile data\"\n        tooltip=\"Export profile data\"\n      />\n    </Dropdown>\n  );\n}\n\nexport const ExportData = memo(ExportDataComponent);\n","import { createDataFrame, DataFrameDTO, FieldType } from '@grafana/data';\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nfunction getNodes(level: number[], names: string[], diff: boolean) {\n  const nodes = [];\n  const itemOffset = diff ? 7 : 4;\n\n  for (let i = 0; i < level.length; i += itemOffset) {\n    nodes.push({\n      level: 0,\n      label: diff ? names[level[i + 6]] : names[level[i + 3]],\n      offset: level[i],\n      val: level[i + 1],\n      self: level[i + 2],\n      selfRight: diff ? level[i + 5] : 0,\n      valRight: diff ? level[i + 4] : 0,\n      valTotal: diff ? level[i + 1] + level[i + 4] : level[i + 1],\n      offsetRight: diff ? level[i + 3] : 0,\n      offsetTotal: diff ? level[i] + level[i + 3] : level[i],\n      children: [],\n    });\n  }\n\n  return nodes;\n}\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function flamebearerToDataFrameDTO(levels: number[][], names: string[], unit: string, diff: boolean) {\n  if (!levels.length) {\n    return;\n  }\n\n  const nodeLevels: any[][] = [];\n\n  for (let i = 0; i < levels.length; i++) {\n    nodeLevels[i] = [];\n\n    for (const node of getNodes(levels[i], names, diff)) {\n      node.level = i;\n      nodeLevels[i].push(node);\n\n      if (i > 0) {\n        const prevNodesInLevel = nodeLevels[i].slice(0, -1);\n        const currentNodeStart =\n          prevNodesInLevel.reduce((acc, n) => n.offsetTotal + n.valTotal + acc, 0) + node.offsetTotal;\n\n        const prevLevel = nodeLevels[i - 1];\n        let prevLevelOffset = 0;\n\n        for (const prevLevelNode of prevLevel) {\n          const parentNodeStart = prevLevelOffset + prevLevelNode.offsetTotal;\n          const parentNodeEnd = parentNodeStart + prevLevelNode.valTotal;\n\n          if (parentNodeStart <= currentNodeStart && parentNodeEnd > currentNodeStart) {\n            prevLevelNode.children.push(node);\n            break;\n          } else {\n            prevLevelOffset += prevLevelNode.offsetTotal + prevLevelNode.valTotal;\n          }\n        }\n      }\n    }\n  }\n\n  const root = nodeLevels[0][0];\n  const stack = [root];\n\n  const labelValues = [];\n  const levelValues = [];\n  const selfValues = [];\n  const valueValues = [];\n  const selfRightValues = [];\n  const valueRightValues = [];\n\n  while (stack.length) {\n    const node = stack.shift();\n    labelValues.push(node.label);\n    levelValues.push(node.level);\n    selfValues.push(node.self);\n    valueValues.push(node.val);\n    selfRightValues.push(node.selfRight);\n    valueRightValues.push(node.valRight);\n    stack.unshift(...node.children);\n  }\n\n  let valueUnit = 'short';\n\n  // See format.ts#getFormatter. We have to use Grafana unit string here though.\n  switch (unit) {\n    case 'samples':\n    case 'trace_samples':\n    case 'lock_nanoseconds':\n    case 'nanoseconds':\n      valueUnit = 'ns';\n      break;\n    case 'bytes':\n      valueUnit = 'bytes';\n      break;\n  }\n\n  const fields = [\n    { name: 'level', values: levelValues },\n    { name: 'label', values: labelValues, type: FieldType.string },\n    { name: 'self', values: selfValues, config: { unit: valueUnit } },\n    { name: 'value', values: valueValues, config: { unit: valueUnit } },\n  ];\n\n  if (diff) {\n    fields.push(\n      ...[\n        {\n          name: 'selfRight',\n          values: selfRightValues,\n          config: { unit: valueUnit },\n        },\n        {\n          name: 'valueRight',\n          values: valueRightValues,\n          config: { unit: valueUnit },\n        },\n      ]\n    );\n  }\n\n  const frame: DataFrameDTO = {\n    name: 'response',\n    meta: { preferredVisualisationType: 'flamegraph' },\n    fields,\n  };\n\n  return createDataFrame(frame);\n}\n","import { createTheme } from '@grafana/data';\nimport { FlameGraph as GrafanaFlameGraph, Props } from '@grafana/flamegraph';\nimport { useTheme2 } from '@grafana/ui';\nimport React, { memo, useMemo } from 'react';\n\nimport type { FlamebearerProfile } from '../../types/FlamebearerProfile';\nimport { ExportData } from './components/ExportData';\nimport { flamebearerToDataFrameDTO } from './domain/flamebearerToDataFrameDTO';\n\ntype FlameGraphProps = {\n  profile: FlamebearerProfile;\n  diff?: boolean;\n  vertical?: boolean;\n  enableFlameGraphDotComExport?: boolean;\n  collapsedFlamegraphs?: boolean;\n  getExtraContextMenuButtons?: Props['getExtraContextMenuButtons'];\n};\n\nfunction FlameGraphComponent({\n  profile,\n  diff,\n  vertical,\n  enableFlameGraphDotComExport,\n  collapsedFlamegraphs,\n  getExtraContextMenuButtons,\n}: FlameGraphProps) {\n  const { isLight } = useTheme2();\n  const getTheme = () => createTheme({ colors: { mode: isLight ? 'light' : 'dark' } });\n\n  const dataFrame = useMemo(\n    () =>\n      flamebearerToDataFrameDTO(\n        profile.flamebearer.levels,\n        profile.flamebearer.names,\n        profile.metadata.units,\n        Boolean(diff)\n      ),\n    [profile, diff]\n  );\n\n  return (\n    <GrafanaFlameGraph\n      data={dataFrame as any}\n      disableCollapsing={!collapsedFlamegraphs}\n      extraHeaderElements={<ExportData profile={profile} enableFlameGraphDotComExport={enableFlameGraphDotComExport} />}\n      vertical={vertical}\n      getTheme={getTheme as any}\n      getExtraContextMenuButtons={getExtraContextMenuButtons}\n      keepFocusOnDataChange\n    />\n  );\n}\n\nexport const FlameGraph = memo(FlameGraphComponent);\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport { FlameGraph } from '@shared/components/FlameGraph/FlameGraph';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\nimport React from 'react';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flamegraph: css`\n    margin-top: ${theme.spacing(2)};\n  `,\n});\n\nexport function AdHocFlameGraph({ profile, diff }: { profile: FlamebearerProfile; diff?: boolean }) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.flamegraph} data-testid=\"flamegraph\">\n      <FlameGraph profile={profile} diff={diff} />\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { InlineField, InlineFieldRow, Select, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\n\ntype ProfileSelectorProps = {\n  profileTypes: string[];\n  onChange: (options: SelectableValue<string>) => void;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  selectorContainer: css`\n    display: flex;\n    justify-content: center;\n    margin-bottom: ${theme.spacing(2)};\n  `,\n});\n\nexport function AdHocProfileTypeSelector({ profileTypes, onChange }: ProfileSelectorProps) {\n  const styles = useStyles2(getStyles);\n\n  const options = useMemo(() => profileTypes.map((type) => ({ value: type, label: type })), [profileTypes]);\n  const [option, setOption] = useState<SelectableValue<string>>();\n\n  const _onChange = useCallback(\n    (o: SelectableValue<string>) => {\n      setOption(o);\n      onChange(o);\n    },\n    [onChange]\n  );\n\n  useEffect(() => {\n    // when the uploaded file contains multiple sample types, the 1st is always returned by the API\n    // so, we select it automatically\n    setOption(options[0]);\n  }, [options]);\n\n  return (\n    <div className={styles.selectorContainer}>\n      <InlineFieldRow>\n        <InlineField label=\"Profile\" disabled={!options.length} data-testid=\"profile-types-dropdown\">\n          {/* added a key to ensure the dropdown is properly reset */}\n          <Select key={option?.value} value={option} options={options} onChange={_onChange} width={16} />\n        </InlineField>\n      </InlineFieldRow>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  spinner: css`\n    text-align: center;\n    margin-top: ${theme.spacing(2)};\n  `,\n});\n\nexport function AdHocSpinner() {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.spinner}>\n      <Spinner size={36} />\n    </div>\n  );\n}\n","import { SelectableValue } from '@grafana/data';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React, { memo } from 'react';\n\nimport { useUploadFile } from '../../domain/useUploadFile';\nimport { AdHocFileDropZone } from '../AdHocFileDropZone';\nimport { AdHocFlameGraph } from '../AdHocFlameGraph';\nimport { AdHocProfileTypeSelector } from '../AdHocProfileTypeSelector';\nimport { AdHocSpinner } from '../AdHocSpinner';\n\nfunction AdHocSingleComponent() {\n  const { processFile, profileTypes, selectProfileType, profile, removeFile, isLoading } = useUploadFile();\n\n  const onChangeProfileType = (options: SelectableValue<string>) => {\n    reportInteraction('g_pyroscope_app_ad_hoc_profile_metric_selected');\n    selectProfileType(options);\n  };\n\n  const onFileDropped = (file: File) => {\n    reportInteraction('g_pyroscope_app_ad_hoc_file_dropped', { fileType: file.type });\n    processFile(file);\n  };\n\n  const onFileRemoved = () => {\n    reportInteraction('g_pyroscope_app_ad_hoc_file_removed');\n    removeFile();\n  };\n\n  return (\n    <div>\n      <AdHocProfileTypeSelector profileTypes={profileTypes} onChange={onChangeProfileType} />\n      <AdHocFileDropZone onFileDropped={onFileDropped} onFileRemove={onFileRemoved} />\n      {isLoading && !profile ? <AdHocSpinner /> : null}\n      {profile && <AdHocFlameGraph profile={profile} />}\n    </div>\n  );\n}\n\nexport const AdHocSingle = memo(AdHocSingleComponent);\n","import React from 'react';\n\nimport { AdHocColumns } from '../AdHocColums';\nimport { AdHocSingle } from './AdHocSingle';\n\nexport function AdHocComparison() {\n  return <AdHocColumns left={<AdHocSingle />} right={<AdHocSingle />} />;\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Tab, TabContent, TabsBar, useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { AdHocComparison } from './tabs/AdHocComparison';\nimport { AdHocSingle } from './tabs/AdHocSingle';\n\n// import { AdHocDiff } from './tabs/AdHocDiff';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  tabContent: css`\n    padding: ${theme.spacing(2)};\n    margin: ${theme.spacing(2)};\n  `,\n});\n\nexport function AdHocTabs() {\n  const styles = useStyles2(getStyles);\n  const [activeTabIndex, setActiveTabIndex] = useState(0);\n\n  return (\n    <div>\n      <TabsBar>\n        <Tab label=\" Single view\" active={activeTabIndex === 0} onChangeTab={() => setActiveTabIndex(0)} />\n        <Tab label=\" Comparison view\" active={activeTabIndex === 1} onChangeTab={() => setActiveTabIndex(1)} />\n        {/* <Tab\n          label=\" Diff view\"\n          active={activeTabIndex === 2}\n          onChangeTab={onChangeTab(2)}\n        /> */}\n      </TabsBar>\n      <TabContent className={styles.tabContent}>\n        {activeTabIndex === 0 && <AdHocSingle />}\n        {activeTabIndex === 1 && <AdHocComparison />}\n        {/* {activeTabIndex === 2 && <AdHocDiff  />} */}\n      </TabContent>\n    </div>\n  );\n}\n","import { BackButton } from '@shared/components/Common/BackButton';\nimport { useReportPageInitialized } from '@shared/infrastructure/tracking/useReportPageInitialized';\nimport { PageTitle } from '@shared/ui/PageTitle';\nimport React from 'react';\n\nimport { AdHocTabs } from './ui/AdHocTabs';\n\nexport default function AdHocView() {\n  useReportPageInitialized('ad_hoc');\n  return (\n    <>\n      <PageTitle title=\"Ad hoc view\" />\n      <AdHocTabs />\n      <BackButton />\n    </>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Modal, Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  loadingIcon: css`\n    color: ${theme.colors.primary.main};\n    font-size: 48px;\n    margin-bottom: ${theme.spacing(2)};\n    display: flex;\n    justify-content: center;\n  `,\n  loadingMessage: css`\n    text-align: center;\n    font-size: ${theme.typography.h4.fontSize};\n    margin-bottom: ${theme.spacing(2)};\n  `,\n  fullScreenModal: css`\n    width: 100vw !important;\n    height: 100vh !important;\n    max-width: none !important;\n    max-height: none !important;\n    margin: 0 !important;\n    top: 0 !important;\n    left: 0 !important;\n    right: 0 !important;\n    bottom: 0 !important;\n  `,\n});\n\nexport default function GitHubCallbackView() {\n  const styles = useStyles2(getStyles);\n  const [isModalOpen, setIsModalOpen] = useState(true);\n\n  const handleDismiss = () => {\n    setIsModalOpen(false);\n    window.close();\n  };\n\n  return (\n    <Modal\n      title=\"GitHub Login\"\n      isOpen={isModalOpen}\n      onDismiss={handleDismiss}\n      closeOnEscape={true}\n      closeOnBackdropClick={true}\n      className={styles.fullScreenModal}\n    >\n      <div className={styles.loadingMessage}>\n        <div className={styles.loadingIcon}>\n          <Spinner size=\"xl\" />\n        </div>\n        <p>Logging in to GitHub...</p>\n      </div>\n    </Modal>\n  );\n}\n","/**\n * Prepares browser history before a user action is called\n *\n * This can be called BEFORE a user action is triggered. It is expected that the app is using UrlSyncManager\n * and the user action will change at least one variable or state synced with the URL. Once any variable or\n * state synced with the URL is triggered, UrlSyncManager will take care of replacing the prepared history entry.\n */\nexport function prepareHistoryEntry() {\n  history.pushState(null, '');\n}\n","import { BusEventWithPayload, DataFrame } from '@grafana/data';\n\ninterface EventTimeseriesDataReceivedPayload {\n  series?: DataFrame[];\n}\n\nexport class EventTimeseriesDataReceived extends BusEventWithPayload<EventTimeseriesDataReceivedPayload> {\n  public static type = 'timeseries-data-received';\n}\n","import { State } from 'xstate';\n\nexport enum FilterKind {\n  'partial' = 'partial',\n  'attribute-operator-value' = 'attribute-operator-value',\n  'attribute-operator' = 'attribute-operator',\n}\n\nexport enum OperatorKind {\n  '=' = '=',\n  '!=' = '!=',\n  'in' = 'in',\n  'not-in' = 'not-in',\n  'is-empty' = 'is-empty',\n  '=~' = '=~',\n  '!~' = '!~',\n}\n\nexport type PartialFilter = {\n  id: string;\n  type: FilterKind;\n  attribute: Suggestion;\n  operator?: Suggestion;\n  value?: Suggestion;\n  active: boolean;\n};\n\nexport type CompleteFilter = {\n  id: string;\n  type: FilterKind;\n  attribute: Suggestion;\n  operator: Suggestion;\n  value: Suggestion;\n  active: boolean;\n};\n\nexport type Filter = PartialFilter | CompleteFilter;\n\nexport type CompleteFilters = CompleteFilter[];\n\nexport type Filters = [PartialFilter] | CompleteFilter[] | [...CompleteFilter[], PartialFilter];\n\nexport enum FilterPartKind {\n  attribute = 'attribute',\n  operator = 'operator',\n  value = 'value',\n}\n\nexport type Suggestion = {\n  value: string;\n  label: string;\n  description?: string;\n};\n\nexport type Suggestions = Suggestion[];\n\nexport enum SuggestionKind {\n  'attribute' = 'attribute',\n  'operator' = 'operator',\n  'value' = 'value',\n}\n\nexport type InputParams = {\n  query: string;\n  from: number;\n  to: number;\n  // TODO: after migrate the legacy comparison pages to Scenes, dataSourceUid will be mandatory\n  dataSourceUid?: string;\n};\n\nexport type Edition = {\n  filterId: string;\n  part: FilterPartKind;\n};\n\nexport type QueryBuilderContext = {\n  inputParams: InputParams;\n  query: string;\n  filters: Filters;\n  isQueryUpToDate: boolean;\n  edition: Edition | null;\n  suggestions: {\n    type: SuggestionKind | null;\n    items: Suggestions;\n    isVisible: boolean;\n    isLoading: boolean;\n    error: Error | null;\n    placeholder: string;\n    noOptionsMessage: string;\n    allowCustomValue: boolean;\n    multiple: boolean;\n    disabled: boolean;\n  };\n};\n\nexport type QueryBuilderSchema = {\n  states: {\n    idle: State<QueryBuilderContext, QueryBuilderEvent>;\n    loadLabels: State<QueryBuilderContext, QueryBuilderEvent>;\n    displayLabels: State<QueryBuilderContext, QueryBuilderEvent>;\n    loadLabelValues: State<QueryBuilderContext, QueryBuilderEvent>;\n    loadOperators: State<QueryBuilderContext, QueryBuilderEvent>;\n    displayOperators: State<QueryBuilderContext, QueryBuilderEvent>;\n    displayLabelValues: State<QueryBuilderContext, QueryBuilderEvent>;\n    autoSuggestProxy: State<QueryBuilderContext, QueryBuilderEvent>;\n  };\n};\n\ntype StartEvent = { type: 'START_INPUT' };\nexport type SelectEvent = { type: 'SELECT_SUGGESTION'; data: Suggestion };\ntype DiscardEvent = { type: 'DISCARD_SUGGESTIONS' };\nexport type EditEvent = { type: 'EDIT_FILTER'; data: Edition };\nexport type RemoveFilterEvent = { type: 'REMOVE_FILTER'; data: string }; // data = filterId\ntype RemoveLastFilterEvent = { type: 'REMOVE_LAST_FILTER' };\nexport type ChangeInputParamsEvent = { type: 'CHANGE_INPUT_PARAMS'; data: InputParams };\ntype ExecuteQueryEvent = { type: 'EXECUTE_QUERY' };\n\nexport type QueryBuilderEvent =\n  | StartEvent\n  | SelectEvent\n  | DiscardEvent\n  | EditEvent\n  | RemoveFilterEvent\n  | RemoveLastFilterEvent\n  | ChangeInputParamsEvent\n  | ExecuteQueryEvent;\n","import { config } from '@grafana/runtime';\nimport { HttpClient } from '@shared/infrastructure/http/HttpClient';\n\nexport class DataSourceProxyClient extends HttpClient {\n  dataSourceUid: string;\n\n  constructor(options: { dataSourceUid: string }) {\n    const { dataSourceUid } = options;\n\n    let { appSubUrl = '', bootData } = config;\n    if (appSubUrl?.at(-1) !== '/') {\n      // ensures that the API pathname is appended correctly (appUrl seems to always have it but better to be extra careful)\n      appSubUrl += '/';\n    }\n\n    super(`${appSubUrl}api/datasources/proxy/uid/${dataSourceUid}`, {\n      'content-type': 'application/json',\n      'X-Grafana-Org-Id': String(bootData?.user?.orgId || ''),\n    });\n\n    this.dataSourceUid = options.dataSourceUid;\n  }\n}\n","import { DataSourceProxyClient } from '../../series/http/DataSourceProxyClient';\n\nexport class LabelsApiClient extends DataSourceProxyClient {\n  static queryToMatchers(query: string) {\n    const labelsIndex = query.indexOf('{');\n\n    if (labelsIndex > 0) {\n      const profileTypeID = query.substring(0, labelsIndex);\n      return [`{__profile_type__=\\\"${profileTypeID}\\\", ${query.substring(labelsIndex + 1, query.length)}`];\n    }\n\n    if (labelsIndex === 0) {\n      return [query];\n    }\n\n    return [`{__profile_type__=\\\"${query}\\\"}`];\n  }\n\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async fetchLabels(query: string, from: number, to: number) {\n    return this._post('/querier.v1.QuerierService/LabelNames', {\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  async fetchLabelValues(labelId: string, query: string, from: number, to: number) {\n    return this._post('/querier.v1.QuerierService/LabelValues', {\n      name: labelId,\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  _post(pathname: string, body: Record<string, any>) {\n    return super.fetch(pathname, {\n      method: 'POST',\n      body: JSON.stringify(body),\n    });\n  }\n}\n","type CacheKeyable = { toString(): string };\n\nexport class MemoryCacheClient {\n  store = new Map<string, any>();\n\n  static buildCacheKey(args: CacheKeyable[]) {\n    let key = '';\n    for (const arg of args) {\n      key += String(arg);\n    }\n    return key;\n  }\n\n  get(args: CacheKeyable[]): any {\n    return this.store.get(MemoryCacheClient.buildCacheKey(args));\n  }\n\n  // TODO: TTL?\n  set(args: CacheKeyable[], data: any) {\n    this.store.set(MemoryCacheClient.buildCacheKey(args), data);\n  }\n\n  delete(args: CacheKeyable[]) {\n    this.store.delete(MemoryCacheClient.buildCacheKey(args));\n  }\n}\n","export function invariant(check: boolean, message: string): asserts check {\n  if (!check) {\n    throw new Error(message);\n  }\n}\n","import { ApiClient } from './http/ApiClient';\n\nexport abstract class AbstractRepository<T extends ApiClient, U> {\n  apiClient?: T;\n  cacheClient: U | undefined;\n\n  constructor(options: { apiClient?: T; cacheClient?: U }) {\n    this.apiClient = options.apiClient;\n    this.cacheClient = options?.cacheClient;\n  }\n\n  setApiClient(apiClient: T) {\n    this.apiClient = apiClient;\n  }\n\n  setCacheClient(cacheClient: U) {\n    this.cacheClient = cacheClient;\n  }\n\n  cancel(reason: any) {\n    this.apiClient!.abort(reason);\n  }\n}\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\n\nexport class LabelsApiClient extends ApiClient {\n  static queryToMatchers(query: string) {\n    const labelsIndex = query.indexOf('{');\n\n    if (labelsIndex > 0) {\n      const profileTypeID = query.substring(0, labelsIndex);\n      return [`{__profile_type__=\\\"${profileTypeID}\\\", ${query.substring(labelsIndex + 1, query.length)}`];\n    }\n\n    if (labelsIndex === 0) {\n      return [query];\n    }\n\n    return [`{__profile_type__=\\\"${query}\\\"}`];\n  }\n\n  async fetchLabels(query: string, from: number, to: number) {\n    // all /querier requests: timerange in Unix time ms (unix * 1000)\n    return this._post('/querier.v1.QuerierService/LabelNames', {\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  async fetchLabelValues(labelId: string, query: string, from: number, to: number) {\n    // all /querier requests: timerange in Unix time ms (unix * 1000)\n    return this._post('/querier.v1.QuerierService/LabelValues', {\n      name: labelId,\n      matchers: LabelsApiClient.queryToMatchers(query),\n      start: from,\n      end: to,\n    }).then((response) => response.json());\n  }\n\n  _post(pathname: string, body: Record<string, any>) {\n    return super.fetch(pathname, {\n      method: 'POST',\n      body: JSON.stringify(body),\n    });\n  }\n}\n","import { MemoryCacheClient } from '@shared/infrastructure/MemoryCacheClient';\n\nimport { Suggestions } from '../../components/QueryBuilder/domain/types';\nimport { invariant } from '../../types/helpers/invariant';\nimport { AbstractRepository } from '../AbstractRepository';\nimport { LabelsApiClient } from './LabelsApiClient';\n\ntype ListLabelsOptions = {\n  query: string;\n  from: number;\n  to: number;\n};\n\ntype ListLabelValuesOptions = ListLabelsOptions & {\n  label: string;\n};\n\nclass LabelsRepository extends AbstractRepository<LabelsApiClient, MemoryCacheClient> {\n  cacheClient: MemoryCacheClient;\n\n  static isNotMetaLabelOrServiceName = (label: string) => !/^(__.+__|service_name)$/.test(label);\n\n  static parseLabelsResponse(json: Record<string, any>): Suggestions {\n    if (!Array.isArray(json.names)) {\n      return [];\n    }\n\n    const uniqueLabels: string[] = Array.from(new Set(json.names.filter(LabelsRepository.isNotMetaLabelOrServiceName)));\n\n    return uniqueLabels.map((label) => ({ value: label, label }));\n  }\n\n  static parseLabelValuesResponse(json: Record<string, any>): Suggestions {\n    if (!Array.isArray(json.names)) {\n      return [];\n    }\n\n    const labelValues: string[] = json.names;\n\n    return labelValues.map((label) => ({ value: label, label }));\n  }\n\n  constructor(options: { apiClient: LabelsApiClient; cacheClient: MemoryCacheClient }) {\n    super({ apiClient: options.apiClient });\n\n    this.cacheClient = options.cacheClient;\n  }\n\n  static assertParams(query: string, from: number, to: number) {\n    invariant(Boolean(query), 'Missing \"query\" parameter!');\n    invariant(from > 0 && to > 0 && to > from, 'Invalid timerange!');\n  }\n\n  async listLabels({ query, from, to }: ListLabelsOptions): Promise<Suggestions> {\n    LabelsRepository.assertParams(query, from, to);\n\n    const cacheParams = [this.apiClient!.baseUrl, query, from, to];\n\n    const labelsFromCacheP = this.cacheClient.get(cacheParams);\n    if (labelsFromCacheP) {\n      const json = await labelsFromCacheP;\n      const labels = LabelsRepository.parseLabelsResponse(json);\n\n      if (!labels.length) {\n        this.cacheClient.delete(cacheParams);\n      }\n\n      return labels;\n    }\n\n    const fetchP = this.apiClient!.fetchLabels(query, from, to);\n    this.cacheClient.set(cacheParams, fetchP);\n\n    try {\n      const json = await fetchP;\n      return LabelsRepository.parseLabelsResponse(json);\n    } catch (error) {\n      this.cacheClient.delete(cacheParams);\n      throw error;\n    }\n  }\n\n  async listLabelValues({ label, query, from, to }: ListLabelValuesOptions): Promise<Suggestions> {\n    LabelsRepository.assertParams(query, from, to);\n    invariant(Boolean(label), 'Missing label value!');\n\n    const cacheParams = [this.apiClient!.baseUrl, label, query, from, to];\n\n    const labelValuesFromCacheP = this.cacheClient.get(cacheParams);\n    if (labelValuesFromCacheP) {\n      const json = await labelValuesFromCacheP;\n      const labelValues = LabelsRepository.parseLabelsResponse(json);\n\n      if (!labelValues.length) {\n        this.cacheClient.delete(cacheParams);\n      }\n\n      return labelValues;\n    }\n\n    const fetchP = this.apiClient!.fetchLabelValues(label, query, from, to);\n    this.cacheClient.set(cacheParams, fetchP);\n\n    try {\n      const json = await fetchP;\n      return LabelsRepository.parseLabelValuesResponse(json);\n    } catch (error) {\n      this.cacheClient.delete(cacheParams);\n      throw error;\n    }\n  }\n}\n\nexport const labelsRepository = new LabelsRepository({\n  apiClient: new LabelsApiClient(),\n  cacheClient: new MemoryCacheClient(),\n});\n","import { FilterKind, Filters } from '../types';\n\nexport function areFiltersEqual(newFilters: Filters, previousFilters: Filters): boolean {\n  const newFiltersWithoutPartial = newFilters.filter(({ type }) => type !== FilterKind.partial);\n  const previousFiltersWithoutPartial = previousFilters.filter(({ type }) => type !== FilterKind.partial);\n\n  return (\n    newFiltersWithoutPartial.length === previousFiltersWithoutPartial.length &&\n    newFiltersWithoutPartial.every((filter) =>\n      previousFiltersWithoutPartial.find(\n        ({ type, attribute, operator, value }) =>\n          type === filter.type &&\n          attribute.value === filter.attribute.value &&\n          operator?.value === filter.operator?.value &&\n          value?.value === filter.value?.value\n      )\n    )\n  );\n}\n","import { Filter, FilterKind, OperatorKind } from '../types';\n\nconst IsEmptyFilter = {\n  type: FilterKind['attribute-operator'],\n  operator: {\n    value: OperatorKind['is-empty'],\n    label: 'is empty',\n  },\n  value: {\n    value: OperatorKind['is-empty'],\n    label: '',\n  },\n};\n\nexport const buildIsEmptyFilter = (filter: Filter) => ({ ...filter, ...IsEmptyFilter });\n","import { CompleteFilter, FilterKind, Filters, OperatorKind } from '../types';\n\nexport function filtersToQuery(query: string, filters: Filters) {\n  const labelsList = filters\n    .filter(({ type }) => type !== FilterKind.partial)\n    .map((filter) => {\n      const { attribute, operator, value } = filter as CompleteFilter;\n\n      switch (operator.value) {\n        case OperatorKind.in:\n          return `${attribute.value}=~\"${value.value}\"`;\n\n        case OperatorKind['not-in']:\n          return `${attribute.value}!~\"${value.value}\"`;\n\n        case OperatorKind['is-empty']:\n          return `${attribute.value}=\"\"`;\n\n        default:\n          return `${attribute.value}${operator.value}\"${value.value}\"`;\n      }\n    });\n\n  const [, serviceNameLabel] = query.match(/{.*(service_name=\"[^\"]*\").*}/) ?? [];\n\n  if (serviceNameLabel) {\n    labelsList.unshift(serviceNameLabel);\n  }\n\n  return query.replace(/{(.*)}$/, `{${labelsList.join(',')}}`);\n}\n","import { Filter, Filters } from '../types';\n\nexport const getLastFilter = (filters: Filters): Filter | null => filters.at(-1) || null;\n","import { OperatorKind } from '../types';\n\nexport const isMultipleValuesOperator = (operator: string | OperatorKind) =>\n  operator === OperatorKind['in'] || operator === OperatorKind['not-in'];\n","import { invariant } from '../../../../types/helpers/invariant';\nimport { Filter, FilterKind } from '../types';\n\nexport const isPartialFilter = (filter: Filter): boolean => {\n  invariant(Boolean(filter), 'The filter is falsy!');\n\n  return filter.type === FilterKind.partial;\n};\n","import { invariant } from '../../../../types/helpers/invariant';\nimport { Filter, OperatorKind } from '../types';\n\n/**\n * Determines if we switch from strict operators (=, !=) to loose ones (=~)\n *\n * This is used when/after editing a filter:\n * - to determine to which state to transition to (see states/loadOperators.ts and domain/guards.ts)\n * - to set the correct edition data after the switch (see domain/actions.ts - editFilterOperator)\n *\n * Returns true when the value should be edited after the switch\n */\nexport function isEditingOperatorMode(currentOperator: string, newOperator: string) {\n  if (currentOperator === newOperator) {\n    return false;\n  }\n\n  if (newOperator === OperatorKind['is-empty']) {\n    return false;\n  }\n\n  return (\n    [\n      OperatorKind['=~'],\n      OperatorKind['!~'],\n      OperatorKind['in'],\n      OperatorKind['not-in'],\n      OperatorKind['is-empty'],\n    ].includes(currentOperator as OperatorKind) ||\n    [OperatorKind['=~'], OperatorKind['!~'], OperatorKind['in'], OperatorKind['not-in']].includes(\n      newOperator as OperatorKind\n    )\n  );\n}\n\nexport function isSwitchingOperatorMode(filterUnderEdition: Filter, newOperator: string) {\n  invariant(typeof filterUnderEdition.operator !== 'undefined', 'No operator for the filter under edition!');\n\n  const currentOperator = filterUnderEdition.operator.value;\n\n  return isEditingOperatorMode(currentOperator, newOperator);\n}\n","import { nanoid } from 'nanoid';\n\nimport { FilterKind, Filters, OperatorKind } from '../types';\nimport { buildIsEmptyFilter } from './buildIsEmptyFilter';\n\nconst parseRawFilters = (rawFilters: string): string[][] => {\n  const matches = rawFilters.matchAll(/(\\w+)(=|!=|=~|!~)\"([^\"]*)\"/g);\n  return Array.from(matches).map(([, attribute, operator, value]) => [attribute, operator, value]);\n};\n\nconst LABELS_REGEX = /.+:[^{]+\\{(.+)\\}$/;\nconst REGEX_CHARS_REGEX = /.*(\\^|\\$|\\*|\\+|\\{|\\}|\\?).*/;\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function queryToFilters(query: string): Filters {\n  // 'process_cpu:cpu:nanoseconds:cpu:nanoseconds{service_name=\"ebpf/gcp-logs-ops/grafana-agent\", namespace=\"gcp-logs-ops\"}'\n  if (!query) {\n    return [];\n  }\n\n  const rawLabels = query.match(LABELS_REGEX);\n  // [_, 'service_name=\"ebpf/gcp-logs-ops/grafana-agent\", namespace=\"gcp-logs-ops\"']\n  if (!rawLabels) {\n    return [];\n  }\n\n  const rawFilters = parseRawFilters(rawLabels[1]);\n\n  // [[service_name, =, ebpf/gcp-logs-ops/grafana-agent], [namespace, =, gcp-logs-ops]]\n\n  return (rawFilters as string[][])\n    .filter(([attribute]) => attribute !== 'service_name')\n    .map(([attribute, operator, value]) => {\n      const filter = {\n        id: nanoid(10),\n        type: FilterKind['attribute-operator-value'],\n        active: true,\n        attribute: { value: attribute, label: attribute },\n        operator: { value: operator, label: operator },\n        value: { value: value, label: value },\n      };\n\n      const shouldConvertToIsEmptyOperator = operator === OperatorKind['='] && value === '';\n      if (shouldConvertToIsEmptyOperator) {\n        return buildIsEmptyFilter(filter);\n      }\n\n      const shouldConvertToInNotInOperator =\n        [OperatorKind['=~'], OperatorKind['!~']].includes(operator as OperatorKind) && !REGEX_CHARS_REGEX.test(value);\n\n      if (shouldConvertToInNotInOperator) {\n        return {\n          ...filter,\n          operator:\n            operator === OperatorKind['=~']\n              ? { value: OperatorKind.in, label: 'in' }\n              : { value: OperatorKind['not-in'], label: 'not in' },\n          value: {\n            value: value,\n            label: value\n              .split('|')\n              .map((v) => v.trim())\n              .join(', '),\n          },\n        };\n      }\n\n      return filter;\n    });\n}\n","import { FilterKind, Filters } from '../types';\n\nexport const toggleCompleteFilters = (filters: Filters, active: boolean): Filters =>\n  filters.map((filter) => (filter.type !== FilterKind.partial ? { ...filter, active } : filter)) as Filters;\n","import { nanoid } from 'nanoid';\nimport { assign } from 'xstate';\n\nimport { LabelsApiClient } from '../../../../pages/ProfilesExplorerView/infrastructure/labels/http/LabelsApiClient';\nimport { labelsRepository } from '../../../infrastructure/labels/labelsRepository';\nimport { areFiltersEqual } from './helpers/areFiltersEqual';\nimport { buildIsEmptyFilter } from './helpers/buildIsEmptyFilter';\nimport { filtersToQuery } from './helpers/filtersToQuery';\nimport { getLastFilter } from './helpers/getLastFilter';\nimport { isMultipleValuesOperator } from './helpers/isMultipleValuesOperator';\nimport { isPartialFilter } from './helpers/isPartialFilter';\nimport { isEditingOperatorMode } from './helpers/isSwitchingOperatorMode';\nimport { queryToFilters } from './helpers/queryToFilters';\nimport { toggleCompleteFilters } from './helpers/toggleCompleteFilters';\nimport {\n  ChangeInputParamsEvent,\n  EditEvent,\n  FilterKind,\n  FilterPartKind,\n  Filters,\n  OperatorKind,\n  QueryBuilderContext,\n  RemoveFilterEvent,\n  SelectEvent,\n} from './types';\n\nfunction updateFiltersAndQuery(newFilters: Filters, context: QueryBuilderContext) {\n  const isQueryUpToDate = areFiltersEqual(newFilters, queryToFilters(context.inputParams.query));\n\n  return {\n    filters: isQueryUpToDate ? toggleCompleteFilters(newFilters, true) : newFilters,\n    query: filtersToQuery(context.query, newFilters),\n    isQueryUpToDate,\n  };\n}\n\nexport const actions: any = {\n  cancelAllLoad: () => {\n    labelsRepository.cancel('Discarded by user');\n  },\n  // FILTER ATTRIBUTES\n  setFilterAttribute: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    const newFilters = [\n      ...context.filters,\n      { id: nanoid(10), type: FilterKind.partial, active: false, attribute: event.data },\n    ] as Filters;\n\n    return {\n      ...context,\n      filters: newFilters,\n      isQueryUpToDate: areFiltersEqual(newFilters, queryToFilters(context.inputParams.query)),\n    };\n  }),\n  editFilterAttribute: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    if (context.edition === null) {\n      throw new Error('Cannot edit filter attribute without edition data!');\n    }\n\n    const { filterId } = context.edition;\n\n    const newFilters = context.filters.map((filter) =>\n      filter.id === filterId\n        ? {\n            ...filter,\n            attribute: event.data,\n            operator: undefined,\n            value: undefined,\n          }\n        : filter\n    ) as Filters;\n\n    return {\n      ...context,\n      filters: newFilters,\n      // note: we can only edit the attribute of partial filters, so no need to rebuild the query here\n      isQueryUpToDate: areFiltersEqual(newFilters, queryToFilters(context.inputParams.query)),\n      edition: null,\n    };\n  }),\n  // FILTER OPERATORS\n  setFilterOperator: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    const newFilters = context.filters.map((filter) => {\n      if (!isPartialFilter(filter)) {\n        return filter;\n      }\n\n      const newOperator = event.data;\n\n      if (newOperator.value === OperatorKind['is-empty']) {\n        return buildIsEmptyFilter(filter);\n      }\n\n      return {\n        ...filter,\n        operator: newOperator,\n        value: undefined,\n      };\n    }) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  editFilterOperator: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    if (context.edition === null) {\n      throw new Error('Cannot edit filter operator without edition data!');\n    }\n\n    const { filterId } = context.edition;\n    const newOperator = event.data;\n    let newEdition = null;\n\n    const newFilters = context.filters.map((filter) => {\n      const previousOperator = filter.operator!.value;\n\n      if (filter.id !== filterId || previousOperator === newOperator.value) {\n        return filter;\n      }\n\n      if (newOperator.value === OperatorKind['is-empty']) {\n        return buildIsEmptyFilter({\n          ...filter,\n          active: false,\n        });\n      }\n\n      if (previousOperator === OperatorKind['is-empty']) {\n        filter.value = { value: '(no value)', label: '(no value)' };\n      }\n\n      if (!isPartialFilter(filter) && isEditingOperatorMode(previousOperator, newOperator.value)) {\n        newEdition = { ...context.edition, part: FilterPartKind.value };\n      }\n\n      return {\n        ...filter,\n        operator: newOperator,\n        value:\n          isMultipleValuesOperator(previousOperator) && !isMultipleValuesOperator(newOperator.value) && filter.value\n            ? {\n                value: filter.value.value.split('|').shift(),\n                label: filter.value.label.split(', ').shift(),\n              }\n            : filter.value,\n        active: false,\n      };\n    }) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n      edition: newEdition,\n    };\n  }),\n  // FILTER VALUES\n  setFilterValue: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    const newFilters = context.filters.map((filter) =>\n      isPartialFilter(filter)\n        ? {\n            ...filter,\n            type: FilterKind['attribute-operator-value'],\n            active: false,\n            value: event.data,\n          }\n        : filter\n    ) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  editFilterValue: assign((context: QueryBuilderContext, event: SelectEvent) => {\n    if (context.edition === null) {\n      throw new Error('Cannot edit filter value without edition data!');\n    }\n\n    const { filterId } = context.edition;\n\n    const newFilters = context.filters.map((filter) =>\n      filter.id === filterId\n        ? {\n            ...filter,\n            type: FilterKind['attribute-operator-value'],\n            active: false,\n            value: event.data,\n          }\n        : filter\n    ) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n      edition: null,\n    };\n  }),\n  // FILTER REMOVAL\n  removeFilter: assign((context: QueryBuilderContext, event: RemoveFilterEvent) => {\n    const filterId = event.data;\n    const newFilters = toggleCompleteFilters(context.filters.filter(({ id }) => id !== filterId) as Filters, false);\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  removeLastFilter: assign((context: QueryBuilderContext) => {\n    const { filters } = context;\n\n    const lastFilter = getLastFilter(filters);\n    if (!lastFilter) {\n      return context;\n    }\n\n    if (isPartialFilter(lastFilter) && lastFilter.operator) {\n      const newFilters = filters.slice(0, filters.length - 1).concat({ ...lastFilter, operator: undefined }) as Filters;\n\n      return {\n        ...context,\n        filters: newFilters,\n        // query doesn't have to change\n        isQueryUpToDate: true,\n      };\n    }\n\n    const newFilters = filters.slice(0, filters.length - 1).map((filter) => ({ ...filter, active: false })) as Filters;\n\n    return {\n      ...context,\n      ...updateFiltersAndQuery(newFilters, context),\n    };\n  }),\n  // MISC\n  setEdition: assign({ edition: (context, event: EditEvent) => event.data }),\n  changeInputParams: assign((context: QueryBuilderContext, event: ChangeInputParamsEvent) => {\n    // TODO: remove this condition after migrating the legacy comparison pages to Scenes\n    // because dataSourceUid will always be provided\n    if (event.data.dataSourceUid) {\n      labelsRepository.setApiClient(new LabelsApiClient({ dataSourceUid: event.data.dataSourceUid }));\n    }\n\n    return {\n      inputParams: event.data,\n      query: event.data.query,\n      // See also buildStateMachine() in domain/stateMachine.ts\n      filters: queryToFilters(event.data.query),\n      isQueryUpToDate: true,\n    };\n  }),\n  activateFilters: assign((context: QueryBuilderContext) => ({\n    ...context,\n    ...updateFiltersAndQuery(context.filters, context),\n  })),\n};\n","import { invariant } from '../../../../types/helpers/invariant';\nimport { Filter, QueryBuilderContext } from '../types';\n\nexport function getFilterUnderEdition(context: QueryBuilderContext): Filter {\n  const { edition, filters } = context;\n\n  invariant(edition !== null, '\"edition\" is null!');\n\n  const filter = filters.find(({ id }) => id === edition.filterId);\n\n  invariant(filter !== undefined, 'Cannot find the filter under edition!');\n\n  return filter;\n}\n","import { getFilterUnderEdition } from './helpers/getFilterUnderEdition';\nimport { getLastFilter } from './helpers/getLastFilter';\nimport { isPartialFilter } from './helpers/isPartialFilter';\nimport { isSwitchingOperatorMode } from './helpers/isSwitchingOperatorMode';\nimport { EditEvent, FilterPartKind, QueryBuilderContext, QueryBuilderEvent, SelectEvent } from './types';\n\ntype CondFn<TContext, TEvent> = (context: TContext, event: TEvent) => boolean;\ntype Guards<TContext, TEvent> = Record<string, CondFn<TContext, TEvent>>;\n\nexport const guards: Guards<QueryBuilderContext, QueryBuilderEvent> = {\n  shouldSuggestAttributes: (context) => {\n    const lastFilter = getLastFilter(context.filters);\n    return !lastFilter || !isPartialFilter(lastFilter);\n  },\n  shouldSuggestOperators: (context) => {\n    return !getLastFilter(context.filters)?.operator;\n  },\n  shouldSuggestValues: (context) => {\n    const lastFilter = getLastFilter(context.filters);\n    return Boolean(lastFilter?.operator && !lastFilter?.value);\n  },\n  // edition only\n  isEditing: (context) => context.edition !== null,\n  shouldSuggestValuesAfterOperatorEdition: (context, event) => {\n    if (!context.edition) {\n      return false;\n    }\n\n    return isSwitchingOperatorMode(getFilterUnderEdition(context), (event as SelectEvent).data.value);\n  },\n  shouldNotSuggestValuesAfterOperatorEdition: (context, event) => {\n    if (!context.edition) {\n      return false;\n    }\n\n    return !isSwitchingOperatorMode(getFilterUnderEdition(context), (event as SelectEvent).data.value);\n  },\n  // after completion\n  hasPartialFilter: (context) => {\n    const lastFilter = getLastFilter(context.filters);\n    return Boolean(lastFilter && isPartialFilter(lastFilter));\n  },\n  shouldEditAttribute: (context, event) => (event as EditEvent).data.part === FilterPartKind.attribute,\n  shouldEditOperator: (context, event) => (event as EditEvent).data.part === FilterPartKind.operator,\n  shouldEditValue: (context, event) => (event as EditEvent).data.part === FilterPartKind.value,\n};\n","import { Suggestions } from '../domain/types';\n\nclass OperatorsRepository {\n  async list(): Promise<Suggestions> {\n    return [\n      { value: '=', label: '=' },\n      { value: '!=', label: '!=' },\n      { value: 'is-empty', label: 'is empty' },\n      { value: 'in', label: 'in', description: 'Is one of' },\n      { value: 'not-in', label: 'not in', description: 'Is not one of' },\n      { value: '=~', label: '=~', description: 'Matches regex' },\n      { value: '!~', label: '!~', description: 'Does not match regex' },\n    ];\n  }\n}\n\nexport const operatorsRepository = new OperatorsRepository();\n","export const isPrivateLabel = (label: string) => label.startsWith('__');\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { labelsRepository } from '../../../infrastructure/labels/labelsRepository';\nimport { operatorsRepository } from '../infrastructure/operatorsRepository';\nimport { filtersToQuery } from './helpers/filtersToQuery';\nimport { getLastFilter } from './helpers/getLastFilter';\nimport { isPrivateLabel } from './helpers/isPrivateLabel';\nimport { FilterKind, Filters, QueryBuilderContext, QueryBuilderEvent, Suggestions } from './types';\n\ntype ServiceFn<TContext, TEvent> = (context: TContext, event: TEvent) => Promise<Suggestions | Error>;\ntype Services<TContext, TEvent> = Record<string, ServiceFn<TContext, TEvent>>;\n\nfunction handleError(error: Error, info: string) {\n  const isAbortError = error instanceof DOMException && error.name === 'AbortError';\n  if (isAbortError) {\n    return [];\n  }\n\n  logger.error(error, { info });\n  throw error;\n}\n\nexport const services: Services<QueryBuilderContext, QueryBuilderEvent> = {\n  fetchLabels: async (context) => {\n    const { from, to } = context.inputParams;\n\n    try {\n      const labels = await labelsRepository.listLabels({ query: context.query, from, to });\n\n      const publicLabels: Suggestions = [];\n      const privateLabels: Suggestions = [];\n\n      // place private labels at the bottom of the suggestions list\n      labels.forEach((label) => {\n        if (isPrivateLabel(label.value)) {\n          privateLabels.push(label);\n        } else {\n          publicLabels.push(label);\n        }\n      });\n\n      return [...publicLabels, ...privateLabels];\n    } catch (error) {\n      return handleError(error as Error, 'Error while fetching labels!');\n    }\n  },\n  fetchOperators: async () => {\n    try {\n      return await operatorsRepository.list();\n    } catch (error) {\n      return handleError(error as Error, 'Error while fetching operators!');\n    }\n  },\n  // TODO: refactor indeed\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  fetchLabelValues: async (context) => {\n    let { query, edition, suggestions } = context;\n    let targetFilter;\n\n    try {\n      if (edition) {\n        const filters = context.filters.filter((filter) => {\n          if (filter.id === edition!.filterId) {\n            targetFilter = filter;\n            return false;\n          }\n\n          return true;\n        }) as Filters;\n\n        if (!targetFilter) {\n          throw new Error(`Impossible to edit filter id=\"${edition.filterId}\": no filter found!`);\n        }\n\n        query = filtersToQuery(query, filters);\n      } else {\n        targetFilter = getLastFilter(context.filters);\n\n        if (targetFilter?.type !== FilterKind.partial) {\n          throw new Error('Impossible to load label values: no partial filter found!');\n        }\n      }\n\n      if (suggestions.disabled) {\n        return [];\n      }\n\n      const labelId = targetFilter.attribute.value;\n      const { from, to } = context.inputParams;\n\n      return await labelsRepository.listLabelValues({ label: labelId, query, from, to });\n    } catch (error) {\n      return handleError(error as Error, 'Error while fetching label values!');\n    }\n  },\n};\n","import { State, StateNodeConfig } from 'xstate';\n\nimport { QueryBuilderContext, QueryBuilderEvent } from '../types';\n\nexport const autoSuggestProxy: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  // epsilon transition to automatically suggests missing partial filter parts\n  always: [\n    {\n      cond: 'shouldSuggestOperators',\n      target: 'loadOperators',\n    },\n    {\n      cond: 'shouldSuggestValues',\n      target: 'loadLabelValues',\n    },\n    { target: 'idle' },\n  ],\n};\n","export const MESSAGES = {\n  FILTER_ADD: 'Filter by label values...',\n  SELECT_LABEL: 'Select a label...',\n  SELECT_OPERATOR: 'Select an operator...',\n  SELECT_VALUE: 'Select a value...',\n  SELECT_VALUES: 'Select values...',\n  TYPE_VALUE: 'Type a regex...',\n  LOADING: 'Loading...',\n  ERROR_LOAD: 'An unexpected error occurred while loading! Please try again.',\n  SUGGESTIONS_NONE: 'No suggestions available.',\n  SUGGESTIONS_DISABLED: 'Suggestions are disabled for this label.',\n};\n","import { OperatorKind } from '../types';\n\nexport const isRegexOperator = (operator: string | OperatorKind) =>\n  operator === OperatorKind['=~'] || operator === OperatorKind['!~'];\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { MESSAGES } from '../../ui/constants';\nimport { getLastFilter } from '../helpers/getLastFilter';\nimport { isMultipleValuesOperator } from '../helpers/isMultipleValuesOperator';\nimport { isPartialFilter } from '../helpers/isPartialFilter';\nimport { isRegexOperator } from '../helpers/isRegexOperator';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent } from '../types';\n\nexport const idle: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: [\n    'cancelAllLoad',\n    assign({\n      // eslint-disable-next-line sonarjs/cognitive-complexity\n      suggestions: (context) => {\n        let placeholder = MESSAGES.FILTER_ADD;\n        let allowCustomValue = false;\n        const lastFilter = getLastFilter(context.filters);\n\n        if (lastFilter && isPartialFilter(lastFilter)) {\n          if (!lastFilter.operator) {\n            placeholder = MESSAGES.SELECT_OPERATOR;\n          } else {\n            allowCustomValue = isRegexOperator(lastFilter.operator.value);\n\n            placeholder = isMultipleValuesOperator(lastFilter.operator.value)\n              ? MESSAGES.SELECT_VALUES\n              : allowCustomValue\n              ? MESSAGES.TYPE_VALUE\n              : MESSAGES.SELECT_VALUE;\n          }\n        }\n\n        return {\n          ...defaultContext.suggestions,\n          placeholder,\n          allowCustomValue,\n        };\n      },\n      edition: null,\n    }),\n  ],\n  on: {\n    START_INPUT: [\n      {\n        cond: 'shouldSuggestAttributes',\n        target: 'loadLabels',\n      },\n      {\n        cond: 'shouldSuggestOperators',\n        target: 'loadOperators',\n      },\n      {\n        cond: 'shouldSuggestValues',\n        target: 'loadLabelValues',\n      },\n    ],\n    EDIT_FILTER: [\n      {\n        cond: 'shouldEditAttribute',\n        target: 'loadLabels',\n        actions: ['setEdition'],\n      },\n      {\n        cond: 'shouldEditOperator',\n        target: 'loadOperators',\n        actions: ['setEdition'],\n      },\n      {\n        cond: 'shouldEditValue',\n        target: 'loadLabelValues',\n        actions: ['setEdition'],\n      },\n    ],\n    REMOVE_FILTER: [\n      {\n        cond: 'hasPartialFilter',\n        target: 'autoSuggestProxy',\n        actions: ['removeFilter'],\n      },\n      {\n        target: 'idle',\n        actions: ['removeFilter'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'idle',\n      actions: ['removeLastFilter'],\n    },\n    CHANGE_INPUT_PARAMS: {\n      target: 'idle',\n      actions: ['changeInputParams'],\n    },\n    EXECUTE_QUERY: {\n      target: 'idle',\n      actions: ['activateFilters'],\n    },\n  },\n};\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { MESSAGES } from '../../ui/constants';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent, SuggestionKind, Suggestions } from '../types';\n\nexport const loadLabels: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: () => ({\n      ...defaultContext.suggestions,\n      isVisible: true,\n      isLoading: true,\n    }),\n  }),\n  invoke: {\n    id: 'fetchLabels',\n    src: 'fetchLabels',\n    onDone: {\n      target: 'displayLabels',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: (event.data as Suggestions).filter(\n            ({ value }) => !context.filters.some((filter) => filter.attribute?.value === value)\n          ),\n          isLoading: false,\n        }),\n      }),\n    },\n    onError: {\n      target: 'displayLabels',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          isLoading: false,\n          error: event.data,\n        }),\n      }),\n    },\n  },\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n  },\n};\n\nexport const displayLabels: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: (context) => ({\n      ...context.suggestions,\n      type: SuggestionKind.attribute,\n      isVisible: true,\n      placeholder: MESSAGES.SELECT_LABEL,\n    }),\n  }),\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n    SELECT_SUGGESTION: [\n      {\n        cond: 'isEditing',\n        target: 'loadOperators',\n        actions: ['editFilterAttribute'],\n      },\n      {\n        target: 'loadOperators',\n        actions: ['setFilterAttribute'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'idle',\n      actions: ['removeLastFilter'],\n    },\n  },\n};\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { invariant } from '../../../../types/helpers/invariant';\nimport { MESSAGES } from '../../ui/constants';\nimport { getFilterUnderEdition } from '../helpers/getFilterUnderEdition';\nimport { getLastFilter } from '../helpers/getLastFilter';\nimport { isMultipleValuesOperator } from '../helpers/isMultipleValuesOperator';\nimport { isPrivateLabel } from '../helpers/isPrivateLabel';\nimport { isRegexOperator } from '../helpers/isRegexOperator';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent, SuggestionKind } from '../types';\n\nexport const loadLabelValues: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: (context) => {\n      const targetFilter = context.edition ? getFilterUnderEdition(context) : getLastFilter(context.filters);\n\n      invariant(typeof targetFilter?.operator !== undefined, 'No operator for the target filter!');\n\n      return {\n        ...defaultContext.suggestions,\n        disabled:\n          // don't fetch for these operators, an input will appear in the UI instead of a select\n          ['=~', '!~'].includes(targetFilter!.operator!.value) ||\n          // See https://github.com/grafana/pyroscope-app-plugin/issues/335\n          isPrivateLabel(targetFilter!.attribute!.value),\n        isVisible: true,\n        isLoading: true,\n      };\n    },\n  }),\n  invoke: {\n    id: 'fetchLabelValues',\n    src: 'fetchLabelValues',\n    onDone: {\n      target: 'displayLabelValues',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: event.data,\n          isLoading: false,\n        }),\n      }),\n    },\n    onError: {\n      target: 'displayLabelValues',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: [],\n          isLoading: false,\n          error: event.data,\n        }),\n      }),\n    },\n  },\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n  },\n};\n\nexport const displayLabelValues: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    // eslint-disable-next-line sonarjs/cognitive-complexity\n    suggestions: (context) => {\n      const targetFilter = context.edition ? getFilterUnderEdition(context) : getLastFilter(context.filters);\n\n      invariant(typeof targetFilter?.operator !== undefined, 'No operator for the target filter!');\n\n      const targetOperator = targetFilter!.operator!.value;\n\n      const allowCustomValue =\n        isRegexOperator(targetOperator) ||\n        // See https://github.com/grafana/pyroscope-app-plugin/issues/335\n        context.suggestions.disabled;\n\n      const multiple = isMultipleValuesOperator(targetOperator);\n\n      let placeholder: string;\n\n      if (allowCustomValue) {\n        placeholder = MESSAGES.TYPE_VALUE;\n      } else {\n        placeholder = multiple ? MESSAGES.SELECT_VALUES : MESSAGES.SELECT_VALUE;\n      }\n\n      let noOptionsMessage: string;\n\n      if (context.suggestions.error) {\n        noOptionsMessage = MESSAGES.ERROR_LOAD;\n      } else {\n        noOptionsMessage = context.suggestions.disabled ? MESSAGES.SUGGESTIONS_DISABLED : MESSAGES.SUGGESTIONS_NONE;\n      }\n\n      return {\n        ...context.suggestions,\n        type: SuggestionKind.value,\n        isVisible: true,\n        placeholder,\n        noOptionsMessage,\n        allowCustomValue,\n        multiple,\n      };\n    },\n  }),\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n    SELECT_SUGGESTION: [\n      {\n        cond: 'isEditing',\n        target: 'autoSuggestProxy',\n        actions: ['editFilterValue'],\n      },\n      {\n        target: 'idle',\n        actions: ['setFilterValue'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'loadOperators',\n      actions: ['removeLastFilter'],\n    },\n  },\n};\n","import { assign, State, StateNodeConfig } from 'xstate';\n\nimport { MESSAGES } from '../../ui/constants';\nimport { defaultContext } from '../stateMachine';\nimport { QueryBuilderContext, QueryBuilderEvent, SuggestionKind } from '../types';\n\nexport const loadOperators: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: () => ({\n      ...defaultContext.suggestions,\n      isVisible: true,\n      isLoading: true,\n    }),\n  }),\n  invoke: {\n    id: 'fetchOperators',\n    src: 'fetchOperators',\n    onDone: {\n      target: 'displayOperators',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: event.data,\n          isLoading: false,\n        }),\n      }),\n    },\n    onError: {\n      target: 'displayOperators',\n      actions: assign({\n        suggestions: (context, event) => ({\n          ...context.suggestions,\n          items: [],\n          isLoading: false,\n          error: event.data,\n        }),\n      }),\n    },\n  },\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n  },\n};\n\nexport const displayOperators: StateNodeConfig<\n  QueryBuilderContext,\n  State<QueryBuilderContext, QueryBuilderEvent>,\n  QueryBuilderEvent\n> = {\n  entry: assign({\n    suggestions: (context) => ({\n      ...context.suggestions,\n      type: SuggestionKind.operator,\n      isVisible: true,\n      placeholder: MESSAGES.SELECT_OPERATOR,\n      allowCustomValue: false,\n      multiple: false,\n    }),\n  }),\n  on: {\n    DISCARD_SUGGESTIONS: 'idle',\n    SELECT_SUGGESTION: [\n      // edition\n      {\n        cond: 'shouldSuggestValuesAfterOperatorEdition',\n        target: 'loadLabelValues',\n        actions: ['editFilterOperator'],\n      },\n      {\n        cond: 'shouldNotSuggestValuesAfterOperatorEdition',\n        target: 'autoSuggestProxy',\n        actions: ['editFilterOperator'],\n      },\n      // no edition\n      {\n        cond: 'hasPartialFilter',\n        target: 'autoSuggestProxy',\n        actions: ['setFilterOperator'],\n      },\n      {\n        target: 'loadLabelValues',\n        actions: ['setFilterOperator'],\n      },\n    ],\n    REMOVE_LAST_FILTER: {\n      target: 'loadLabels',\n      actions: ['removeLastFilter'],\n    },\n  },\n};\n","import { createMachine, interpret, Interpreter, type MachineConfig, type MachineOptions } from 'xstate';\n\nimport { actions } from './actions';\nimport { guards } from './guards';\nimport { queryToFilters } from './helpers/queryToFilters';\nimport { services } from './services';\nimport { autoSuggestProxy } from './states/autoSuggestProxy';\nimport { idle } from './states/idle';\nimport { displayLabels, loadLabels } from './states/loadLabels';\nimport { displayLabelValues, loadLabelValues } from './states/loadLabelValues';\nimport { displayOperators, loadOperators } from './states/loadOperators';\nimport { InputParams, QueryBuilderContext, QueryBuilderEvent, QueryBuilderSchema } from './types';\n\nexport const defaultContext: QueryBuilderContext = Object.freeze({\n  inputParams: {\n    query: '',\n    from: 0,\n    to: 0,\n  },\n  query: '',\n  filters: [],\n  isQueryUpToDate: true,\n  edition: null,\n  suggestions: {\n    type: null,\n    items: [],\n    isVisible: false,\n    isLoading: false,\n    error: null,\n    placeholder: '',\n    noOptionsMessage: '',\n    allowCustomValue: false,\n    multiple: false,\n    disabled: false,\n  },\n});\n\nconst config = (\n  context: QueryBuilderContext\n): MachineConfig<QueryBuilderContext, QueryBuilderSchema, QueryBuilderEvent> => ({\n  id: 'query-builder',\n  initial: 'idle',\n  context,\n  predictableActionArguments: true,\n  states: {\n    idle,\n    loadLabels,\n    displayLabels,\n    loadOperators,\n    displayOperators,\n    loadLabelValues,\n    displayLabelValues,\n    autoSuggestProxy,\n  },\n});\n\nconst options: MachineOptions<QueryBuilderContext, QueryBuilderEvent> = {\n  guards,\n  services,\n  actions,\n};\n\nexport type Actor = Interpreter<QueryBuilderContext, QueryBuilderSchema, QueryBuilderEvent>;\n\nexport function buildStateMachine(inputParams: InputParams) {\n  const { query } = inputParams;\n\n  const initialContext: QueryBuilderContext = {\n    ...defaultContext,\n    inputParams,\n    query,\n    // See changeInputParams() in domain/actions.ts\n    filters: queryToFilters(query),\n  };\n\n  const stateMachine = createMachine(config(initialContext), options);\n\n  const actor = interpret(stateMachine) as unknown as Actor;\n\n  return { actor, initialContext };\n}\n","const collator = new Intl.Collator('en', { sensitivity: 'case' });\n\nexport const localeCompare = collator.compare;\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { MultiSelect, useStyles2 } from '@grafana/ui';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport { Suggestion, Suggestions } from '../../domain/types';\nimport { MESSAGES } from '../constants';\n\ntype MultipleEditionSelectProps = {\n  selection: Suggestion;\n  suggestions: any;\n  onCloseMenu: (values: Suggestions) => void;\n};\n\nconst placeSelectedValuesFirst = (values: Suggestions) => (a: Suggestion, b: Suggestion) => {\n  const aIsSelected = values.some((v) => v.value === a.value);\n  const bIsSelected = values.some((v) => v.value === b.value);\n\n  if (aIsSelected && bIsSelected) {\n    return localeCompare(a.value, b.value);\n  }\n\n  if (bIsSelected) {\n    return +1;\n  }\n\n  if (aIsSelected) {\n    return -1;\n  }\n\n  return 0;\n};\n\nexport function MultipleEditionSelect({ selection, suggestions, onCloseMenu }: MultipleEditionSelectProps) {\n  const styles = useStyles2(getStyles);\n\n  const defaultValue = useMemo(() => {\n    const selectionValues = selection.value.split('|');\n    const selectionLabels = selection.label.split(', ');\n    return selectionValues.map((v, i) => ({ value: v, label: selectionLabels[i] }));\n  }, [selection]);\n\n  const [values, setValues] = useState<Suggestions>(defaultValue);\n\n  // we don't sort when values change so that, for long lists, the user keeps the context they're in\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const sortedOptions = useMemo(() => suggestions.items.sort(placeSelectedValuesFirst(values)), [suggestions.items]);\n\n  const onChange = useCallback((newValues: Array<SelectableValue<string>>) => {\n    setValues(newValues.map(({ value = '', label = '' }) => ({ value, label })));\n  }, []);\n\n  const onInternalCloseMenu = useCallback(() => {\n    onCloseMenu(values);\n  }, [onCloseMenu, values]);\n\n  return (\n    <MultiSelect\n      className={styles.editionSelect}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      hideSelectedOptions={false}\n      backspaceRemovesValue\n      // auto focus required when switching from another operator type\n      autoFocus\n      value={values}\n      onChange={onChange}\n      onCloseMenu={onInternalCloseMenu}\n      options={sortedOptions}\n      isOpen\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n\nconst getStyles = () => ({\n  editionSelect: css`\n    position: absolute;\n    z-index: 1;\n\n    [aria-label='Remove'] svg {\n      display: none;\n    }\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Input, useStyles2 } from '@grafana/ui';\nimport React, { useEffect, useRef, useState } from 'react';\n\ntype SingleEditionInputProps = {\n  placeholder: string;\n  onChange: (suggestion: SelectableValue<string>) => void;\n  onBlur: () => void;\n  defaultValue?: string;\n  onFocus?: () => void;\n};\n\nexport function SingleEditionInput({ placeholder, defaultValue, onFocus, onChange, onBlur }: SingleEditionInputProps) {\n  const styles = useStyles2(getStyles);\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [invalid, setInvalid] = useState(false);\n\n  const onKeyUp = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    const value = (e.target as HTMLInputElement).value.trim();\n\n    // TODO: introduce an \"is empty\" value to handle this case (so that the filter will be synced in the URL)?\n    // see https://github.com/grafana/profiles-drilldown/pull/205\n    if (e.code === 'Enter') {\n      if (value) {\n        onChange({ value, label: value });\n      } else {\n        setInvalid(true);\n      }\n    }\n  };\n\n  const onInternalBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    const value = (e.target as HTMLInputElement).value.trim();\n\n    // TODO: introduce an \"is empty\" value to handle this case (so that the filter will be synced in the URL)?\n    // see https://github.com/grafana/explore-profiles/pull/205\n    if (value) {\n      onChange({ value, label: value });\n    } else {\n      onBlur();\n    }\n  };\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  return (\n    <Input\n      ref={inputRef}\n      className={cx(defaultValue && styles.edition)}\n      invalid={invalid}\n      placeholder={placeholder}\n      defaultValue={defaultValue}\n      onFocus={onFocus}\n      onKeyUp={onKeyUp}\n      onBlur={onInternalBlur}\n    />\n  );\n}\n\nconst getStyles = () => ({\n  edition: css`\n    position: absolute;\n    z-index: 1;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Select, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { Suggestion } from '../../domain/types';\nimport { MESSAGES } from '../constants';\nimport { SingleEditionInput } from '../inputs/SingleEditionInput';\n\nconst getStyles = () => ({\n  editionSelect: css`\n    position: absolute;\n    z-index: 1;\n    min-width: 160px;\n    box-shadow: none;\n\n    & input:focus {\n      outline: none !important;\n    }\n  `,\n});\n\ntype EditionSelectProps = {\n  selection: Suggestion;\n  suggestions: any;\n  onChange: (suggestion: SelectableValue<string>) => void;\n  onCloseMenu: () => void;\n};\n\nexport function SingleEditionSelect({ selection, suggestions, onChange, onCloseMenu }: EditionSelectProps) {\n  const styles = useStyles2(getStyles);\n\n  if (suggestions.allowCustomValue) {\n    return (\n      <SingleEditionInput\n        defaultValue={selection.value}\n        placeholder={suggestions.placeholder}\n        onChange={onChange}\n        onBlur={onCloseMenu}\n      />\n    );\n  }\n\n  return (\n    <Select\n      className={styles.editionSelect}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      autoFocus\n      value={selection.value}\n      onChange={onChange}\n      onCloseMenu={onCloseMenu}\n      options={suggestions.items}\n      isOpen\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n","import { cx } from '@emotion/css';\nimport { Tag, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { CompleteFilter, FilterPartKind } from '../../domain/types';\nimport { getStyles } from './Chiclet';\n\ntype ChicletAttributeOperatorValueProps = {\n  filter: CompleteFilter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter, part: FilterPartKind) => void;\n  onRemove: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n};\n\nconst noOp = () => {};\n\nexport const ChicletAttributeOperator = ({ filter, onClick, onRemove }: ChicletAttributeOperatorValueProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { attribute, operator, active } = filter;\n  const className = active ? styles.chiclet : cx(styles.chiclet, styles.inactiveChiclet);\n\n  return (\n    <div className={className} aria-label=\"Filter\">\n      <Tag aria-label=\"Filter label\" className={styles.chicletAttribute} name={attribute.label} onClick={noOp} />\n\n      <Tag\n        aria-label=\"Filter operator\"\n        className={styles.chicletOperator}\n        name={operator.label}\n        onClick={(name, e) => onClick(e, filter, FilterPartKind.operator)}\n        tabIndex={0}\n      />\n\n      <Tag\n        aria-label=\"Remove filter\"\n        className={styles.chicletRemoveButton}\n        icon=\"times\"\n        name=\"\"\n        onClick={(name, e) => onRemove(e, filter)}\n        tabIndex={0}\n      />\n    </div>\n  );\n};\n","import { cx } from '@emotion/css';\nimport { Tag, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { CompleteFilter, FilterPartKind } from '../../domain/types';\nimport { getStyles } from './Chiclet';\n\ntype ChicletAttributeOperatorValueProps = {\n  filter: CompleteFilter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter, part: FilterPartKind) => void;\n  onRemove: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n};\n\nconst noOp = () => {};\n\nexport const ChicletAttributeOperatorValue = ({ filter, onClick, onRemove }: ChicletAttributeOperatorValueProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { attribute, operator, value, active } = filter;\n  const className = active ? styles.chiclet : cx(styles.chiclet, styles.inactiveChiclet);\n\n  return (\n    <div className={className} aria-label=\"Filter\">\n      <Tag aria-label=\"Filter label\" className={styles.chicletAttribute} name={attribute.label} onClick={noOp} />\n\n      <Tag\n        aria-label=\"Filter operator\"\n        className={styles.chicletOperator}\n        name={operator.label}\n        onClick={(name, e) => onClick(e, filter, FilterPartKind.operator)}\n        tabIndex={0}\n      />\n\n      <Tooltip content={value.label}>\n        <Tag\n          aria-label=\"Filter value\"\n          name={value.label}\n          className={styles.chicletValue}\n          onClick={(name, e) => onClick(e, filter, FilterPartKind.value)}\n          tabIndex={0}\n        />\n      </Tooltip>\n\n      <Tag\n        aria-label=\"Remove filter\"\n        className={styles.chicletRemoveButton}\n        icon=\"times\"\n        name=\"\"\n        onClick={(name, e) => onRemove(e, filter)}\n        tabIndex={0}\n      />\n    </div>\n  );\n};\n","import { cx } from '@emotion/css';\nimport { Tag, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { FilterPartKind, PartialFilter } from '../../domain/types';\nimport { getStyles } from './Chiclet';\n\ntype PartialChicletProps = {\n  filter: PartialFilter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: PartialFilter, part: FilterPartKind) => void;\n};\n\nexport const PartialChiclet = ({ filter, onClick }: PartialChicletProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { attribute, operator } = filter;\n  if (!attribute && !operator) {\n    return null;\n  }\n\n  return (\n    <div className={cx(styles.chiclet, styles.partialChiclet)} aria-label=\"Partial filter\">\n      <Tag\n        colorIndex={9}\n        name={attribute.label}\n        title={`Edit \"${attribute.label}\"`}\n        onClick={(name, e) => onClick(e, filter, FilterPartKind.attribute)}\n        tabIndex={0}\n      />\n\n      {operator && (\n        <Tag\n          colorIndex={9}\n          name={operator.label}\n          title={`Edit \"${operator.label}\"`}\n          className={styles.chicletOperator}\n          onClick={(name, e) => onClick(e, filter, FilterPartKind.operator)}\n          tabIndex={0}\n        />\n      )}\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport React, { memo } from 'react';\n\nimport { CompleteFilter, Filter, FilterKind, FilterPartKind } from '../../domain/types';\nimport { ChicletAttributeOperator } from './ChicletAttributeOperator';\nimport { ChicletAttributeOperatorValue } from './ChicletAttributeOperatorValue';\nimport { PartialChiclet } from './PartialChiclet';\n\ntype ChicletProps = {\n  filter: Filter;\n  onClick: (event: React.MouseEvent<HTMLElement>, filter: Filter, part: FilterPartKind) => void;\n  onRemove: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n};\n\nconst activeBackgroundColor = 'rgb(61, 113, 217)';\nconst activeTextColor = '#fff';\nconst inactiveBorderColor = '#4a4b52';\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  chiclet: css`\n    display: flex;\n    align-items: center;\n    border: 1px solid ${activeBackgroundColor};\n    border-radius: 2px;\n\n    & > button {\n      height: 30px;\n      background-color: ${theme.colors.background.primary};\n      color: ${theme.colors.text.maxContrast};\n    }\n\n    & > :first-child {\n      background-color: ${activeBackgroundColor};\n      color: ${activeTextColor};\n      border-radius: 0;\n\n      &:hover {\n        cursor: not-allowed !important;\n      }\n    }\n\n    & > :last-child {\n      border-left: 1px solid ${activeBackgroundColor};\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n    }\n  `,\n  partialChiclet: css`\n    border-color: ${inactiveBorderColor};\n    border-right: 0;\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n\n    & > :first-child {\n      background-color: ${theme.colors.background.secondary};\n      color: ${theme.colors.text.maxContrast};\n      border-radius: 0;\n      border-left: 0;\n\n      &:hover {\n        cursor: pointer !important;\n      }\n    }\n\n    & > :last-child {\n      border-color: ${inactiveBorderColor};\n      color: ${theme.colors.text.maxContrast};\n    }\n  `,\n  inactiveChiclet: css`\n    border-color: ${inactiveBorderColor};\n\n    & > button {\n      color: ${theme.colors.text.maxContrast};\n    }\n\n    & > :first-child {\n      background-color: ${theme.colors.background.secondary};\n      color: ${theme.colors.text.maxContrast};\n    }\n\n    & > :last-child {\n      border-color: ${inactiveBorderColor};\n    }\n  `,\n  chicletAttribute: css`\n    &:hover {\n      opacity: 1 !important;\n    }\n  `,\n  chicletOperator: css`\n    &:hover {\n      background-color: ${theme.colors.background.secondary};\n    }\n  `,\n  chicletValue: css`\n    flex-grow: 1;\n    text-align: left;\n    max-width: 420px;\n    text-overflow: ellipsis;\n    text-wrap: nowrap;\n    overflow: hidden;\n\n    &:hover {\n      background-color: ${theme.colors.background.secondary};\n    }\n  `,\n  chicletRemoveButton: css`\n    &:hover {\n      background-color: ${theme.colors.background.secondary};\n    }\n\n    & svg {\n      width: 12px;\n      height: 12px;\n    }\n  `,\n});\n\nconst ChicletComponent = ({ filter, onClick, onRemove }: ChicletProps) => {\n  switch (filter.type) {\n    case FilterKind.partial:\n      return <PartialChiclet filter={filter} onClick={onClick} />;\n\n    case FilterKind['attribute-operator-value']:\n      return <ChicletAttributeOperatorValue filter={filter as CompleteFilter} onClick={onClick} onRemove={onRemove} />;\n\n    case FilterKind['attribute-operator']:\n      return <ChicletAttributeOperator filter={filter as CompleteFilter} onClick={onClick} onRemove={onRemove} />;\n\n    default:\n      throw new TypeError(`Unsupported filter type \"${filter.type}\" (${JSON.stringify(filter)})!`);\n  }\n};\n\nexport const Chiclet = memo(\n  ChicletComponent,\n  (prevProps, nextProps) => JSON.stringify(prevProps.filter) === JSON.stringify(nextProps.filter)\n);\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { memo } from 'react';\n\nimport {\n  CompleteFilter,\n  Edition,\n  Filter,\n  FilterPartKind,\n  Filters,\n  QueryBuilderContext,\n  Suggestion,\n  Suggestions,\n} from '../../domain/types';\nimport { MultipleEditionSelect } from '../selects/MultipleEditionSelect';\nimport { SingleEditionSelect } from '../selects/SingleEditionSelect';\nimport { Chiclet } from './Chiclet';\n\nconst getStyles = () => ({\n  chicletsList: css`\n    display: flex;\n    align-items: center;\n    flex-wrap: wrap;\n    gap: 4px;\n  `,\n  editChicletContainer: css`\n    position: relative;\n  `,\n});\n\ntype ChicletsListProps = {\n  filters: Filters;\n  onClickChiclet: (event: React.MouseEvent<HTMLElement>, filter: Filter, part: FilterPartKind) => void;\n  onRemoveChiclet: (event: React.MouseEvent<HTMLElement>, filter: CompleteFilter) => void;\n  edition: Edition | null;\n  suggestions: QueryBuilderContext['suggestions'];\n  onChangeSingleSuggestion: (suggestion: SelectableValue<string>) => void;\n  onCloseSingleSuggestionsMenu: () => void;\n  onCloseMultipleSuggestionsMenu: (values: Suggestions) => void;\n};\n\nfunction ChicletsListComponent({\n  filters,\n  onClickChiclet,\n  onRemoveChiclet,\n  edition,\n  suggestions,\n  onChangeSingleSuggestion,\n  onCloseSingleSuggestionsMenu,\n  onCloseMultipleSuggestionsMenu,\n}: ChicletsListProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.chicletsList} data-testid=\"filtersList\">\n      {filters.map((filter) => (\n        <div key={filter.id} className={styles.editChicletContainer}>\n          <Chiclet filter={filter} onClick={onClickChiclet} onRemove={onRemoveChiclet} />\n\n          {edition?.filterId === filter.id ? (\n            !suggestions.multiple ? (\n              <SingleEditionSelect\n                // we add a key to force to unmount the component. this prevents the operator to stick when editing label values\n                key={edition.part}\n                selection={filter[edition.part] as Suggestion}\n                suggestions={suggestions}\n                onChange={onChangeSingleSuggestion}\n                onCloseMenu={onCloseSingleSuggestionsMenu}\n              />\n            ) : (\n              <MultipleEditionSelect\n                selection={filter[edition.part] as Suggestion}\n                suggestions={suggestions}\n                onCloseMenu={onCloseMultipleSuggestionsMenu}\n              />\n            )\n          ) : null}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport const ChicletsList = memo(ChicletsListComponent);\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Select, useStyles2 } from '@grafana/ui';\nimport React, { useEffect, useState } from 'react';\n\nimport { MESSAGES } from '../constants';\nimport { SingleEditionInput } from '../inputs/SingleEditionInput';\n\nexport const getStyles = () => ({\n  select: css`\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  `,\n});\n\ntype SingleSelectProps = {\n  suggestions: any;\n  onFocus: () => void;\n  onChange: (suggestion: SelectableValue<string>) => void;\n  onKeyDown: (event: any) => void;\n  onCloseMenu: () => void;\n};\n\n// we use this hack to force the select to open after (e.g.) editing an existing attribute\n// in this case, regardless that the `isOpen` prop of the <Select /> component is true\n// the dropdown does not appear on the UI\n// it seems it's a bug from the <Select /> component itself\n// TODO: report it!\nfunction useEnsureIsOpenHack(isVisible: boolean) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  useEffect(() => {\n    if (isVisible && !isOpen) {\n      setTimeout(() => setIsOpen(true), 0);\n      return;\n    }\n\n    if (isVisible !== isOpen) {\n      setIsOpen(isVisible);\n    }\n  }, [isOpen, isVisible]);\n\n  return isOpen;\n}\n\nexport function SingleSelect({ suggestions, onFocus, onChange, onKeyDown, onCloseMenu }: SingleSelectProps) {\n  const styles = useStyles2(getStyles);\n  const isOpen = useEnsureIsOpenHack(suggestions.isVisible);\n\n  if (suggestions.allowCustomValue) {\n    return (\n      <SingleEditionInput\n        placeholder={suggestions.placeholder}\n        onFocus={onFocus}\n        onChange={onChange}\n        onBlur={onCloseMenu}\n      />\n    );\n  }\n\n  return (\n    <Select\n      className={styles.select}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      value={null}\n      onFocus={onFocus}\n      onKeyDown={onKeyDown}\n      onChange={onChange}\n      onCloseMenu={onCloseMenu}\n      options={suggestions.items}\n      isOpen={isOpen}\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n","import { Select, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { MESSAGES } from '../constants';\nimport { getStyles } from './SingleSelect';\n\nconst noOp = () => {};\n\nexport function DisabledSelect() {\n  const styles = useStyles2(getStyles);\n\n  return <Select disabled className={styles.select} placeholder={MESSAGES.FILTER_ADD} onChange={noOp} />;\n}\n","import { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { MultiSelect, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\n\nimport { Suggestions } from '../../domain/types';\nimport { MESSAGES } from '../constants';\n\ntype MultipleSelectProps = {\n  suggestions: any;\n  onFocus: () => void;\n  onKeyDown: (event: any, values: Suggestions) => void;\n  onCloseMenu: (values: Suggestions) => void;\n};\n\nexport function MultipleSelect({ suggestions, onFocus, onKeyDown, onCloseMenu }: MultipleSelectProps) {\n  const styles = useStyles2(getStyles);\n  const [values, setValues] = useState<Suggestions>([]);\n\n  const onChange = useCallback((newValues: Array<SelectableValue<string>>) => {\n    setValues(newValues.map(({ value = '', label = '' }) => ({ value, label })));\n  }, []);\n\n  const onInternalKeyDown = useCallback(\n    (event: any) => {\n      onKeyDown(event, values);\n    },\n    [onKeyDown, values]\n  );\n\n  const onInternalCloseMenu = useCallback(() => {\n    onCloseMenu(values);\n  }, [onCloseMenu, values]);\n\n  return (\n    <MultiSelect\n      className={styles.select}\n      placeholder={suggestions.placeholder}\n      loadingMessage={MESSAGES.LOADING}\n      closeMenuOnSelect={false}\n      hideSelectedOptions={false}\n      backspaceRemovesValue\n      // auto focus required when switching from another operator type\n      autoFocus\n      value={values}\n      onFocus={onFocus}\n      onKeyDown={onInternalKeyDown}\n      onChange={onChange}\n      onCloseMenu={onInternalCloseMenu}\n      options={suggestions.items}\n      isOpen={suggestions.isVisible}\n      isLoading={suggestions.isLoading}\n      invalid={Boolean(suggestions.error)}\n      noOptionsMessage={suggestions.noOptionsMessage}\n    />\n  );\n}\n\nconst getStyles = () => ({\n  select: css`\n    [aria-label='Remove'] svg {\n      display: none;\n    }\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { usePrevious } from '@shared/components/QueryBuilder/ui/hooks';\nimport React, { memo, useCallback, useEffect } from 'react';\nimport { StateListener } from 'xstate/lib/interpreter';\n\nimport { Actor } from './domain/stateMachine';\nimport {\n  CompleteFilter,\n  CompleteFilters,\n  Filter,\n  FilterPartKind,\n  QueryBuilderContext,\n  QueryBuilderEvent,\n  Suggestions,\n} from './domain/types';\nimport { useStateMachine } from './domain/useStateMachine';\nimport { ChicletsList } from './ui/chiclets/ChicletsList';\nimport { DisabledSelect } from './ui/selects/DisabledSelect';\nimport { MultipleSelect } from './ui/selects/MultipleSelect';\nimport { SingleSelect } from './ui/selects/SingleSelect';\n\nconst getStyles = () => ({\n  queryBuilder: css`\n    display: flex;\n    justify-content: flex-start;\n    align-items: flex-end;\n    flex-wrap: wrap;\n    gap: 4px;\n    width: 100%;\n  `,\n  controls: css`\n    display: flex;\n    align-self: flex-start;\n    flex-grow: 1;\n  `,\n  executeButton: css`\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  `,\n});\n\nexport type QueryBuilderProps = {\n  id: string;\n  // TODO: after migrate the legacy comparison pages to Scenes, dataSourceUid will be mandatory\n  dataSourceUid?: string;\n  query: string;\n  from: number;\n  to: number;\n  onChangeQuery: (newQuery: string, filters: CompleteFilters) => void;\n  className?: string;\n  autoExecute?: boolean;\n};\n\nfunction QueryBuilderComponent(props: QueryBuilderProps) {\n  const styles = useStyles2(getStyles);\n\n  const { actor, internalProps } = useStateMachine(props);\n  const { filters, edition, isQueryUpToDate, suggestions } = internalProps;\n\n  const { onClickChiclet, onRemoveChiclet } = useChicletHandlers(actor);\n\n  const {\n    onFocus,\n    onChangeSingleSuggestion,\n    onSingleSelectKeyDown,\n    onCloseSingleMenu,\n    onMultipleSelectKeyDown,\n    onCloseMultipleMenu,\n  } = useSelectHandlers(actor, suggestions, props.id);\n\n  const onClickExecute = useCallback(() => {\n    actor.send({ type: 'EXECUTE_QUERY' });\n  }, [actor]);\n\n  useEffect(() => {\n    if (!props.autoExecute) {\n      return;\n    }\n\n    const onTransition: StateListener<QueryBuilderContext, QueryBuilderEvent> = ({ value, context, event }) => {\n      if (value === 'idle' && !context.isQueryUpToDate && event.type !== 'EXECUTE_QUERY') {\n        actor.send({ type: 'EXECUTE_QUERY' });\n      }\n    };\n\n    actor.onTransition(onTransition);\n\n    return () => {\n      actor.off(onTransition);\n    };\n  }, [actor, props.autoExecute]);\n\n  return (\n    <div id={props.id} className={cx(styles.queryBuilder, props.className)}>\n      {filters.length > 0 ? (\n        <ChicletsList\n          filters={filters}\n          onClickChiclet={onClickChiclet}\n          onRemoveChiclet={onRemoveChiclet}\n          edition={edition}\n          suggestions={suggestions}\n          onChangeSingleSuggestion={onChangeSingleSuggestion}\n          onCloseSingleSuggestionsMenu={onCloseSingleMenu}\n          onCloseMultipleSuggestionsMenu={onCloseMultipleMenu}\n        />\n      ) : null}\n\n      <div className={styles.controls}>\n        {edition ? (\n          <DisabledSelect />\n        ) : suggestions.multiple ? (\n          <MultipleSelect\n            suggestions={suggestions}\n            onFocus={onFocus}\n            onKeyDown={onMultipleSelectKeyDown}\n            onCloseMenu={onCloseMultipleMenu}\n          />\n        ) : (\n          <SingleSelect\n            suggestions={suggestions}\n            onFocus={onFocus}\n            onChange={onChangeSingleSuggestion}\n            onKeyDown={onSingleSelectKeyDown}\n            onCloseMenu={onCloseSingleMenu}\n          />\n        )}\n\n        {!props.autoExecute && (\n          <Button\n            onClick={onClickExecute}\n            tooltip={!isQueryUpToDate ? 'Execute new query' : 'Nothing to execute, all filters applied'}\n            className={styles.executeButton}\n            disabled={isQueryUpToDate}\n          >\n            Execute\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction useChicletHandlers(actor: Actor) {\n  const onClickChiclet = useCallback(\n    (event: any, filter: Filter, part: FilterPartKind) => {\n      actor.send({ type: 'EDIT_FILTER', data: { filterId: filter.id, part } });\n    },\n    [actor]\n  );\n\n  const onRemoveChiclet = useCallback(\n    (event: any, filter: CompleteFilter) => {\n      actor.send({ type: 'REMOVE_FILTER', data: filter.id });\n    },\n    [actor]\n  );\n\n  return {\n    onClickChiclet,\n    onRemoveChiclet,\n  };\n}\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nfunction useSelectHandlers(actor: Actor, suggestions: QueryBuilderContext['suggestions'], queryBuilderId: string) {\n  /* single & multiple */\n  const onFocus = useCallback(() => {\n    actor.send({ type: 'START_INPUT' });\n  }, [actor]);\n\n  /* single only */\n  const onChangeSingleSuggestion = useCallback(\n    (suggestion: SelectableValue<string>) => {\n      const { value = '', label = '' } = suggestion;\n\n      actor.send({ type: 'SELECT_SUGGESTION', data: { value, label } });\n    },\n    [actor]\n  );\n\n  const onSingleSelectKeyDown = useCallback(\n    (event: any) => {\n      if (event.code === 'Backspace' && !event.target.value) {\n        actor.send({ type: 'REMOVE_LAST_FILTER' });\n      }\n    },\n    [actor]\n  );\n\n  const onCloseSingleMenu = useCallback(() => {\n    actor.send({ type: 'DISCARD_SUGGESTIONS' });\n  }, [actor]);\n\n  /* multiple only */\n  const onMultipleSelectKeyDown = useCallback(\n    (event: any, values: Suggestions) => {\n      if (event.code === 'Backspace' && !event.target.value && !values.length) {\n        actor.send({ type: 'REMOVE_LAST_FILTER' });\n      }\n    },\n\n    [actor]\n  );\n\n  const onCloseMultipleMenu = useCallback(\n    (values: Suggestions) => {\n      if (values.length) {\n        actor.send({\n          type: 'SELECT_SUGGESTION',\n          data: { value: values.map((v) => v.value).join('|'), label: values.map((v) => v.label).join(', ') },\n        });\n      } else {\n        actor.send({ type: 'DISCARD_SUGGESTIONS' });\n      }\n    },\n    [actor]\n  );\n\n  /* misc */\n\n  const previousSuggestionsIsVisible = usePrevious(suggestions.isVisible);\n\n  useEffect(() => {\n    if (!suggestions.isVisible && previousSuggestionsIsVisible) {\n      // ensures that the input is blurred when a filter has been completed.\n      // we could have used blurInputOnSelect but this allows us to handle properly the case of\n      // editing a complete filter operator from (e.g.) =~ to = (and vice-versa).\n      // indeed, in such cases, we know if the input should be blurred only after selecting a\n      // suggestion, when the select is already rendered.\n      (document.querySelector(`#${queryBuilderId} input`) as HTMLInputElement)?.blur();\n    }\n  }, [suggestions.isVisible, previousSuggestionsIsVisible, queryBuilderId]);\n\n  return {\n    onFocus,\n    onChangeSingleSuggestion,\n    onSingleSelectKeyDown,\n    onMultipleSelectKeyDown,\n    onCloseSingleMenu,\n    onCloseMultipleMenu,\n  };\n}\n\nexport const QueryBuilder = memo(QueryBuilderComponent);\n","import { useEffect, useMemo, useState } from 'react';\n\nimport { QueryBuilderProps } from '../QueryBuilder';\nimport { buildStateMachine } from './stateMachine';\nimport { CompleteFilters, QueryBuilderContext } from './types';\n\nexport function useStateMachine({ dataSourceUid, query, from, to, onChangeQuery }: QueryBuilderProps) {\n  const { actor, initialContext } = useMemo(\n    () => buildStateMachine({ query, from, to }),\n    // We don't want to build a new state machine when the props change, props change is handheld via the CHANGE_INPUT_PARAMS action below\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n\n  useEffect(() => {\n    actor.send({ type: 'CHANGE_INPUT_PARAMS', data: { dataSourceUid, query, from, to } });\n  }, [actor, dataSourceUid, query, from, to]);\n\n  const [internalProps, setInternalProps] = useState<QueryBuilderContext>(initialContext);\n\n  useEffect(() => {\n    actor.start();\n\n    // actor.subscribe(({ value: state, event, context }) => {\n    //   logger.debug('*** %o', JSON.stringify(event));\n    //   logger.debug('***', JSON.stringify(context, null, 1));\n    //   logger.debug('*** ---------------------> \"%s\"', state);\n    actor.subscribe(({ event, context }) => {\n      if (event.type === 'EXECUTE_QUERY') {\n        onChangeQuery(context.query, context.filters as CompleteFilters);\n      }\n\n      setInternalProps(context);\n    });\n\n    return () => {\n      actor.stop();\n    };\n    // onChangeQuery is not a stable prop, we omit it to prevent multiple machine initializations that would end up in a broken UI\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [actor]);\n\n  return { actor, internalProps };\n}\n","/**\n * This is the same use react-use: usePrevious()\n * If more react-use like hooks are needed, we can consider adding react-use as a dependency\n */\nimport { useEffect, useRef } from 'react';\n\nexport function usePrevious<T>(state: T): T | undefined {\n  const ref = useRef<T>();\n\n  useEffect(() => {\n    ref.current = state;\n  });\n\n  return ref.current;\n}\n","import PROFILE_METRICS from './profile-metrics.json';\n\nexport type ProfileMetricId = keyof typeof PROFILE_METRICS;\n\nexport type ProfileMetric = {\n  id: ProfileMetricId;\n  description: string;\n  type: string;\n  group: string;\n  unit: string; // TODO: enum\n};\n\nexport function getProfileMetric(profileMetricId: ProfileMetricId): ProfileMetric {\n  if (PROFILE_METRICS[profileMetricId]) {\n    return PROFILE_METRICS[profileMetricId] as ProfileMetric;\n  }\n\n  const [group = '?', type = '?'] = profileMetricId ? profileMetricId.split(':') : [];\n\n  // TODO: add missing metrics (e.g. godeltaprof are not yet defined)\n  // logger.warn(`No profile metric found for id \"${profileMetricId}\"`);\n\n  return {\n    id: profileMetricId,\n    description: '',\n    type,\n    group,\n    unit: 'short',\n  };\n}\n","type DataSourceDef = {\n  type: string;\n  uid: string;\n};\n\nexport const PYROSCOPE_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-datasource',\n  uid: '$dataSource', // interpolated variable\n});\n\n/* Runtime data sources */\n\nexport const PYROSCOPE_SERIES_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-series-datasource',\n  uid: 'grafana-pyroscope-series-datasource',\n});\n\nexport const PYROSCOPE_FAVORITES_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-favorites-datasource',\n  uid: 'grafana-pyroscope-favorites-datasource',\n});\n\nexport const PYROSCOPE_LABELS_DATA_SOURCE: DataSourceDef = Object.freeze({\n  type: 'grafana-pyroscope-labels-datasource',\n  uid: 'grafana-pyroscope-labels-datasource',\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, VariableRefresh } from '@grafana/data';\nimport { MultiValueVariable, QueryVariable, SceneComponentProps, VariableValueOption } from '@grafana/scenes';\nimport { Cascader, CascaderOption, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { nanoid } from 'nanoid';\nimport React, { useMemo } from 'react';\nimport { lastValueFrom } from 'rxjs';\n\nimport { PYROSCOPE_SERIES_DATA_SOURCE } from '../../infrastructure/pyroscope-data-sources';\n\ntype ProfileMetricOptions = Array<{\n  value: string;\n  label: string;\n  type: string;\n  group: string;\n}>;\n\ntype ProfileMetricVariableState = {\n  query: string;\n  skipUrlSync: boolean;\n};\n\nexport class ProfileMetricVariable extends QueryVariable {\n  static DEFAULT_VALUE = 'process_cpu:cpu:nanoseconds:cpu:nanoseconds';\n\n  // hack: subscribe to changes of dataSource only\n  static QUERY_DEFAULT = '$dataSource and all profile metrics';\n\n  // hack: subscribe to changes of dataSource and serviceName to avoid showing options that don't have any data associated\n  static QUERY_SERVICE_NAME_DEPENDENT = '$dataSource and only $serviceName profile metrics';\n\n  constructor(state?: ProfileMetricVariableState) {\n    super({\n      key: 'profileMetricId',\n      name: 'profileMetricId',\n      label: 'Profile type',\n      datasource: PYROSCOPE_SERIES_DATA_SOURCE,\n      query: ProfileMetricVariable.QUERY_DEFAULT,\n      loading: true,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      ...state,\n    });\n\n    this.changeValueTo = this.changeValueTo.bind(this);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    if (!this.state.value) {\n      this.setState({ value: ProfileMetricVariable.DEFAULT_VALUE });\n    }\n  }\n\n  async update(force = false) {\n    if (!force && this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  }\n\n  static buildCascaderOptions(options: ProfileMetricOptions): CascaderOption[] {\n    const optionsMap = new Map();\n\n    for (const { value } of options) {\n      const profileMetric = getProfileMetric(value as ProfileMetricId);\n      const { group, type } = profileMetric;\n\n      const nameSpaceServices = optionsMap.get(group) || {\n        value: group,\n        label: group,\n        items: [],\n      };\n\n      const items = nameSpaceServices.items || [];\n\n      items.push({\n        value,\n        label: type,\n      });\n\n      nameSpaceServices.items = items;\n\n      optionsMap.set(group, nameSpaceServices);\n    }\n\n    return Array.from(optionsMap.values()).sort((a, b) => localeCompare(b.label, a.label));\n  }\n\n  onSelect = (newValue: string) => {\n    reportInteraction('g_pyroscope_app_profile_metric_selected');\n\n    if (!this.state.skipUrlSync) {\n      prepareHistoryEntry();\n    }\n    this.changeValueTo(newValue);\n  };\n\n  static Component = ({ model }: SceneComponentProps<MultiValueVariable & { onSelect?: any }>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, value, options, error } = model.useState();\n\n    const cascaderOptions = useMemo(() => {\n      return ProfileMetricVariable.buildCascaderOptions(options as ProfileMetricOptions);\n    }, [options]);\n\n    if (error) {\n      return (\n        <Tooltip theme=\"error\" content={error.toString()}>\n          <Icon className={styles.iconError} name=\"exclamation-triangle\" size=\"xl\" />\n        </Tooltip>\n      );\n    }\n\n    return (\n      <Cascader\n        // we add a key to ensure that the Cascader selects the initial value or available options properly when landing on the page\n        // and when switching exploration types, because the value might also be changed after the component has been rendered by SceneProfilesExplorer\n        key={nanoid(5)}\n        aria-label=\"Profile metrics list\"\n        width={24}\n        separator=\"/\"\n        displayAllSelectedLevels\n        placeholder={loading ? 'Loading...' : `Select a profile metric (${options.length})`}\n        options={cascaderOptions}\n        initialValue={value as string}\n        changeOnSelect={false}\n        onSelect={model.onSelect}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  iconError: css`\n    height: 32px;\n    align-self: center;\n    color: ${theme.colors.error.text};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, VariableRefresh } from '@grafana/data';\nimport { MultiValueVariable, QueryVariable, SceneComponentProps, VariableValueOption } from '@grafana/scenes';\nimport { Cascader, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { userStorage } from '@shared/infrastructure/userStorage';\nimport { nanoid } from 'nanoid';\nimport React, { useMemo } from 'react';\nimport { lastValueFrom } from 'rxjs';\n\nimport { PYROSCOPE_SERIES_DATA_SOURCE } from '../../../infrastructure/pyroscope-data-sources';\nimport { buildServiceNameCascaderOptions } from './domain/useBuildServiceNameOptions';\n\ntype ServiceNameVariableState = {\n  query: string;\n  skipUrlSync: boolean;\n};\n\nexport class ServiceNameVariable extends QueryVariable {\n  // hack: subscribe to changes of dataSource only\n  static QUERY_DEFAULT = '$dataSource and all services';\n\n  // hack: subscribe to changes of dataSource and profileMetricId\n  static QUERY_PROFILE_METRIC_DEPENDENT = '$dataSource and only $profileMetricId services';\n\n  constructor(state?: ServiceNameVariableState) {\n    super({\n      key: 'serviceName',\n      name: 'serviceName',\n      label: 'Service',\n      datasource: PYROSCOPE_SERIES_DATA_SOURCE,\n      query: ServiceNameVariable.QUERY_DEFAULT,\n      loading: true,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const { serviceName: serviceNameFromStorage } = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n\n    if (serviceNameFromStorage && !this.state.value) {\n      this.setState({ value: serviceNameFromStorage });\n    }\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n        storage.serviceName = newState.value;\n        userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n      }\n    });\n  }\n\n  async update() {\n    if (this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  }\n\n  selectNewValue = (newValue: string) => {\n    reportInteraction('g_pyroscope_app_service_name_selected');\n\n    if (!this.state.skipUrlSync) {\n      prepareHistoryEntry();\n    }\n\n    this.changeValueTo(newValue);\n  };\n\n  static Component = ({ model }: SceneComponentProps<MultiValueVariable & { selectNewValue?: any }>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, value, options, error } = model.useState();\n\n    const cascaderOptions = useMemo(\n      () => buildServiceNameCascaderOptions(options.map(({ label }) => label)),\n      [options]\n    );\n\n    if (error) {\n      return (\n        <Tooltip theme=\"error\" content={error.toString()}>\n          <Icon className={styles.iconError} name=\"exclamation-triangle\" size=\"xl\" />\n        </Tooltip>\n      );\n    }\n\n    return (\n      <Cascader\n        // we add a key to ensure that the Cascader selects the initial value properly when landing on the page\n        // and when switching exploration types, because the value might also be changed after the component has been rendered by SceneProfilesExplorer\n        // (e.g. in SceneExploreServiceProfileTypes)\n        // it's also required for supporting the Investigations app when opening a link with a different data source\n        // than the one currently selected\n        key={nanoid(5)}\n        aria-label=\"Services list\"\n        width={32}\n        separator=\"/\"\n        displayAllSelectedLevels\n        placeholder={loading ? 'Loading services...' : `Select a service (${options.length})`}\n        options={cascaderOptions}\n        initialValue={value as string}\n        changeOnSelect={false}\n        onSelect={model.selectNewValue}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  iconError: css`\n    height: 32px;\n    align-self: center;\n    color: ${theme.colors.error.text};\n  `,\n});\n","import { CascaderOption } from '@grafana/ui';\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function buildServiceNameCascaderOptions(serviceNames: string[]) {\n  // Sort the service names to ensure consistent ordering\n  const sortedServiceNames = [...serviceNames].sort();\n\n  // Keep track of the root elements\n  const rootElements: CascaderOption[] = [];\n\n  // Create a map to store the hierarchy\n  const hierarchy = new Map<string, CascaderOption>();\n\n  for (const serviceId of sortedServiceNames) {\n    const parts = serviceId.split('/');\n    let currentPath = '';\n\n    for (let i = 0; i < parts.length; i++) {\n      const part = parts[i];\n      const previousPath = currentPath;\n      currentPath = currentPath ? `${currentPath}/${part}` : part;\n\n      const isComplete = i === parts.length - 1;\n\n      if (!hierarchy.has(currentPath) || isComplete) {\n        const option: CascaderOption = {\n          // the value needs to be different for a complete one vs the one that goes deeper otherwise it will not be selected.\n          value: isComplete ? currentPath : currentPath + '/',\n          label: part,\n          items: isComplete ? undefined : [],\n        };\n\n        // if the option is not complete it should be part of the hierachy\n        if (!isComplete) {\n          hierarchy.set(currentPath, option);\n        }\n\n        // Add to parent's items if not root level, other wise it will be added to the rootElements\n        if (previousPath) {\n          const parent = hierarchy.get(previousPath);\n          if (parent && parent.items) {\n            parent.items.push(option);\n          }\n        } else {\n          rootElements.push(option);\n        }\n      }\n    }\n  }\n  return rootElements;\n}\n","import { sceneGraph, SceneObject } from '@grafana/scenes';\nimport { useMemo } from 'react';\n\nimport { FiltersVariable } from './variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from './variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from './variables/ServiceNameVariable/ServiceNameVariable';\n\nexport function useBuildPyroscopeQuery(sceneObject: SceneObject, filterKey: string) {\n  const { value: serviceName } = sceneGraph\n    .findByKeyAndType(sceneObject, 'serviceName', ServiceNameVariable)\n    .useState();\n\n  const { value: profileMetricId } = sceneGraph\n    .findByKeyAndType(sceneObject, 'profileMetricId', ProfileMetricVariable)\n    .useState();\n\n  const { filterExpression } = sceneGraph.findByKeyAndType(sceneObject, filterKey, FiltersVariable).useState();\n\n  return useMemo(\n    () => `${profileMetricId}{service_name=\"${serviceName}\",${filterExpression}}`,\n    [filterExpression, profileMetricId, serviceName]\n  );\n}\n","import { DataSourceVariable } from '@grafana/scenes';\nimport { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport { userStorage } from '@shared/infrastructure/userStorage';\n\nexport class ProfilesDataSourceVariable extends DataSourceVariable {\n  constructor() {\n    super({\n      pluginId: 'grafana-pyroscope-datasource',\n      key: 'dataSource',\n      name: 'dataSource',\n      label: 'Data source',\n      skipUrlSync: true,\n      // we ensure that we'll always have the expected default data source (when the \"var-dataSource\" URL search param is missing, incorrect, etc.)\n      value: ApiClient.selectDefaultDataSource().uid,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({ skipUrlSync: false });\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n        storage.dataSource = newState.value;\n        userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n      }\n    });\n  }\n}\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { CompleteFilter, OperatorKind } from '@shared/components/QueryBuilder/domain/types';\n\nexport const convertPyroscopeToVariableFilter = (filter: CompleteFilter): AdHocVariableFilter => {\n  let newOperator = filter.operator.value;\n\n  if (filter.operator.value === OperatorKind['in']) {\n    newOperator = OperatorKind['=~'];\n  } else if (filter.operator.value === OperatorKind['not-in']) {\n    newOperator = OperatorKind['!~'];\n  }\n\n  return {\n    key: filter.attribute.value,\n    operator: newOperator,\n    value: filter.value.value,\n  };\n};\n\nfunction searchForFilter(filters: AdHocVariableFilter[], filterKey: string) {\n  let found: AdHocVariableFilter | undefined;\n\n  const filtersWithoutFound = filters.filter((f) => {\n    if (f.key === filterKey) {\n      found = f;\n      return false;\n    }\n\n    return true;\n  });\n\n  return { found, filtersWithoutFound };\n}\n\nconst addToFilters = (filters: AdHocVariableFilter[], filterToAdd: AdHocVariableFilter) => [...filters, filterToAdd];\n\nexport function includeLabelValue(\n  filters: AdHocVariableFilter[],\n  filterForInclude: AdHocVariableFilter\n): AdHocVariableFilter[] {\n  const { found, filtersWithoutFound } = searchForFilter(filters, filterForInclude.key);\n\n  if (!found) {\n    return addToFilters(filters, { ...filterForInclude, operator: '=~' });\n  }\n\n  if (['!~', '!='].includes(found.operator)) {\n    return addToFilters(filtersWithoutFound, { ...filterForInclude, operator: '=~' });\n  }\n\n  const foundValues = new Set(found.value.split('|'));\n\n  if (found.operator === '=~') {\n    return addToFilters(filtersWithoutFound, {\n      ...found,\n      value: Array.from(foundValues.add(filterForInclude.value)).join('|'),\n    });\n  }\n\n  // found.operator is '='\n  return found.value === filterForInclude.value\n    ? filters\n    : addToFilters(filtersWithoutFound, {\n        ...filterForInclude,\n        operator: '=~',\n        value: Array.from(foundValues.add(filterForInclude.value)).join('|'),\n      });\n}\n\nexport function excludeLabelValue(\n  filters: AdHocVariableFilter[],\n  filterForExclude: AdHocVariableFilter\n): AdHocVariableFilter[] {\n  const { found, filtersWithoutFound } = searchForFilter(filters, filterForExclude.key);\n\n  if (!found) {\n    return addToFilters(filters, { ...filterForExclude, operator: '!~' });\n  }\n\n  if (['=~', '='].includes(found.operator)) {\n    return addToFilters(filtersWithoutFound, { ...filterForExclude, operator: '!~' });\n  }\n\n  const foundValues = new Set(found.value.split('|'));\n\n  if (found.operator === '!~') {\n    return addToFilters(filtersWithoutFound, {\n      ...found,\n      value: Array.from(foundValues.add(filterForExclude.value)).join('|'),\n    });\n  }\n\n  // found.operator is '!='\n  return found.value === filterForExclude.value\n    ? filters\n    : addToFilters(filtersWithoutFound, {\n        ...filterForExclude,\n        operator: '!~',\n        value: Array.from(foundValues.add(filterForExclude.value)).join('|'),\n      });\n}\n\nexport function clearLabelValue(\n  filters: AdHocVariableFilter[],\n  filterForClear: AdHocVariableFilter\n): AdHocVariableFilter[] {\n  const { found, filtersWithoutFound } = searchForFilter(filters, filterForClear.key);\n\n  if (!found) {\n    return filters;\n  }\n\n  const filteredValues = found.value.split('|').filter((v) => v !== filterForClear.value);\n\n  if (filteredValues.length > 0) {\n    return addToFilters(filtersWithoutFound, {\n      ...found,\n      value: filteredValues.join('|'),\n    });\n  }\n\n  return [...filtersWithoutFound];\n}\n\nexport const isFilterValid = (filter: AdHocVariableFilter) => filter.operator in OperatorKind;\n","import { AdHocFiltersVariable, SceneComponentProps, sceneGraph, SceneObject } from '@grafana/scenes';\nimport { CompleteFilters, OperatorKind } from '@shared/components/QueryBuilder/domain/types';\nimport { QueryBuilder } from '@shared/components/QueryBuilder/QueryBuilder';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { uniq } from 'lodash';\nimport React from 'react';\n\nimport { useBuildPyroscopeQuery } from '../../useBuildPyroscopeQuery';\nimport { ProfilesDataSourceVariable } from '../ProfilesDataSourceVariable';\nimport { convertPyroscopeToVariableFilter, isFilterValid } from './filters-ops';\n\nexport class FiltersVariable extends AdHocFiltersVariable {\n  static DEFAULT_VALUE = [];\n\n  constructor({ key }: { key: string }) {\n    super({\n      key,\n      name: key,\n      label: 'Filters',\n      filters: FiltersVariable.DEFAULT_VALUE,\n      expressionBuilder: (filters) =>\n        filters\n          // after parsing the URL search parameters the filters might end up having an invalid operator, which in turn, will\n          // generate an invalid query that will make the API requests fail - we prevent this to happen by sanitizing the filters here\n          .filter(isFilterValid)\n          .map(({ key, operator, value }) =>\n            operator === OperatorKind['is-empty'] ? `${key}=\"\"` : `${key}${operator}\"${value}\"`\n          )\n          .join(','),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  reset() {\n    this.setState({ filters: FiltersVariable.DEFAULT_VALUE });\n  }\n\n  static resetAll(sceneObject: SceneObject) {\n    ['filters', 'filtersBaseline', 'filtersComparison'].forEach((filterKey) => {\n      sceneGraph.findByKeyAndType(sceneObject, filterKey, FiltersVariable).reset();\n    });\n  }\n\n  onActivate() {\n    // VariableDependencyConfig does not work :man_shrug: (never called)\n    const dataSourceSub = sceneGraph\n      .findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable)\n      .subscribeToState(() => {\n        this.reset();\n      });\n\n    return () => {\n      dataSourceSub.unsubscribe();\n    };\n  }\n\n  onChangeQuery = (query: string, filters: CompleteFilters) => {\n    reportInteraction('g_pyroscope_app_filters_changed', {\n      name: this.state.name,\n      count: filters.length,\n      operators: uniq(filters.map((f) => f.operator.label)),\n    });\n\n    this.setState({\n      filters: filters.map(convertPyroscopeToVariableFilter),\n    });\n  };\n\n  static Component = ({ model }: SceneComponentProps<AdHocFiltersVariable & { onChangeQuery?: any }>) => {\n    const { key } = model.useState();\n\n    const query = useBuildPyroscopeQuery(model, key as string);\n\n    const { value: dataSourceUid } = sceneGraph\n      .findByKeyAndType(model, 'dataSource', ProfilesDataSourceVariable)\n      .useState();\n\n    const { from, to } = sceneGraph.getTimeRange(model).state.value;\n\n    return (\n      <QueryBuilder\n        id={`query-builder-${key}`}\n        autoExecute\n        dataSourceUid={dataSourceUid as string}\n        query={query}\n        from={from.unix() * 1000}\n        to={to.unix() * 1000}\n        onChangeQuery={model.onChangeQuery}\n      />\n    );\n  };\n}\n","import { sceneGraph, SceneObject } from '@grafana/scenes';\n\nexport function getSceneVariableValue(sceneObject: SceneObject, variableName: string): string {\n  return sceneGraph.lookupVariable(variableName, sceneObject)?.getValue() as string;\n}\n","import {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport enum PanelType {\n  TIMESERIES = 'time-series',\n  BARGAUGE = 'bar-gauge',\n  TABLE = 'table',\n  HISTOGRAM = 'histogram',\n}\n\nexport interface ScenePanelTypeSwitcherState extends SceneObjectState {\n  panelType: PanelType;\n  onChange?: (panelType: PanelType) => void;\n}\n\nexport class ScenePanelTypeSwitcher extends SceneObjectBase<ScenePanelTypeSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['panelType'] });\n\n  static OPTIONS = [\n    { label: 'Time series', value: PanelType.TIMESERIES, icon: 'heart-rate' },\n    { label: 'Totals', value: PanelType.BARGAUGE, icon: 'align-left' },\n    { label: 'Maxima', value: PanelType.TABLE, icon: 'angle-double-up' },\n    { label: 'Histograms', value: PanelType.HISTOGRAM, icon: 'graph-bar' },\n  ];\n\n  static DEFAULT_PANEL_TYPE = PanelType.TIMESERIES;\n\n  constructor() {\n    super({\n      key: 'panel-type-switcher',\n      panelType: ScenePanelTypeSwitcher.DEFAULT_PANEL_TYPE,\n    });\n  }\n\n  getUrlState() {\n    return {\n      panelType: this.state.panelType,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<ScenePanelTypeSwitcherState> = {};\n\n    if (typeof values.panelType === 'string' && values.panelType !== this.state.panelType) {\n      stateUpdate.panelType = Object.values(PanelType).includes(values.panelType as PanelType)\n        ? (values.panelType as PanelType)\n        : ScenePanelTypeSwitcher.DEFAULT_PANEL_TYPE;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  reset() {\n    this.setState({ panelType: ScenePanelTypeSwitcher.DEFAULT_PANEL_TYPE });\n  }\n\n  onChange = (panelType: PanelType) => {\n    reportInteraction('g_pyroscope_app_panel_type_changed', { panelType });\n\n    this.setState({ panelType });\n  };\n\n  static Component = ({ model }: SceneComponentProps<ScenePanelTypeSwitcher>) => {\n    const { panelType } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Panel type switcher\"\n        options={ScenePanelTypeSwitcher.OPTIONS}\n        value={panelType}\n        onChange={model.onChange}\n        fullWidth={false}\n      />\n    );\n  };\n}\n","import { config } from '@grafana/runtime';\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n","import { Field } from '@grafana/data';\n\nexport const getSeriesLabelFieldName = (metricField: Field, label?: string) =>\n  metricField.labels?.[label as string] || '(no value)'; // metricField.labels can be empty when the ingested profiles do not have a label value set\n","import { DataFrame } from '@grafana/data';\n\nexport const getSeriesStatsValue = (series: DataFrame, displayName: string) =>\n  series.meta?.stats?.find((s) => s.displayName === displayName)?.value;\n","type ParsedQuery = {\n  serviceId: string;\n  profileMetricId: string;\n  labelsSelector: string;\n  labels: string[];\n};\n\nexport function parseQuery(query: string): ParsedQuery {\n  const [, serviceId = ''] = query.match(/.+\\{.*service_name=\"([^\"]+)\".*\\}/) || [];\n  const [, profileMetricId = ''] = query.match(/([^{]+)\\{.*}/) || [];\n\n  const labelsSelector = query.substring(query.indexOf('{'));\n\n  const labels = labelsSelector\n    .replace(/(\\{|\\})/, '')\n    .split(',')\n    .map((m) => m.match(/\\W*([^=!~]+)(=|!=|=~|!~)\"(.*)\"/)?.[0])\n    .filter((label) => label && !label.includes('service_name')) as string[];\n\n  return { serviceId, profileMetricId, labelsSelector, labels };\n}\n\ntype BuildQueryParams = {\n  serviceId: string;\n  profileMetricId: string;\n  labels?: string[];\n};\n\nexport const buildQuery = ({ serviceId, profileMetricId, labels }: BuildQueryParams): string =>\n  labels?.length\n    ? `${profileMetricId}{service_name=\"${serviceId}\",${labels.join()}}`\n    : `${profileMetricId}{service_name=\"${serviceId}\"}`;\n","import { LoadingState } from '@grafana/data';\nimport { sceneGraph, SceneQueryRunner } from '@grafana/scenes';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nexport function withPreventInvalidQuery(queryRunner: SceneQueryRunner) {\n  queryRunner.addActivationHandler(() => {\n    const { profileTypeId, labelSelector } = queryRunner.state.queries[0];\n\n    if (!profileTypeId) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing profile type!'),\n      });\n      return;\n    }\n\n    if (!labelSelector) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing label selector!'),\n      });\n      return;\n    }\n\n    if (!sceneGraph.interpolate(queryRunner, '$profileMetricId')) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing profile type!'),\n      });\n      return;\n    }\n\n    const parsed = parseQuery(sceneGraph.interpolate(queryRunner, `$profileTypeId${labelSelector})`));\n\n    if (!parsed.serviceId) {\n      queryRunner.setState({\n        queries: [{ refId: 'null' }],\n        data: buildErrorData(queryRunner, 'Missing service name!'),\n      });\n    }\n  });\n\n  return queryRunner;\n}\n\nfunction buildErrorData(queryRunner: SceneQueryRunner, errorMsg: string) {\n  const error = new Error(errorMsg);\n\n  logger.error(error);\n\n  return {\n    state: LoadingState.Error,\n    errors: [error],\n    series: [],\n    timeRange: sceneGraph.getTimeRange(queryRunner).state.value,\n  };\n}\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { withPreventInvalidQuery } from '../withPreventInvalidQuery';\nimport { TimeSeriesQueryRunnerParams } from './TimeSeriesQueryRunnerParams';\n\nexport type TimeSeriesQuery = {\n  refId: string;\n  queryType: 'metrics';\n  profileTypeId: string;\n  labelSelector: string;\n  groupBy: string[];\n};\n\nexport function buildTimeSeriesQueryRunner(\n  { serviceName, profileMetricId, groupBy, filters }: TimeSeriesQueryRunnerParams,\n  limit?: number\n) {\n  const completeFilters = filters ? [...filters] : [];\n  completeFilters.unshift({ key: 'service_name', operator: '=', value: serviceName || '$serviceName' });\n\n  const selector = completeFilters.map(({ key, operator, value }) => `${key}${operator}\"${value}\"`).join(',');\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: `${profileMetricId || '$profileMetricId'}-${selector}-${groupBy?.label || 'no-group-by'}`,\n        queryType: 'metrics',\n        profileTypeId: profileMetricId || '$profileMetricId',\n        labelSelector: `{${selector},$filters}`,\n        groupBy: groupBy?.label ? [groupBy.label] : [],\n        limit,\n      },\n    ],\n  });\n\n  return withPreventInvalidQuery(queryRunner);\n}\n","import { DataFrame } from '@grafana/data';\nimport { merge } from 'lodash';\nimport { map, Observable } from 'rxjs';\n\n// General note: because (e.g.) SceneLabelValuesTimeseries sets the data provider in its constructor, data can come as undefined, hence all the optional chaining operators\n// in the transformers below\n\nexport const addRefId = () => (source: Observable<DataFrame[]>) =>\n  source.pipe(map((data: DataFrame[]) => data?.map((d, i) => merge(d, { refId: `${d.refId}-${i}` }))));\n\nexport const addStats = () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) => {\n      const totalSeriesCount = data?.length;\n\n      // TODO: in case of a groupBy query, find a way to always add a rank to each label value (based on allValuesSum) so that we can use it as startColorIndex to\n      // always display each series consistently in the same color regardless of it's timseries, bar gauges with sums, or tables with maxima\n      return data?.map((d) => {\n        let maxValue = Number.NEGATIVE_INFINITY;\n\n        const allValuesSum = d.fields\n          ?.find((field) => field.type === 'number')\n          ?.values.reduce((acc: number, value: number) => {\n            if (value > maxValue) {\n              maxValue = value;\n            }\n            return acc + value;\n          }, 0);\n\n        return merge(d, {\n          meta: {\n            stats: [\n              {\n                displayName: 'totalSeriesCount',\n                value: totalSeriesCount,\n              },\n              {\n                displayName: 'allValuesSum',\n                value: allValuesSum,\n              },\n              {\n                displayName: 'maxValue',\n                value: maxValue,\n              },\n            ],\n          },\n        });\n      });\n    })\n  );\n","import { DataFrame, FieldMatcherID, LoadingState, ThresholdsMode, VizOrientation } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { BarGaugeDisplayMode, BarGaugeNamePlacement, BarGaugeSizing, BarGaugeValueMode } from '@grafana/schema';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../domain/events/EventTimeseriesDataReceived';\nimport { getColorByIndex } from '../helpers/getColorByIndex';\nimport { getSeriesLabelFieldName } from '../infrastructure/helpers/getSeriesLabelFieldName';\nimport { getSeriesStatsValue } from '../infrastructure/helpers/getSeriesStatsValue';\nimport { buildTimeSeriesQueryRunner } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { addRefId, addStats } from './SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneLabelValuesBarGaugeState extends SceneObjectState {\n  body: VizPanel;\n}\n\nexport class SceneLabelValuesBarGauge extends SceneObjectBase<SceneLabelValuesBarGaugeState> {\n  constructor({\n    item,\n    headerActions,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  }) {\n    super({\n      key: 'bar-gauge-label-values',\n      body: PanelBuilders.bargauge()\n        .setTitle(item.label)\n        .setData(\n          new SceneDataTransformer({\n            $data: buildTimeSeriesQueryRunner(item.queryRunnerParams),\n            transformations: [addRefId, addStats],\n          })\n        )\n        .setHeaderActions(headerActions(item))\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item: GridItemData) {\n    const { body } = this.state;\n\n    const sub = (body.state.$data as SceneDataTransformer)!.subscribeToState((newState) => {\n      if (newState.data?.state !== LoadingState.Done) {\n        return;\n      }\n\n      const { series } = newState.data;\n\n      if (series?.length) {\n        body.setState(this.getConfig(item, series));\n      }\n\n      // we publish the event only after setting the new config so that the subscribers can modify it\n      this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n    });\n\n    return () => {\n      sub.unsubscribe();\n    };\n  }\n\n  getConfig(item: GridItemData, series: DataFrame[]) {\n    let max = Number.NEGATIVE_INFINITY;\n\n    for (const s of series) {\n      const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n\n      if (allValuesSum > max) {\n        max = allValuesSum;\n      }\n    }\n\n    const groupByLabel = item.queryRunnerParams.groupBy?.label;\n\n    const description = groupByLabel ? 'This panel displays aggregate values over the current time period' : undefined;\n\n    return {\n      title: series.length > 1 ? `${item.label} (${series.length})` : item.label,\n      description,\n      options: {\n        reduceOptions: { values: false, calcs: ['sum'] },\n        orientation: VizOrientation.Horizontal,\n        displayMode: BarGaugeDisplayMode.Gradient,\n        valueMode: BarGaugeValueMode.Text,\n        showUnfilled: true,\n        sizing: BarGaugeSizing.Manual,\n        text: { titleSize: 13, valueSize: 13 },\n        namePlacement: BarGaugeNamePlacement.Top,\n        minVizHeight: 36,\n        maxVizHeight: 36,\n        legend: {\n          showLegend: false,\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          // we force the label value because the overrides don't seem to work when we receive a single serie\n          displayName: series.length === 1 ? groupByLabel : undefined,\n          min: 0,\n          max,\n          thresholds: {\n            mode: ThresholdsMode.Percentage,\n            steps: [],\n          },\n        },\n        overrides: this.getOverrides(item, series),\n      },\n    };\n  }\n\n  getOverrides(item: GridItemData, series: DataFrame[]) {\n    const { index: startColorIndex, queryRunnerParams } = item;\n    const groupByLabel = queryRunnerParams.groupBy?.label;\n\n    return series.map((s, i) => ({\n      matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n      properties: [\n        {\n          id: 'displayName',\n          value: getSeriesLabelFieldName(s.fields[1], groupByLabel),\n        },\n        {\n          id: 'color',\n          value: { mode: 'fixed', fixedColor: getColorByIndex(startColorIndex + i) },\n        },\n      ],\n    }));\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesBarGauge>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { DataFrame, getValueFormat } from '@grafana/data';\n\nimport { getSeriesStatsValue } from '../infrastructure/helpers/getSeriesStatsValue';\n\nexport function formatSingleSeriesDisplayName(label: string, s: DataFrame) {\n  const metricFieldUnit = s.fields[1].config.unit;\n\n  const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n  const allValuesSumFormatted = getValueFormat(metricFieldUnit)(allValuesSum);\n\n  const maxValue = getSeriesStatsValue(s, 'maxValue') || 0;\n  const maxValueFormatted = getValueFormat(metricFieldUnit)(maxValue);\n\n  return `total ${label} = ${allValuesSumFormatted.text}${allValuesSumFormatted.suffix} / max = ${maxValueFormatted.text}${maxValueFormatted.suffix}`;\n}\n","import { DataFrame, FieldMatcherID, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { SortOrder } from '@grafana/schema';\nimport { LegendDisplayMode, TooltipDisplayMode, VizLegendOptions } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../domain/events/EventTimeseriesDataReceived';\nimport { formatSingleSeriesDisplayName } from '../helpers/formatSingleSeriesDisplayName';\nimport { getColorByIndex } from '../helpers/getColorByIndex';\nimport { getSeriesLabelFieldName } from '../infrastructure/helpers/getSeriesLabelFieldName';\nimport { buildTimeSeriesQueryRunner } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { addRefId, addStats } from './SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneLabelValuesHistogramState extends SceneObjectState {\n  body: VizPanel;\n  legendPlacement: VizLegendOptions['placement'];\n}\n\nexport class SceneLabelValuesHistogram extends SceneObjectBase<SceneLabelValuesHistogramState> {\n  constructor({\n    item,\n    headerActions,\n    legendPlacement,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n    legendPlacement?: SceneLabelValuesHistogramState['legendPlacement'];\n  }) {\n    super({\n      key: 'histogram-label-values',\n      legendPlacement: legendPlacement || 'bottom',\n      body: PanelBuilders.histogram()\n        .setTitle(item.label)\n        .setData(\n          new SceneDataTransformer({\n            $data: buildTimeSeriesQueryRunner(item.queryRunnerParams),\n            transformations: [addRefId, addStats],\n          })\n        )\n        .setHeaderActions(headerActions(item))\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item: GridItemData) {\n    const { body } = this.state;\n\n    const sub = (body.state.$data as SceneDataTransformer)!.subscribeToState((newState) => {\n      if (newState.data?.state !== LoadingState.Done) {\n        return;\n      }\n\n      const { series } = newState.data;\n\n      if (series?.length) {\n        body.setState(this.getConfig(item, series));\n      }\n\n      // we publish the event only after setting the new config so that the subscribers can modify it\n      this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n    });\n\n    return () => {\n      sub.unsubscribe();\n    };\n  }\n\n  getConfig(item: GridItemData, series: DataFrame[]) {\n    const { legendPlacement } = this.state;\n    const groupByLabel = item.queryRunnerParams.groupBy?.label;\n\n    return {\n      title: series.length > 1 ? `${item.label} (${series.length})` : item.label,\n      options: {\n        tooltip: {\n          mode: TooltipDisplayMode.Single,\n          sort: SortOrder.None,\n        },\n        legend: {\n          showLegend: true,\n          displayMode: LegendDisplayMode.List,\n          placement: legendPlacement,\n          calcs: [],\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          // we force the label value because the overrides don't seem to work when we receive a single serie\n          displayName: series.length === 1 ? groupByLabel : undefined,\n          custom: {\n            lineWidth: 1,\n          },\n        },\n        overrides: this.getOverrides(item, series),\n      },\n    };\n  }\n\n  getOverrides(item: GridItemData, series: DataFrame[]) {\n    const { index: startColorIndex, queryRunnerParams } = item;\n    const groupByLabel = queryRunnerParams.groupBy?.label;\n\n    return series.map((s, i) => {\n      const metricField = s.fields[1];\n      let displayName = groupByLabel ? getSeriesLabelFieldName(metricField, groupByLabel) : metricField.name;\n\n      if (series.length === 1) {\n        displayName = formatSingleSeriesDisplayName(displayName, s);\n      }\n\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties: [\n          {\n            id: 'displayName',\n            value: displayName,\n          },\n          {\n            id: 'color',\n            value: { mode: 'fixed', fixedColor: getColorByIndex(startColorIndex + i) },\n          },\n        ],\n      };\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesHistogram>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { css } from '@emotion/css';\nimport { DataFrame, DataTransformerID, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../domain/events/EventTimeseriesDataReceived';\nimport { ProfileMetricVariable } from '../domain/variables/ProfileMetricVariable';\nimport { getColorByIndex } from '../helpers/getColorByIndex';\nimport { buildTimeSeriesQueryRunner } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneLabelValuesTableState extends SceneObjectState {\n  body: VizPanel;\n}\n\nexport class SceneLabelValuesTable extends SceneObjectBase<SceneLabelValuesTableState> {\n  constructor({\n    item,\n    headerActions,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  }) {\n    super({\n      key: 'table-label-values',\n      body: PanelBuilders.table()\n        .setTitle(item.label)\n        .setData(\n          new SceneDataTransformer({\n            $data: buildTimeSeriesQueryRunner(item.queryRunnerParams),\n            transformations: [\n              {\n                id: DataTransformerID.reduce,\n                options: {\n                  reducers: ['max'],\n                  labelsToFields: true,\n                },\n              },\n              {\n                id: DataTransformerID.filterFieldsByName,\n                options: {\n                  exclude: {\n                    names: ['Field'],\n                  },\n                },\n              },\n              {\n                id: DataTransformerID.renameByRegex,\n                options: {\n                  regex: 'Max',\n                  renamePattern: 'max',\n                },\n              },\n              {\n                id: DataTransformerID.sortBy,\n                options: {\n                  sort: [\n                    {\n                      field: 'max',\n                      desc: true,\n                    },\n                  ],\n                },\n              },\n            ],\n          })\n        )\n        .setHeaderActions(headerActions(item))\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item: GridItemData) {\n    const { body } = this.state;\n\n    const sub = (body.state.$data as SceneDataTransformer)!.subscribeToState((newState) => {\n      if (newState.data?.state !== LoadingState.Done) {\n        return;\n      }\n\n      const { series } = newState.data;\n\n      if (series?.length) {\n        body.setState(this.getConfig(item, series));\n      }\n\n      // we publish the event only after setting the new config so that the subscribers can modify it\n      this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n    });\n\n    return () => {\n      sub.unsubscribe();\n    };\n  }\n\n  getConfig(item: GridItemData, series: DataFrame[]) {\n    const cardinality = series[0].fields[0].values.length;\n\n    const profileMetricId = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable).state\n      .value as ProfileMetricId;\n    const unitValue = getProfileMetric(profileMetricId).unit;\n\n    return {\n      title: cardinality > 1 ? `${item.label} (${cardinality})` : item.label,\n      fieldConfig: {\n        defaults: {\n          custom: {\n            filterable: true,\n            cellOptions: {},\n          },\n        },\n        overrides: [\n          {\n            matcher: {\n              id: 'byName',\n              options: 'max',\n            },\n            properties: [\n              {\n                id: 'unit',\n                value: unitValue,\n              },\n              {\n                id: 'custom.width',\n                value: 100,\n              },\n            ],\n          },\n        ],\n      },\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesTable>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { body } = model.useState();\n\n    return (\n      <span className={styles.container}>\n        <body.Component model={body} />\n      </span>\n    );\n  }\n}\n\nconst getStyles = () => ({\n  // couldn't find a better way just by configuring the table panel :man_shrug:\n  container: css`\n    [data-testid='data-testid table body'] [role='row']:first-child {\n      color: ${getColorByIndex(3)};\n      font-weight: 500;\n    }\n  `,\n});\n","import { TimeRange } from '@grafana/data';\n\nexport function computeRoundedTimeRange(timeRange: TimeRange) {\n  // round to 10s\n  return {\n    from: Math.floor((timeRange.from.valueOf() || 0) / 10000) * 10000,\n    to: Math.floor((timeRange.to.valueOf() || 0) / 10000) * 10000,\n  };\n}\n","import {\n  DataQueryResponse,\n  FieldType,\n  LegacyMetricFindQueryOptions,\n  LoadingState,\n  MetricFindValue,\n  TestDataSourceResponse,\n  TimeRange,\n} from '@grafana/data';\nimport { RuntimeDataSource, sceneGraph } from '@grafana/scenes';\nimport { isPrivateLabel } from '@shared/components/QueryBuilder/domain/helpers/isPrivateLabel';\nimport { labelsRepository } from '@shared/infrastructure/labels/labelsRepository';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport pLimit from 'p-limit';\n\nimport { GroupByVariable } from '../../domain/variables/GroupByVariable/GroupByVariable';\nimport { computeRoundedTimeRange } from '../../helpers/computeRoundedTimeRange';\nimport { PYROSCOPE_LABELS_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { LabelsApiClient } from './http/LabelsApiClient';\n\nconst MAX_CONCURRENT_LABEL_VALUES_REQUESTS = 20;\nconst limit = pLimit(MAX_CONCURRENT_LABEL_VALUES_REQUESTS);\n\nexport class LabelsDataSource extends RuntimeDataSource {\n  static MAX_TIMESERIES_LABEL_VALUES = 10;\n\n  constructor() {\n    super(PYROSCOPE_LABELS_DATA_SOURCE.type, PYROSCOPE_LABELS_DATA_SOURCE.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: 'Label',\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  getParams(options: LegacyMetricFindQueryOptions) {\n    const { scopedVars, range } = options;\n    const sceneObject = scopedVars?.__sceneObject?.value as GroupByVariable;\n\n    const dataSourceUid = sceneGraph.interpolate(sceneObject, '$dataSource');\n    const serviceName = sceneGraph.interpolate(sceneObject, '$serviceName');\n    const profileMetricId = sceneGraph.interpolate(sceneObject, '$profileMetricId');\n\n    // we could interpolate ad hoc filters, but the Labels exploration type would reload all labels each time they are modified\n    // const filters = sceneGraph.interpolate(sceneObject, '$filters');\n    // const pyroscopeQuery = `${profileMetricId}{service_name=\"${serviceName}\",${filters}}`;\n    const query = `${profileMetricId}{service_name=\"${serviceName}\"}`;\n\n    const { from, to } = computeRoundedTimeRange(range as TimeRange);\n\n    return {\n      dataSourceUid,\n      serviceName,\n      profileMetricId,\n      query,\n      from,\n      to,\n    };\n  }\n\n  async fetchLabels(dataSourceUid: string, query: string, from: number, to: number, variableName?: string) {\n    labelsRepository.setApiClient(new LabelsApiClient({ dataSourceUid }));\n\n    try {\n      return await labelsRepository.listLabels({ query, from, to });\n    } catch (error) {\n      logger.error(error as Error, {\n        info: 'Error while loading Pyroscope label names!',\n        variableName: variableName || '',\n      });\n\n      throw error;\n    }\n  }\n\n  async fetchLabelValues(\n    index: number,\n    query: string,\n    from: number,\n    to: number,\n    labelName: string,\n    variableName?: string\n  ) {\n    let values;\n\n    try {\n      values = await labelsRepository.listLabelValues({ query, from, to, label: labelName });\n    } catch (error) {\n      logger.error(error as Error, {\n        info: 'Error while loading Pyroscope label values!',\n        variableName: variableName || '',\n      });\n    }\n\n    const count = values ? values.length : -1;\n\n    return {\n      value: {\n        value: labelName,\n        groupBy: {\n          label: labelName,\n          values: values || [],\n        },\n      },\n      text: `${labelName} (${count > -1 ? count : '?'})`,\n      count,\n    };\n  }\n\n  async metricFindQuery(_: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.value as GroupByVariable;\n\n    // save bandwidth\n    // TODO: remove this when we can declare the GroupByVariable in the Scene it's used\n    // without messing up the variable URL sync\n    if (!sceneObject.isActive) {\n      return [];\n    }\n\n    const { dataSourceUid, serviceName, profileMetricId, query, from, to } = this.getParams(options);\n\n    if (!serviceName || !profileMetricId) {\n      logger.warn(\n        'LabelsDataSource: either serviceName=\"%s\" and/or profileMetricId=\"%s\" is empty! Discarding request.',\n        serviceName,\n        profileMetricId\n      );\n      return [];\n    }\n\n    const labels = await this.fetchLabels(dataSourceUid, query, from, to, options.variable?.name);\n\n    const labelsWithValuesAndCount = await Promise.all(\n      labels\n        .filter(({ value }) => !isPrivateLabel(value))\n        .map(({ value }, index) =>\n          limit(() => this.fetchLabelValues(index, query, from, to, value, options.variable?.name))\n        )\n    );\n\n    const sortedLabels = labelsWithValuesAndCount\n      .sort((a, b) => b.count - a.count)\n      .map(({ value, text }, index) => {\n        return {\n          // TODO: check if there's a better way\n          value: JSON.stringify({ ...value, index }),\n          text,\n        };\n      });\n\n    return [\n      // we do this here because GroupByVariable may set its default value to the 1st element automatically\n      {\n        value: 'all',\n        text: 'All',\n      },\n      ...sortedLabels,\n    ];\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\n\nexport function getProfileMetricLabel(profileMetricId: string) {\n  const profileMetric = getProfileMetric(profileMetricId as ProfileMetricId);\n  return `${profileMetric.type} (${profileMetric.group})`;\n}\n","import { PanelMenuItem, PluginExtensionLink } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport {\n  SceneComponentProps,\n  SceneDataQuery,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanelMenu,\n} from '@grafana/scenes';\nimport { ScaleDistribution, ScaleDistributionConfig } from '@grafana/schema';\nimport PyroscopeLogo from '@img/logo.svg';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { nanoid } from 'nanoid';\nimport React, { useEffect, useMemo } from 'react';\n\nimport {\n  INVESTIGATIONS_APP_ID,\n  INVESTIGATIONS_EXTENSTION_POINT_ID,\n  useGetPluginExtensionLink,\n} from '../../domain/useGetPluginExtensionLink';\nimport { getExploreUrl } from '../../helpers/getExploreUrl';\nimport { getProfileMetricLabel } from '../../infrastructure/series/helpers/getProfileMetricLabel';\nimport { TimeSeriesQuery } from '../../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { SceneLabelValuesTimeseries } from './SceneLabelValuesTimeseries';\n\ninterface SceneTimeseriesMenuState extends SceneObjectState {\n  items?: PanelMenuItem[];\n  scaleType?: ScaleDistribution;\n}\n\nconst SCALE_TYPES = [\n  {\n    text: 'Linear',\n    scaleDistribution: { type: ScaleDistribution.Linear },\n  },\n  {\n    text: 'Log2',\n    scaleDistribution: { type: ScaleDistribution.Log, log: 2 },\n  },\n];\n\nexport class SceneTimeseriesMenu extends SceneObjectBase<SceneTimeseriesMenuState> {\n  constructor(state: SceneTimeseriesMenuState) {\n    super({\n      scaleType: ScaleDistribution.Linear,\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({ items: this.buildMenuItems() });\n  }\n\n  buildMenuItems(addToInvestigationLink?: PluginExtensionLink): PanelMenuItem[] {\n    const { items, scaleType } = this.state;\n\n    const menuItems: PanelMenuItem[] = [\n      {\n        text: 'Scale type',\n        type: 'group',\n        subMenu: SCALE_TYPES.map((option) => ({\n          text: `${scaleType === option.scaleDistribution.type ? '✔ ' : ''}${option.text}`,\n          onClick: () => this.onClickScaleOption(option),\n        })),\n      },\n      {\n        type: 'divider',\n        text: '',\n      },\n      {\n        iconClassName: 'compass',\n        text: 'Open in Explore',\n        onClick: () => this.onClickExplore(),\n      },\n    ];\n\n    if (addToInvestigationLink) {\n      menuItems.push({\n        iconClassName: 'plus-square',\n        text: 'Add to investigation (beta)',\n        onClick: () => {\n          addToInvestigationLink.onClick!();\n        },\n      });\n    } else {\n      const existingAddToInvestigationItem = items?.find((i) => i.text.includes('Add to investigation'));\n\n      if (existingAddToInvestigationItem) {\n        menuItems.push({ ...existingAddToInvestigationItem });\n      }\n    }\n\n    return menuItems;\n  }\n\n  onClickScaleOption(option: PanelMenuItem & { scaleDistribution: ScaleDistributionConfig }) {\n    const { scaleDistribution, text } = option;\n\n    reportInteraction('g_pyroscope_app_timeseries_scale_changed', { scale: scaleDistribution.type });\n\n    const timeseries = sceneGraph.getAncestor(this, SceneLabelValuesTimeseries);\n\n    timeseries.changeScale(scaleDistribution, text);\n\n    this.setState({\n      scaleType: scaleDistribution.type,\n      items: this.buildMenuItems(),\n    });\n  }\n\n  onClickExplore() {\n    reportInteraction('g_pyroscope_app_open_in_explore_clicked');\n\n    const rawTimeRange = sceneGraph.getTimeRange(this).state.value.raw;\n    const query = this.getInterpolatedQuery();\n    const datasource = sceneGraph.interpolate(this, '${dataSource}');\n\n    const exploreUrl = getExploreUrl(rawTimeRange, query, datasource);\n\n    window.open(exploreUrl, '_blank');\n  }\n\n  getInterpolatedQuery() {\n    const timeseries = sceneGraph.getAncestor(this, SceneLabelValuesTimeseries);\n    const queryRunner = timeseries.state.body.state.$data?.state.$data as SceneQueryRunner;\n    const nonInterpolatedQuery = queryRunner?.state.queries[0] as SceneDataQuery;\n\n    return Object.entries(nonInterpolatedQuery)\n      .map(([key, value]) => [key, typeof value === 'string' ? sceneGraph.interpolate(this, value) : value])\n      .reduce(\n        (acc, [key, value]) => ({\n          ...acc,\n          [key]: value,\n        }),\n        {}\n      ) as TimeSeriesQuery;\n  }\n\n  useGetInvestigationPluginLinkContext() {\n    const { refId, queryType, profileTypeId, labelSelector, groupBy } = this.getInterpolatedQuery();\n\n    const parsedQuery = parseQuery(`${profileTypeId}${labelSelector}`);\n    const titleParts = [parsedQuery.serviceId, getProfileMetricLabel(parsedQuery.profileMetricId)];\n\n    if (groupBy?.length) {\n      titleParts.push(groupBy[0]);\n    }\n\n    if (parsedQuery.labels.length) {\n      titleParts.push(parsedQuery.labels.join(', '));\n    }\n\n    const title = titleParts.join(' · ');\n    const datasource = sceneGraph.interpolate(this, '${dataSource}');\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    return useMemo(() => {\n      return {\n        id: nanoid(),\n        origin: 'Grafana Profiles Drilldown',\n        url: window.location.href,\n        logoPath: PyroscopeLogo,\n        title,\n        type: 'timeseries',\n        timeRange: { ...timeRange },\n        queries: [{ refId, queryType, profileTypeId, labelSelector, groupBy }],\n        datasource,\n      };\n    }, [datasource, groupBy, labelSelector, profileTypeId, queryType, refId, timeRange, title]);\n  }\n\n  useUpdateMenuItems() {\n    const context = this.useGetInvestigationPluginLinkContext();\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const link = useGetPluginExtensionLink({\n      extensionPointId: INVESTIGATIONS_EXTENSTION_POINT_ID,\n      context,\n      pluginId: INVESTIGATIONS_APP_ID,\n    });\n\n    // wrapped in a useEffect to prevent a warning when clicking on the \"Add to investigation\" link\n    // (\"Cannot update a component while rendering a different component\")\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    useEffect(() => {\n      if (link) {\n        this.setState({ items: this.buildMenuItems(link) });\n      }\n    }, [link]);\n  }\n\n  static Component({ model }: SceneComponentProps<SceneTimeseriesMenu>) {\n    model.useUpdateMenuItems();\n\n    return <VizPanelMenu.Component model={model as unknown as VizPanelMenu} />;\n  }\n}\n","import { RawTimeRange, toURLRange, urlUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { TimeSeriesQuery } from '../infrastructure/timeseries/buildTimeSeriesQueryRunner';\n\nexport function getExploreUrl(rawTimeRange: RawTimeRange, query: TimeSeriesQuery, datasource: string): string {\n  const exploreState = JSON.stringify({\n    ['pyroscope-explore']: {\n      range: toURLRange(rawTimeRange),\n      queries: [{ ...query, datasource }],\n      panelsState: {},\n      datasource,\n    },\n  });\n\n  const subUrl = config.appSubUrl ?? '';\n\n  return urlUtil.renderUrl(`${subUrl}/explore`, {\n    panes: exploreState,\n    schemaVersion: 1,\n  });\n}\n","import { PluginExtensionLink } from '@grafana/data';\nimport { usePluginLinks } from '@grafana/runtime';\n\nexport const INVESTIGATIONS_EXTENSTION_POINT_ID = 'grafana-pyroscope-app/investigation/v1';\nexport const INVESTIGATIONS_APP_ID = 'grafana-investigations-app';\n\ntype UseGetPluginLinkParams = {\n  extensionPointId: string;\n  context?: object | Record<string | symbol, unknown>;\n  pluginId: string;\n};\n\nexport function useGetPluginExtensionLink({\n  extensionPointId,\n  context,\n  pluginId,\n}: UseGetPluginLinkParams): PluginExtensionLink | undefined {\n  const pluginLinks = usePluginLinks({ extensionPointId, context });\n\n  const [link] = pluginLinks.links.filter((link) => link.pluginId === pluginId);\n\n  return link;\n}\n","import { DataFrame, FieldMatcherID, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataProvider,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanel,\n  VizPanelMenu,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { GraphGradientMode, ScaleDistribution, ScaleDistributionConfig, SortOrder } from '@grafana/schema';\nimport { LegendDisplayMode, TooltipDisplayMode, VizLegendOptions } from '@grafana/ui';\nimport { isEqual, merge } from 'lodash';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../domain/events/EventTimeseriesDataReceived';\nimport { formatSingleSeriesDisplayName } from '../../helpers/formatSingleSeriesDisplayName';\nimport { getColorByIndex } from '../../helpers/getColorByIndex';\nimport { getSeriesLabelFieldName } from '../../infrastructure/helpers/getSeriesLabelFieldName';\nimport { LabelsDataSource } from '../../infrastructure/labels/LabelsDataSource';\nimport { buildTimeSeriesQueryRunner } from '../../infrastructure/timeseries/buildTimeSeriesQueryRunner';\nimport { addRefId, addStats } from '../SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneTimeseriesMenu } from './SceneTimeseriesMenu';\n\ninterface SceneLabelValuesTimeseriesState extends SceneObjectState {\n  item: GridItemData;\n  headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  body: VizPanel;\n  displayAllValues: boolean;\n  legendPlacement: VizLegendOptions['placement'];\n  overrides?: (series: DataFrame[]) => VizPanelState['fieldConfig']['overrides'];\n}\n\nexport class SceneLabelValuesTimeseries extends SceneObjectBase<SceneLabelValuesTimeseriesState> {\n  constructor({\n    item,\n    headerActions,\n    displayAllValues,\n    legendPlacement,\n    data,\n    overrides,\n  }: {\n    item: SceneLabelValuesTimeseriesState['item'];\n    headerActions: SceneLabelValuesTimeseriesState['headerActions'];\n    displayAllValues?: SceneLabelValuesTimeseriesState['displayAllValues'];\n    legendPlacement?: SceneLabelValuesTimeseriesState['legendPlacement'];\n    data?: SceneDataTransformer;\n    overrides?: SceneLabelValuesTimeseriesState['overrides'];\n  }) {\n    super({\n      key: 'timeseries-label-values',\n      item,\n      headerActions,\n      displayAllValues: Boolean(displayAllValues),\n      legendPlacement: legendPlacement || 'bottom',\n      overrides,\n      body: PanelBuilders.timeseries()\n        .setTitle(item.label)\n        .setData(\n          data ||\n            new SceneDataTransformer({\n              $data: buildTimeSeriesQueryRunner(\n                item.queryRunnerParams,\n                displayAllValues ? undefined : LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES\n              ),\n              transformations: [addRefId, addStats],\n            })\n        )\n        .setHeaderActions(headerActions(item))\n        .setMenu(new SceneTimeseriesMenu({}) as unknown as VizPanelMenu)\n        .build(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const { body } = this.state;\n\n    const sub = (body.state.$data as SceneDataProvider).subscribeToState((newState, prevState) => {\n      if (newState.data?.state !== LoadingState.Done) {\n        return;\n      }\n\n      // ensure we retain the previous annotations, if they exist\n      if (!newState.data.annotations?.length && prevState.data?.annotations?.length) {\n        newState.data.annotations = prevState.data.annotations;\n      }\n\n      const { series } = newState.data;\n\n      if (series?.length) {\n        const config = this.state.displayAllValues ? this.getAllValuesConfig(series) : this.getConfig(series);\n        body.setState(merge({}, body.state, config));\n      }\n\n      // we publish the event only after setting the new config so that the subscribers can modify it\n      // (e.g. sync y-axis in SceneExploreDiffFlameGraphs.tsx)\n      this.publishEvent(new EventTimeseriesDataReceived({ series }), true);\n    });\n\n    return () => {\n      sub.unsubscribe();\n    };\n  }\n\n  getConfig(series: DataFrame[]) {\n    const { body, item, legendPlacement } = this.state;\n    let { title } = body.state;\n    let description;\n\n    if (item.queryRunnerParams.groupBy?.label) {\n      title = series.length > 1 ? `${item.label} (${series.length})` : item.label;\n      description = this.buildDescription(item.queryRunnerParams.groupBy!);\n    }\n\n    return {\n      title,\n      description,\n      options: {\n        tooltip: {\n          mode: 'single',\n          sort: 'none',\n        },\n        legend: {\n          showLegend: true,\n          displayMode: 'list',\n          placement: legendPlacement,\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          min: 0,\n          custom: {\n            fillOpacity: series.length >= LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES ? 0 : 9,\n            gradientMode: series.length === 1 ? GraphGradientMode.None : GraphGradientMode.Opacity,\n            pointSize: 3,\n          },\n        },\n        overrides: this.getOverrides(series),\n      },\n    };\n  }\n\n  buildDescription(groupBy: GridItemData['queryRunnerParams']['groupBy']) {\n    if (!groupBy) {\n      return '';\n    }\n\n    // this case is for favorites: they are stored in localStorage without the `values` array\n    if (!groupBy!.values) {\n      return `Showing only ${LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES} series to preserve readability. To view all the series, click on the expand icon on this panel.`;\n    }\n\n    if (groupBy!.values.length > LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES) {\n      return `Showing only ${LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES} out of ~${\n        groupBy!.values.length\n      } series to preserve readability. To view all the series for the current filters, click on the expand icon on this panel.`;\n    }\n\n    return '';\n  }\n\n  getAllValuesConfig(series: DataFrame[]) {\n    const { legendPlacement } = this.state;\n\n    return {\n      options: {\n        tooltip: {\n          mode: TooltipDisplayMode.Single,\n          sort: SortOrder.None,\n        },\n        legend: {\n          showLegend: true,\n          displayMode: LegendDisplayMode.List,\n          placement: legendPlacement,\n          calcs: [],\n        },\n      },\n      fieldConfig: {\n        defaults: {\n          min: 0,\n          custom: {\n            fillOpacity: 0,\n            pointSize: 5,\n          },\n        },\n        overrides: this.getOverrides(series),\n      },\n    };\n  }\n\n  getOverrides(series: DataFrame[]) {\n    if (this.state.overrides) {\n      return this.state.overrides(series);\n    }\n\n    const { item } = this.state;\n    const groupByLabel = item.queryRunnerParams.groupBy?.label;\n\n    return series.map((s, i) => {\n      const metricField = s.fields[1];\n      let displayName = groupByLabel ? getSeriesLabelFieldName(metricField, groupByLabel) : metricField.name;\n\n      if (series.length === 1) {\n        displayName = formatSingleSeriesDisplayName(displayName, s);\n      }\n\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties: [\n          {\n            id: 'displayName',\n            value: displayName,\n          },\n          {\n            id: 'color',\n            value: { mode: 'fixed', fixedColor: getColorByIndex(item.index + i) },\n          },\n        ],\n      };\n    });\n  }\n\n  updateItem(partialItem: Partial<GridItemData>) {\n    const { item, headerActions, body } = this.state;\n    const updatedItem = merge({}, item, partialItem);\n\n    if (partialItem.queryRunnerParams?.hasOwnProperty('groupBy')) {\n      if (partialItem.queryRunnerParams.groupBy === undefined) {\n        delete updatedItem.queryRunnerParams.groupBy;\n      } else {\n        // we completely replace groupBy because merge() above concatenates groupBy.values\n        updatedItem.queryRunnerParams.groupBy = partialItem.queryRunnerParams.groupBy;\n      }\n    }\n\n    if (\n      partialItem.queryRunnerParams?.hasOwnProperty('filters') &&\n      partialItem.queryRunnerParams.filters === undefined\n    ) {\n      delete updatedItem.queryRunnerParams.filters;\n    }\n\n    this.setState({ item: updatedItem });\n\n    body.setState({\n      title: partialItem.label,\n      description: this.buildDescription(updatedItem.queryRunnerParams.groupBy),\n      headerActions: headerActions(updatedItem),\n    });\n\n    if (!isEqual(item.queryRunnerParams, updatedItem.queryRunnerParams)) {\n      const { queries } = buildTimeSeriesQueryRunner(\n        updatedItem.queryRunnerParams,\n        LabelsDataSource.MAX_TIMESERIES_LABEL_VALUES\n      ).state;\n\n      const queryRunner = body.state.$data?.state.$data as SceneQueryRunner;\n\n      // this allows us not to have to subscribe to the data provider changes as we do in onActivate() above\n      queryRunner?.setState({ queries });\n      queryRunner?.runQueries();\n    }\n  }\n\n  changeScale(scaleDistribution: ScaleDistributionConfig, axisLabel: string) {\n    const { body } = this.state;\n\n    body.clearFieldConfigCache();\n\n    body.setState({\n      fieldConfig: merge({}, body.state.fieldConfig, {\n        defaults: {\n          custom: {\n            scaleDistribution,\n            axisLabel: scaleDistribution.type !== ScaleDistribution.Linear ? axisLabel : '',\n          },\n        },\n      }),\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesTimeseries>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { PanelType } from '../components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneLabelValuesBarGauge } from '../components/SceneLabelValuesBarGauge';\nimport { SceneLabelValuesHistogram } from '../components/SceneLabelValuesHistogram';\nimport { SceneLabelValuesTable } from '../components/SceneLabelValuesTable';\nimport { SceneLabelValuesTimeseries } from '../components/SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\n\nexport function vizPanelBuilder(panelType: PanelType, options: any) {\n  switch (panelType) {\n    case PanelType.BARGAUGE:\n      return new SceneLabelValuesBarGauge(options);\n\n    case PanelType.TABLE:\n      return new SceneLabelValuesTable(options);\n\n    case PanelType.HISTOGRAM:\n      return new SceneLabelValuesHistogram(options);\n\n    case PanelType.TIMESERIES:\n    default:\n      return new SceneLabelValuesTimeseries(options);\n  }\n}\n","import { throttle } from 'lodash';\nimport { useEffect, useState } from 'react';\n\ninterface MousePosition {\n  x: number | null;\n  y: number | null;\n}\n\n// For performance reasons, we throttle the mouse position updates\nconst DEFAULT_THROTTLE_INTERVAL_MS = 50;\n\nconst useMousePosition = (throttleInterval = DEFAULT_THROTTLE_INTERVAL_MS) => {\n  const [mousePosition, setMousePosition] = useState<MousePosition>({ x: null, y: null });\n\n  useEffect(() => {\n    const updateMousePosition = throttle((event: MouseEvent) => {\n      setMousePosition({ x: event.clientX, y: event.clientY });\n    }, throttleInterval);\n    window.addEventListener('mousemove', updateMousePosition);\n\n    return () => {\n      window.removeEventListener('mousemove', updateMousePosition);\n    };\n  }, [throttleInterval]);\n\n  return mousePosition;\n};\n\nexport default useMousePosition;\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2 } from '@grafana/ui';\nimport React, { SVGProps } from 'react';\nimport SVG from 'react-inlinesvg';\n\nimport dark404 from './img/grot-404-dark.svg';\nimport light404 from './img/grot-404-light.svg';\nimport useMousePosition from './useMousePosition';\n\nconst MIN_ARM_ROTATION = -20;\nconst MAX_ARM_ROTATION = 5;\nconst MIN_ARM_TRANSLATION = -5;\nconst MAX_ARM_TRANSLATION = 5;\n\ninterface Props {\n  width?: SVGProps<SVGElement>['width'];\n  height?: SVGProps<SVGElement>['height'];\n  show404?: boolean;\n}\n\nexport const GrotNotFound = ({ width = 'auto', height, show404 = false }: Props) => {\n  const theme = useTheme2();\n  const { x, y } = useMousePosition();\n  const styles = useStyles2(getStyles, x, y, show404);\n  return (\n    <SVG\n      src={(theme.isDark ? dark404 : light404) as unknown as string}\n      className={styles.svg}\n      height={height}\n      width={width}\n    />\n  );\n};\n\nGrotNotFound.displayName = 'GrotNotFound';\n\nconst getStyles = (theme: GrafanaTheme2, xPos: number | null, yPos: number | null, show404: boolean) => {\n  const { innerWidth, innerHeight } = window;\n  const heightRatio = yPos && yPos / innerHeight;\n  const widthRatio = xPos && xPos / innerWidth;\n  const rotation = heightRatio !== null ? getIntermediateValue(heightRatio, MIN_ARM_ROTATION, MAX_ARM_ROTATION) : 0;\n  const translation =\n    widthRatio !== null ? getIntermediateValue(widthRatio, MIN_ARM_TRANSLATION, MAX_ARM_TRANSLATION) : 0;\n\n  return {\n    svg: css({\n      '#grot-404-arm, #grot-404-magnifier': {\n        transform: `rotate(${rotation}deg) translateX(${translation}%)`,\n        transformOrigin: 'center',\n        transition: 'transform 50ms linear',\n      },\n      '#grot-404-text': {\n        display: show404 ? 'block' : 'none',\n      },\n    }),\n  };\n};\n\n/**\n * Given a start value, end value, and a ratio, return the intermediate value\n * Works with negative and inverted start/end values\n */\nconst getIntermediateValue = (ratio: number, start: number, end: number) => {\n  const value = ratio * (end - start) + start;\n  return value;\n};\n","import { css } from '@emotion/css';\nimport { Box, Stack, Text, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GrotNotFound } from './GrotNotFound';\n\ninterface Props {\n  message: string;\n}\n\nexport const EmptyState = ({ message }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <Box paddingY={8}>\n        <Stack direction=\"column\" alignItems=\"center\" gap={3}>\n          <GrotNotFound width={300} />\n          <Text variant=\"h5\">{message}</Text>\n        </Stack>\n      </Box>\n    </div>\n  );\n};\n\nEmptyState.displayName = 'EmptyState';\n\nfunction getStyles() {\n  return {\n    container: css({\n      width: '100%',\n      display: 'flex',\n      justifyContent: 'space-evenly',\n      flexDirection: 'column',\n    }),\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\n\nimport { EmptyState } from './ui/EmptyState';\n\ninterface SceneEmptyStateState extends SceneObjectState {\n  message: string;\n}\n\nexport class SceneEmptyState extends SceneObjectBase<SceneEmptyStateState> {\n  public static Component = ({ model }: SceneComponentProps<SceneEmptyState>) => {\n    const { message } = model.useState();\n    return <EmptyState message={message} />;\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Alert } from '@grafana/ui';\nimport React from 'react';\n\ninterface SceneErrorStateState extends SceneObjectState {\n  message: string;\n}\n\nexport class SceneErrorState extends SceneObjectBase<SceneErrorStateState> {\n  public static Component = ({ model }: SceneComponentProps<SceneErrorState>) => {\n    const { message } = model.useState();\n    return (\n      <Alert title=\"Query error!\" severity=\"error\">\n        {message}\n      </Alert>\n    );\n  };\n}\n","import {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport enum LayoutType {\n  GRID = 'grid',\n  ROWS = 'rows',\n}\n\nexport interface SceneLayoutSwitcherState extends SceneObjectState {\n  layout: LayoutType;\n  onChange?: (layout: LayoutType) => void;\n}\n\nexport class SceneLayoutSwitcher extends SceneObjectBase<SceneLayoutSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['layout'] });\n\n  static OPTIONS = [\n    { label: 'Grid', value: LayoutType.GRID },\n    { label: 'Rows', value: LayoutType.ROWS },\n  ];\n\n  static DEFAULT_LAYOUT = LayoutType.GRID;\n\n  constructor() {\n    super({\n      key: 'layout-switcher',\n      layout: SceneLayoutSwitcher.DEFAULT_LAYOUT,\n    });\n  }\n\n  getUrlState() {\n    return {\n      layout: this.state.layout,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<SceneLayoutSwitcherState> = {};\n\n    if (typeof values.layout === 'string' && values.layout !== this.state.layout) {\n      stateUpdate.layout = Object.values(LayoutType).includes(values.layout as LayoutType)\n        ? (values.layout as LayoutType)\n        : SceneLayoutSwitcher.DEFAULT_LAYOUT;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onChange = (layout: LayoutType) => {\n    reportInteraction('g_pyroscope_app_layout_changed', { layout });\n\n    this.setState({ layout });\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneLayoutSwitcher>) => {\n    const { layout } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Layout switcher\"\n        options={SceneLayoutSwitcher.OPTIONS}\n        value={layout}\n        onChange={model.onChange}\n        fullWidth={false}\n      />\n    );\n  };\n}\n","import {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { InlineSwitch } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport interface SceneNoDataSwitcherState extends SceneObjectState {\n  hideNoData: string;\n  onChange?: (hideNoData: string) => void;\n}\n\nexport class SceneNoDataSwitcher extends SceneObjectBase<SceneNoDataSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['hideNoData'] });\n\n  static DEFAULT_VALUE = 'off';\n\n  constructor() {\n    super({\n      key: 'no-data-switcher',\n      hideNoData: SceneNoDataSwitcher.DEFAULT_VALUE,\n    });\n  }\n\n  getUrlState() {\n    return {\n      hideNoData: this.state.hideNoData,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<SceneNoDataSwitcherState> = {};\n\n    if (typeof values.hideNoData === 'string' && values.hideNoData !== this.state.hideNoData) {\n      stateUpdate.hideNoData = ['on', 'off'].includes(values.hideNoData)\n        ? values.hideNoData\n        : SceneNoDataSwitcher.DEFAULT_VALUE;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onChange = (hideNoData: 'on' | 'off') => {\n    reportInteraction('g_pyroscope_app_hide_no_data_changed', { hideNoData });\n\n    this.setState({ hideNoData });\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneNoDataSwitcher>) => {\n    const { hideNoData } = model.useState();\n\n    return (\n      <InlineSwitch\n        data-testid=\"noDataSwitcher\"\n        showLabel\n        label=\"Hide panels without data\"\n        value={hideNoData === 'on'}\n        onChange={(event: React.ChangeEvent<HTMLInputElement>) => model.onChange(event.target.checked ? 'on' : 'off')}\n      />\n    );\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneComponentProps,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Icon, IconButton, Input, Tag, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nexport interface SceneQuickFilterState extends SceneObjectState {\n  placeholder: string;\n  searchText: string;\n  onChange?: (searchText: string) => void;\n  resultsCount: string;\n}\n\nexport class SceneQuickFilter extends SceneObjectBase<SceneQuickFilterState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['searchText'] });\n\n  static DEFAULT_SEARCH_TEXT = '';\n\n  static DEBOUNCE_DELAY = 250;\n\n  constructor({ placeholder }: { placeholder: string }) {\n    super({\n      key: 'quick-filter',\n      placeholder,\n      searchText: SceneQuickFilter.DEFAULT_SEARCH_TEXT,\n      resultsCount: '',\n    });\n  }\n\n  setPlaceholder(placeholder: string) {\n    this.setState({ placeholder });\n  }\n\n  setResultsCount(resultsCount: number) {\n    this.setState({ resultsCount: String(resultsCount) });\n  }\n\n  getUrlState() {\n    return {\n      searchText: this.state.searchText,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<SceneQuickFilterState> = {};\n\n    if (typeof values.searchText === 'string' && values.searchText !== this.state.searchText) {\n      stateUpdate.searchText = values.searchText;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.setState({ searchText: e.target.value });\n  };\n\n  reset() {\n    this.setState({ placeholder: '', searchText: '', resultsCount: '' });\n  }\n\n  clearSearchText = () => {\n    this.setState({ searchText: '' });\n  };\n\n  onFocus = () => {\n    reportInteraction('g_pyroscope_app_quick_filter_focused');\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneQuickFilter>) => {\n    const styles = useStyles2(getStyles);\n    const { placeholder, searchText, resultsCount } = model.useState();\n\n    return (\n      <Input\n        type=\"text\"\n        className=\"quick-filter\"\n        aria-label=\"Quick filter\"\n        placeholder={placeholder}\n        value={searchText}\n        prefix={<Icon name=\"search\" />}\n        suffix={\n          <>\n            {resultsCount !== '' && (\n              <Tag\n                className={styles.resultsCount}\n                name={resultsCount}\n                colorIndex={9}\n                data-testid=\"quick-filter-results-count\"\n              />\n            )}\n            <IconButton name=\"times\" aria-label=\"Clear search\" onClick={model.clearSearchText} />\n          </>\n        }\n        onChange={model.onChange}\n        onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {\n          if (e.key === 'Escape') {\n            model.clearSearchText();\n          }\n        }}\n        onFocus={model.onFocus}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  resultsCount: css`\n    margin-right: ${theme.spacing(1)};\n    border-radius: 11px;\n    padding: 2px 8px;\n    color: ${theme.colors.text.primary};\n    background-color: ${theme.colors.background.secondary};\n  `,\n});\n","import {\n  AdHocVariableFilter,\n  DataQueryResponse,\n  FieldType,\n  LoadingState,\n  MetricFindValue,\n  TestDataSourceResponse,\n} from '@grafana/data';\nimport { RuntimeDataSource } from '@grafana/scenes';\nimport { userStorage } from '@shared/infrastructure/userStorage';\nimport { isEqual } from 'lodash';\n\nimport { PanelType } from '../../components/SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { PYROSCOPE_FAVORITES_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { getProfileMetricLabel } from '../series/helpers/getProfileMetricLabel';\n\nexport type Favorite = {\n  index: number; // for colouring purpose only\n  queryRunnerParams: {\n    serviceName: string;\n    profileMetricId: string;\n    groupBy?: {\n      label: string;\n    };\n    filters?: AdHocVariableFilter[];\n  };\n  panelType?: PanelType;\n};\n\nexport class FavoritesDataSource extends RuntimeDataSource {\n  static getAllFavorites() {\n    return userStorage.get(userStorage.KEYS.PROFILES_EXPLORER)?.favorites || [];\n  }\n\n  static areFavoritesEqual(f1: Favorite, f2: Favorite) {\n    return f1.panelType === f2.panelType && isEqual(f1.queryRunnerParams, f2.queryRunnerParams);\n  }\n\n  static exists(favorite: Favorite) {\n    return FavoritesDataSource.getAllFavorites().some((f: Favorite) =>\n      FavoritesDataSource.areFavoritesEqual(f, favorite)\n    );\n  }\n\n  static addFavorite(favorite: Favorite) {\n    const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER);\n    storage.favorites.push(favorite);\n    userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n  }\n\n  static removeFavorite(favorite: Favorite) {\n    const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER);\n    storage.favorites = storage.favorites.filter((f: Favorite) => !FavoritesDataSource.areFavoritesEqual(f, favorite));\n    userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n  }\n\n  constructor() {\n    super(PYROSCOPE_FAVORITES_DATA_SOURCE.type, PYROSCOPE_FAVORITES_DATA_SOURCE.uid);\n\n    const storage = userStorage.get(userStorage.KEYS.PROFILES_EXPLORER) || {};\n    storage.favorites ||= [];\n\n    // ensures backward compatibility for older favorites without panel type\n    storage.favorites = storage.favorites.map((f: Favorite) => ({\n      panelType: PanelType.TIMESERIES,\n      ...f,\n    }));\n\n    userStorage.set(userStorage.KEYS.PROFILES_EXPLORER, storage);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Favories',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(): Promise<MetricFindValue[]> {\n    return FavoritesDataSource.getAllFavorites().map((f: Favorite) => {\n      const { serviceName, profileMetricId, groupBy, filters } = f.queryRunnerParams || {};\n      const textParts = [serviceName, getProfileMetricLabel(profileMetricId)];\n\n      if (groupBy?.label) {\n        textParts.push(groupBy.label);\n      }\n\n      if (filters?.length) {\n        textParts.push(filters.map(({ key, operator, value }) => `${key}${operator}\"${value}\"`).join(', '));\n      }\n\n      return {\n        value: JSON.stringify({ value: JSON.stringify(f), ...f }),\n        text: textParts.join(' · '),\n      };\n    });\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { sceneGraph, SceneObject } from '@grafana/scenes';\nimport { clone, defaults, uniqBy } from 'lodash';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\n\ntype InterpolatedQueryRunnerParams = GridItemData['queryRunnerParams'] & {\n  serviceName: string;\n  profileMetricId: string;\n  filters: AdHocVariableFilter[];\n};\n\nexport function interpolateQueryRunnerVariables(\n  sceneObject: SceneObject,\n  item: GridItemData\n): InterpolatedQueryRunnerParams {\n  const { queryRunnerParams } = item;\n\n  const interpolatedParams = defaults(clone(queryRunnerParams), {\n    serviceName: getSceneVariableValue(sceneObject, 'serviceName'),\n    profileMetricId: getSceneVariableValue(sceneObject, 'profileMetricId'),\n  });\n\n  // state.filters has the AdHocFilterWithLabels[] type so we get rid of keyLabel and valueLabel\n  const parsedFilters = (sceneGraph.lookupVariable('filters', sceneObject) as FiltersVariable).state.filters.map(\n    ({ key, operator, value }) => ({ key, operator, value })\n  );\n\n  interpolatedParams.filters = uniqBy(\n    [...(interpolatedParams.filters || []), ...parsedFilters],\n    ({ key, operator, value }) => `${key}${operator}${value}`\n  );\n\n  return interpolatedParams as InterpolatedQueryRunnerParams;\n}\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, VariableDependencyConfig } from '@grafana/scenes';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { Favorite, FavoritesDataSource } from '../../infrastructure/favorites/FavoritesDataSource';\nimport { interpolateQueryRunnerVariables } from '../../infrastructure/helpers/interpolateQueryRunnerVariables';\n\ninterface FavActionState extends SceneObjectState {\n  item: GridItemData;\n  isFav?: boolean;\n  skipVariablesInterpolation?: boolean;\n}\n\nexport class FavAction extends SceneObjectBase<FavActionState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['serviceName', 'profileMetricId', 'filters'],\n    onReferencedVariableValueChanged: () => {\n      this.update();\n    },\n  });\n\n  constructor(state: FavActionState) {\n    super(state);\n\n    this.addActivationHandler(() => this.update());\n  }\n\n  update() {\n    this.setState({ isFav: this.isStored() });\n  }\n\n  isStored() {\n    return FavoritesDataSource.exists(this.buildFavorite());\n  }\n\n  static buildFavorite(item: GridItemData): Favorite {\n    const { index, queryRunnerParams, panelType } = item;\n\n    const favorite: Favorite = {\n      index,\n      queryRunnerParams: {\n        serviceName: queryRunnerParams.serviceName as string,\n        profileMetricId: queryRunnerParams.profileMetricId as string,\n      },\n      panelType,\n    };\n\n    // we don't store values, we'll fetch all timeseries by using the `groupBy` parameter\n    if (queryRunnerParams.groupBy) {\n      favorite.queryRunnerParams.groupBy = {\n        label: queryRunnerParams.groupBy.label,\n      };\n    }\n\n    // we don't store filters if empty\n    if (queryRunnerParams.filters?.length) {\n      favorite.queryRunnerParams.filters = queryRunnerParams.filters;\n    }\n\n    return favorite;\n  }\n\n  buildFavorite(): Favorite {\n    const { item, skipVariablesInterpolation } = this.state;\n\n    return FavAction.buildFavorite({\n      index: item.index,\n      queryRunnerParams: skipVariablesInterpolation\n        ? item.queryRunnerParams\n        : interpolateQueryRunnerVariables(this, item),\n      panelType: item.panelType,\n    } as GridItemData);\n  }\n\n  public onClick = () => {\n    reportInteraction('g_pyroscope_app_fav_action_clicked', { favAfterClick: !this.state.isFav });\n\n    if (!this.state.isFav) {\n      FavoritesDataSource.addFavorite(this.buildFavorite());\n    } else {\n      FavoritesDataSource.removeFavorite(this.buildFavorite());\n    }\n\n    this.setState({ isFav: !this.state.isFav });\n  };\n\n  public static Component = ({ model }: SceneComponentProps<FavAction>) => {\n    const styles = useStyles2(getStyles);\n    const { isFav } = model.useState();\n\n    return (\n      <IconButton\n        className={isFav ? styles.favedButton : styles.notFavedbutton}\n        name={isFav ? 'favorite' : 'star'}\n        variant=\"secondary\"\n        size=\"sm\"\n        aria-label={isFav ? 'Unfavorite' : 'Favorite'}\n        tooltip={isFav ? 'Unfavorite' : 'Favorite'}\n        tooltipPlacement=\"top\"\n        onClick={model.onClick}\n      />\n    );\n  };\n}\n\nconst getStyles = () => ({\n  favedButton: css`\n    color: #f2cc0d;\n    margin: 0;\n  `,\n  notFavedbutton: css`\n    margin: 0;\n  `,\n});\n","import { localeCompare } from '@shared/domain/localeCompare';\n\nimport { FavAction } from '../../..//domain/actions/FavAction';\nimport { FavoritesDataSource } from '../../../infrastructure/favorites/FavoritesDataSource';\nimport { GridItemData } from '../types/GridItemData';\n\nexport const sortFavGridItems: (a: GridItemData, b: GridItemData) => number = function (a, b) {\n  const aIsFav = FavoritesDataSource.exists(FavAction.buildFavorite(a));\n  const bIsFav = FavoritesDataSource.exists(FavAction.buildFavorite(b));\n\n  if (aIsFav && bIsFav) {\n    return localeCompare(a.label, b.label);\n  }\n\n  if (bIsFav) {\n    return +1;\n  }\n\n  if (aIsFav) {\n    return -1;\n  }\n\n  return 0;\n};\n","import { DashboardCursorSync, VariableRefresh } from '@grafana/data';\nimport {\n  behaviors,\n  EmbeddedSceneState,\n  QueryVariable,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  VariableValueOption,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { Spinner } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { debounce, isEqual } from 'lodash';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../domain/events/EventTimeseriesDataReceived';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { vizPanelBuilder } from '../../helpers/vizPanelBuilder';\nimport { SceneLabelValuesBarGauge } from '../SceneLabelValuesBarGauge';\nimport { SceneLabelValuesHistogram } from '../SceneLabelValuesHistogram';\nimport { SceneLabelValuesTable } from '../SceneLabelValuesTable';\nimport { SceneLabelValuesTimeseries } from '../SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\nimport { SceneEmptyState } from './components/SceneEmptyState/SceneEmptyState';\nimport { SceneErrorState } from './components/SceneErrorState/SceneErrorState';\nimport { LayoutType, SceneLayoutSwitcher, SceneLayoutSwitcherState } from './components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher, SceneNoDataSwitcherState } from './components/SceneNoDataSwitcher';\nimport { ScenePanelTypeSwitcher } from './components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter, SceneQuickFilterState } from './components/SceneQuickFilter';\nimport { sortFavGridItems } from './domain/sortFavGridItems';\nimport { GridItemData } from './types/GridItemData';\n\ninterface SceneByVariableRepeaterGridState extends EmbeddedSceneState {\n  variableName: string;\n  items: GridItemData[];\n  headerActions: (item: GridItemData, items: GridItemData[]) => VizPanelState['headerActions'];\n  mapOptionToItem: (\n    option: VariableValueOption,\n    index: number,\n    variablesValues: Record<string, string>\n  ) => GridItemData | null;\n  sortItemsFn: (a: GridItemData, b: GridItemData) => number;\n  hideNoData: boolean;\n}\n\nconst GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\nconst GRID_TEMPLATE_ROWS = '1fr';\nconst GRID_AUTO_ROWS = '240px';\n\nexport class SceneByVariableRepeaterGrid extends SceneObjectBase<SceneByVariableRepeaterGridState> {\n  static buildGridItemKey(item: GridItemData) {\n    return `grid-item-${item.index}-${item.value}`;\n  }\n\n  static getGridColumnsTemplate(layout: LayoutType) {\n    return layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS;\n  }\n\n  constructor({\n    key,\n    variableName,\n    headerActions,\n    mapOptionToItem,\n    sortItemsFn,\n  }: {\n    key: string;\n    variableName: SceneByVariableRepeaterGridState['variableName'];\n    headerActions: SceneByVariableRepeaterGridState['headerActions'];\n    mapOptionToItem: SceneByVariableRepeaterGridState['mapOptionToItem'];\n    sortItemsFn?: SceneByVariableRepeaterGridState['sortItemsFn'];\n  }) {\n    super({\n      key,\n      variableName,\n      items: [],\n      headerActions,\n      mapOptionToItem,\n      sortItemsFn: sortItemsFn || sortFavGridItems,\n      hideNoData: false,\n      body: new SceneCSSGridLayout({\n        templateColumns: SceneByVariableRepeaterGrid.getGridColumnsTemplate(SceneLayoutSwitcher.DEFAULT_LAYOUT),\n        autoRows: GRID_AUTO_ROWS,\n        isLazy: true,\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: [],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    // here we try to emulate VariableDependencyConfig.onVariableUpdateCompleted\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as QueryVariable & { update: () => void };\n\n    const variableSub = variable.subscribeToState((newState, prevState) => {\n      if (!newState.loading && prevState.loading) {\n        this.renderGridItems();\n      }\n    });\n\n    // if the variable is inactive, the data source will not fetch the options\n    // so we force an update here to be sure we have the latest values\n    variable.update();\n\n    const refreshSub = this.subscribeToRefreshClick();\n    const quickFilterSub = this.subscribeToQuickFilterChange();\n    const layoutChangeSub = this.subscribeToLayoutChange();\n    const hideNoDataSub = this.subscribeToHideNoDataChange();\n    const filtersSub = this.subscribeToFiltersChange();\n\n    return () => {\n      filtersSub.unsubscribe();\n      hideNoDataSub.unsubscribe();\n      layoutChangeSub.unsubscribe();\n      quickFilterSub.unsubscribe();\n      refreshSub.unsubscribe();\n\n      variableSub.unsubscribe();\n    };\n  }\n\n  subscribeToRefreshClick() {\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as QueryVariable & { update: () => void };\n    const originalRefresh = variable.state.refresh;\n\n    variable.setState({ refresh: VariableRefresh.never });\n\n    const onClickRefresh = () => {\n      variable.update();\n    };\n\n    // start of hack, for a better UX: we disable the variable \"refresh\" option and we allow the user to reload the list only by clicking on the \"Refresh\" button\n    // if we don't do this, every time the time range changes (even with auto-refresh on),\n    // all the timeseries present on the screen would be re-created, resulting in blinking and a poor UX\n    const refreshButton = document.querySelector(\n      '[data-testid=\"data-testid RefreshPicker run button\"]'\n    ) as HTMLButtonElement;\n\n    if (!refreshButton) {\n      logger.error(\n        new Error('SceneByVariableRepeaterGrid: Refresh button not found! The list of items will never be updated.')\n      );\n    }\n\n    refreshButton?.addEventListener('click', onClickRefresh);\n    refreshButton?.setAttribute('title', 'Click to completely refresh all the panels present on the screen');\n    // end of hack\n\n    return {\n      unsubscribe() {\n        refreshButton?.removeAttribute('title');\n        refreshButton?.removeEventListener('click', onClickRefresh);\n        variable.setState({ refresh: originalRefresh });\n      },\n    };\n  }\n\n  subscribeToQuickFilterChange() {\n    const quickFilter = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.items.length !== prevState.items.length) {\n        quickFilter.setResultsCount(newState.items.length);\n      }\n    });\n\n    const onChangeState = (newState: SceneQuickFilterState, prevState?: SceneQuickFilterState) => {\n      if (newState.searchText !== prevState?.searchText) {\n        this.renderGridItems();\n      }\n    };\n\n    return quickFilter.subscribeToState(debounce(onChangeState, SceneQuickFilter.DEBOUNCE_DELAY));\n  }\n\n  subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher);\n\n    const body = this.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: SceneLayoutSwitcherState, prevState?: SceneLayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: SceneByVariableRepeaterGrid.getGridColumnsTemplate(newState.layout),\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state);\n\n    return layoutSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToHideNoDataChange() {\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    if (!noDataSwitcher.isActive) {\n      this.setState({ hideNoData: false });\n\n      return {\n        unsubscribe: noOp,\n      };\n    }\n\n    const onChangeState = (newState: SceneNoDataSwitcherState, prevState?: SceneNoDataSwitcherState) => {\n      if (newState.hideNoData !== prevState?.hideNoData) {\n        this.setState({ hideNoData: newState.hideNoData === 'on' });\n\n        // we force render because this.state.items certainly have not changed but we want to update the UI panels anyway\n        this.renderGridItems(true);\n      }\n    };\n\n    onChangeState(noDataSwitcher.state);\n\n    return noDataSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToFiltersChange() {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    // the handler will be called each time a filter is added/removed/modified\n    return filtersVariable.subscribeToState(() => {\n      if (noDataSwitcher.state.hideNoData === 'on') {\n        // to be sure the list is updated we force render because the filters only influence the query made in each panel\n        this.renderGridItems(true);\n      }\n    });\n  }\n\n  buildItemsData(variable: QueryVariable) {\n    const { mapOptionToItem } = this.state;\n\n    const variableValues = {\n      serviceName: getSceneVariableValue(this, 'serviceName'),\n      profileMetricId: getSceneVariableValue(this, 'profileMetricId'),\n      panelType: sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher).state.panelType,\n    };\n\n    const items = variable.state.options\n      .map((option, i) => mapOptionToItem(option, i, variableValues))\n      .filter(Boolean) as GridItemData[];\n\n    return this.filterItems(items).sort(this.state.sortItemsFn);\n  }\n\n  shouldRenderItems(newItems: SceneByVariableRepeaterGridState['items']) {\n    const { items } = this.state;\n\n    if (!newItems.length || items.length !== newItems.length) {\n      return true;\n    }\n\n    return !isEqual(items, newItems);\n  }\n\n  renderGridItems(forceRender = false) {\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as QueryVariable;\n\n    if (variable.state.loading) {\n      return;\n    }\n\n    if (variable.state.error) {\n      this.renderErrorState(variable.state.error);\n      return;\n    }\n\n    const newItems = this.buildItemsData(variable);\n\n    if (!forceRender && !this.shouldRenderItems(newItems)) {\n      return;\n    }\n\n    this.setState({ items: newItems });\n\n    if (!this.state.items.length) {\n      this.renderEmptyState();\n      return;\n    }\n\n    const gridItems = this.state.items.map((item) => {\n      const vizPanel = vizPanelBuilder(item.panelType, {\n        item,\n        headerActions: this.state.headerActions.bind(null, item, this.state.items),\n      });\n\n      if (this.state.hideNoData) {\n        this.setupHideNoData(vizPanel);\n      }\n\n      return new SceneCSSGridItem({\n        key: SceneByVariableRepeaterGrid.buildGridItemKey(item),\n        body: vizPanel,\n      });\n    });\n\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: GRID_AUTO_ROWS, // required to have the correct grid items height\n      children: gridItems,\n    });\n  }\n\n  setupHideNoData(\n    vizPanel: SceneLabelValuesTimeseries | SceneLabelValuesBarGauge | SceneLabelValuesHistogram | SceneLabelValuesTable\n  ) {\n    const sub = vizPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      if (event.payload.series?.length) {\n        return;\n      }\n\n      const gridItem = sceneGraph.getAncestor(vizPanel, SceneCSSGridItem);\n      const { key: gridItemKey } = gridItem.state;\n      const grid = sceneGraph.getAncestor(gridItem, SceneCSSGridLayout);\n\n      const filteredChildren = grid.state.children.filter((c) => c.state.key !== gridItemKey);\n\n      if (!filteredChildren.length) {\n        this.renderEmptyState();\n      } else {\n        grid.setState({ children: filteredChildren });\n      }\n    });\n\n    vizPanel.addActivationHandler(() => {\n      return () => {\n        sub.unsubscribe();\n      };\n    });\n  }\n\n  filterItems(items: SceneByVariableRepeaterGridState['items']) {\n    const quickFilterScene = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n    const { searchText } = quickFilterScene.state;\n\n    if (!searchText) {\n      return items;\n    }\n\n    const regexes = searchText\n      .split(',')\n      .map((t) => t.trim())\n      .filter(Boolean)\n      .map((r) => {\n        try {\n          return new RegExp(r);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean) as RegExp[];\n\n    return items.filter(({ label }) => regexes.some((r) => r.test(label)));\n  }\n\n  renderEmptyState() {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneEmptyState({\n            message: 'No results',\n          }),\n        }),\n      ],\n    });\n  }\n\n  renderErrorState(error: Error) {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneErrorState({\n            message: error.message || error.toString(),\n          }),\n        }),\n      ],\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneByVariableRepeaterGrid>) {\n    const { body, variableName } = model.useState();\n    const { loading } = (sceneGraph.lookupVariable(variableName, model) as QueryVariable)?.useState();\n\n    return loading ? <Spinner /> : <body.Component model={body} />;\n  }\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventExpandPanelPayload {\n  item: GridItemData;\n}\n\nexport class EventExpandPanel extends BusEventWithPayload<EventExpandPanelPayload> {\n  public static type = 'expand-panel';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventSelectLabelPayload {\n  item: GridItemData;\n}\n\nexport class EventSelectLabel extends BusEventWithPayload<EventSelectLabelPayload> {\n  public static type = 'select-label';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventViewServiceFlameGraphPayload {\n  item: GridItemData;\n}\n\nexport class EventViewServiceFlameGraph extends BusEventWithPayload<EventViewServiceFlameGraphPayload> {\n  public static type = 'view-service-flame-graph';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventViewServiceLabelsPayload {\n  item: GridItemData;\n}\n\nexport class EventViewServiceLabels extends BusEventWithPayload<EventViewServiceLabelsPayload> {\n  public static type = 'view-service-labels';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventViewServiceProfilesPayload {\n  item: GridItemData;\n}\n\nexport class EventViewServiceProfiles extends BusEventWithPayload<EventViewServiceProfilesPayload> {\n  public static type = 'view-service-profiles';\n}\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, IconName, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { merge } from 'lodash';\nimport React from 'react';\n\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { interpolateQueryRunnerVariables } from '../../infrastructure/helpers/interpolateQueryRunnerVariables';\nimport { EventExpandPanel, EventExpandPanelPayload } from '../events/EventExpandPanel';\nimport { EventSelectLabel, EventSelectLabelPayload } from '../events/EventSelectLabel';\nimport { EventViewServiceFlameGraph, EventViewServiceFlameGraphPayload } from '../events/EventViewServiceFlameGraph';\nimport { EventViewServiceLabels, EventViewServiceLabelsPayload } from '../events/EventViewServiceLabels';\nimport { EventViewServiceProfiles, EventViewServiceProfilesPayload } from '../events/EventViewServiceProfiles';\n\ntype ActionType = 'expand-panel' | 'select-label' | 'view-flame-graph' | 'view-labels' | 'view-profiles';\n\ntype EventLookup = {\n  icon?: IconName;\n  label?: string;\n  ariaLabel?: string;\n  tooltip: (item: GridItemData, model: SceneObject) => string;\n  EventConstructor:\n    | (new (payload: EventExpandPanelPayload) => EventExpandPanel)\n    | (new (payload: EventSelectLabelPayload) => EventSelectLabel)\n    | (new (payload: EventViewServiceFlameGraphPayload) => EventViewServiceFlameGraph)\n    | (new (payload: EventViewServiceLabelsPayload) => EventViewServiceLabels)\n    | (new (payload: EventViewServiceProfilesPayload) => EventViewServiceProfiles);\n};\n\nconst Events = new Map<ActionType, EventLookup>([\n  [\n    'expand-panel',\n    Object.freeze({\n      ariaLabel: 'Expand panel',\n      icon: 'expand-arrows',\n      tooltip: () => 'Expand this panel to view all the data for the current filters',\n      EventConstructor: EventExpandPanel,\n    }),\n  ],\n  [\n    'select-label',\n    Object.freeze({\n      label: 'Select',\n      tooltip: ({ queryRunnerParams }) => `View \"${queryRunnerParams.groupBy?.label}\" values breakdown`,\n      EventConstructor: EventSelectLabel,\n    }),\n  ],\n  [\n    'view-flame-graph',\n    Object.freeze({\n      label: 'Flame graph',\n      tooltip: ({ queryRunnerParams }, model) => {\n        const serviceName = queryRunnerParams.serviceName || getSceneVariableValue(model, 'serviceName');\n        const profileMetricId = queryRunnerParams.profileMetricId || getSceneVariableValue(model, 'profileMetricId');\n        return `View the \"${getProfileMetric(profileMetricId as ProfileMetricId).type}\" flame graph of ${serviceName}`;\n      },\n      EventConstructor: EventViewServiceFlameGraph,\n    }),\n  ],\n  [\n    'view-labels',\n    Object.freeze({\n      label: 'Labels',\n      tooltip: ({ queryRunnerParams }, model) => {\n        const serviceName = queryRunnerParams.serviceName || getSceneVariableValue(model, 'serviceName');\n        return `Explore the labels of ${serviceName}`;\n      },\n      EventConstructor: EventViewServiceLabels,\n    }),\n  ],\n  [\n    'view-profiles',\n    Object.freeze({\n      label: 'Profile types',\n      tooltip: ({ queryRunnerParams }, model) => {\n        const serviceName = queryRunnerParams.serviceName || getSceneVariableValue(model, 'serviceName');\n        return `View the profile types of ${serviceName}`;\n      },\n      EventConstructor: EventViewServiceProfiles,\n    }),\n  ],\n]);\n\ninterface SelectActionState extends SceneObjectState {\n  type: ActionType;\n  EventConstructor: EventLookup['EventConstructor'];\n  item: GridItemData;\n  label?: string;\n  ariaLabel?: string;\n  icon?: IconName;\n  tooltip?: EventLookup['tooltip'];\n  skipVariablesInterpolation?: boolean;\n}\n\nexport class SelectAction extends SceneObjectBase<SelectActionState> {\n  constructor({\n    type,\n    item,\n    tooltip,\n    skipVariablesInterpolation,\n  }: {\n    type: ActionType;\n    item: SelectActionState['item'];\n    tooltip?: SelectActionState['tooltip'];\n    skipVariablesInterpolation?: SelectActionState['skipVariablesInterpolation'];\n  }) {\n    const lookup = Events.get(type);\n    if (!lookup) {\n      throw new TypeError(`Unknown event type=\"${type}\"!`);\n    }\n\n    super({ type, item, ...merge({}, lookup, { tooltip, skipVariablesInterpolation }) });\n  }\n\n  public onClick = () => {\n    reportInteraction('g_pyroscope_app_select_action_clicked', { type: this.state.type });\n\n    this.publishEvent(this.buildEvent(), true);\n  };\n\n  buildEvent() {\n    const { EventConstructor, item, skipVariablesInterpolation } = this.state;\n\n    const completeItem = {\n      ...item,\n      queryRunnerParams: skipVariablesInterpolation\n        ? item.queryRunnerParams\n        : interpolateQueryRunnerVariables(this, item),\n    };\n\n    return new EventConstructor({\n      item: completeItem,\n    });\n  }\n\n  public static Component = ({ model }: SceneComponentProps<SelectAction>) => {\n    const styles = useStyles2(getStyles);\n    const { ariaLabel, label, icon, tooltip, item } = model.useState();\n\n    return (\n      <Button\n        className={styles.selectButton}\n        aria-label={ariaLabel || label}\n        variant=\"primary\"\n        size=\"sm\"\n        fill=\"text\"\n        onClick={model.onClick}\n        icon={icon}\n        tooltip={tooltip?.(item, model)}\n        tooltipPlacement=\"top\"\n      >\n        {label}\n      </Button>\n    );\n  };\n}\n\nconst getStyles = () => ({\n  selectButton: css`\n    margin: 0;\n    padding: 0;\n  `,\n});\n","import {\n  EmbeddedSceneState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { SceneByVariableRepeaterGrid } from '../../components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { PanelType } from '../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\n\ninterface SceneExploreAllServicesState extends EmbeddedSceneState {}\n\nexport class SceneExploreAllServices extends SceneObjectBase<SceneExploreAllServicesState> {\n  constructor() {\n    super({\n      key: 'explore-all-services',\n      $variables: new SceneVariableSet({\n        variables: [\n          // we use a custom instance of ServiceNameVariable to display only the services associated to the selected profile metric\n          new ServiceNameVariable({\n            query: ServiceNameVariable.QUERY_PROFILE_METRIC_DEPENDENT,\n            skipUrlSync: true,\n          }),\n        ],\n      }),\n      body: new SceneByVariableRepeaterGrid({\n        key: 'all-services-grid',\n        variableName: 'serviceName',\n        mapOptionToItem: (option, index, { profileMetricId }) => ({\n          index,\n          value: option.value as string,\n          label: option.label,\n          queryRunnerParams: {\n            serviceName: option.value as string,\n            profileMetricId,\n          },\n          panelType: PanelType.TIMESERIES,\n        }),\n        headerActions: (item) => [\n          new SelectAction({ type: 'view-profiles', item }),\n          new SelectAction({ type: 'view-labels', item }),\n          new SelectAction({ type: 'view-flame-graph', item }),\n          new FavAction({ item }),\n        ],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search services (comma-separated regexes are supported)');\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable)],\n      gridControls: [\n        sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter),\n        sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher),\n      ],\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreAllServices>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Drawer } from '@grafana/ui';\nimport React from 'react';\n\ninterface SceneDrawerState extends SceneObjectState {\n  key?: string;\n  isOpen?: boolean;\n  title?: string;\n  subTitle?: string;\n  body?: SceneObject;\n}\n\nexport class SceneDrawer extends SceneObjectBase<SceneDrawerState> {\n  constructor(state?: SceneDrawerState) {\n    super({\n      key: 'drawer',\n      isOpen: false,\n      ...state,\n    });\n  }\n\n  open = ({\n    title,\n    subTitle,\n    body,\n  }: {\n    title?: SceneDrawerState['title'];\n    subTitle?: SceneDrawerState['subTitle'];\n    body?: SceneDrawerState['body'];\n  }) => {\n    this.setState({ ...this.state, isOpen: true, title, subTitle, body });\n  };\n\n  close = () => {\n    this.setState({ isOpen: false });\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneDrawer>) => {\n    const { isOpen, title, subTitle, body } = model.useState();\n\n    return (\n      <>\n        {body && isOpen && (\n          <Drawer size=\"lg\" title={title} subtitle={subTitle} closeOnMaskClick onClose={model.close}>\n            <body.Component model={body} />\n          </Drawer>\n        )}\n      </>\n    );\n  };\n}\n","import { VariableRefresh } from '@grafana/data';\nimport { QueryVariable, VariableValueOption } from '@grafana/scenes';\nimport { lastValueFrom } from 'rxjs';\n\nimport { PYROSCOPE_FAVORITES_DATA_SOURCE } from '../../infrastructure/pyroscope-data-sources';\n\nexport class FavoriteVariable extends QueryVariable {\n  constructor() {\n    super({\n      name: 'favorite',\n      label: '🔖 Favorite',\n      datasource: PYROSCOPE_FAVORITES_DATA_SOURCE,\n      // \"hack\": we want to subscribe to changes of dataSource\n      query: '$dataSource',\n      loading: true,\n      refresh: VariableRefresh.never,\n      skipUrlSync: true,\n    });\n  }\n\n  async update() {\n    if (this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  }\n}\n","import {\n  EmbeddedSceneState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport React from 'react';\n\nimport { SceneByVariableRepeaterGrid } from '../../components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { GridItemData } from '../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneDrawer } from '../../components/SceneDrawer';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { EventExpandPanel } from '../../domain/events/EventExpandPanel';\nimport { FavoriteVariable } from '../../domain/variables/FavoriteVariable';\nimport { vizPanelBuilder } from '../../helpers/vizPanelBuilder';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\n\ninterface SceneExploreFavoritesState extends EmbeddedSceneState {\n  drawer: SceneDrawer;\n}\n\nexport class SceneExploreFavorites extends SceneObjectBase<SceneExploreFavoritesState> {\n  constructor() {\n    super({\n      key: 'explore-favorites',\n      $variables: new SceneVariableSet({ variables: [new FavoriteVariable()] }),\n      body: new SceneByVariableRepeaterGrid({\n        key: 'favorites-grid',\n        variableName: 'favorite',\n        mapOptionToItem: (option) => {\n          // see FavoritesDataSource.ts\n          const { index, value, panelType, queryRunnerParams } = JSON.parse(option.value as string);\n\n          return {\n            index,\n            value,\n            label: option.label,\n            queryRunnerParams,\n            panelType,\n          };\n        },\n        sortItemsFn: (a, b) => localeCompare(a.label, b.label),\n        headerActions: (item) => {\n          const actions: Array<SelectAction | FavAction> = [\n            new SelectAction({ type: 'view-labels', item, skipVariablesInterpolation: true }),\n            new SelectAction({ type: 'view-flame-graph', item, skipVariablesInterpolation: true }),\n          ];\n\n          if (item.queryRunnerParams.groupBy) {\n            actions.push(\n              new SelectAction({\n                type: 'expand-panel',\n                item,\n                tooltip: () => 'Expand panel to view all the data',\n                skipVariablesInterpolation: true,\n              })\n            );\n          }\n\n          actions.push(new FavAction({ item, skipVariablesInterpolation: true }));\n\n          return actions;\n        },\n      }),\n      drawer: new SceneDrawer(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search favorites (comma-separated regexes are supported)');\n\n    const expandPanelSub = this.subscribeToEvent(EventExpandPanel, async (event) => {\n      this.openExpandedPanelDrawer(event.payload.item);\n    });\n\n    return () => {\n      expandPanelSub.unsubscribe();\n    };\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [],\n      gridControls: [\n        sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter),\n        sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher),\n        sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher),\n      ],\n    };\n  }\n\n  openExpandedPanelDrawer(item: GridItemData) {\n    const headerActions = () => [\n      new SelectAction({ type: 'view-labels', item }),\n      new SelectAction({ type: 'view-flame-graph', item }),\n    ];\n\n    this.state.drawer.open({\n      title: item.label,\n      body: vizPanelBuilder(item.panelType, {\n        displayAllValues: true,\n        legendPlacement: 'right',\n        item,\n        headerActions,\n      }),\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreFavorites>) {\n    const { body, drawer } = model.useState();\n\n    return (\n      <>\n        <body.Component model={body} />\n        <drawer.Component model={drawer} />\n      </>\n    );\n  }\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Field, measureText, RadioButtonGroup, RefreshPicker, Select, useStyles2, useTheme2 } from '@grafana/ui';\nimport { useResizeObserver } from '@react-aria/utils';\nimport { noOp } from '@shared/domain/noOp';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { GroupByVariable } from './GroupByVariable';\n\ntype Props = {\n  options: Array<SelectableValue<string>>;\n  mainLabels: string[];\n  value?: string;\n  onChange: (label: string) => void;\n  onRefresh: () => void;\n};\n\nexport function GroupBySelector({ options, mainLabels, value, onChange, onRefresh }: Props) {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n\n  const [labelSelectorRequiredWidth, setLabelSelectorRequiredWidth] = useState<number>(0);\n  const [availableWidth, setAvailableWidth] = useState<number>(0);\n\n  const useHorizontalLabelSelector = availableWidth > labelSelectorRequiredWidth;\n\n  const controlsContainer = useRef<HTMLDivElement>(null);\n\n  useResizeObserver({\n    ref: controlsContainer,\n    onResize: () => {\n      const element = controlsContainer.current;\n      if (element) {\n        setAvailableWidth(element.clientWidth);\n      }\n    },\n  });\n\n  const mainOptions = options.filter((o) => mainLabels.includes(o.value as string));\n  const otherOptions = options.filter((o) => !mainLabels.includes(o.value as string));\n\n  useEffect(() => {\n    const { fontSize } = theme.typography;\n    const text = mainOptions.map((option) => option.label || option.text || '').join(' ');\n    const textWidth = measureText(text, fontSize).width;\n    const additionalWidthPerItem = 70;\n    setLabelSelectorRequiredWidth(textWidth + additionalWidthPerItem * mainOptions.length);\n  }, [mainOptions, theme]);\n\n  return (\n    <Field label=\"Group by labels\">\n      <div ref={controlsContainer} className={styles.container}>\n        {useHorizontalLabelSelector ? (\n          <>\n            <RadioButtonGroup aria-label=\"Labels selector\" options={mainOptions} value={value} onChange={onChange} />\n            <Select\n              aria-label=\"Other labels selector\"\n              className={styles.select}\n              placeholder=\"Other labels\"\n              options={otherOptions}\n              value={value && otherOptions.some((x) => x.value === value) ? value : null} // remove value from select when radio button clicked\n              onChange={(selected) => onChange(selected?.value ?? 'all')}\n              isClearable\n            />\n          </>\n        ) : (\n          <Select\n            aria-label=\"Labels selector\"\n            className={styles.select}\n            value={value}\n            placeholder=\"Select label\"\n            options={options}\n            onChange={(selected) => onChange(selected?.value || GroupByVariable.DEFAULT_VALUE)}\n            isClearable\n          />\n        )}\n        <RefreshPicker\n          noIntervalPicker\n          onRefresh={onRefresh}\n          isOnCanvas={false}\n          onIntervalChanged={noOp}\n          tooltip=\"Click to refresh all labels\"\n        />\n      </div>\n    </Field>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n  `,\n  select: css`\n    max-width: ${theme.spacing(22)};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { MultiValueVariable, QueryVariable, SceneComponentProps, VariableValueOption } from '@grafana/scenes';\nimport { Field, Icon, RefreshPicker, Spinner, Tooltip, useStyles2 } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React, { useMemo } from 'react';\nimport { lastValueFrom } from 'rxjs';\nimport { GridItemData } from 'src/pages/ProfilesExplorerView/components/SceneByVariableRepeaterGrid/types/GridItemData';\n\nimport { PYROSCOPE_LABELS_DATA_SOURCE } from '../../../infrastructure/pyroscope-data-sources';\nimport { GroupBySelector } from './GroupBySelector';\n\nexport type OptionWithIndex = VariableValueOption & {\n  index: number;\n  value: string;\n  label: string;\n  groupBy: GridItemData['queryRunnerParams']['groupBy'];\n};\n\nexport class GroupByVariable extends QueryVariable {\n  static DEFAULT_VALUE = 'all';\n\n  static MAX_MAIN_LABELS = 8;\n\n  constructor() {\n    super({\n      key: 'groupBy',\n      name: 'groupBy',\n      label: 'Group by labels',\n      datasource: PYROSCOPE_LABELS_DATA_SOURCE,\n      // \"hack\": we want to subscribe to changes of dataSource, serviceName and profileMetricId\n      // we could also add filters, but the Service labels exploration type would reload all labels each time they are modified\n      // which wouldn't be great UX\n      query: '$dataSource and $profileMetricId{service_name=\"$serviceName\"}',\n      loading: true,\n    });\n\n    this.changeValueTo = this.changeValueTo.bind(this);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    if (!this.state.value) {\n      this.setState({ value: GroupByVariable.DEFAULT_VALUE });\n    }\n  }\n\n  update = async () => {\n    if (this.state.loading) {\n      return;\n    }\n\n    let options: VariableValueOption[] = [];\n    let error = null;\n\n    this.setState({ loading: true, options: [], error: null });\n\n    try {\n      options = await lastValueFrom(this.getValueOptions({}));\n    } catch (e) {\n      error = e;\n    } finally {\n      this.setState({ loading: false, options, error });\n    }\n  };\n\n  onChange = (newValue: string) => {\n    reportInteraction('g_pyroscope_app_group_by_label_clicked');\n\n    prepareHistoryEntry();\n    this.changeValueTo(newValue);\n  };\n\n  findCurrentOption(): OptionWithIndex {\n    const { value } = this.state;\n\n    // See LabelsDataSource.ts\n    const option = this.state.options\n      .filter((o) => o.value !== 'all')\n      .find((o) => JSON.parse(o.value as string).value === value);\n\n    if (option) {\n      const parsedValue = JSON.parse(option.value as string);\n      return {\n        index: parsedValue.index,\n        value: parsedValue.value,\n        label: parsedValue.value,\n        groupBy: parsedValue.groupBy,\n      };\n    }\n\n    return {\n      index: 0,\n      value: value as string,\n      label: value as string,\n      groupBy: undefined,\n    };\n  }\n\n  static Component = ({ model }: SceneComponentProps<MultiValueVariable & { update?: any; onChange?: any }>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, value, options, error } = model.useState();\n\n    const groupByOptions = useMemo(\n      () =>\n        options.map(({ label, value }) => {\n          return value === 'all'\n            ? { label, value }\n            : {\n                label,\n                // see src/pages/ProfilesExplorerView/data/labels/LabelsDataSource.ts\n                value: JSON.parse(String(value)).value,\n              };\n        }),\n      [options]\n    );\n\n    if (loading) {\n      return (\n        <Field label=\"Group by labels\">\n          <Spinner className={styles.spinner} />\n        </Field>\n      );\n    }\n\n    if (error) {\n      return (\n        <Field label=\"Group by labels\">\n          <div className={styles.groupByErrorContainer}>\n            <Tooltip theme=\"error\" content={error.toString()}>\n              <Icon className={styles.iconError} name=\"exclamation-triangle\" size=\"xl\" />\n            </Tooltip>\n            <RefreshPicker noIntervalPicker onRefresh={model.update} isOnCanvas={false} onIntervalChanged={noOp} />\n          </div>\n        </Field>\n      );\n    }\n\n    const getMainLabels = (groupByOptions: Array<SelectableValue<string>>) => {\n      return groupByOptions.slice(0, GroupByVariable.MAX_MAIN_LABELS).map(({ value }) => value as string);\n    };\n\n    return (\n      <GroupBySelector\n        options={groupByOptions}\n        value={value as string}\n        mainLabels={getMainLabels(groupByOptions)}\n        onChange={model.onChange}\n        onRefresh={model.update}\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  spinner: css`\n    height: 32px;\n    line-height: 32px;\n  `,\n  groupByErrorContainer: css`\n    display: flex;\n  `,\n  iconError: css`\n    height: 32px;\n    align-self: center;\n    color: ${theme.colors.error.text};\n  `,\n});\n","import {\n  SceneComponentProps,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VariableDependencyConfig,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\n\nimport { FiltersVariable } from '../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../domain/variables/GroupByVariable/GroupByVariable';\nimport { ProfileMetricVariable } from '../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { getSceneVariableValue } from '../helpers/getSceneVariableValue';\nimport { PYROSCOPE_DATA_SOURCE } from '../infrastructure/pyroscope-data-sources';\nimport { getProfileMetricLabel } from '../infrastructure/series/helpers/getProfileMetricLabel';\nimport { PanelType } from './SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { addRefId, addStats } from './SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from './SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneLabelValuesTimeseries } from './SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\n\ninterface SceneMainServiceTimeseriesState extends SceneObjectState {\n  headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  body?: SceneLabelValuesTimeseries;\n}\n\nexport class SceneMainServiceTimeseries extends SceneObjectBase<SceneMainServiceTimeseriesState> {\n  static MIN_HEIGHT = 240;\n\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['serviceName', 'profileMetricId'],\n    onReferencedVariableValueChanged: (variable) => {\n      this.resetTimeseries(variable.state.name === 'serviceName');\n    },\n  });\n\n  constructor({\n    item,\n    headerActions,\n    supportGroupBy,\n  }: {\n    item?: GridItemData;\n    headerActions: SceneMainServiceTimeseriesState['headerActions'];\n    supportGroupBy?: boolean;\n  }) {\n    super({\n      headerActions,\n      body: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item, supportGroupBy));\n  }\n\n  onActivate(item?: GridItemData, supportGroupBy?: boolean) {\n    if (item) {\n      this.initVariables(item);\n    }\n\n    this.setState({ body: this.buildTimeseries(item, supportGroupBy) });\n\n    if (supportGroupBy) {\n      this.subscribeToGroupByStateChanges(item);\n    }\n  }\n\n  initVariables(item: GridItemData) {\n    const { serviceName, profileMetricId, filters } = item.queryRunnerParams;\n\n    if (serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(serviceName);\n    }\n\n    if (profileMetricId) {\n      const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n      profileMetricVariable.changeValueTo(profileMetricId);\n    }\n\n    if (filters) {\n      const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n      filtersVariable.setState({ filters });\n    }\n  }\n\n  buildTimeseries(item?: GridItemData, supportGroupBy?: boolean) {\n    const { headerActions } = this.state;\n\n    const timeseriesItem: GridItemData = {\n      index: 0,\n      value: '',\n      queryRunnerParams: {}, // let interpolation happen\n      label: this.buildTitle(),\n      panelType: PanelType.TIMESERIES,\n    };\n\n    if (item && supportGroupBy) {\n      timeseriesItem.queryRunnerParams.groupBy = item.queryRunnerParams.groupBy;\n    }\n\n    const groupBy = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable).state.value;\n\n    return new SceneLabelValuesTimeseries({\n      item: timeseriesItem,\n      headerActions,\n      // we pass data for the scenarios where we land on the page from a shared link\n      // we do this to prevent rendering a timeseries without groupBy for a second then with groupBy\n      // and also to directly render something when there's no groupBy in the URL\n      data:\n        !item && supportGroupBy && groupBy && groupBy !== 'all'\n          ? new SceneDataTransformer({\n              $data: new SceneQueryRunner({ datasource: PYROSCOPE_DATA_SOURCE, queries: [] }),\n              transformations: [addRefId, addStats],\n            })\n          : undefined,\n    });\n  }\n\n  subscribeToGroupByStateChanges(item?: GridItemData) {\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n\n    this._subs.add(\n      groupByVariable.subscribeToState((newState, prevState) => {\n        if (newState.loading || !newState.options.length) {\n          return;\n        }\n\n        // First load:\n        // here we check for the item to prevent two queries to occur when coming from (e.g) favorites and\n        // selecting an item with a different profile metric than the current ProfileMetricVariable value\n        if (!item && prevState.loading) {\n          this.onGroupByChanged(groupByVariable);\n          return;\n        }\n\n        if (newState.value !== prevState.value) {\n          this.onGroupByChanged(groupByVariable);\n        }\n      })\n    );\n  }\n\n  onGroupByChanged(groupByVariable: GroupByVariable) {\n    if (!groupByVariable.state.value || groupByVariable.state.value === 'all') {\n      this.resetTimeseries();\n      return;\n    }\n\n    const { index, value, groupBy } = groupByVariable.findCurrentOption();\n\n    (this.state.body as SceneLabelValuesTimeseries)?.updateItem({\n      index,\n      label: `${this.buildTitle()}, grouped by ${value}`,\n      queryRunnerParams: { groupBy },\n    });\n  }\n\n  resetTimeseries(resetFilters = false) {\n    if (resetFilters) {\n      sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable).reset();\n    }\n\n    (this.state.body as SceneLabelValuesTimeseries)?.updateItem({\n      index: 0,\n      label: this.buildTitle(),\n      queryRunnerParams: { groupBy: undefined },\n    });\n  }\n\n  buildTitle() {\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const { description } = getProfileMetric(profileMetricId as ProfileMetricId);\n    return description || getProfileMetricLabel(profileMetricId);\n  }\n\n  static Component({ model }: SceneComponentProps<SceneMainServiceTimeseries>) {\n    const { body } = model.useState();\n\n    return body && <body.Component model={body} />;\n  }\n}\n","import { AdHocVariableFilter, BusEventWithPayload } from '@grafana/data';\n\ninterface EventViewDiffFlameGraphPayload {\n  useAncestorTimeRange: boolean;\n  clearDiffRange: boolean;\n  baselineFilters: AdHocVariableFilter[];\n  comparisonFilters: AdHocVariableFilter[];\n}\n\nexport class EventViewDiffFlameGraph extends BusEventWithPayload<EventViewDiffFlameGraphPayload> {\n  public static type = 'view-diff-flame-graph';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { CompareTarget } from '../../../../../SceneExploreDiffFlameGraph/domain/types';\n\ninterface EventSelectForComparePayload {\n  compareTarget: CompareTarget;\n  item: GridItemData;\n}\n\nexport class EventSelectForCompare extends BusEventWithPayload<EventSelectForComparePayload> {\n  public static type = 'select-for-compare';\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, Tooltip, useStyles2 } from '@grafana/ui';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { CompareTarget } from '../../../../../../../../SceneExploreDiffFlameGraph/domain/types';\n\ntype CompareActionProps = {\n  option: {\n    label: string;\n    value: CompareTarget;\n    description: string;\n  };\n  checked: boolean;\n  onChange: (compareTarget: CompareTarget) => void;\n};\n\nexport function CompareAction({ option, checked, onChange }: CompareActionProps) {\n  const styles = useStyles2(getStyles);\n\n  const [showTooltip, setShowTooltip] = useState(false);\n  const checkboxRef = useRef<HTMLInputElement>(null);\n  const label = (checkboxRef.current as HTMLInputElement)?.closest('label');\n\n  // we write custom code to provide the tooltips because wrapping our checkbox into the <Tooltip> component does not work\n  useEffect(() => {\n    if (!label || checked) {\n      setShowTooltip(false);\n      return;\n    }\n\n    const onMouseEnter = () => {\n      setShowTooltip(true);\n    };\n\n    const onMouseLeave = () => {\n      setShowTooltip(false);\n    };\n\n    label.addEventListener('mouseenter', onMouseEnter);\n    label.addEventListener('mouseleave', onMouseLeave);\n\n    return () => {\n      label.removeEventListener('mouseleave', onMouseLeave);\n      label.removeEventListener('mouseenter', onMouseEnter);\n    };\n  }, [checked, label]);\n\n  return (\n    <>\n      <Tooltip content={option.description} show={!checked && showTooltip} placement=\"top\">\n        <span className={styles.tooltipAnchor} />\n      </Tooltip>\n      <Checkbox\n        ref={checkboxRef}\n        className={cx(styles.checkbox, 'checkbox', checked && 'checked')}\n        checked={checked}\n        label={option.label}\n        onChange={() => onChange(option.value)}\n      />\n    </>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  tooltipAnchor: css`\n    position: relative;\n    left: 42px;\n  `,\n  checkbox: css`\n    column-gap: 4px;\n\n    &:last-child {\n      & :nth-child(1) {\n        grid-column-start: 2;\n      }\n      & :nth-child(2) {\n        grid-column-start: 1;\n      }\n    }\n\n    span {\n      color: ${theme.colors.text.secondary};\n    }\n    span:hover {\n      color: ${theme.colors.text.primary};\n    }\n\n    &.checked span {\n      color: ${theme.colors.text.primary};\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { getValueFormat, GrafanaTheme2 } from '@grafana/data';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { GridItemData } from '../../../../../../../../../components/SceneByVariableRepeaterGrid/types/GridItemData';\nimport { getColorByIndex } from '../../../../../../../../../helpers/getColorByIndex';\nimport { CompareTarget } from '../../../../../../../../SceneExploreDiffFlameGraph/domain/types';\nimport { ItemStats } from '../SceneStatsPanel';\nimport { CompareAction } from './CompareAction';\n\ntype StatsPanelProps = {\n  item: GridItemData;\n  itemStats?: ItemStats;\n  statsDescription: string;\n  compareActionChecks: boolean[];\n  onChangeCompareTarget: (compareTarget: CompareTarget) => void;\n};\n\nexport function StatsPanel({\n  item,\n  itemStats,\n  statsDescription,\n  compareActionChecks,\n  onChangeCompareTarget,\n}: StatsPanelProps) {\n  const styles = useStyles2(getStyles);\n\n  const { index, value } = item;\n\n  const color = getColorByIndex(index);\n\n  const total = useMemo(() => {\n    if (!itemStats) {\n      return <Spinner inline />;\n    }\n\n    const { allValuesSum, unit } = itemStats;\n    const { text, suffix } = getValueFormat(unit)(allValuesSum);\n\n    return `${text}${suffix}`;\n  }, [itemStats]);\n\n  const options = useMemo(\n    () => [\n      {\n        label: 'Baseline',\n        value: CompareTarget.BASELINE,\n        description: !compareActionChecks[0] ? `Click to select \"${value}\" as baseline for comparison` : '',\n      },\n      {\n        label: 'Comparison',\n        value: CompareTarget.COMPARISON,\n        description: !compareActionChecks[1] ? `Click to select \"${value}\" as target for comparison` : '',\n      },\n    ],\n    [compareActionChecks, value]\n  );\n\n  return (\n    <div className={styles.container} data-testid={`stats-panel-${value}`}>\n      <h1 style={{ color }} className={styles.title} title={`${statsDescription}: ${total}`}>\n        {total}\n      </h1>\n\n      <div className={styles.compareActions}>\n        <CompareAction option={options[0]} checked={compareActionChecks[0]} onChange={onChangeCompareTarget} />\n        <CompareAction option={options[1]} checked={compareActionChecks[1]} onChange={onChangeCompareTarget} />\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    background-color: ${theme.colors.background.canvas};\n    padding: ${theme.spacing(1)};\n    border: 1px solid ${theme.colors.border.weak};\n    border-right: none;\n    border-radius: 2px 0 0 2px;\n  `,\n  title: css`\n    font-size: 24px;\n    width: 100%;\n    text-align: center;\n    margin-top: ${theme.spacing(5)};\n  `,\n  compareActions: css`\n    display: flex;\n    justify-content: space-between;\n    font-size: 11px;\n    border-top: 1px solid ${theme.colors.border.weak};\n    padding: ${theme.spacing(1)} 0 0 0;\n\n    & .checkbox:nth-child(2) {\n      padding-right: 4px;\n      border-right: 1px solid ${theme.colors.border.strong};\n    }\n    & .checkbox:nth-child(4) {\n      padding-left: 4px;\n    }\n  `,\n});\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\nimport { getSceneVariableValue } from 'src/pages/ProfilesExplorerView/helpers/getSceneVariableValue';\nimport { getProfileMetricLabel } from 'src/pages/ProfilesExplorerView/infrastructure/series/helpers/getProfileMetricLabel';\n\nimport { GridItemData } from '../../../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { CompareTarget } from '../../../../../../../SceneExploreDiffFlameGraph/domain/types';\nimport { EventSelectForCompare } from '../../../../domain/events/EventSelectForCompare';\nimport { SceneGroupByLabels } from '../../../../SceneGroupByLabels';\nimport { StatsPanel } from './ui/StatsPanel';\n\nexport type ItemStats = {\n  allValuesSum: number;\n  unit: string;\n};\n\ninterface SceneStatsPanelState extends SceneObjectState {\n  item: GridItemData;\n  itemStats?: ItemStats;\n  compareActionChecks: boolean[];\n  statsDescription: string;\n}\n\nexport class SceneStatsPanel extends SceneObjectBase<SceneStatsPanelState> {\n  static WIDTH_IN_PIXELS = 186;\n\n  constructor({ item }: { item: GridItemData }) {\n    super({\n      item,\n      itemStats: undefined,\n      compareActionChecks: [false, false],\n      statsDescription: '',\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const compare = sceneGraph.findByKeyAndType(this, 'group-by-labels', SceneGroupByLabels).getCompare();\n\n    this.updateCompareActions(compare.get(CompareTarget.BASELINE), compare.get(CompareTarget.COMPARISON));\n\n    this.setState({ statsDescription: this.getStatsDescription() });\n  }\n\n  updateCompareActions(baselineItem?: GridItemData, comparisonItem?: GridItemData) {\n    const { item } = this.state;\n\n    this.setState({\n      compareActionChecks: [baselineItem?.value === item.value, comparisonItem?.value === item.value],\n    });\n  }\n\n  getStatsDescription() {\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const { description } = getProfileMetric(profileMetricId as ProfileMetricId);\n    return description || getProfileMetricLabel(profileMetricId);\n  }\n\n  onChangeCompareTarget = (compareTarget: CompareTarget) => {\n    this.publishEvent(\n      new EventSelectForCompare({\n        compareTarget,\n        item: this.state.item,\n      }),\n      true\n    );\n  };\n\n  getStats() {\n    return this.state.itemStats;\n  }\n\n  updateStats(itemStats: ItemStats) {\n    this.setState({ itemStats });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneStatsPanel>) {\n    const { item, itemStats, statsDescription, compareActionChecks } = model.useState();\n\n    return (\n      <StatsPanel\n        item={item}\n        itemStats={itemStats}\n        statsDescription={statsDescription}\n        compareActionChecks={compareActionChecks}\n        onChangeCompareTarget={model.onChangeCompareTarget}\n      />\n    );\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, VizPanelState } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../../../../../../domain/events/EventTimeseriesDataReceived';\nimport { getSeriesStatsValue } from '../../../../../../../infrastructure/helpers/getSeriesStatsValue';\nimport { GridItemData } from '../../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneLabelValuesTimeseries } from '../../../../../../SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\nimport { GRID_AUTO_ROWS } from '../SceneLabelValuesGrid';\nimport { SceneStatsPanel } from './SceneStatsPanel/SceneStatsPanel';\n\ninterface SceneLabelValuesStatAndTimeseriesState extends SceneObjectState {\n  statsPanel: SceneStatsPanel;\n  timeseriesPanel: SceneLabelValuesTimeseries;\n}\n\nexport class SceneLabelValuePanel extends SceneObjectBase<SceneLabelValuesStatAndTimeseriesState> {\n  static buildPanelKey(item: GridItemData) {\n    return `compare-panel-${item.value}`;\n  }\n\n  constructor({\n    item,\n    headerActions,\n  }: {\n    item: GridItemData;\n    headerActions: (item: GridItemData) => VizPanelState['headerActions'];\n  }) {\n    super({\n      key: 'label-value-panel',\n      statsPanel: new SceneStatsPanel({ item }),\n      timeseriesPanel: new SceneLabelValuesTimeseries({ item, headerActions }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const { statsPanel, timeseriesPanel } = this.state;\n\n    const timeseriesSub = timeseriesPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      const s = event.payload.series?.[0];\n\n      if (!s) {\n        statsPanel.updateStats({ allValuesSum: 0, unit: 'short' });\n        return;\n      }\n\n      const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n\n      if (statsPanel.getStats()?.allValuesSum !== allValuesSum) {\n        statsPanel.updateStats({\n          allValuesSum,\n          unit: s.fields[1].config.unit || 'short',\n        });\n      }\n    });\n\n    return () => {\n      timeseriesSub.unsubscribe();\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuePanel>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { statsPanel, timeseriesPanel } = model.useState();\n    const { compareActionChecks } = statsPanel.useState();\n    const isSelected = compareActionChecks[0] || compareActionChecks[1];\n\n    return (\n      <div className={cx(styles.container, isSelected && 'selected')}>\n        <div className={styles.statsPanel}>\n          <statsPanel.Component model={statsPanel} />\n        </div>\n        <div className={styles.timeseriesPanel}>\n          <timeseriesPanel.Component model={timeseriesPanel} />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    min-width: 0px;\n    min-height: ${GRID_AUTO_ROWS};\n    flex-flow: row;\n\n    box-sizing: border-box;\n    border: 1px solid transparent;\n    &.selected {\n      border: 1px solid ${theme.colors.primary.main};\n    }\n\n    & > div {\n      display: flex;\n      position: relative;\n      flex-direction: row;\n      align-self: stretch;\n      min-height: ${GRID_AUTO_ROWS};\n    }\n  `,\n  statsPanel: css`\n    width: ${SceneStatsPanel.WIDTH_IN_PIXELS}px;\n  `,\n  timeseriesPanel: css`\n    flex-grow: 1;\n\n    & [data-viz-panel-key] > * {\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n    }\n  `,\n});\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../../../../../../../infrastructure/pyroscope-data-sources';\n\nexport function buildLabelValuesGridQueryRunner({ label }: { label: string }) {\n  const selector = 'service_name=\"$serviceName\"';\n\n  return new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: `$profileMetricId-${selector}-${label}`,\n        queryType: 'metrics',\n        profileTypeId: '$profileMetricId',\n        labelSelector: `{${selector}}`,\n        groupBy: [label],\n      },\n    ],\n  });\n}\n","import { DashboardCursorSync, DataFrame, LoadingState } from '@grafana/data';\nimport {\n  behaviors,\n  EmbeddedSceneState,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  VizPanelState,\n} from '@grafana/scenes';\nimport { Spinner } from '@grafana/ui';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { debounce, isEqual } from 'lodash';\nimport React from 'react';\n\nimport { EventTimeseriesDataReceived } from '../../../../../../domain/events/EventTimeseriesDataReceived';\nimport { FiltersVariable } from '../../../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../../../../../../domain/variables/GroupByVariable/GroupByVariable';\nimport { getSceneVariableValue } from '../../../../../../helpers/getSceneVariableValue';\nimport { getSeriesLabelFieldName } from '../../../../../../infrastructure/helpers/getSeriesLabelFieldName';\nimport { SceneEmptyState } from '../../../../../SceneByVariableRepeaterGrid/components/SceneEmptyState/SceneEmptyState';\nimport { SceneErrorState } from '../../../../../SceneByVariableRepeaterGrid/components/SceneErrorState/SceneErrorState';\nimport {\n  LayoutType,\n  SceneLayoutSwitcher,\n  SceneLayoutSwitcherState,\n} from '../../../../../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport {\n  SceneNoDataSwitcher,\n  SceneNoDataSwitcherState,\n} from '../../../../../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport { PanelType } from '../../../../../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport {\n  SceneQuickFilter,\n  SceneQuickFilterState,\n} from '../../../../../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { sortFavGridItems } from '../../../../../SceneByVariableRepeaterGrid/domain/sortFavGridItems';\nimport { addRefId, addStats } from '../../../../../SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneLabelValuePanel } from './components/SceneLabelValuePanel';\nimport { buildLabelValuesGridQueryRunner } from './infrastructure/buildLabelValuesGridQueryRunner';\n\ninterface SceneLabelValuesGridState extends EmbeddedSceneState {\n  $data: SceneDataProvider;\n  isLoading: boolean;\n  items: GridItemData[];\n  label: string;\n  startColorIndex: number;\n  headerActions: (item: GridItemData, items: GridItemData[]) => VizPanelState['headerActions'];\n  sortItemsFn: (a: GridItemData, b: GridItemData) => number;\n  hideNoData: boolean;\n}\n\nconst GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(600px, 1fr))';\nconst GRID_TEMPLATE_ROWS = '1fr';\nexport const GRID_AUTO_ROWS = '160px';\n\nexport class SceneLabelValuesGrid extends SceneObjectBase<SceneLabelValuesGridState> {\n  static buildGridItemKey(item: GridItemData) {\n    return `grid-item-${item.index}-${item.value}`;\n  }\n\n  constructor({\n    key,\n    label,\n    startColorIndex,\n    headerActions,\n  }: {\n    key: string;\n    label: SceneLabelValuesGridState['label'];\n    startColorIndex: SceneLabelValuesGridState['startColorIndex'];\n    headerActions: SceneLabelValuesGridState['headerActions'];\n  }) {\n    super({\n      key,\n      label,\n      startColorIndex,\n      items: [],\n      isLoading: true,\n      $data: new SceneDataTransformer({\n        $data: buildLabelValuesGridQueryRunner({ label }),\n        transformations: [addRefId, addStats],\n      }),\n      hideNoData: false,\n      headerActions,\n      sortItemsFn: sortFavGridItems,\n      body: new SceneCSSGridLayout({\n        templateColumns: GRID_TEMPLATE_ROWS,\n        autoRows: GRID_AUTO_ROWS,\n        isLazy: true,\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: [],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.subscribeOnceToDataChange();\n\n    const groupBySub = this.subscribeToGroupByChange();\n\n    const refreshSub = this.subscribeToRefreshClick();\n    const quickFilterSub = this.subscribeToQuickFilterChange();\n    const layoutChangeSub = this.subscribeToLayoutChange();\n    const hideNoDataSub = this.subscribeToHideNoDataChange();\n    const filtersSub = this.subscribeToFiltersChange();\n\n    return () => {\n      filtersSub.unsubscribe();\n      hideNoDataSub.unsubscribe();\n      layoutChangeSub.unsubscribe();\n      quickFilterSub.unsubscribe();\n      refreshSub.unsubscribe();\n      groupBySub.unsubscribe();\n    };\n  }\n\n  subscribeOnceToDataChange(forceRender = false) {\n    const dataSub = this.state.$data.subscribeToState((newState) => {\n      if (newState.data?.state === LoadingState.Loading) {\n        return;\n      }\n\n      dataSub.unsubscribe();\n\n      this.renderGridItems(forceRender);\n\n      this.setState({ isLoading: false });\n    });\n  }\n\n  subscribeToGroupByChange() {\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n\n    return groupByVariable.subscribeToState((newState, prevState) => {\n      if (!newState.loading && prevState.loading) {\n        this.refetchData();\n      }\n    });\n  }\n\n  subscribeToRefreshClick() {\n    const onClickRefresh = () => {\n      this.refetchData();\n    };\n\n    // start of hack, for a better UX: we disable the variable \"refresh\" option and we allow the user to reload the list only by clicking on the \"Refresh\" button\n    // if we don't do this, every time the time range changes (even with auto-refresh on),\n    // all the timeseries present on the screen would be re-created, resulting in blinking and a poor UX\n    const refreshButton = document.querySelector(\n      '[data-testid=\"data-testid RefreshPicker run button\"]'\n    ) as HTMLButtonElement;\n\n    if (!refreshButton) {\n      logger.error(\n        new Error('SceneByVariableRepeaterGrid: Refresh button not found! The list of items will never be updated.')\n      );\n    }\n\n    refreshButton?.addEventListener('click', onClickRefresh);\n    refreshButton?.setAttribute('title', 'Click to completely refresh all the panels present on the screen');\n    // end of hack\n\n    return {\n      unsubscribe() {\n        refreshButton?.removeAttribute('title');\n        refreshButton?.removeEventListener('click', onClickRefresh);\n      },\n    };\n  }\n\n  subscribeToQuickFilterChange() {\n    const quickFilter = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.items.length !== prevState.items.length) {\n        quickFilter.setResultsCount(newState.items.length);\n      }\n    });\n\n    const onChangeState = (newState: SceneQuickFilterState, prevState?: SceneQuickFilterState) => {\n      if (newState.searchText !== prevState?.searchText) {\n        this.renderGridItems();\n      }\n    };\n\n    return quickFilter.subscribeToState(debounce(onChangeState, SceneQuickFilter.DEBOUNCE_DELAY));\n  }\n\n  subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher);\n    const body = this.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: SceneLayoutSwitcherState, prevState?: SceneLayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state);\n\n    return layoutSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToHideNoDataChange() {\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    this.setState({ hideNoData: noDataSwitcher.state.hideNoData === 'on' });\n\n    const onChangeState = (newState: SceneNoDataSwitcherState, prevState?: SceneNoDataSwitcherState) => {\n      if (newState.hideNoData !== prevState?.hideNoData) {\n        this.setState({ hideNoData: newState.hideNoData === 'on' });\n\n        this.refetchData(true);\n      }\n    };\n\n    return noDataSwitcher.subscribeToState(onChangeState);\n  }\n\n  subscribeToFiltersChange() {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const noDataSwitcher = sceneGraph.findByKeyAndType(this, 'no-data-switcher', SceneNoDataSwitcher);\n\n    // the handler will be called each time a filter is added/removed/modified\n    return filtersVariable.subscribeToState(() => {\n      if (noDataSwitcher.state.hideNoData === 'on') {\n        // to be sure the list is updated we refetch because the filters only influence the query made in each panel\n        this.refetchData();\n      }\n    });\n  }\n\n  refetchData(forceRender = false) {\n    this.setState({\n      isLoading: true,\n      $data: new SceneDataTransformer({\n        $data: buildLabelValuesGridQueryRunner({ label: this.state.label }),\n        transformations: [addRefId, addStats],\n      }),\n    });\n\n    this.subscribeOnceToDataChange(forceRender);\n  }\n\n  shouldRenderItems(newItems: SceneLabelValuesGridState['items']) {\n    const { items } = this.state;\n\n    if (!newItems.length || items.length !== newItems.length) {\n      return true;\n    }\n\n    return !isEqual(items, newItems);\n  }\n\n  buildItemsData(series: DataFrame[]) {\n    const serviceName = getSceneVariableValue(this, 'serviceName');\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n\n    const { label, startColorIndex, sortItemsFn } = this.state;\n\n    // the series are already sorted by the data transformation\n    const items = series.map((s, index) => {\n      const metricField = s.fields[1];\n      const labelValue = metricField.labels?.[label] || '';\n      const labelName = getSeriesLabelFieldName(metricField, label);\n\n      return {\n        index: startColorIndex + index,\n        value: labelValue,\n        label: labelName,\n        queryRunnerParams: {\n          serviceName,\n          profileMetricId,\n          // defaults to an \"is empty\" operator in the UI when the label value is not set\n          filters: [{ key: label, operator: '=', value: labelValue }],\n        },\n        panelType: PanelType.TIMESERIES,\n      };\n    });\n\n    return this.filterItems(items).sort(sortItemsFn);\n  }\n\n  renderGridItems(forceRender = false) {\n    if (!this.state.$data.state.data) {\n      return;\n    }\n\n    const { state: loadingState, series, errors } = this.state.$data.state.data;\n\n    if (loadingState === LoadingState.Loading) {\n      return;\n    }\n\n    if (loadingState === LoadingState.Error) {\n      // TODO: check if we need https://github.com/grafana/grafana/blob/d7f7cd1e61eac1e0103e0ca1e2122264aa831ffd/public/app/plugins/datasource/azuremonitor/utils/messageFromError.ts#L30\n      this.renderErrorState(errors?.[0] as Error);\n      return;\n    }\n\n    const newItems = this.buildItemsData(series);\n\n    if (!forceRender && !this.shouldRenderItems(newItems)) {\n      return;\n    }\n\n    this.setState({ items: newItems });\n\n    if (!this.state.items.length) {\n      this.renderEmptyState();\n      return;\n    }\n\n    const gridItems = newItems.map((item) => {\n      return new SceneCSSGridItem({\n        key: SceneLabelValuesGrid.buildGridItemKey(item),\n        body: this.buildVizPanel(item),\n      });\n    });\n\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: GRID_AUTO_ROWS, // required to have the correct grid items height\n      children: gridItems,\n    });\n  }\n\n  buildVizPanel(item: GridItemData) {\n    const vizPanel = new SceneLabelValuePanel({\n      item,\n      headerActions: this.state.headerActions.bind(null, item, this.state.items),\n    });\n\n    const sub = vizPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      if (!this.state.hideNoData || event.payload.series?.length) {\n        return;\n      }\n\n      const gridItem = sceneGraph.getAncestor(vizPanel, SceneCSSGridItem);\n      const { key: gridItemKey } = gridItem.state;\n      const grid = sceneGraph.getAncestor(gridItem, SceneCSSGridLayout);\n\n      const filteredChildren = grid.state.children.filter((c) => c.state.key !== gridItemKey);\n\n      if (!filteredChildren.length) {\n        this.renderEmptyState();\n      } else {\n        grid.setState({ children: filteredChildren });\n      }\n    });\n\n    vizPanel.addActivationHandler(() => {\n      return () => {\n        sub.unsubscribe();\n      };\n    });\n\n    return vizPanel;\n  }\n\n  filterItems(items: SceneLabelValuesGridState['items']) {\n    const quickFilterScene = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n    const { searchText } = quickFilterScene.state;\n\n    if (!searchText) {\n      return items;\n    }\n\n    const regexes = searchText\n      .split(',')\n      .map((t) => t.trim())\n      .filter(Boolean)\n      .map((r) => {\n        try {\n          return new RegExp(r);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean) as RegExp[];\n\n    return items.filter(({ label }) => regexes.some((r) => r.test(label)));\n  }\n\n  renderEmptyState() {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneEmptyState({\n            message: 'No results',\n          }),\n        }),\n      ],\n    });\n  }\n\n  renderErrorState(error: Error) {\n    (this.state.body as SceneCSSGridLayout).setState({\n      autoRows: '480px',\n      children: [\n        new SceneCSSGridItem({\n          body: new SceneErrorState({\n            message: error.message || error.toString(),\n          }),\n        }),\n      ],\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneLabelValuesGrid>) {\n    const { body, isLoading } = model.useState();\n\n    return isLoading ? (\n      <Spinner />\n    ) : (\n      <div style={{ marginBottom: '2px' }}>\n        <body.Component model={body} />\n      </div>\n    );\n  }\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventClearLabelFromFiltersPayload {\n  item: GridItemData;\n}\n\nexport class EventClearLabelFromFilters extends BusEventWithPayload<EventClearLabelFromFiltersPayload> {\n  public static type = 'clear-label-from-filters';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventExcludeLabelFromFiltersPayload {\n  item: GridItemData;\n}\n\nexport class EventExcludeLabelFromFilters extends BusEventWithPayload<EventExcludeLabelFromFiltersPayload> {\n  public static type = 'exclude-label-from-filters';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { GridItemData } from '../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\n\nexport interface EventIncludeLabelInFiltersPayload {\n  item: GridItemData;\n}\n\nexport class EventIncludeLabelInFilters extends BusEventWithPayload<EventIncludeLabelInFiltersPayload> {\n  public static type = 'include-label-in-filters';\n}\n\nexport interface EventExcludeLabelFromFiltersPayload {\n  item: GridItemData;\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React, { memo } from 'react';\n\ntype FilterButtonsProps = {\n  label: string;\n  status: 'included' | 'excluded' | 'clear';\n  onInclude: () => void;\n  onExclude: () => void;\n  onClear: () => void;\n};\n\nfunction getStatus({ status, label, onInclude, onExclude, onClear }: FilterButtonsProps) {\n  const isIncludeSelected = status === 'included';\n  const includeTooltip = !isIncludeSelected ? `Include \"${label}\" in the filters` : `Clear \"${label}\" from the filters`;\n\n  const isExcludeSelected = status === 'excluded';\n  const excludeTooltip = !isExcludeSelected ? `Exclude \"${label}\" in the filters` : `Clear \"${label}\" from the filters`;\n\n  return {\n    include: {\n      isSelected: isIncludeSelected,\n      tooltip: includeTooltip,\n      onClick: isIncludeSelected ? onClear : onInclude,\n    },\n    exclude: {\n      isSelected: isExcludeSelected,\n      tooltip: excludeTooltip,\n      onClick: isExcludeSelected ? onClear : onExclude,\n    },\n  };\n}\n\n// Kindly borrowed and adapted from https://github.com/grafana/explore-logs/blob/main/src/Components/FilterButton.tsx :)\nconst FilterButtonsComponent = (props: FilterButtonsProps) => {\n  const styles = useStyles2(getStyles);\n\n  const { include, exclude } = getStatus(props);\n\n  return (\n    <div className={styles.container}>\n      <Button\n        size=\"sm\"\n        fill=\"outline\"\n        variant={include.isSelected ? 'primary' : 'secondary'}\n        aria-selected={include.isSelected}\n        className={cx(styles.includeButton, include.isSelected && 'selected')}\n        onClick={include.onClick}\n        tooltip={include.tooltip}\n        tooltipPlacement=\"top\"\n        data-testid=\"filter-button-include\"\n      >\n        Include\n      </Button>\n      <Button\n        size=\"sm\"\n        fill=\"outline\"\n        variant={exclude.isSelected ? 'primary' : 'secondary'}\n        aria-selected={exclude.isSelected}\n        className={cx(styles.excludeButton, exclude.isSelected && 'selected')}\n        onClick={exclude.onClick}\n        tooltip={exclude.tooltip}\n        tooltipPlacement=\"top\"\n        data-testid=\"filter-button-exclude\"\n      >\n        Exclude\n      </Button>\n    </div>\n  );\n};\n\nexport const FilterButtons = memo(FilterButtonsComponent);\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css`\n      display: flex;\n      justify-content: center;\n    `,\n    includeButton: css`\n      border-radius: ${theme.shape.radius.default} 0 0 ${theme.shape.radius.default};\n\n      &:not(.selected) {\n        border-right: none;\n      }\n    `,\n    excludeButton: css`\n      border-radius: 0 ${theme.shape.radius.default} ${theme.shape.radius.default} 0;\n\n      &:not(.selected) {\n        border-left: none;\n      }\n    `,\n  };\n};\n","import { AdHocVariableFilter } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { isRegexOperator } from '@shared/components/QueryBuilder/domain/helpers/isRegexOperator';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React, { useMemo } from 'react';\n\nimport { FiltersVariable } from '../../../../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GridItemData } from '../../../../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { EventClearLabelFromFilters } from '../../events/EventClearLabelFromFilters';\nimport { EventExcludeLabelFromFilters } from '../../events/EventExcludeLabelFromFilters';\nimport { EventIncludeLabelInFilters } from '../../events/EventIncludeLabelInFilters';\nimport { FilterButtons } from './ui/FilterButtons';\n\nexport interface IncludeExcludeActionState extends SceneObjectState {\n  item: GridItemData;\n}\n\nexport class IncludeExcludeAction extends SceneObjectBase<IncludeExcludeActionState> {\n  constructor({ item }: IncludeExcludeActionState) {\n    super({ item });\n  }\n\n  getStatus(filters: AdHocVariableFilter[]) {\n    const { key, value } = this.state.item.queryRunnerParams.filters![0];\n\n    const found = filters.find((f) => f.key === key);\n    if (!found) {\n      return 'clear';\n    }\n\n    if (isRegexOperator(found.operator) && found.value.split('|').includes(value)) {\n      return found.operator === '=~' ? 'included' : 'excluded';\n    }\n\n    // found.operator is '=' or '!='\n    if (found.value === value) {\n      return found.operator === '=' ? 'included' : 'excluded';\n    }\n\n    return 'clear';\n  }\n\n  onInclude = () => {\n    reportInteraction('g_pyroscope_app_include_action_clicked');\n\n    this.publishEvent(new EventIncludeLabelInFilters({ item: this.state.item }), true);\n  };\n\n  onExclude = () => {\n    reportInteraction('g_pyroscope_app_exclude_action_clicked');\n\n    this.publishEvent(new EventExcludeLabelFromFilters({ item: this.state.item }), true);\n  };\n\n  onClear = () => {\n    this.publishEvent(new EventClearLabelFromFilters({ item: this.state.item }), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<IncludeExcludeAction>) => {\n    const { item } = model.useState();\n\n    const { filters } = (sceneGraph.findByKeyAndType(model, 'filters', FiltersVariable) as FiltersVariable).useState();\n    const status = useMemo(() => model.getStatus(filters), [filters, model]);\n\n    return (\n      <FilterButtons\n        label={item.value}\n        status={status}\n        onInclude={model.onInclude}\n        onExclude={model.onExclude}\n        onClear={model.onClear}\n      />\n    );\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport React, { useMemo } from 'react';\n\nimport { CompareTarget } from '../../../../SceneExploreDiffFlameGraph/domain/types';\nimport { SceneStatsPanel } from '../components/SceneLabelValuesGrid/components/SceneStatsPanel/SceneStatsPanel';\nimport { SceneGroupByLabelsState } from '../SceneGroupByLabels';\n\ntype CompareButtonProps = {\n  compare: SceneGroupByLabelsState['compare'];\n  onClickCompare: () => void;\n  onClickClear: () => void;\n};\n\nexport function CompareControls({ compare, onClickCompare, onClickClear }: CompareButtonProps) {\n  const styles = useStyles2(getStyles);\n  const compareIsDisabled = compare.size < 2;\n  const hasSelection = compare.size > 0;\n\n  const tooltip = useMemo(() => {\n    if (compare.size === 2) {\n      return `Compare \"${compare.get(CompareTarget.BASELINE)?.label}\" vs \"${\n        compare.get(CompareTarget.COMPARISON)?.label\n      }\"`;\n    }\n    if (compare.size === 0) {\n      return 'Select both a baseline and a comparison panel to compare their flame graphs';\n    }\n\n    return compare.has(CompareTarget.BASELINE)\n      ? `Select another panel to compare against \"${compare.get(CompareTarget.BASELINE)?.label}\"`\n      : `Select another panel to compare against \"${compare.get(CompareTarget.COMPARISON)?.label}\"`;\n  }, [compare]);\n\n  return (\n    <div className={styles.container}>\n      <Button\n        arial-label=\"Compare\"\n        className={styles.compareButton}\n        variant=\"primary\"\n        disabled={compareIsDisabled}\n        onClick={compareIsDisabled ? noOp : onClickCompare}\n        tooltip={tooltip}\n      >\n        Compare ({compare.size}/2)\n      </Button>\n\n      <Button\n        data-testid=\"clearComparison\"\n        className={cx(styles.clearButton, !compareIsDisabled ? styles.clearButtonActive : undefined)}\n        icon=\"times\"\n        variant=\"secondary\"\n        tooltip={hasSelection ? 'Clear comparison selection' : ''}\n        disabled={!hasSelection}\n        onClick={!hasSelection ? noOp : onClickClear}\n      />\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    align-items: center;\n    width: ${SceneStatsPanel.WIDTH_IN_PIXELS}px;\n  `,\n  compareButton: css`\n    width: ${SceneStatsPanel.WIDTH_IN_PIXELS - 32}px;\n    border-right: none;\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  `,\n  clearButton: css`\n    box-sizing: border-box;\n    width: 32px !important;\n    height: 32px !important;\n    color: ${theme.colors.text.secondary};\n    background-color: transparent;\n    border-left: none !important;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n\n    &:not([disabled]),\n    &:not([disabled]):hover {\n      background-color: transparent;\n      box-shadow: none;\n    }\n  `,\n  clearButtonActive: css`\n    border-color: ${theme.colors.border.medium};\n\n    &:hover {\n      border-color: ${theme.colors.border.medium};\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Stack, useStyles2 } from '@grafana/ui';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React, { useMemo } from 'react';\nimport { Unsubscribable } from 'rxjs';\nimport { EventViewDiffFlameGraph } from 'src/pages/ProfilesExplorerView/domain/events/EventViewDiffFlameGraph';\n\nimport { FavAction } from '../../../../domain/actions/FavAction';\nimport { SelectAction } from '../../../../domain/actions/SelectAction';\nimport { EventSelectLabel } from '../../../../domain/events/EventSelectLabel';\nimport {\n  clearLabelValue,\n  excludeLabelValue,\n  includeLabelValue,\n} from '../../../../domain/variables/FiltersVariable/filters-ops';\nimport { FiltersVariable } from '../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../../../../domain/variables/GroupByVariable/GroupByVariable';\nimport { getSceneVariableValue } from '../../../../helpers/getSceneVariableValue';\nimport { interpolateQueryRunnerVariables } from '../../../../infrastructure/helpers/interpolateQueryRunnerVariables';\nimport { SceneLayoutSwitcher } from '../../../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher } from '../../../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport {\n  PanelType,\n  ScenePanelTypeSwitcher,\n  ScenePanelTypeSwitcherState,\n} from '../../../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../../../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { SceneByVariableRepeaterGrid } from '../../../SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { GridItemData } from '../../../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { CompareTarget } from '../../../SceneExploreDiffFlameGraph/domain/types';\nimport { SceneProfilesExplorer } from '../../../SceneProfilesExplorer/SceneProfilesExplorer';\nimport { SceneStatsPanel } from './components/SceneLabelValuesGrid/components/SceneStatsPanel/SceneStatsPanel';\nimport { SceneLabelValuesGrid } from './components/SceneLabelValuesGrid/SceneLabelValuesGrid';\nimport { IncludeExcludeAction } from './domain/actions/IncludeExcludeAction/IncludeExcludeAction';\nimport { EventClearLabelFromFilters } from './domain/events/EventClearLabelFromFilters';\nimport { EventExcludeLabelFromFilters } from './domain/events/EventExcludeLabelFromFilters';\nimport { EventIncludeLabelInFilters } from './domain/events/EventIncludeLabelInFilters';\nimport { EventSelectForCompare } from './domain/events/EventSelectForCompare';\nimport { CompareControls } from './ui/CompareControls';\n\nexport interface SceneGroupByLabelsState extends SceneObjectState {\n  body?: SceneObject;\n  compare: Map<CompareTarget, GridItemData>;\n  panelTypeChangeSub?: Unsubscribable;\n}\n\nexport class SceneGroupByLabels extends SceneObjectBase<SceneGroupByLabelsState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'group-by-labels',\n      body: undefined,\n      compare: new Map(),\n      panelTypeChangeSub: undefined,\n    });\n\n    this.addActivationHandler(() => {\n      this.onActivate(item);\n    });\n  }\n\n  async onActivate(item?: GridItemData) {\n    // initial load\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n    await groupByVariable.update();\n\n    if (item) {\n      this.initVariablesAndControls(item);\n    }\n\n    this.renderBody(groupByVariable);\n\n    const groupBySub = this.subscribeToGroupByChange();\n    const panelEventsSub = this.subscribeToPanelEvents();\n\n    return () => {\n      panelEventsSub.unsubscribe();\n      groupBySub.unsubscribe();\n\n      this.state.panelTypeChangeSub?.unsubscribe();\n    };\n  }\n\n  initVariablesAndControls(item: GridItemData) {\n    const { queryRunnerParams, panelType } = item;\n    const { groupBy } = queryRunnerParams;\n\n    if (groupBy?.label) {\n      const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n      groupByVariable.changeValueTo(groupBy.label);\n    }\n\n    if (panelType) {\n      const panelTypeSwitcher = sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher);\n      panelTypeSwitcher.setState({ panelType });\n    }\n  }\n\n  subscribeToGroupByChange() {\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n    const quickFilter = sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter);\n\n    return groupByVariable.subscribeToState((newState, prevState) => {\n      if (newState.value !== prevState?.value) {\n        quickFilter.clearSearchText();\n\n        this.renderBody(groupByVariable);\n      }\n    });\n  }\n\n  subscribeToPanelEvents() {\n    const selectLabelSub = this.subscribeToEvent(EventSelectLabel, (event) => {\n      this.selectLabel(event.payload.item);\n    });\n\n    const selectForCompareSub = this.subscribeToEvent(EventSelectForCompare, (event) => {\n      const { compareTarget, item } = event.payload;\n      this.selectForCompare(compareTarget, item);\n    });\n\n    const includeFilterSub = this.subscribeToEvent(EventIncludeLabelInFilters, (event) => {\n      this.includeLabelValueInFilters(event.payload.item);\n    });\n\n    const excludeFilterSub = this.subscribeToEvent(EventExcludeLabelFromFilters, (event) => {\n      this.excludeLabelValueFromFilters(event.payload.item);\n    });\n\n    const clearFilterSub = this.subscribeToEvent(EventClearLabelFromFilters, (event) => {\n      this.clearLabelValueFromFilters(event.payload.item);\n    });\n\n    return {\n      unsubscribe() {\n        clearFilterSub.unsubscribe();\n        excludeFilterSub.unsubscribe();\n        includeFilterSub.unsubscribe();\n        selectForCompareSub.unsubscribe();\n        selectLabelSub.unsubscribe();\n      },\n    };\n  }\n\n  subscribeToPanelTypeChange() {\n    const panelTypeSwitcher = sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher);\n\n    return panelTypeSwitcher.subscribeToState(\n      (newState: ScenePanelTypeSwitcherState, prevState?: ScenePanelTypeSwitcherState) => {\n        if (newState.panelType !== prevState?.panelType) {\n          (this.state.body as SceneByVariableRepeaterGrid)?.renderGridItems();\n        }\n      }\n    );\n  }\n\n  renderBody(groupByVariable: GroupByVariable) {\n    this.state.panelTypeChangeSub?.unsubscribe();\n\n    if (groupByVariable.state.value === 'all') {\n      // we have to resubscribe every time because the subscription is removed every time the ScenePanelTypeSwitcher UI component is unmounted\n      this.setState({ panelTypeChangeSub: this.subscribeToPanelTypeChange() });\n\n      this.switchToLabelNamesGrid();\n    } else {\n      this.switchToLabelValuesGrid(groupByVariable);\n    }\n  }\n\n  switchToLabelNamesGrid() {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search labels (comma-separated regexes are supported)');\n\n    this.setState({\n      body: this.buildSceneLabelNamesGrid(),\n    });\n  }\n\n  buildSceneLabelNamesGrid() {\n    return new SceneByVariableRepeaterGrid({\n      key: 'service-labels-grid',\n      variableName: 'groupBy',\n      mapOptionToItem: (option, index, { serviceName, profileMetricId, panelType }) => {\n        if (option.value === 'all') {\n          return null;\n        }\n\n        // see LabelsDataSource.ts\n        const { value, groupBy } = JSON.parse(option.value as string);\n\n        return {\n          index: index - 1, // the 'all' option has been removed ;)\n          value,\n          // remove the count in parenthesis that exists in option.label\n          // it'll be set by SceneLabelValuesTimeseries or SceneLabelValuesBarGauge\n          label: value,\n          queryRunnerParams: {\n            serviceName,\n            profileMetricId,\n            groupBy,\n            filters: [],\n          },\n          panelType: panelType as PanelType,\n        };\n      },\n      headerActions: (item) => [\n        new SelectAction({ type: 'select-label', item }),\n        new SelectAction({ type: 'expand-panel', item }),\n        new FavAction({ item }),\n      ],\n    });\n  }\n\n  switchToLabelValuesGrid(groupByVariable: GroupByVariable) {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search label values (comma-separated regexes are supported)');\n\n    this.clearCompare();\n\n    const { index, value } = groupByVariable.findCurrentOption();\n\n    this.setState({\n      body: this.buildSceneLabelValuesGrid(value, index),\n    });\n  }\n\n  buildSceneLabelValuesGrid(label: string, startColorIndex: number) {\n    return new SceneLabelValuesGrid({\n      key: 'service-label-values-grid',\n      startColorIndex,\n      label,\n      headerActions: (item) => [\n        new SelectAction({\n          type: 'view-flame-graph',\n          item,\n          tooltip: (item, model) => {\n            const { queryRunnerParams, label } = item;\n            const profileMetricId =\n              queryRunnerParams.profileMetricId || getSceneVariableValue(model, 'profileMetricId');\n            const groupByValue = getSceneVariableValue(model, 'groupBy');\n\n            return `View the \"${\n              getProfileMetric(profileMetricId as ProfileMetricId).type\n            }\" flame graph for \"${groupByValue}=${label}\"`;\n          },\n        }),\n        new IncludeExcludeAction({ item }),\n        new FavAction({ item }),\n      ],\n    });\n  }\n\n  selectLabel({ queryRunnerParams }: GridItemData) {\n    const labelValue = queryRunnerParams!.groupBy!.label;\n    const groupByVariable = sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable);\n\n    prepareHistoryEntry();\n    groupByVariable.changeValueTo(labelValue);\n  }\n\n  includeLabelValueInFilters(item: GridItemData) {\n    const [filterToInclude] = item.queryRunnerParams.filters!;\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n\n    filtersVariable.setState({ filters: includeLabelValue(filtersVariable.state.filters, filterToInclude) });\n  }\n\n  excludeLabelValueFromFilters(item: GridItemData) {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const [filterToExclude] = item.queryRunnerParams.filters!;\n\n    filtersVariable.setState({ filters: excludeLabelValue(filtersVariable.state.filters, filterToExclude) });\n  }\n\n  clearLabelValueFromFilters(item: GridItemData) {\n    const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n    const [filterToClear] = item.queryRunnerParams.filters!;\n\n    filtersVariable.setState({ filters: clearLabelValue(filtersVariable.state.filters, filterToClear) });\n  }\n\n  selectForCompare(compareTarget: CompareTarget, item: GridItemData) {\n    const compare = new Map(this.state.compare);\n\n    if (compare.get(compareTarget)?.value === item.value) {\n      compare.delete(compareTarget);\n    } else {\n      compare.set(compareTarget, item);\n    }\n\n    this.setState({ compare });\n\n    this.updateStatsPanels();\n  }\n\n  updateStatsPanels() {\n    const { compare } = this.state;\n    const baselineItem = compare.get(CompareTarget.BASELINE);\n    const comparisonItem = compare.get(CompareTarget.COMPARISON);\n\n    const statsPanels = sceneGraph.findAllObjects(this, (o) => o instanceof SceneStatsPanel) as SceneStatsPanel[];\n\n    // TODO: optimize if needed\n    // we can remove the loop if we clear the current selection in the UI before updating the compare map (see selectForCompare() and onClickClearCompareButton())\n    for (const panel of statsPanels) {\n      panel.updateCompareActions(baselineItem, comparisonItem);\n    }\n  }\n\n  getCompare() {\n    return this.state.compare;\n  }\n\n  clearCompare() {\n    this.setState({ compare: new Map() });\n  }\n\n  onClickCompareButton = () => {\n    reportInteraction('g_pyroscope_app_compare_link_clicked');\n\n    const { compare } = this.state;\n\n    const { filters: baselineFilters } = interpolateQueryRunnerVariables(\n      this,\n      compare.get(CompareTarget.BASELINE) as GridItemData\n    );\n\n    const { filters: comparisonFilters } = interpolateQueryRunnerVariables(\n      this,\n      compare.get(CompareTarget.COMPARISON) as GridItemData\n    );\n\n    this.publishEvent(\n      new EventViewDiffFlameGraph({\n        useAncestorTimeRange: true,\n        clearDiffRange: true,\n        baselineFilters,\n        comparisonFilters,\n      }),\n      true\n    );\n  };\n\n  onClickClearCompareButton = () => {\n    this.clearCompare();\n    this.updateStatsPanels();\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneGroupByLabels>) => {\n    const styles = useStyles2(getStyles);\n\n    const { body, compare } = model.useState();\n\n    const groupByVariable = sceneGraph.findByKeyAndType(model, 'groupBy', GroupByVariable);\n    const { value: groupByVariableValue } = groupByVariable.useState();\n\n    const gridControls = useMemo(\n      () =>\n        groupByVariableValue === 'all'\n          ? sceneGraph.findByKeyAndType(model, 'profiles-explorer', SceneProfilesExplorer).state.gridControls\n          : ([\n              sceneGraph.findByKeyAndType(model, 'quick-filter', SceneQuickFilter),\n              sceneGraph.findByKeyAndType(model, 'layout-switcher', SceneLayoutSwitcher),\n              sceneGraph.findByKeyAndType(model, 'no-data-switcher', SceneNoDataSwitcher),\n            ] as SceneObject[]),\n      [groupByVariableValue, model]\n    );\n\n    return (\n      <div className={styles.container} data-testid=\"groupByLabelsContainer\">\n        <groupByVariable.Component model={groupByVariable} />\n\n        <div className={styles.sceneControls}>\n          <Stack wrap=\"wrap\">\n            {groupByVariableValue !== 'all' && (\n              <CompareControls\n                compare={compare}\n                onClickCompare={model.onClickCompareButton}\n                onClickClear={model.onClickClearCompareButton}\n              />\n            )}\n\n            {gridControls.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n          </Stack>\n        </div>\n\n        {body && <body.Component model={body} />}\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    margin-top: ${theme.spacing(1)};\n  `,\n  sceneControls: css`\n    margin-bottom: ${theme.spacing(1)};\n\n    & .quick-filter {\n      flex: 1;\n      min-width: 112px;\n    }\n  `,\n});\n","import { DashboardCursorSync } from '@grafana/data';\nimport {\n  behaviors,\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n} from '@grafana/scenes';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport React from 'react';\n\nimport { SceneMainServiceTimeseries } from '../../components/SceneMainServiceTimeseries';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { EventExpandPanel } from '../../domain/events/EventExpandPanel';\nimport { EventSelectLabel } from '../../domain/events/EventSelectLabel';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { vizPanelBuilder } from '../../helpers/vizPanelBuilder';\nimport { getProfileMetricLabel } from '../../infrastructure/series/helpers/getProfileMetricLabel';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneDrawer } from '../SceneDrawer';\nimport { SceneGroupByLabels } from './components/SceneGroupByLabels/SceneGroupByLabels';\n\ninterface SceneExploreServiceLabelsState extends SceneObjectState {\n  body: SceneFlexLayout;\n  drawer: SceneDrawer;\n}\n\nexport class SceneExploreServiceLabels extends SceneObjectBase<SceneExploreServiceLabelsState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'explore-service-labels',\n      body: new SceneFlexLayout({\n        direction: 'column',\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: [\n          new SceneFlexItem({\n            minHeight: SceneMainServiceTimeseries.MIN_HEIGHT,\n            body: new SceneMainServiceTimeseries({\n              item,\n              headerActions: (item) => {\n                return item.queryRunnerParams.groupBy\n                  ? [\n                      new SelectAction({ type: 'view-flame-graph', item }),\n                      new SelectAction({\n                        type: 'expand-panel',\n                        item,\n                      }),\n                      new FavAction({ item }),\n                    ]\n                  : [new SelectAction({ type: 'view-flame-graph', item }), new FavAction({ item })];\n              },\n              supportGroupBy: true,\n            }),\n          }),\n          new SceneFlexItem({\n            body: new SceneGroupByLabels({ item }),\n          }),\n        ],\n      }),\n      drawer: new SceneDrawer(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item?: GridItemData) {\n    if (item) {\n      this.initVariables(item);\n    }\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n\n    profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT });\n    profileMetricVariable.update(true);\n\n    const panelEventsSub = this.subscribeToPanelEvents();\n\n    return () => {\n      panelEventsSub.unsubscribe();\n      profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_DEFAULT });\n      profileMetricVariable.update(true);\n    };\n  }\n\n  initVariables(item: GridItemData) {\n    const { queryRunnerParams } = item;\n    const { serviceName, profileMetricId, filters } = queryRunnerParams;\n\n    if (serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(serviceName);\n    }\n\n    if (profileMetricId) {\n      const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n      profileMetricVariable.changeValueTo(profileMetricId);\n    }\n\n    if (filters) {\n      const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n      filtersVariable.setState({ filters });\n    }\n  }\n\n  subscribeToPanelEvents() {\n    const expandPanelSub = this.subscribeToEvent(EventExpandPanel, async (event) => {\n      this.openExpandedPanelDrawer(event.payload.item);\n    });\n\n    const selectLabelSub = this.subscribeToEvent(EventSelectLabel, () => {\n      // the event may be published from an expanded panel in the drawer\n      this.state.drawer.close();\n    });\n\n    return {\n      unsubscribe() {\n        selectLabelSub.unsubscribe();\n        expandPanelSub.unsubscribe();\n      },\n    };\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [\n        sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable),\n        sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable),\n        sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable),\n      ],\n      gridControls: [],\n    };\n  }\n\n  openExpandedPanelDrawer(item: GridItemData) {\n    const title = getSceneVariableValue(this, 'serviceName');\n\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const profileMetricDescription =\n      getProfileMetric(profileMetricId as ProfileMetricId).description || getProfileMetricLabel(profileMetricId);\n    const timeseriesTitle = `${profileMetricDescription}, grouped by ${item.queryRunnerParams.groupBy?.label || '?'}`;\n\n    this.state.drawer.open({\n      title,\n      body: vizPanelBuilder(item.panelType, {\n        displayAllValues: true,\n        legendPlacement: 'right',\n        item: { ...item, label: timeseriesTitle },\n        headerActions: () => [new SelectAction({ type: 'select-label', item }), new FavAction({ item })],\n      }),\n    });\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreServiceLabels>) {\n    const { body, drawer } = model.useState();\n\n    return (\n      <>\n        <body.Component model={body} />\n        <drawer.Component model={drawer} />\n      </>\n    );\n  }\n}\n","import {\n  EmbeddedSceneState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { SceneByVariableRepeaterGrid } from '../../components/SceneByVariableRepeaterGrid/SceneByVariableRepeaterGrid';\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { PanelType } from '../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\n\ninterface SceneExploreServiceProfileTypesState extends EmbeddedSceneState {}\n\nexport class SceneExploreServiceProfileTypes extends SceneObjectBase<SceneExploreServiceProfileTypesState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'explore-service-profile-types',\n      $variables: new SceneVariableSet({\n        variables: [\n          // we use a custom instance of ProfileMetricVariable to display only the profile metrics associated to the selected service\n          new ProfileMetricVariable({\n            query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT,\n            skipUrlSync: true,\n          }),\n        ],\n      }),\n      body: new SceneByVariableRepeaterGrid({\n        key: 'profile-metrics-grid',\n        variableName: 'profileMetricId',\n        mapOptionToItem: (option, index, { serviceName }) => ({\n          index,\n          value: option.value as string,\n          label: option.label,\n          queryRunnerParams: {\n            serviceName,\n            profileMetricId: option.value as string,\n          },\n          panelType: PanelType.TIMESERIES,\n        }),\n        headerActions: (item) => [\n          new SelectAction({ type: 'view-labels', item }),\n          new SelectAction({ type: 'view-flame-graph', item }),\n          new FavAction({ item }),\n        ],\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item?: GridItemData) {\n    sceneGraph\n      .findByKeyAndType(this, 'quick-filter', SceneQuickFilter)\n      .setPlaceholder('Search profile types (comma-separated regexes are supported)');\n\n    if (item) {\n      this.initVariables(item);\n    }\n  }\n\n  initVariables(item: GridItemData) {\n    if (item.queryRunnerParams.serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(item.queryRunnerParams.serviceName);\n    }\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable)],\n      gridControls: [\n        sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter),\n        sceneGraph.findByKeyAndType(this, 'layout-switcher', SceneLayoutSwitcher),\n      ],\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreServiceProfileTypes>) {\n    const { body } = model.useState();\n\n    return <body.Component model={body} />;\n  }\n}\n","import { dateTimeParse } from '@grafana/data';\nimport { SceneTimeRangeState } from '@grafana/scenes';\n\nexport function buildTimeRange(from: string, to: string): SceneTimeRangeState {\n  return {\n    from,\n    to,\n    value: {\n      from: dateTimeParse(from),\n      to: dateTimeParse(to),\n      raw: { from, to },\n    },\n  };\n}\n\nexport const getDefaultTimeRange = () => buildTimeRange('now-30m', 'now');\n","import { CustomVariable } from '@grafana/scenes';\n\nexport class SpanSelectorVariable extends CustomVariable {\n  constructor() {\n    super({\n      key: 'spanSelector',\n      name: 'spanSelector',\n      label: 'Span selector',\n      value: undefined,\n    });\n  }\n\n  reset() {\n    this.setState({ value: undefined });\n  }\n}\n","import { MetricFindValue } from '@grafana/data';\nimport { localeCompare } from '@shared/domain/localeCompare';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\n\nimport { PyroscopeSeries } from './http/SeriesApiClient';\n\nexport function formatSeriesToProfileMetrics(\n  pyroscopeSeries: PyroscopeSeries,\n  serviceName?: string\n): MetricFindValue[] {\n  if (serviceName) {\n    const profileMetricsMap = pyroscopeSeries.services.get(serviceName) || new Map();\n\n    return Array.from(profileMetricsMap.values())\n      .sort((a, b) => localeCompare(b.group, a.group))\n      .map(({ id, type, group }) => ({\n        value: id,\n        text: `${type} (${group})`,\n      }));\n  }\n\n  return Array.from(pyroscopeSeries.profileMetrics.keys())\n    .map((id) => getProfileMetric(id as ProfileMetricId))\n    .sort((a, b) => localeCompare(b.group, a.group))\n    .map(({ id, type, group }) => ({\n      value: id,\n      text: `${type} (${group})`,\n    }));\n}\n","import { MetricFindValue } from '@grafana/data';\nimport { localeCompare } from '@shared/domain/localeCompare';\n\nimport { PyroscopeSeries } from './http/SeriesApiClient';\n\nexport function formatSeriesToServices(pyroscopeSeries: PyroscopeSeries, profileMetricId?: string): MetricFindValue[] {\n  if (profileMetricId) {\n    const servicesSet = pyroscopeSeries.profileMetrics.get(profileMetricId) || new Set();\n\n    return Array.from(servicesSet)\n      .sort(localeCompare)\n      .map((serviceName) => ({\n        text: serviceName,\n        value: serviceName,\n      }));\n  }\n\n  return Array.from(pyroscopeSeries.services.keys())\n    .sort(localeCompare)\n    .map((serviceName) => ({\n      text: serviceName,\n      value: serviceName,\n    }));\n}\n","import { DataSourceProxyClient } from './DataSourceProxyClient';\n\nexport class DataSourceProxyClientBuilder {\n  private static cache = new Map<string, DataSourceProxyClient>();\n\n  static build<ApiClentType>(\n    dataSourceUid: string,\n    ApiClientClass: { new (options: { dataSourceUid: string }): ApiClentType }\n  ) {\n    const cacheKey = `${dataSourceUid}-${ApiClientClass.name}`;\n\n    const cachedInstance = DataSourceProxyClientBuilder.cache.get(cacheKey);\n    if (cachedInstance instanceof ApiClientClass) {\n      return cachedInstance;\n    }\n\n    const clientInstance = new ApiClientClass({ dataSourceUid });\n\n    DataSourceProxyClientBuilder.cache.set(cacheKey, clientInstance as DataSourceProxyClient);\n\n    return clientInstance;\n  }\n}\n","import { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { PyroscopeSeries } from './SeriesApiClient';\n\ntype Labels = Array<{ name: string; value: string }>;\n\nfunction findServiceNameAndProfileMetricId(labels: Labels) {\n  let serviceName;\n  let profileMetricId;\n\n  for (const { name, value } of labels) {\n    if (name === 'service_name') {\n      serviceName = value;\n    }\n\n    if (name === '__profile_type__') {\n      profileMetricId = value;\n    }\n\n    if (serviceName && profileMetricId) {\n      return [serviceName, profileMetricId];\n    }\n  }\n\n  return [];\n}\n\nexport function formatSeriesResponse(data: { labelsSet: Array<{ labels: Labels }> }): PyroscopeSeries {\n  const services: PyroscopeSeries['services'] = new Map();\n  const profileMetrics: PyroscopeSeries['profileMetrics'] = new Map();\n\n  if (!data.labelsSet) {\n    logger.warn('Pyroscope SeriesApiClient: no data received!');\n    return { services, profileMetrics };\n  }\n\n  for (const { labels } of data.labelsSet) {\n    const [serviceName, profileMetricId] = findServiceNameAndProfileMetricId(labels);\n\n    if (!serviceName || !profileMetricId) {\n      logger.warn(\n        'Pyroscope ServicesApiClient: \"service_name\" and/or \"__profile_type__\" are missing in the labels received!',\n        labels\n      );\n      continue;\n    }\n\n    const serviceProfileMetrics = services.get(serviceName) || new Map();\n    serviceProfileMetrics.set(profileMetricId, getProfileMetric(profileMetricId as ProfileMetricId));\n    services.set(serviceName, serviceProfileMetrics);\n\n    const profileMetricServices = profileMetrics.get(profileMetricId) || new Set();\n    profileMetricServices.add(serviceName);\n    profileMetrics.set(profileMetricId, profileMetricServices);\n  }\n\n  return { services, profileMetrics };\n}\n","import { ProfileMetric } from '@shared/infrastructure/profile-metrics/getProfileMetric';\n\nimport { DataSourceProxyClient } from './DataSourceProxyClient';\nimport { formatSeriesResponse } from './formatSeriesResponse';\n\ntype ProfileMetricsMap = Map<ProfileMetric['id'], ProfileMetric>;\ntype ServiceToProfileMetricsMap = Map<string, ProfileMetricsMap>;\n\ntype ServicesSet = Set<string>;\ntype ProfileMetricToServicesSet = Map<string, ServicesSet>;\n\nexport type PyroscopeSeries = { services: ServiceToProfileMetricsMap; profileMetrics: ProfileMetricToServicesSet };\n\nexport class SeriesApiClient extends DataSourceProxyClient {\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async list(options: { from: number; to: number }): Promise<PyroscopeSeries> {\n    const { from, to } = options;\n\n    return this.fetch('/querier.v1.QuerierService/Series', {\n      method: 'POST',\n      body: JSON.stringify({\n        start: from,\n        end: to,\n        labelNames: ['service_name', '__profile_type__'],\n        matchers: [],\n      }),\n    })\n      .then((response) => response.json())\n      .then(formatSeriesResponse);\n  }\n}\n","import { TimeRange } from '@grafana/data';\nimport { AbstractRepository } from '@shared/infrastructure/AbstractRepository';\nimport { MemoryCacheClient } from '@shared/infrastructure/MemoryCacheClient';\n\nimport { computeRoundedTimeRange } from '../../../helpers/computeRoundedTimeRange';\nimport { PyroscopeSeries, SeriesApiClient } from './SeriesApiClient';\n\nclass SeriesRepository extends AbstractRepository<SeriesApiClient, MemoryCacheClient> {\n  constructor(options: { cacheClient: MemoryCacheClient }) {\n    super(options);\n  }\n\n  async list(options: { timeRange: TimeRange }): Promise<PyroscopeSeries> {\n    const { from, to } = computeRoundedTimeRange(options.timeRange);\n\n    const cacheParams = [this.apiClient!.baseUrl, from, to];\n\n    const responseFromCacheP = this.cacheClient!.get(cacheParams);\n    if (responseFromCacheP) {\n      const { services, profileMetrics } = await responseFromCacheP;\n\n      if (!services.size && !profileMetrics.size) {\n        this.cacheClient!.delete(cacheParams);\n      }\n\n      return { services, profileMetrics };\n    }\n\n    const fetchP = this.apiClient!.list({ from, to });\n    this.cacheClient!.set(cacheParams, fetchP);\n\n    try {\n      const { services, profileMetrics } = await fetchP;\n      return { services, profileMetrics };\n    } catch (error) {\n      this.cacheClient!.delete(cacheParams);\n      throw error;\n    }\n  }\n}\n\nexport const seriesRepository = new SeriesRepository({\n  cacheClient: new MemoryCacheClient(),\n});\n","import {\n  DataQueryResponse,\n  FieldType,\n  LegacyMetricFindQueryOptions,\n  LoadingState,\n  MetricFindValue,\n  TestDataSourceResponse,\n  TimeRange,\n} from '@grafana/data';\nimport { RuntimeDataSource, sceneGraph } from '@grafana/scenes';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { PYROSCOPE_SERIES_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { formatSeriesToProfileMetrics } from './formatSeriesToProfileMetrics';\nimport { formatSeriesToServices } from './formatSeriesToServices';\nimport { DataSourceProxyClientBuilder } from './http/DataSourceProxyClientBuilder';\nimport { SeriesApiClient } from './http/SeriesApiClient';\nimport { seriesRepository } from './http/seriesRepository';\n\nexport class SeriesDataSource extends RuntimeDataSource {\n  constructor() {\n    super(PYROSCOPE_SERIES_DATA_SOURCE.type, PYROSCOPE_SERIES_DATA_SOURCE.uid);\n  }\n\n  async fetchSeries(dataSourceUid: string, timeRange: TimeRange, variableName?: string) {\n    seriesRepository.setApiClient(DataSourceProxyClientBuilder.build(dataSourceUid, SeriesApiClient));\n\n    try {\n      return await seriesRepository.list({ timeRange });\n    } catch (error) {\n      logger.error(error as Error, {\n        info: 'Error while loading Pyroscope series!',\n        variableName: variableName || '',\n      });\n\n      throw error;\n    }\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'PyroscopeSeries',\n          fields: [\n            {\n              name: 'PyroscopeSeries',\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(query: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.value;\n\n    const dataSourceUid = sceneGraph.interpolate(sceneObject, '$dataSource');\n    const serviceName = sceneGraph.interpolate(sceneObject, '$serviceName');\n    const profileMetricId = sceneGraph.interpolate(sceneObject, '$profileMetricId');\n\n    const pyroscopeSeries = await this.fetchSeries(dataSourceUid, options.range as TimeRange, options.variable?.name);\n\n    switch (query) {\n      // queries that depend only on the selected data source\n      case '$dataSource and all services':\n        return formatSeriesToServices(pyroscopeSeries);\n\n      case '$dataSource and all profile metrics':\n        return formatSeriesToProfileMetrics(pyroscopeSeries);\n\n      // queries that depend on the selected profile metric or the selected service\n      case '$dataSource and only $profileMetricId services':\n        return formatSeriesToServices(pyroscopeSeries, profileMetricId);\n\n      case '$dataSource and only $serviceName profile metrics':\n        return formatSeriesToProfileMetrics(pyroscopeSeries, serviceName);\n\n      default:\n        throw new TypeError(`Unsupported query \"${query}\"!`);\n    }\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { BusEventWithPayload, TimeRange } from '@grafana/data';\nimport { SceneTimeRangeState } from '@grafana/scenes';\n\nimport { CompareTarget } from '../../../../domain/types';\n\ninterface EventEnableSyncTimeRangesPayload {\n  source: CompareTarget;\n  enable: boolean;\n  timeRange: SceneTimeRangeState;\n  annotationTimeRange: TimeRange;\n}\n\nexport class EventEnableSyncTimeRanges extends BusEventWithPayload<EventEnableSyncTimeRangesPayload> {\n  public static type = 'enable-sync-timeranges';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { CompareTarget } from '../../../../domain/types';\n\ninterface EventSyncRefreshPayload {\n  source: CompareTarget;\n}\n\nexport class EventSyncRefresh extends BusEventWithPayload<EventSyncRefreshPayload> {\n  public static type = 'sync-refresh';\n}\n","import { BusEventWithPayload, TimeRange } from '@grafana/data';\nimport { SceneTimeRangeState } from '@grafana/scenes';\n\nimport { CompareTarget } from '../../../../domain/types';\n\ninterface EventSyncTimeRangesPayload {\n  source: CompareTarget;\n  timeRange?: SceneTimeRangeState;\n  annotationTimeRange?: TimeRange;\n}\n\nexport class EventSyncTimeRanges extends BusEventWithPayload<EventSyncTimeRangesPayload> {\n  public static type = 'sync-timeranges';\n}\n","import { SceneComponentProps, sceneGraph, SceneTimePicker } from '@grafana/scenes';\nimport { TimeRangePicker } from '@grafana/ui';\nimport React from 'react';\n\nexport class SceneTimePickerWithoutSync extends SceneTimePicker {\n  public static Component = function SceneTimePickerRenderer({\n    model,\n  }: SceneComponentProps<SceneTimePickerWithoutSync>) {\n    const { hidePicker, isOnCanvas } = model.useState();\n    const timeRange = sceneGraph.getTimeRange(model);\n    const timeZone = timeRange.getTimeZone();\n    const timeRangeState = timeRange.useState();\n\n    if (hidePicker) {\n      return null;\n    }\n\n    return (\n      <TimeRangePicker\n        isOnCanvas={isOnCanvas ?? true}\n        value={timeRangeState.value}\n        onChange={timeRange.onTimeRangeChange}\n        timeZone={timeZone}\n        fiscalYearStartMonth={timeRangeState.fiscalYearStartMonth}\n        onMoveBackward={model.onMoveBackward}\n        onMoveForward={model.onMoveForward}\n        onZoom={model.onZoom}\n        onChangeTimeZone={timeRange.onTimeZoneChange}\n        onChangeFiscalYearStartMonth={model.onChangeFiscalYearStartMonth}\n        // disable the sync\n        isSynced={false}\n      />\n    );\n  };\n}\n","import { toUtc } from '@grafana/data';\nimport { SceneObjectUrlValue } from '@grafana/scenes';\n\nconst INTERVAL_STRING_REGEX = /^\\d+[yYmMsSwWhHdD]$/;\n\n/* Copied from https://github.com/grafana/scenes/blob/main/packages/scenes/src/utils/parseUrlParam.ts */\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function parseUrlParam(value: SceneObjectUrlValue): string | null {\n  if (typeof value !== 'string') {\n    return null;\n  }\n\n  if (value.indexOf('now') !== -1) {\n    return value;\n  }\n\n  if (INTERVAL_STRING_REGEX.test(value)) {\n    return value;\n  }\n\n  if (value.length === 8) {\n    const utcValue = toUtc(value, 'YYYYMMDD');\n    if (utcValue.isValid()) {\n      return utcValue.toISOString();\n    }\n  } else if (value.length === 15) {\n    const utcValue = toUtc(value, 'YYYYMMDDTHHmmss');\n    if (utcValue.isValid()) {\n      return utcValue.toISOString();\n    }\n  } else if (value.length === 24) {\n    const utcValue = toUtc(value);\n    return utcValue.toISOString();\n  }\n\n  const epoch = parseInt(value, 10);\n  if (!isNaN(epoch)) {\n    return toUtc(epoch).toISOString();\n  }\n\n  return null;\n}\n","import { FieldType, MutableDataFrame } from '@grafana/data';\n\nexport class RangeAnnotation extends MutableDataFrame {\n  constructor() {\n    super();\n    [\n      {\n        name: 'time',\n        type: FieldType.time,\n      },\n      {\n        name: 'timeEnd',\n        type: FieldType.time,\n      },\n      {\n        name: 'isRegion',\n        type: FieldType.boolean,\n      },\n      {\n        name: 'color',\n        type: FieldType.other,\n      },\n      {\n        name: 'text',\n        type: FieldType.string,\n      },\n    ].forEach((field) => this.addField(field));\n  }\n\n  addRange(entry: { time: number; timeEnd: number; color?: string; text: string }) {\n    this.add({ ...entry, isRegion: true });\n  }\n}\n","import { DateTime, dateTime, LoadingState, TimeRange } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneTimeRangeLike,\n  SceneTimeRangeState,\n  VariableDependencyConfig,\n  VizPanel,\n} from '@grafana/scenes';\nimport { omit } from 'lodash';\n\nimport { evaluateTimeRange } from '../domain/evaluateTimeRange';\nimport { parseUrlParam } from '../domain/parseUrlParam';\nimport { RangeAnnotation } from '../domain/RangeAnnotation';\n\nexport enum TimeRangeWithAnnotationsMode {\n  ANNOTATIONS = 'annotations',\n  DEFAULT = 'default',\n}\n\ninterface SceneTimeRangeWithAnnotationsState extends SceneTimeRangeState {\n  annotationTimeRange: TimeRange;\n  mode: TimeRangeWithAnnotationsMode;\n  annotationColor: string;\n  annotationTitle: string;\n}\n\nconst TIMERANGE_NIL = {\n  from: dateTime(0),\n  to: dateTime(0),\n  raw: { from: '', to: '' },\n};\n\n/**\n * This custom SceneTimeRange class provides the ability to draw annotations on timeseries vizualisations.\n * Indeed, timeseries visualizations don't support drawing annotations by dragging (it's only supported when holding ctrl/command key) so we need to hijack the zooming event to emulate drawing.\n * At the same time, the only way to hijack it is by passing custom $timeRange because TimeSeries vizualization handles zooming internally by looking for the nearest time range object.\n * @see https://github.com/grafana/scenes/pull/744\n */\nexport class SceneTimeRangeWithAnnotations\n  extends SceneObjectBase<SceneTimeRangeWithAnnotationsState>\n  implements SceneTimeRangeLike\n{\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['dataSource', 'serviceName'],\n    onReferencedVariableValueChanged: () => {\n      this.nullifyAnnotationTimeRange();\n      this.updateTimeseriesAnnotation();\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['diffFrom', 'diffTo'] });\n\n  constructor(options: {\n    key: string;\n    mode: TimeRangeWithAnnotationsMode;\n    annotationColor: string;\n    annotationTitle: string;\n  }) {\n    super({\n      from: TIMERANGE_NIL.raw.from,\n      to: TIMERANGE_NIL.raw.to,\n      value: TIMERANGE_NIL,\n      annotationTimeRange: TIMERANGE_NIL,\n      ...options,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState(omit(this.getAncestorTimeRange().state, 'key'));\n\n    this._subs.add(\n      this.getAncestorTimeRange().subscribeToState((newState) => {\n        this.setState(omit(newState, 'key'));\n      })\n    );\n\n    this._subs.add(\n      this.getTimeseries().state.$data?.subscribeToState((newState, prevState) => {\n        if (!newState.data || newState.data.state !== LoadingState.Done) {\n          return;\n        }\n\n        // add annotation for the first time\n        if (!newState.data.annotations?.length && !prevState.data?.annotations?.length) {\n          this.updateTimeseriesAnnotation();\n          return;\n        }\n\n        // ensure we retain the previous annotations, if they exist\n        if (!newState.data.annotations?.length && prevState.data?.annotations?.length) {\n          newState.data.annotations = prevState.data.annotations;\n        }\n      })\n    );\n  }\n\n  protected getAncestorTimeRange(): SceneTimeRangeLike {\n    if (!this.parent || !this.parent.parent) {\n      throw new Error(typeof this + ' must be used within $timeRange scope');\n    }\n\n    return sceneGraph.getTimeRange(this.parent.parent);\n  }\n\n  protected getTimeseries(): VizPanel {\n    try {\n      const vizPanel = sceneGraph.getAncestor(this, VizPanel);\n\n      if (vizPanel.state.pluginId !== 'timeseries') {\n        throw new TypeError('Incorrect VizPanel type!');\n      }\n\n      return vizPanel;\n    } catch (error) {\n      throw new Error('Ancestor timeseries panel not found!');\n    }\n  }\n\n  updateTimeseriesAnnotation() {\n    const { annotationTimeRange, annotationColor, annotationTitle } = this.state;\n\n    const { $data } = this.getTimeseries().state;\n\n    const data = $data?.state.data;\n    if (!data) {\n      return;\n    }\n\n    const annotation = new RangeAnnotation();\n\n    annotation.addRange({\n      color: annotationColor,\n      text: annotationTitle,\n      time: annotationTimeRange.from.unix() * 1000,\n      timeEnd: annotationTimeRange.to.unix() * 1000,\n    });\n\n    // tradeoff: this will notify all the $data subscribers even though the data itself hasn't changed\n    $data?.setState({\n      data: {\n        ...data,\n        annotations: [annotation],\n      },\n    });\n  }\n\n  setAnnotationTimeRange(annotationTimeRange: TimeRange, updateTimeseries = false) {\n    this.setState({ annotationTimeRange });\n\n    if (updateTimeseries) {\n      this.updateTimeseriesAnnotation();\n    }\n  }\n\n  nullifyAnnotationTimeRange() {\n    this.setAnnotationTimeRange(TIMERANGE_NIL);\n  }\n\n  getUrlState() {\n    const { annotationTimeRange } = this.state;\n\n    return {\n      diffFrom:\n        typeof annotationTimeRange.raw.from === 'string'\n          ? annotationTimeRange.raw.from\n          : annotationTimeRange.raw.from.toISOString(),\n      diffTo:\n        typeof annotationTimeRange.raw.to === 'string'\n          ? annotationTimeRange.raw.to\n          : annotationTimeRange.raw.to.toISOString(),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const { diffFrom, diffTo } = values;\n\n    if (!diffTo && !diffFrom) {\n      return;\n    }\n\n    const { annotationTimeRange } = this.state;\n\n    this.setAnnotationTimeRange(\n      this.buildAnnotationTimeRange(\n        parseUrlParam(diffFrom) ?? annotationTimeRange.from,\n        parseUrlParam(diffTo) ?? annotationTimeRange.to\n      )\n    );\n  }\n\n  buildAnnotationTimeRange(diffFrom: string | DateTime, diffTo: string | DateTime) {\n    return evaluateTimeRange(\n      diffFrom,\n      diffTo,\n      this.getTimeZone(),\n      this.state.fiscalYearStartMonth,\n      this.state.UNSAFE_nowDelay\n    );\n  }\n\n  onTimeRangeChange(timeRange: TimeRange): void {\n    const { mode } = this.state;\n\n    if (mode === TimeRangeWithAnnotationsMode.DEFAULT) {\n      this.getAncestorTimeRange().onTimeRangeChange(timeRange);\n      return;\n    }\n\n    // this triggers a timeseries request to the API\n    // TODO: caching?\n    this.setAnnotationTimeRange(timeRange, true);\n  }\n\n  onTimeZoneChange(timeZone: string): void {\n    this.getAncestorTimeRange().onTimeZoneChange(timeZone);\n  }\n\n  getTimeZone(): string {\n    return this.getAncestorTimeRange().getTimeZone();\n  }\n\n  onRefresh(): void {\n    this.getAncestorTimeRange().onRefresh();\n  }\n}\n","import { dateMath, DateTime, TimeRange } from '@grafana/data';\nimport { TimeZone } from '@grafana/schema';\n\n/* Copied from https://github.com/grafana/scenes/blob/main/packages/scenes/src/utils/evaluateTimeRange.ts */\n\nexport function evaluateTimeRange(\n  from: string | DateTime,\n  to: string | DateTime,\n  timeZone: TimeZone,\n  fiscalYearStartMonth?: number,\n  delay?: string\n): TimeRange {\n  const hasDelay = delay && to === 'now';\n\n  return {\n    from: dateMath.parse(from, false, timeZone, fiscalYearStartMonth)!,\n    to: dateMath.parse(hasDelay ? 'now-' + delay : to, true, timeZone, fiscalYearStartMonth)!,\n    raw: {\n      from: from,\n      to: to,\n    },\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { TimerangeSelectionMode } from '../actions/SwitchTimeRangeSelectionModeAction';\n\ninterface EventSwitchTimerangeSelectionModePayload {\n  mode: TimerangeSelectionMode;\n}\n\nexport class EventSwitchTimerangeSelectionMode extends BusEventWithPayload<EventSwitchTimerangeSelectionModePayload> {\n  public static type = 'switch-timerange-selection-mode';\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Icon, RadioButtonGroup, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventSwitchTimerangeSelectionMode } from '../events/EventSwitchTimerangeSelectionMode';\n\nexport enum TimerangeSelectionMode {\n  TIMEPICKER = 'timepicker',\n  FLAMEGRAPH = 'flame-graph',\n}\n\ninterface SwitchTimeRangeSelectionTypeActionState extends SceneObjectState {\n  mode: TimerangeSelectionMode;\n}\n\nexport class SwitchTimeRangeSelectionModeAction extends SceneObjectBase<SwitchTimeRangeSelectionTypeActionState> {\n  static OPTIONS = [\n    { label: 'Time picker', value: TimerangeSelectionMode.TIMEPICKER },\n    { label: 'Flame graph', value: TimerangeSelectionMode.FLAMEGRAPH },\n  ];\n\n  constructor() {\n    super({\n      mode: TimerangeSelectionMode.FLAMEGRAPH,\n    });\n  }\n\n  public onChange = (newMode: TimerangeSelectionMode) => {\n    this.setState({ mode: newMode });\n\n    this.publishEvent(new EventSwitchTimerangeSelectionMode({ mode: newMode }), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SwitchTimeRangeSelectionModeAction>) => {\n    const styles = useStyles2(getStyles);\n    const { mode } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <label className={styles.label}>\n          <span>Range selection mode&nbsp;</span>\n          <Tooltip\n            content={\n              <div className={styles.tooltip}>\n                <div>\n                  Use these buttons to change the behaviour when selecting a range with the mouse on the time series:\n                </div>\n                <dl>\n                  <dt>Time picker</dt>\n                  <dd>Time range zoom in (default behaviour)</dd>\n                  <dt>Flame graph</dt>\n                  <dd>\n                    Time range for building the flame graph (the stack traces will be retrieved only for the selected\n                    range)\n                  </dd>\n                </dl>\n              </div>\n            }\n            placement=\"top\"\n          >\n            <Icon name=\"question-circle\" />\n          </Tooltip>\n        </label>\n        <RadioButtonGroup\n          size=\"sm\"\n          options={SwitchTimeRangeSelectionModeAction.OPTIONS}\n          value={mode}\n          onChange={model.onChange}\n          aria-label=\"Range selection mode\"\n        />\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: column;\n  `,\n  tooltip: css`\n    padding: ${theme.spacing(1)};\n    & dl {\n      margin-top: ${theme.spacing(2)};\n      display: grid;\n      grid-gap: ${theme.spacing(1)} ${theme.spacing(2)};\n      grid-template-columns: max-content;\n    }\n    & dt {\n      font-weight: bold;\n    }\n    & dd {\n      margin: 0;\n      grid-column-start: 2;\n    }\n  `,\n  label: css`\n    font-size: 12px;\n    text-align: right;\n    margin-bottom: 2px;\n    color: ${theme.colors.text.secondary};\n  `,\n});\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../../../../../infrastructure/pyroscope-data-sources';\nimport { withPreventInvalidQuery } from '../../../../../infrastructure/withPreventInvalidQuery';\n\nexport function buildCompareTimeSeriesQueryRunner({\n  filterKey,\n}: {\n  filterKey: 'filtersBaseline' | 'filtersComparison';\n}) {\n  const queryRunner = new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: `$profileMetricId-$serviceName-${filterKey}}`,\n        queryType: 'metrics',\n        profileTypeId: '$profileMetricId',\n        labelSelector: `{service_name=\"$serviceName\",$${filterKey}}`,\n      },\n    ],\n  });\n\n  return withPreventInvalidQuery(queryRunner);\n}\n","import Color from 'color';\n\nexport const BASELINE_COLORS = {\n  COLOR: Color('#d066d4'),\n  OVERLAY: Color('#d066d4').alpha(0.3),\n};\n\nexport const COMPARISON_COLORS = {\n  COLOR: Color('#1398f6'),\n  OVERLAY: Color('#1398f6').alpha(0.3),\n};\n","import { css, cx } from '@emotion/css';\nimport {\n  AdHocVariableFilter,\n  dateTime,\n  dateTimeFormat,\n  FieldMatcherID,\n  getValueFormat,\n  GrafanaTheme2,\n  systemDateFormats,\n} from '@grafana/data';\nimport {\n  SceneComponentProps,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneTimeRangeLike,\n  SceneTimeRangeState,\n  VariableDependencyConfig,\n} from '@grafana/scenes';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport { SceneTimePickerWithoutSync } from '@shared/components/SceneTimePickerWithoutSync/SceneTimePickerWithoutSync';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { omit } from 'lodash';\nimport React from 'react';\n\nimport { buildTimeRange } from '../../../../domain/buildTimeRange';\nimport { FiltersVariable } from '../../../../domain/variables/FiltersVariable/FiltersVariable';\nimport { getSceneVariableValue } from '../../../../helpers/getSceneVariableValue';\nimport { getSeriesStatsValue } from '../../../../infrastructure/helpers/getSeriesStatsValue';\nimport { getProfileMetricLabel } from '../../../../infrastructure/series/helpers/getProfileMetricLabel';\nimport { PanelType } from '../../../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { addRefId, addStats } from '../../../SceneByVariableRepeaterGrid/infrastructure/data-transformations';\nimport { SceneLabelValuesTimeseries } from '../../../SceneLabelValuesTimeseries/SceneLabelValuesTimeseries';\nimport { CompareTarget } from '../../domain/types';\nimport { Preset } from '../ScenePresetsPicker/ScenePresetsPicker';\nimport {\n  SceneTimeRangeWithAnnotations,\n  TimeRangeWithAnnotationsMode,\n} from './components/SceneTimeRangeWithAnnotations';\nimport {\n  SwitchTimeRangeSelectionModeAction,\n  TimerangeSelectionMode,\n} from './domain/actions/SwitchTimeRangeSelectionModeAction';\nimport { EventEnableSyncTimeRanges } from './domain/events/EventEnableSyncTimeRanges';\nimport { EventSwitchTimerangeSelectionMode } from './domain/events/EventSwitchTimerangeSelectionMode';\nimport { EventSyncRefresh } from './domain/events/EventSyncRefresh';\nimport { EventSyncTimeRanges } from './domain/events/EventSyncTimeRanges';\nimport { RangeAnnotation } from './domain/RangeAnnotation';\nimport { buildCompareTimeSeriesQueryRunner } from './infrastructure/buildCompareTimeSeriesQueryRunner';\nimport { BASELINE_COLORS, COMPARISON_COLORS } from './ui/colors';\n\nconst ONE_DAY_IN_MS = 24 * 60 * 60 * 1000;\n\ninterface SceneComparePanelState extends SceneObjectState {\n  target: CompareTarget;\n  filterKey: 'filtersBaseline' | 'filtersComparison';\n  title: string;\n  color: string;\n  timePicker: SceneTimePicker;\n  refreshPicker: SceneRefreshPicker;\n  $timeRange: SceneTimeRange;\n  timeseriesPanel: SceneLabelValuesTimeseries;\n  timeRangeSyncEnabled: boolean;\n}\n\nexport class SceneComparePanel extends SceneObjectBase<SceneComparePanelState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['profileMetricId'],\n    onReferencedVariableValueChanged: () => {\n      this.state.timeseriesPanel.updateItem({ label: this.buildTimeseriesTitle() });\n    },\n  });\n\n  constructor({\n    target,\n    useAncestorTimeRange,\n    clearDiffRange,\n    filters,\n  }: {\n    target: SceneComparePanelState['target'];\n    useAncestorTimeRange: boolean;\n    clearDiffRange: boolean;\n    filters: AdHocVariableFilter[];\n  }) {\n    const filterKey = target === CompareTarget.BASELINE ? 'filtersBaseline' : 'filtersComparison';\n    const title = target === CompareTarget.BASELINE ? 'Baseline' : 'Comparison';\n    const color =\n      target === CompareTarget.BASELINE ? BASELINE_COLORS.COLOR.toString() : COMPARISON_COLORS.COLOR.toString();\n\n    super({\n      key: `${target}-panel`,\n      target,\n      filterKey,\n      title,\n      color,\n      $timeRange: new SceneTimeRange({ key: `${target}-panel-timerange`, ...buildTimeRange('now-1h', 'now') }),\n      timePicker: new SceneTimePickerWithoutSync({ isOnCanvas: true }),\n      refreshPicker: new SceneRefreshPicker({ isOnCanvas: true }),\n      timeseriesPanel: SceneComparePanel.buildTimeSeriesPanel({ target, filterKey, title, color }),\n      timeRangeSyncEnabled: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, useAncestorTimeRange, clearDiffRange, filters));\n  }\n\n  onActivate(useAncestorTimeRange: boolean, clearDiffRange: boolean, filters: AdHocVariableFilter[]) {\n    const { $timeRange, timeseriesPanel, filterKey } = this.state;\n\n    if (clearDiffRange) {\n      this.setDiffRange(null);\n    }\n\n    if (useAncestorTimeRange) {\n      $timeRange.setState(omit(this.getAncestorTimeRange().state, 'key'));\n    }\n\n    if (filters.length) {\n      const filtersVariable = sceneGraph.findByKey(this, filterKey) as FiltersVariable;\n\n      filtersVariable.setState({ filters });\n    }\n\n    timeseriesPanel.updateItem({ label: this.buildTimeseriesTitle() });\n\n    const eventSub = this.subscribeToEvents();\n\n    return () => {\n      eventSub.unsubscribe();\n    };\n  }\n\n  static buildTimeSeriesPanel({ target, filterKey, title, color }: any) {\n    const timeseriesPanel = new SceneLabelValuesTimeseries({\n      item: {\n        index: 0,\n        value: target,\n        label: '',\n        queryRunnerParams: {},\n        panelType: PanelType.TIMESERIES,\n      },\n      data: new SceneDataTransformer({\n        $data: buildCompareTimeSeriesQueryRunner({ filterKey }),\n        transformations: [addRefId, addStats],\n      }),\n      overrides: (series) =>\n        series.map((s) => {\n          const metricField = s.fields[1];\n          const allValuesSum = getSeriesStatsValue(s, 'allValuesSum') || 0;\n          const formattedValue = getValueFormat(metricField.config.unit)(allValuesSum);\n          const total = `${formattedValue.text}${formattedValue.suffix}`;\n          const [diffFrom, diffTo, timeZone] = SceneComparePanel.getDiffRange(timeseriesPanel);\n\n          const displayName =\n            diffFrom && diffTo\n              ? `Total = ${total} / Flame graph range = ${dateTimeFormat(diffFrom, {\n                  format: systemDateFormats.fullDate,\n                  timeZone,\n                })} → ${dateTimeFormat(diffTo, {\n                  format: systemDateFormats.fullDate,\n                  timeZone,\n                })}`\n              : `Total = ${total}`;\n\n          return {\n            matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n            properties: [\n              {\n                id: 'displayName',\n                value: displayName,\n              },\n              {\n                id: 'color',\n                value: { mode: 'fixed', fixedColor: color },\n              },\n            ],\n          };\n        }),\n      headerActions: () => [new SwitchTimeRangeSelectionModeAction()],\n    });\n\n    timeseriesPanel.state.body.setState({\n      $timeRange: new SceneTimeRangeWithAnnotations({\n        key: `${target}-annotation-timerange`,\n        mode: TimeRangeWithAnnotationsMode.ANNOTATIONS,\n        annotationColor:\n          target === CompareTarget.BASELINE ? BASELINE_COLORS.OVERLAY.toString() : COMPARISON_COLORS.OVERLAY.toString(),\n        annotationTitle: `${title} flame graph range`,\n      }),\n    });\n\n    return timeseriesPanel;\n  }\n\n  static getDiffRange(\n    timeseriesPanel: SceneLabelValuesTimeseries\n  ): [number | undefined, number | undefined, string | undefined] {\n    let diffFrom: number | undefined;\n    let diffTo: number | undefined;\n\n    const annotation = timeseriesPanel.state.body.state.$data?.state.data?.annotations?.[0] as RangeAnnotation;\n\n    annotation?.fields.some(({ name, values }) => {\n      diffFrom = name === 'time' ? values[0] : diffFrom;\n      diffTo = name === 'timeEnd' ? values[0] : diffTo;\n      return diffFrom && diffTo;\n    });\n\n    return [diffFrom, diffTo, timeseriesPanel.state.$timeRange?.state.timeZone];\n  }\n\n  protected getAncestorTimeRange(): SceneTimeRangeLike {\n    if (!this.parent || !this.parent.parent) {\n      throw new Error(typeof this + ' must be used within $timeRange scope');\n    }\n\n    return sceneGraph.getTimeRange(this.parent.parent);\n  }\n\n  subscribeToEvents() {\n    const { target, timeseriesPanel, $timeRange } = this.state;\n\n    const $annotationTimeRange = timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations;\n\n    const switchSub = this.subscribeToEvent(EventSwitchTimerangeSelectionMode, (event) => {\n      // this triggers a timeseries request to the API\n      // TODO: caching?\n      $annotationTimeRange.setState({\n        mode:\n          event.payload.mode === TimerangeSelectionMode.FLAMEGRAPH\n            ? TimeRangeWithAnnotationsMode.ANNOTATIONS\n            : TimeRangeWithAnnotationsMode.DEFAULT,\n      });\n    });\n\n    const annotationTimeRangeSub = $annotationTimeRange.subscribeToState((newState, prevState) => {\n      if (this.state.timeRangeSyncEnabled && newState.annotationTimeRange !== prevState.annotationTimeRange) {\n        this.publishEvent(\n          new EventSyncTimeRanges({ source: target, annotationTimeRange: newState.annotationTimeRange }),\n          true\n        );\n      }\n    });\n\n    const timeRangeSub = $timeRange.subscribeToState((newState, prevState) => {\n      if (newState.from !== prevState.from || newState.to !== prevState.to) {\n        this.updateTitle('');\n\n        if (this.state.timeRangeSyncEnabled) {\n          this.publishEvent(new EventSyncTimeRanges({ source: target, timeRange: newState }), true);\n        }\n      }\n    });\n\n    return {\n      unsubscribe() {\n        timeRangeSub.unsubscribe();\n        annotationTimeRangeSub.unsubscribe();\n        switchSub.unsubscribe();\n      },\n    };\n  }\n\n  buildTimeseriesTitle() {\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const { description } = getProfileMetric(profileMetricId as ProfileMetricId);\n    return description || getProfileMetricLabel(profileMetricId);\n  }\n\n  useDiffTimeRange() {\n    return (this.state.timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations).useState();\n  }\n\n  applyPreset({ from, to, diffFrom, diffTo, label }: Preset) {\n    this.setDiffRange({ from: diffFrom, to: diffTo });\n\n    this.setTimeRange(buildTimeRange(from, to));\n\n    this.updateTitle(label);\n  }\n\n  setTimeRange(newTimeRange: SceneTimeRangeState) {\n    const { from, to } = this.state.$timeRange.state.value;\n\n    if (!from.isSame(newTimeRange.value.from) || !to.isSame(newTimeRange.value.to)) {\n      this.state.$timeRange.setState({ from: newTimeRange.from, to: newTimeRange.to, value: newTimeRange.value });\n    }\n  }\n\n  setDiffRange(options: { from: string; to: string } | null) {\n    const $diffTimeRange = this.state.timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations;\n\n    if (options === null) {\n      $diffTimeRange.nullifyAnnotationTimeRange();\n      return;\n    }\n\n    const { annotationTimeRange } = $diffTimeRange.state;\n    const newAnnotationTimeRange = $diffTimeRange.buildAnnotationTimeRange(options.from, options.to);\n\n    if (\n      !annotationTimeRange.from.isSame(newAnnotationTimeRange.from) ||\n      !annotationTimeRange.to.isSame(newAnnotationTimeRange.to)\n    ) {\n      $diffTimeRange.setAnnotationTimeRange(newAnnotationTimeRange, true);\n    }\n  }\n\n  /**\n   * This function is responsible for automatically selecting half of the time range (from the time picker) that will be used to build the diff flame graph\n   * For the baseline panel, the leftmost part, for the comparison one, the rightmost part.\n   * In the future, we might want to be smarter and provides a way to select (e.g.) the region with the lowest resource consumption on the baseline panel vs\n   * the region with the highest consumption on the comparison panel.\n   */\n  autoSelectDiffRange(selectWholeRange: boolean) {\n    const { $timeRange, target } = this.state;\n    const { from, to } = $timeRange.state.value;\n\n    this.updateTitle('');\n\n    if (selectWholeRange) {\n      this.setDiffRange({ from: from.toISOString(), to: to.toISOString() });\n      return;\n    }\n\n    const diff = to.diff(from);\n\n    // ensure that we don't kill the backend when selecting long periods like 7d\n    const range = Math.min(Math.round(diff * 0.25), ONE_DAY_IN_MS);\n\n    if (target === CompareTarget.BASELINE) {\n      // we have to create a new instance because add() mutates the original one\n      this.setDiffRange({ from: from.toISOString(), to: dateTime(from).add(range).toISOString() });\n    } else {\n      // we have to create a new instance because subtract() mutates the original one\n      this.setDiffRange({ from: dateTime(to).subtract(range).toISOString(), to: to.toISOString() });\n    }\n  }\n\n  updateTitle(label = '') {\n    const title = this.state.target === CompareTarget.BASELINE ? 'Baseline' : 'Comparison';\n    const newTitle = label ? `${title} (${label})` : title;\n\n    this.setState({ title: newTitle });\n  }\n\n  onClickTimeRangeSync = () => {\n    const { target, timeRangeSyncEnabled, $timeRange, timeseriesPanel } = this.state;\n    const $annotationTimeRange = timeseriesPanel.state.body.state.$timeRange as SceneTimeRangeWithAnnotations;\n\n    this.publishEvent(\n      new EventEnableSyncTimeRanges({\n        source: target,\n        enable: !timeRangeSyncEnabled,\n        timeRange: $timeRange.state,\n        annotationTimeRange: $annotationTimeRange.state.annotationTimeRange,\n      }),\n      true\n    );\n  };\n\n  toggleTimeRangeSync(timeRangeSyncEnabled: boolean) {\n    this.setState({ timeRangeSyncEnabled });\n  }\n\n  onClickRefresh = () => {\n    this.publishEvent(new EventSyncRefresh({ source: this.state.target }), true);\n  };\n\n  refreshTimeseries() {\n    this.state.$timeRange.onRefresh();\n  }\n\n  public static Component = ({ model }: SceneComponentProps<SceneComparePanel>) => {\n    const {\n      target,\n      color,\n      title,\n      timeseriesPanel: timeseries,\n      timePicker,\n      refreshPicker,\n      filterKey,\n      timeRangeSyncEnabled,\n    } = model.useState();\n\n    const styles = useStyles2(getStyles, color);\n\n    const filtersVariable = sceneGraph.findByKey(model, filterKey) as FiltersVariable;\n\n    return (\n      <div className={styles.panel} data-testid={`panel-${target}`}>\n        <div className={styles.panelHeader}>\n          <h6>\n            <div className={styles.colorCircle} />\n            {title}\n          </h6>\n\n          <div className={styles.timeControls}>\n            <timePicker.Component model={timePicker} />\n\n            <div onClick={model.onClickRefresh}>\n              <refreshPicker.Component model={refreshPicker} />\n            </div>\n\n            <IconButton\n              className={cx(styles.syncButton, timeRangeSyncEnabled && 'active')}\n              name=\"link\"\n              aria-label={timeRangeSyncEnabled ? 'Unsync time ranges' : 'Sync time ranges'}\n              tooltip={timeRangeSyncEnabled ? 'Unsync time ranges' : 'Sync time ranges'}\n              onClick={model.onClickTimeRangeSync}\n            />\n          </div>\n        </div>\n\n        <div className={styles.filter}>\n          <filtersVariable.Component model={filtersVariable} />\n        </div>\n\n        <div className={styles.timeseries}>{timeseries && <timeseries.Component model={timeseries} />}</div>\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2, color: string) => ({\n  panel: css`\n    background-color: ${theme.colors.background.primary};\n    padding: ${theme.spacing(1)} ${theme.spacing(1)} 0 ${theme.spacing(1)};\n    border: 1px solid ${theme.colors.border.weak};\n    border-radius: 2px;\n  `,\n  panelHeader: css`\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: ${theme.spacing(2)};\n    flex-wrap: wrap;\n\n    & > h6 {\n      font-size: 15px;\n      height: 32px;\n      line-height: 32px;\n      margin: 0 ${theme.spacing(1)} 0 0;\n    }\n  `,\n  colorCircle: css`\n    display: inline-block;\n    background-color: ${color};\n    border-radius: 50%;\n    width: 9px;\n    height: 9px;\n    margin-right: 6px;\n  `,\n  timeControls: css`\n    display: flex;\n    justify-content: flex-end;\n    gap: 4px;\n  `,\n  syncButton: css`\n    z-index: unset;\n    padding: ${theme.spacing(0, 1)};\n    margin: 0;\n    background: ${theme.colors.secondary.main};\n    border: 1px solid ${theme.colors.secondary.border};\n    border-radius: ${theme.shape.radius.default};\n\n    &:hover {\n      background: ${theme.colors.secondary.shade};\n    }\n\n    &.active {\n      color: ${theme.colors.primary.text};\n      border: 1px solid ${theme.colors.primary.text};\n    }\n  `,\n  filter: css`\n    display: flex;\n    margin-bottom: ${theme.spacing(3)};\n  `,\n  timeseries: css`\n    height: 200px;\n\n    & [data-viz-panel-key] > * {\n      border: 0 none;\n    }\n\n    & [data-viz-panel-key] [data-testid='uplot-main-div'] {\n      cursor: crosshair;\n    }\n  `,\n});\n","import { useState } from 'react';\n\ntype PanelId = 'ai' | 'function-details' | null;\n\ntype OnOpenHandler = () => void;\n\ntype SidePanel = {\n  onOpen: (handler: OnOpenHandler) => void;\n  isOpen: (panelId: PanelId) => boolean;\n  open: (panelId: PanelId) => void;\n  close: () => void;\n};\n\nexport function useToggleSidePanel(): SidePanel {\n  const [openPanelId, setOpenPanelId] = useState<PanelId>(null);\n  const [onOpenHandler, setOnOpenHandler] = useState<OnOpenHandler>();\n\n  return {\n    onOpen(handler: OnOpenHandler) {\n      setOnOpenHandler(() => handler);\n    },\n    isOpen(panelId: PanelId) {\n      return panelId === openPanelId;\n    },\n    open(panelId: PanelId) {\n      setOpenPanelId(panelId);\n      onOpenHandler?.();\n    },\n    close() {\n      setOpenPanelId(null);\n    },\n  };\n}\n","export type PluginSettings = {\n  collapsedFlamegraphs: boolean;\n  maxNodes: number;\n  enableFlameGraphDotComExport: boolean;\n  enableFunctionDetails: boolean;\n  enableMetricsFromProfiles?: boolean;\n};\n\nexport const DEFAULT_SETTINGS: PluginSettings = Object.freeze({\n  collapsedFlamegraphs: false,\n  maxNodes: 16384,\n  enableFlameGraphDotComExport: true,\n  enableFunctionDetails: true,\n  enableMetricsFromProfiles: false,\n});\n","import { ApiClient } from '../http/ApiClient';\nimport { PluginSettings } from './PluginSettings';\n\ntype ApiResponse = {\n  settings: Array<{ name: string; value: string }>;\n};\n\nclass SettingsApiClient extends ApiClient {\n  static PLUGIN_SETTING_NAME = 'pluginSettings';\n\n  async get(): Promise<PluginSettings> {\n    return super\n      .fetch('/settings.v1.SettingsService/Get', { method: 'POST', body: JSON.stringify({}) })\n      .then((response) => response.json())\n      .then((json: ApiResponse) => {\n        const setting = json.settings?.find(({ name }) => name === SettingsApiClient.PLUGIN_SETTING_NAME);\n\n        if (!setting) {\n          return {};\n        }\n\n        return JSON.parse(setting.value);\n      });\n  }\n\n  async set(newSettings: PluginSettings) {\n    return super\n      .fetch('/settings.v1.SettingsService/Set', {\n        method: 'POST',\n        body: JSON.stringify({\n          setting: {\n            name: SettingsApiClient.PLUGIN_SETTING_NAME,\n            value: JSON.stringify(newSettings),\n          },\n        }),\n      })\n      .then((response) => response.json());\n  }\n}\n\nexport const useSettingsApiClient = () => {\n  return new SettingsApiClient();\n};\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport { useMutation, useQuery } from '@tanstack/react-query';\n\nimport { DEFAULT_SETTINGS, PluginSettings } from './PluginSettings';\nimport { useSettingsApiClient } from './settingsApiClient';\n\ntype FetchParams = {\n  enabled?: boolean;\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: Error | null;\n  settings?: PluginSettings;\n  mutate: (newSettings: PluginSettings) => Promise<void>;\n};\n\n/**\n * Fetches the plugin settings and, if none/only some have been stored previously, returns adequate default values for the rest of the application\n */\nexport function useFetchPluginSettings({ enabled }: FetchParams = {}): FetchResponse {\n  const settingsApiClient = useSettingsApiClient();\n\n  const { isFetching, error, data } = useQuery({\n    enabled,\n    queryKey: ['settings', 'ds-uid-' + ApiClient.selectDefaultDataSource().uid],\n    queryFn: () =>\n      settingsApiClient.get().then(\n        (json) =>\n          // provide defaults if any value comes null or undefined from the API (which can be the case ;))\n          Object.keys(DEFAULT_SETTINGS).reduce((acc, key) => {\n            acc[key] ??= DEFAULT_SETTINGS[key as keyof PluginSettings]; // TS luv :man_shrug:\n            return acc;\n          }, json as Record<string, any>) as PluginSettings // TS luv :man_shrug:\n      ),\n  });\n\n  const { mutateAsync: mutate } = useMutation({\n    mutationFn: (newSettings: PluginSettings) => settingsApiClient.set(newSettings),\n    networkMode: 'always',\n  });\n\n  return {\n    isFetching,\n    error: settingsApiClient.isAbortError(error) ? null : error,\n    settings: data,\n    mutate,\n  };\n}\n","import { Alert, AlertVariant } from '@grafana/ui';\nimport { ErrorContext, logger } from '@shared/infrastructure/tracking/logger';\nimport React from 'react';\n\ntype InlineBannerProps = {\n  severity: AlertVariant;\n  title: string;\n  message?: string | React.ReactNode;\n  error?: Error;\n  errorContext?: ErrorContext;\n};\n\nexport function InlineBanner({ severity, title, message, error, errorContext }: InlineBannerProps) {\n  if (error) {\n    logger.error(error, errorContext);\n  }\n\n  return (\n    <Alert title={title} severity={severity}>\n      {error && (\n        <>\n          {error.message}\n          <br />\n        </>\n      )}\n      {message}\n    </Alert>\n  );\n}\n","import React, { useEffect, useState } from 'react';\n\ninterface Props {\n  children: React.ReactNode;\n  delay: number;\n}\n\n/**\n * Delay the rendering of the children by N amount of milliseconds\n */\nexport function DelayRender({ children, delay }: Props) {\n  const [shouldRender, setShouldRender] = useState(false);\n  useEffect(() => {\n    window.setTimeout(() => {\n      setShouldRender(true);\n    }, delay);\n  }, [children, delay]);\n\n  return <>{shouldRender ? children : null}</>;\n}\n","import { cx } from '@emotion/css';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Dropdown, ToolbarButton } from '@grafana/ui';\nimport React, { ReactElement, useCallback } from 'react';\n\ntype TooltipPlacement =\n  | 'auto-start'\n  | 'auto'\n  | 'auto-end'\n  | 'top-start'\n  | 'top'\n  | 'top-end'\n  | 'right-start'\n  | 'right'\n  | 'right-end'\n  | 'bottom-end'\n  | 'bottom'\n  | 'bottom-start'\n  | 'left-end'\n  | 'left'\n  | 'left-start';\n\ninterface PanelMenuProps {\n  menu: ReactElement | (() => ReactElement);\n  menuButtonClass?: string;\n  dragClassCancel?: string;\n  title?: string;\n  placement?: TooltipPlacement;\n  offset?: [number, number];\n  onVisibleChange?: (state: boolean) => void;\n  onOpenMenu?: () => void;\n}\n\nexport function PanelMenu({\n  menu,\n  title,\n  placement = 'bottom',\n  offset,\n  dragClassCancel,\n  menuButtonClass,\n  onVisibleChange,\n  onOpenMenu,\n}: PanelMenuProps) {\n  const testId = title ? selectors.components.Panels.Panel.menu(title) : `panel-menu-button`;\n\n  const handleVisibility = useCallback(\n    (show: boolean) => {\n      if (show && onOpenMenu) {\n        onOpenMenu();\n      }\n      return onVisibleChange;\n    },\n    [onOpenMenu, onVisibleChange]\n  );\n\n  const label = title ? `Menu for panel with title ${title}` : `Menu for panel with no title`;\n\n  return (\n    <Dropdown overlay={menu} placement={placement} offset={offset} onVisibleChange={handleVisibility}>\n      <ToolbarButton\n        aria-label={label}\n        title=\"Menu\"\n        icon=\"ellipsis-v\"\n        iconSize=\"md\"\n        narrow\n        data-testid={testId}\n        className={cx(menuButtonClass, dragClassCancel)}\n      />\n    </Dropdown>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors as e2eSelectors } from '@grafana/e2e-selectors';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport React, { ReactElement, useCallback, useRef, useState } from 'react';\n\nimport { PanelMenu } from './PanelMenu';\n\ninterface Props {\n  children?: React.ReactNode;\n  menu?: ReactElement | (() => ReactElement);\n  title?: string;\n  offset?: number;\n  dragClass?: string;\n  onOpenMenu?: () => void;\n}\n\nexport function HoverWidget({ menu, title, dragClass, children, offset = -32, onOpenMenu }: Props) {\n  const styles = useStyles2(getStyles);\n  const draggableRef = useRef<HTMLDivElement>(null);\n  const selectors = e2eSelectors.components.Panels.Panel.HoverWidget;\n  // Capture the pointer to keep the widget visible while dragging\n  const onPointerDown = useCallback((e: React.PointerEvent<HTMLDivElement>) => {\n    draggableRef.current?.setPointerCapture(e.pointerId);\n  }, []);\n\n  const onPointerUp = useCallback((e: React.PointerEvent<HTMLDivElement>) => {\n    draggableRef.current?.releasePointerCapture(e.pointerId);\n  }, []);\n\n  const [menuOpen, setMenuOpen] = useState(false);\n\n  if (children === undefined || React.Children.count(children) === 0) {\n    return null;\n  }\n\n  return (\n    <div\n      className={cx(styles.container, { 'show-on-hover': !menuOpen })}\n      style={{ top: `${offset}px` }}\n      data-testid={selectors.container}\n    >\n      {dragClass && (\n        <div\n          className={cx(styles.square, styles.draggable, dragClass)}\n          onPointerDown={onPointerDown}\n          onPointerUp={onPointerUp}\n          ref={draggableRef}\n          data-testid={selectors.dragIcon}\n        >\n          <Icon name=\"expand-arrows\" className={styles.draggableIcon} />\n        </div>\n      )}\n      {!title && <h6 className={cx(styles.untitled, { [styles.draggable]: !!dragClass }, dragClass)}>Untitled</h6>}\n      {children}\n      {menu && (\n        <PanelMenu\n          menu={menu}\n          title={title}\n          placement=\"bottom\"\n          menuButtonClass={styles.menuButton}\n          onVisibleChange={setMenuOpen}\n          onOpenMenu={onOpenMenu}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    hidden: css({\n      visibility: 'hidden',\n      opacity: '0',\n    }),\n    container: css({\n      label: 'hover-container-widget',\n      transition: `all .1s linear`,\n      display: 'flex',\n      position: 'absolute',\n      zIndex: 1,\n      right: 0,\n      boxSizing: 'content-box',\n      alignItems: 'center',\n      background: theme.colors.background.secondary,\n      color: theme.colors.text.primary,\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: theme.shape.radius.default,\n      height: theme.spacing(4),\n      boxShadow: theme.shadows.z1,\n    }),\n    square: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      width: theme.spacing(4),\n      height: '100%',\n    }),\n    draggable: css({\n      cursor: 'move',\n      // mobile do not support draggable panels\n      [theme.breakpoints.down('md')]: {\n        display: 'none',\n      },\n    }),\n    menuButton: css({\n      // Background and border are overriden when topnav toggle is disabled\n      background: 'inherit',\n      border: 'none',\n      '&:hover': {\n        background: theme.colors.secondary.main,\n      },\n    }),\n    untitled: css({\n      color: theme.colors.text.disabled,\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1),\n      marginBottom: 0,\n    }),\n    draggableIcon: css({\n      transform: 'rotate(45deg)',\n      color: theme.colors.text.secondary,\n      '&:hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n  };\n}\n","import { css, CSSObject, cx } from '@emotion/css';\nimport { GrafanaTheme2, LinkModel, LinkTarget } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React, { forwardRef } from 'react';\n\ntype TitleItemProps = {\n  className?: string;\n  children: React.ReactNode;\n  onClick?: LinkModel['onClick'];\n  href?: string;\n  target?: LinkTarget;\n  title?: string;\n};\n\ntype TitleItemElement = HTMLAnchorElement & HTMLButtonElement;\n\nexport const TitleItem = forwardRef<TitleItemElement, TitleItemProps>(\n  ({ className, children, href, onClick, target, title, ...rest }, ref) => {\n    const styles = useStyles2(getStyles);\n\n    if (href) {\n      return (\n        <a\n          ref={ref}\n          href={href}\n          onClick={onClick}\n          target={target}\n          title={title}\n          className={cx(styles.linkItem, className)}\n          {...rest}\n        >\n          {children}\n        </a>\n      );\n    } else if (onClick) {\n      return (\n        <Button ref={ref} className={cx(styles.item, className)} variant=\"secondary\" fill=\"text\" onClick={onClick}>\n          {children}\n        </Button>\n      );\n    } else {\n      return (\n        <span ref={ref} className={cx(styles.item, className)} {...rest}>\n          {children}\n        </span>\n      );\n    }\n  }\n);\n\nTitleItem.displayName = 'TitleItem';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const item = css({\n    color: `${theme.colors.text.secondary}`,\n    label: 'panel-header-item',\n    cursor: 'auto',\n    border: 'none',\n    borderRadius: `${theme.shape.radius.default}`,\n    padding: `${theme.spacing(0, 1)}`,\n    height: `${theme.spacing(theme.components.panel.headerHeight)}`,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n\n    '&:focus, &:focus-visible': {\n      ...getFocusStyles(theme),\n      zIndex: 1,\n    },\n    '&: focus:not(:focus-visible)': {\n      outline: 'none',\n      boxShadow: `none`,\n    },\n\n    '&:hover ': {\n      boxShadow: `${theme.shadows.z1}`,\n      background: `${theme.colors.background.secondary}`,\n      color: `${theme.colors.text.primary}`,\n    },\n  });\n\n  return {\n    item,\n    linkItem: cx(item, css({ cursor: 'pointer' })),\n  };\n};\n\nfunction getFocusStyles(theme: GrafanaTheme2): CSSObject {\n  return {\n    outline: '2px dotted transparent',\n    outlineOffset: '2px',\n    boxShadow: `0 0 0 2px ${theme.colors.background.canvas}, 0 0 0px 4px ${theme.colors.primary.main}`,\n    transitionTimingFunction: `cubic-bezier(0.19, 1, 0.22, 1)`,\n    transitionDuration: '0.2s',\n    transitionProperty: 'outline, outline-offset, box-shadow',\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { TitleItem } from './TitleItem';\n\ninterface Props {\n  description: string | (() => string);\n  className?: string;\n}\n\nexport function PanelDescription({ description, className }: Props) {\n  const styles = useStyles2(getStyles);\n\n  const getDescriptionContent = () => {\n    const panelDescription = typeof description === 'function' ? description() : description;\n\n    return (\n      <div className=\"panel-info-content markdown-html\">\n        <div dangerouslySetInnerHTML={{ __html: panelDescription }} />\n      </div>\n    );\n  };\n\n  return description !== '' ? (\n    <Tooltip interactive content={getDescriptionContent}>\n      <TitleItem className={cx(className, styles.description)}>\n        <Icon name=\"info-circle\" size=\"md\" />\n      </TitleItem>\n    </Tooltip>\n  ) : null;\n}\n\nconst getStyles = () => {\n  return {\n    description: css({\n      code: {\n        whiteSpace: 'normal',\n        wordWrap: 'break-word',\n      },\n\n      'pre > code': {\n        display: 'block',\n      },\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ninterface Props {\n  message?: string;\n  onClick?: (e: React.SyntheticEvent) => void;\n  ariaLabel?: string;\n}\n\nexport function PanelStatus({ message, onClick, ariaLabel = 'status' }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <ToolbarButton\n      className={styles.buttonStyles}\n      onClick={onClick}\n      variant={'destructive'}\n      icon=\"exclamation-triangle\"\n      iconSize=\"md\"\n      tooltip={message || ''}\n      aria-label={ariaLabel}\n    />\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const { headerHeight, padding } = theme.components.panel;\n\n  return {\n    buttonStyles: css({\n      label: 'panel-header-state-button',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: theme.spacing(padding),\n      width: theme.spacing(headerHeight),\n      height: theme.spacing(headerHeight),\n      borderRadius: theme.shape.radius.default,\n    }),\n  };\n};\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2, LoadingState } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Icon, LoadingBar, Tooltip, useStyles2, useTheme2 } from '@grafana/ui';\nimport React, { CSSProperties, ReactElement, ReactNode, useEffect, useRef, useState } from 'react';\n\nimport { DelayRender } from './DelayRender';\nimport { HoverWidget } from './HoverWidget';\nimport { PanelDescription } from './PanelDescription';\nimport { PanelMenu } from './PanelMenu';\nimport { PanelStatus } from './PanelStatus';\nimport { TitleItem } from './TitleItem';\n\n// This `GrafanaPanelBox` has been derived from the `PanelChrome`, which is exportable via @grafana/ui\n// This variant makes it behave more like the panel/box from Pyroscope, where css dictates the style\n// versus explicit height & width props.\n// The various files in this subdirectory are lifted from grafana/grafana, but this base component, `PanelChromeProps`\n// has been altered slightly.\n//\n// TODO Consider creating a varation of this component that can be exported from @grafana/ui.\n\n/**\n * @internal\n */\ninterface PanelChromeProps {\n  children: ReactNode;\n  padding?: PanelPadding;\n  hoverHeaderOffset?: number;\n  title?: string;\n  description?: string | (() => string);\n  titleItems?: ReactNode;\n  menu?: ReactElement | (() => ReactElement);\n  dragClass?: string;\n  dragClassCancel?: string;\n  hoverHeader?: boolean;\n  /**\n   * Use only to indicate loading or streaming data in the panel.\n   * Any other values of loadingState are ignored.\n   */\n  loadingState?: LoadingState;\n  /**\n   * Used to display status message (used for panel errors currently)\n   */\n  statusMessage?: string;\n  /**\n   * Handle opening error details view (like inspect / error tab)\n   */\n  statusMessageOnClick?: (e: React.SyntheticEvent) => void;\n  actions?: ReactNode;\n  displayMode?: 'default' | 'transparent';\n  onCancelQuery?: () => void;\n  /**\n   * callback when opening the panel menu\n   */\n  onOpenMenu?: () => void;\n}\n\n/**\n * @internal\n */\ntype PanelPadding = 'none' | 'md';\n\n/**\n * @internal\n */\nexport function GrafanaPanelBox({\n  children,\n  padding = 'md',\n  title = '',\n  description = '',\n  displayMode = 'default',\n  titleItems,\n  menu,\n  dragClass,\n  dragClassCancel,\n  hoverHeader = false,\n  hoverHeaderOffset,\n  loadingState,\n  statusMessage,\n  statusMessageOnClick,\n  actions,\n  onCancelQuery,\n  onOpenMenu,\n}: PanelChromeProps) {\n  const theme = useTheme2();\n  const styles = useStyles2(getStyles);\n\n  const [width, setWidth] = useState(0);\n  const childrenContainerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (childrenContainerRef.current) {\n      setWidth(childrenContainerRef.current.offsetWidth);\n    }\n  }, [childrenContainerRef]);\n\n  const hasHeader = !hoverHeader;\n\n  // hover menu is only shown on hover when not on touch devices\n  const showOnHoverClass = 'show-on-hover';\n\n  const headerHeight = getHeaderHeight(theme, hasHeader);\n  const { contentStyle } = getContentStyle(padding, theme);\n\n  const headerStyles: CSSProperties = {\n    height: headerHeight,\n    cursor: dragClass ? 'move' : 'auto',\n  };\n\n  const containerStyles: CSSProperties = {};\n  if (displayMode === 'transparent') {\n    containerStyles.backgroundColor = 'transparent';\n    containerStyles.border = 'none';\n  }\n\n  const testid = title ? selectors.components.Panels.Panel.title(title) : 'Panel';\n\n  const headerContent = (\n    <>\n      {title && (\n        <h6 title={title} className={styles.title}>\n          {title}\n        </h6>\n      )}\n\n      <div className={cx(styles.titleItems, dragClassCancel)} data-testid=\"title-items-container\">\n        <PanelDescription description={description} className={dragClassCancel} />\n        {titleItems}\n      </div>\n\n      {loadingState === LoadingState.Streaming && (\n        <Tooltip content={onCancelQuery ? 'Stop streaming' : 'Streaming'}>\n          <TitleItem className={dragClassCancel} data-testid=\"panel-streaming\" onClick={onCancelQuery}>\n            <Icon name=\"circle-mono\" size=\"md\" className={styles.streaming} />\n          </TitleItem>\n        </Tooltip>\n      )}\n      {loadingState === LoadingState.Loading && onCancelQuery && (\n        <DelayRender delay={2000}>\n          <Tooltip content=\"Cancel query\">\n            <TitleItem\n              className={cx(dragClassCancel, styles.pointer)}\n              data-testid=\"panel-cancel-query\"\n              onClick={onCancelQuery}\n            >\n              <Icon name=\"sync-slash\" size=\"md\" />\n            </TitleItem>\n          </Tooltip>\n        </DelayRender>\n      )}\n      <div className={styles.rightAligned}>\n        {actions && <div className={styles.rightActions}>{itemsRenderer(actions, (item) => item)}</div>}\n      </div>\n    </>\n  );\n\n  return (\n    <div className={styles.container} style={containerStyles} data-testid={testid}>\n      <div className={styles.loadingBarContainer}>\n        {loadingState === LoadingState.Loading ? <LoadingBar width={width} ariaLabel=\"Panel loading bar\" /> : null}\n      </div>\n\n      {hoverHeader && (\n        <>\n          <HoverWidget\n            menu={menu}\n            title={title}\n            offset={hoverHeaderOffset}\n            dragClass={dragClass}\n            onOpenMenu={onOpenMenu}\n          >\n            {headerContent}\n          </HoverWidget>\n\n          {statusMessage && (\n            <div className={styles.errorContainerFloating}>\n              <PanelStatus message={statusMessage} onClick={statusMessageOnClick} ariaLabel=\"Panel status\" />\n            </div>\n          )}\n        </>\n      )}\n\n      {hasHeader && (\n        <div className={cx(styles.headerContainer, dragClass)} style={headerStyles} data-testid=\"header-container\">\n          {statusMessage && (\n            <div className={dragClassCancel}>\n              <PanelStatus message={statusMessage} onClick={statusMessageOnClick} ariaLabel=\"Panel status\" />\n            </div>\n          )}\n\n          {headerContent}\n\n          {menu && (\n            <PanelMenu\n              menu={menu}\n              title={title}\n              placement=\"bottom-end\"\n              menuButtonClass={cx(styles.menuItem, dragClassCancel, showOnHoverClass)}\n              onOpenMenu={onOpenMenu}\n            />\n          )}\n        </div>\n      )}\n\n      <div className={styles.content} style={contentStyle} ref={childrenContainerRef}>\n        {children}\n      </div>\n    </div>\n  );\n}\n\nconst itemsRenderer = (items: ReactNode[] | ReactNode, renderer: (items: ReactNode[]) => ReactNode): ReactNode => {\n  const toRender = React.Children.toArray(items).filter(Boolean);\n  return toRender.length > 0 ? renderer(toRender) : null;\n};\n\nconst getHeaderHeight = (theme: GrafanaTheme2, hasHeader: boolean) => {\n  if (hasHeader) {\n    return theme.spacing.gridSize * theme.components.panel.headerHeight;\n  }\n\n  return 0;\n};\n\nconst getContentStyle = (padding: string, theme: GrafanaTheme2) => {\n  const chromePadding = (padding === 'md' ? theme.components.panel.padding : 0) * theme.spacing.gridSize;\n\n  const contentStyle: CSSProperties = {\n    padding: chromePadding,\n  };\n\n  return { contentStyle };\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const { background, borderColor, padding } = theme.components.panel;\n\n  return {\n    container: css({\n      label: 'panel-container',\n      backgroundColor: background,\n      border: `1px solid ${borderColor}`,\n      position: 'relative',\n      borderRadius: theme.shape.radius.default,\n      height: '100%',\n      display: 'flex',\n      flexDirection: 'column',\n\n      '.show-on-hover': {\n        visibility: 'hidden',\n        opacity: '0',\n      },\n\n      '&:focus-visible, &:hover': {\n        // only show menu icon on hover or focused panel\n        '.show-on-hover': {\n          visibility: 'visible',\n          opacity: '1',\n        },\n      },\n\n      '&:focus-visible': {\n        outline: `1px solid ${theme.colors.action.focus}`,\n      },\n\n      '&:focus-within': {\n        '.show-on-hover': {\n          visibility: 'visible',\n          opacity: '1',\n        },\n      },\n    }),\n    loadingBarContainer: css({\n      label: 'panel-loading-bar-container',\n      position: 'absolute',\n      top: 0,\n      width: '100%',\n      overflow: 'hidden',\n    }),\n    content: css({\n      label: 'panel-content',\n      flexGrow: 1,\n      //contain: 'strict',\n    }),\n    headerContainer: css({\n      label: 'panel-header',\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    pointer: css({\n      cursor: 'pointer',\n    }),\n    streaming: css({\n      label: 'panel-streaming',\n      marginRight: 0,\n      color: theme.colors.success.text,\n\n      '&:hover': {\n        color: theme.colors.success.text,\n      },\n    }),\n    title: css({\n      label: 'panel-title',\n      marginBottom: 0, // override default h6 margin-bottom\n      padding: theme.spacing(0, padding),\n      textOverflow: 'ellipsis',\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      fontSize: theme.typography.h6.fontSize,\n      fontWeight: theme.typography.h6.fontWeight,\n    }),\n    items: css({\n      display: 'flex',\n    }),\n    item: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    }),\n    hiddenMenu: css({\n      visibility: 'hidden',\n    }),\n    menuItem: css({\n      label: 'panel-menu',\n      border: 'none',\n      background: theme.colors.secondary.main,\n      '&:hover': {\n        background: theme.colors.secondary.shade,\n      },\n    }),\n    errorContainerFloating: css({\n      label: 'error-container',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      zIndex: theme.zIndex.tooltip,\n    }),\n    rightActions: css({\n      display: 'flex',\n      padding: theme.spacing(0, padding),\n      gap: theme.spacing(1),\n    }),\n    rightAligned: css({\n      label: 'right-aligned-container',\n      marginLeft: 'auto',\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    titleItems: css({\n      display: 'flex',\n      height: '100%',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, LoadingState } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { ReactNode } from 'react';\n\nimport { GrafanaPanelBox } from './GrafanaPanelBox/GrafanaPanelBox';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  panelWrap: css`\n    margin-bottom: ${theme.spacing(1)};\n  `,\n});\n\ntype PanelProps = {\n  isLoading: boolean;\n  title?: ReactNode;\n  description?: ReactNode;\n  children: ReactNode;\n  className?: string;\n  headerActions?: ReactNode;\n  dataTestId?: string;\n};\n\nexport function Panel({\n  isLoading,\n  title,\n  description,\n  children,\n  className = '',\n  headerActions,\n  dataTestId,\n}: PanelProps) {\n  const s = useStyles2(getStyles);\n\n  const loadingState = isLoading ? LoadingState.Loading : LoadingState.Done;\n\n  return (\n    <div className={`${className} ${s.panelWrap}`} data-testid={dataTestId || 'panel'}>\n      <GrafanaPanelBox\n        loadingState={loadingState}\n        title={title as unknown as string}\n        description={description as unknown as string}\n        actions={headerActions}\n      >\n        {children}\n      </GrafanaPanelBox>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { IconName } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React, { ReactNode } from 'react';\n\nimport { useFetchLlmPluginStatus } from './infrastructure/useFetchLlmPluginStatus';\n\ntype AIButtonProps = {\n  children: ReactNode;\n  onClick: (event: React.MouseEvent<HTMLButtonElement>) => void;\n  disabled?: boolean;\n  interactionName: 'g_pyroscope_app_explain_flamegraph_clicked' | 'g_pyroscope_app_optimize_code_clicked';\n};\n\nexport function AIButton({ children, onClick, disabled, interactionName }: AIButtonProps) {\n  const styles = useStyles2(getStyles);\n  const { isEnabled, error, isFetching } = useFetchLlmPluginStatus();\n\n  let icon: IconName = 'ai';\n  let tooltip = '';\n\n  if (isFetching) {\n    icon = 'fa fa-spinner';\n    tooltip = 'Checking the status of the Grafana LLM plugin...';\n  } else if (error) {\n    icon = 'exclamation-triangle';\n    tooltip = 'Error while checking the status of the Grafana LLM plugin!';\n  } else if (!isEnabled) {\n    icon = 'shield-exclamation';\n    tooltip = 'Grafana LLM plugin missing or not configured! Please check the plugins administration page.';\n  }\n\n  return (\n    <Button\n      className={styles.aiButton}\n      size=\"md\"\n      fill=\"text\"\n      icon={icon}\n      disabled={!isEnabled || disabled}\n      tooltip={tooltip}\n      tooltipPlacement=\"top\"\n      onClick={(event: React.MouseEvent<HTMLButtonElement>) => {\n        reportInteraction(interactionName);\n        onClick(event);\n      }}\n    >\n      {children}\n    </Button>\n  );\n}\n\nconst getStyles = () => ({\n  aiButton: css`\n    padding: 0 4px;\n  `,\n});\n","import { openai } from '@grafana/llm';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { useQuery } from '@tanstack/react-query';\n\nexport function useFetchLlmPluginStatus() {\n  const { data, isFetching, error } = useQuery({\n    queryKey: ['llm'],\n    queryFn: () => openai.enabled(),\n  });\n\n  if (error) {\n    logger.error(error, { info: 'Error while checking the status of the Grafana LLM plugin!' });\n  }\n\n  return { isEnabled: Boolean(data), isFetching, error };\n}\n","import { css } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport Markdown from 'markdown-to-jsx';\nimport React, { ReactNode } from 'react';\n\nimport { OpenAiReply } from '../domain/useOpenAiChatCompletions';\n\n// yeah, I know...\nconst setNativeValue = (element: Element, value: string) => {\n  const valueSetter = Object!.getOwnPropertyDescriptor(element, 'value')!.set;\n  const prototypeValueSetter = Object!.getOwnPropertyDescriptor(Object.getPrototypeOf(element), 'value')!.set;\n\n  if (valueSetter && valueSetter !== prototypeValueSetter) {\n    prototypeValueSetter!.call(element, value);\n  } else {\n    valueSetter!.call(element, value);\n  }\n};\n\nconst onClickSearchTerm = (event: any) => {\n  const searchInputElement = document.querySelector('[placeholder^=\"Search\"]');\n\n  if (searchInputElement === null) {\n    logger.error(new Error('Cannot find search input element!'));\n    return;\n  }\n\n  const value = event.target.textContent.trim();\n\n  setNativeValue(searchInputElement, value);\n\n  searchInputElement.dispatchEvent(new Event('input', { bubbles: true }));\n};\n\nconst SearchTerm = ({ children }: { children: ReactNode }) => {\n  const styles = useStyles2(getStyles);\n\n  // If the code block contains newlines, don't make it a search link\n  if (typeof children === 'string' && children.includes('\\n')) {\n    return <code>{children}</code>;\n  }\n\n  return (\n    <code className={styles.searchLink} title=\"Search for this node\" onClick={onClickSearchTerm}>\n      {children}\n    </code>\n  );\n};\n\nconst MARKDOWN_OPTIONS = {\n  overrides: {\n    code: {\n      component: SearchTerm,\n    },\n  },\n};\n\ntype AiReplyProps = {\n  reply: OpenAiReply['reply'];\n};\n\nexport function AiReply({ reply }: AiReplyProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      {reply?.messages\n        ?.filter((message) => message.role !== 'system')\n        .map((message) => (\n          <>\n            <div className={styles.reply}>\n              <Markdown options={MARKDOWN_OPTIONS}>{message.content || ''}</Markdown>\n            </div>\n            <hr />\n          </>\n        ))}\n\n      <div className={styles.reply}>\n        <Markdown options={MARKDOWN_OPTIONS}>{reply.text}</Markdown>\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = () => ({\n  container: css`\n    width: 100%;\n    height: 100%;\n  `,\n  reply: css`\n    font-size: 13px;\n\n    & ol,\n    & ul {\n      margin: 0 0 16px 24px;\n    }\n  `,\n  searchLink: css`\n    color: rgb(255, 136, 51);\n    border: 1px solid transparent;\n    padding: 2px 4px;\n    cursor: pointer;\n    font-size: 13px;\n\n    &:hover,\n    &:focus,\n    &:active {\n      box-sizing: border-box;\n      border: 1px solid rgb(255, 136, 51, 0.8);\n      border-radius: 4px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { Button, TextArea, useStyles2 } from '@grafana/ui';\nimport React, { KeyboardEvent, useCallback, useState } from 'react';\n\nconst getStyles = () => ({\n  textarea: css`\n    margin-bottom: 8px;\n  `,\n  sendButton: css`\n    float: right;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  `,\n});\n\ntype FollowUpFormProps = {\n  onSubmit: (question: string) => void;\n};\n\nfunction useFollowUpForm(onSubmit: FollowUpFormProps['onSubmit']) {\n  const [question, setQuestion] = useState('');\n\n  const onChangeInput = useCallback((event: any) => {\n    setQuestion(event.target.value);\n  }, []);\n\n  const onClickSend = useCallback(() => {\n    const questionToSend = question.trim();\n    if (!questionToSend) {\n      return;\n    }\n\n    onSubmit(questionToSend);\n\n    setQuestion('');\n  }, [question, onSubmit]);\n\n  return {\n    question,\n    onChangeInput,\n    onClickSend,\n  };\n}\n\nexport function FollowUpForm({ onSubmit }: FollowUpFormProps) {\n  const styles = useStyles2(getStyles);\n  const { question, onChangeInput, onClickSend } = useFollowUpForm(onSubmit);\n\n  const onKeyDown = (event: KeyboardEvent<HTMLTextAreaElement>) => {\n    if (event.code === 'Enter' && !event.shiftKey) {\n      onClickSend();\n    }\n  };\n\n  return (\n    <div>\n      <TextArea\n        className={styles.textarea}\n        placeholder=\"Ask a follow-up question...\"\n        value={question}\n        onChange={onChangeInput}\n        onKeyDown={onKeyDown}\n      />\n\n      <Button className={styles.sendButton} onClick={onClickSend}>\n        Send\n      </Button>\n    </div>\n  );\n}\n","/* https://platform.openai.com/docs/models/overview */\n\nexport const model = 'gpt-4-1106-preview';\n\n/* https://platform.openai.com/docs/guides/prompt-engineering/tactics */\n\nenum PromptCategories {\n  system = 'system',\n  user = 'user',\n}\n\ntype Prompts = Record<string, (profileType: string, profiles: string[]) => string>;\n\nconst prompts: Record<PromptCategories, Prompts> = {\n  system: {\n    // add new system prompts above\n    empty: () => `\n    You are a performance profiling expert and excel at analyzing profiles in the DOT format.\n    In the DOT format, a row like N47 -> N61 means the function from N47 called the function from N61.\n`,\n  },\n  user: {\n    // add new user prompts above\n    single: (profileType: string, profiles: string[]) => `\n    Analyze this flamegraph in DOT format and address these key aspects:\n    - **Performance Bottleneck**: Identify the primary factors slowing down the process, consuming excessive memory, or causing a bottleneck in the system.\n    - **Root Cause**: Explain clearly why these bottlenecks are occurring.\n    - **Recommended Fix**: Suggest practical solutions for these issues.\n\n    Guidelines:\n    - Always use full function names without splitting them from package names.\n    - Exclude numeric values, percentages, and node names (e.g., N1, N3, Node 1, Node 2).\n    - Focus on user code over low-level runtime optimizations.\n    - For standard library or runtime functions, explain their presence/function and link them to user code functions calling them. Avoid repetitive mentions from the same call chain.\n    - Do not mention that the flamegraph profile is in DOT format.\n    - Only use h5 and h6 markdown headers (e.g., ##### Performance Bottleneck, ###### Recommended Fix)\n    - Do not use h1,h2,h3,h4 headers (e.g., ## Bottleneck, ### Root Cause, #### Recommended Fix)\n\n    Format the response using markdown headers for each section corresponding to the key aspects.\n\n    The profile type is: ${profileType}\n    Profile in DOT format:\n    ${profiles[0]}\n`,\n    anton: (profileType: string, profiles: string[]) => `\nGive me actionable feedback and suggestions on how I improve the application performance.\n\nDo not break function names.\nDo not show any numeric values, absolute or percents.\nDo not show node names like N1, N3, or Node 1, Node 2.\nDo not suggest low-level runtime optimisations, focus on the user code.\n\nAlways use full function names.\nNever split function and package name.\n\nRemove any numeric values, absolute or percents, from the output.\nRemove node names like N1, N3, or Node 1, Node 2 from the output.\n\nIf the function is widely known (e.g., a runtime or stdlib function), provide me concise explanation why the function is present in the profile and what could be the cause.\nIf a function is defined in the runtime or in the standard library, tell me which function in the user code calls it.\nAvoid mentioning functions from the same call-chain.\n\n5 suggestions is enough.\nThe profile type is ${profileType}\nBelow is the performance profile in DOT format:\n${profiles[0]}\n`,\n    diff: (profileType: string, profiles: string[]) => `\nAnalyze the differences between these two performance profiles presented in DOT format. Provide a detailed comparison focusing on the following aspects:\n\n- Performance Change: Determine how the performance has changed from the first profile to the second. Identify if there are new bottlenecks, improved or worsened performance areas, or significant changes in resource consumption.\n- Function Impact: Highlight no more than 3 specific functions that have undergone notable changes in their performance impact. Discuss any new functions that have appeared in the second profile or any existing functions that have significantly increased or decreased in resource usage.\n- Potential Causes: Discuss the possible reasons for these changes in performance, linking them to the differences in function execution or resource usage between the two profiles.\n\nGuidelines for Analysis:\n- Use full function names without separating them from their package names\n- Focus on user code rather than low-level runtime optimizations or standard library functions unless they are directly relevant to the user code's performance changes\n- Exclude numeric values, percentages, and node names (e.g., N1, N3, Node 1, Node 2) from the analysis\n- Format the response using markdown headers for each section to structure the analysis clearly\n\nThe profile type is: ${profileType}\n\nFirst performance profile in DOT format:\n${profiles[0]}\n\nSecond performance profile in DOT format:\n${profiles[1]}\n`,\n  },\n};\n\nexport const buildPrompts = ({\n  system,\n  user,\n  profileType,\n  profiles,\n}: {\n  system: string;\n  user: string;\n  profileType: string;\n  profiles: string[];\n}) => {\n  const systemPrompt = prompts.system[system];\n\n  if (typeof systemPrompt !== 'function') {\n    throw new Error(`Cannot find system prompt \"${system}\"!`);\n  }\n\n  const userPrompt = prompts.user[user];\n\n  if (typeof userPrompt !== 'function') {\n    throw new Error(`Cannot find user prompt \"${user}\"!`);\n  }\n\n  return {\n    system: systemPrompt(profileType, profiles),\n    user: userPrompt(profileType, profiles),\n  };\n};\n","import { TimeRange } from '@grafana/data';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\nimport { DataSourceProxyClient } from '../series/http/DataSourceProxyClient';\n\ntype DiffProfileResponse = string | FlamebearerProfile;\n\ntype GetParams = {\n  query: string;\n  timeRange: TimeRange;\n  format: 'dot' | 'json';\n  maxNodes: number;\n};\n\nexport class ProfileApiClient extends DataSourceProxyClient {\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async get(params: GetParams): Promise<DiffProfileResponse> {\n    const searchParams = new URLSearchParams({\n      query: params.query,\n      from: String(params.timeRange.from.unix() * 1000),\n      until: String(params.timeRange.to.unix() * 1000),\n      format: params.format,\n    });\n\n    if (params.maxNodes) {\n      searchParams.set('max-nodes', String(params.maxNodes));\n    }\n\n    const response = await this.fetch(`/pyroscope/render?${searchParams.toString()}`);\n\n    switch (params.format) {\n      case 'dot':\n        return response.text();\n\n      case 'json':\n        return response.json();\n\n      default:\n        throw new TypeError(`Unknown format \"${params.format}\"!`);\n    }\n  }\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Alert, Button, IconButton, Spinner, useStyles2 } from '@grafana/ui';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport React from 'react';\n\nimport { ProfilesDataSourceVariable } from '../../domain/variables/ProfilesDataSourceVariable';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { AiReply } from './components/AiReply';\nimport { FollowUpForm } from './components/FollowUpForm';\nimport { useOpenAiChatCompletions } from './domain/useOpenAiChatCompletions';\nimport { FetchParams, useFetchDotProfiles } from './infrastructure/useFetchDotProfiles';\n\ninterface SceneAiPanelState extends SceneObjectState {}\n\nexport class SceneAiPanel extends SceneObjectBase<SceneAiPanelState> {\n  constructor() {\n    super({ key: 'ai-panel' });\n  }\n\n  validateFetchParams(isDiff: boolean, fetchParams: FetchParams) {\n    let params = fetchParams;\n    let error;\n\n    if (isDiff && fetchParams.length !== 2) {\n      error = new Error(\n        `Invalid number of fetch parameters for analyzing the diff flame graph (${fetchParams.length})!`\n      );\n      params = [];\n    } else if (!isDiff && fetchParams.length !== 1) {\n      error = new Error(`Invalid number of fetch parameters for analyzing the flame graph (${fetchParams.length})!`);\n      params = [];\n    }\n\n    return { params, error };\n  }\n\n  useSceneAiPanel = (isDiff: boolean, fetchParams: FetchParams): DomainHookReturnValue => {\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n\n    const { params, error: validationError } = this.validateFetchParams(isDiff, fetchParams);\n\n    const { error: fetchError, isFetching, profiles } = useFetchDotProfiles(dataSourceUid, params);\n\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const profileType = getProfileMetric(profileMetricId as ProfileMetricId).type;\n\n    const { reply, error: llmError, retry } = useOpenAiChatCompletions(profileType, profiles);\n\n    return {\n      data: {\n        validationError,\n        isLoading: isFetching || (!isFetching && !fetchError && !llmError && !reply.text.trim()),\n        fetchError,\n        llmError,\n        reply,\n        shouldDisplayReply: Boolean(reply?.hasStarted || reply?.hasFinished),\n        shouldDisplayFollowUpForm: !fetchError && !llmError && Boolean(reply?.hasFinished),\n      },\n      actions: {\n        retry,\n        submitFollowupQuestion(question: string) {\n          reply.askFollowupQuestion(question);\n        },\n      },\n    };\n  };\n\n  static Component = ({\n    model,\n    isDiff,\n    fetchParams,\n    onClose,\n  }: SceneComponentProps<SceneAiPanel> & {\n    isDiff: boolean;\n    fetchParams: FetchParams;\n    onClose: () => void;\n  }) => {\n    const styles = useStyles2(getStyles);\n    const { data, actions } = model.useSceneAiPanel(isDiff, fetchParams);\n\n    return (\n      <Panel\n        className={styles.sidePanel}\n        title=\"Flame graph analysis\"\n        isLoading={data.isLoading}\n        headerActions={\n          <IconButton\n            title=\"Close panel\"\n            name=\"times-circle\"\n            variant=\"secondary\"\n            aria-label=\"close\"\n            onClick={onClose}\n          />\n        }\n        dataTestId=\"ai-panel\"\n      >\n        <div className={styles.content}>\n          {data.validationError && (\n            <InlineBanner severity=\"error\" title=\"Validation error!\" error={data.validationError} />\n          )}\n\n          {data.fetchError && (\n            <InlineBanner\n              severity=\"error\"\n              title=\"Error while loading profile data!\"\n              message=\"Sorry for any inconvenience, please try again later.\"\n              error={data.fetchError}\n            />\n          )}\n\n          {data.shouldDisplayReply && <AiReply reply={data.reply} />}\n\n          {data.isLoading && (\n            <>\n              <Spinner inline />\n              &nbsp;Analyzing...\n            </>\n          )}\n\n          {data.llmError && (\n            <Alert title=\"An error occured while generating content using OpenAI!\" severity=\"warning\">\n              <div>\n                <div>\n                  <p>{data.llmError.message}</p>\n                  <p>\n                    Sorry for any inconvenience, please retry or if the problem persists, contact your organization\n                    admin.\n                  </p>\n                </div>\n              </div>\n              <Button className={styles.retryButton} variant=\"secondary\" fill=\"outline\" onClick={() => actions.retry()}>\n                Retry\n              </Button>\n            </Alert>\n          )}\n\n          {data.shouldDisplayFollowUpForm && <FollowUpForm onSubmit={actions.submitFollowupQuestion} />}\n        </div>\n      </Panel>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  sidePanel: css`\n    flex: 1 0 50%;\n    margin-left: 8px;\n    max-width: calc(50% - 4px);\n  `,\n  title: css`\n    margin: -4px 0 4px 0;\n  `,\n  content: css`\n    padding: ${theme.spacing(1)};\n  `,\n  retryButton: css`\n    float: right;\n  `,\n});\n","import { TimeRange } from '@grafana/data';\nimport { useQuery } from '@tanstack/react-query';\n\nimport { ProfileApiClient } from '../../../infrastructure/profiles/ProfileApiClient';\nimport { DataSourceProxyClientBuilder } from '../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { cleanupDotResponse } from './cleanupDotResponse';\n\nexport type FetchParams = Array<{\n  query: string;\n  timeRange: TimeRange;\n}>;\n\nconst MAX_NODES = 100;\n\nexport function useFetchDotProfiles(dataSourceUid: string, fetchParams: FetchParams) {\n  const profileApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, ProfileApiClient);\n\n  const { isFetching, error, data } = useQuery({\n    queryKey: [\n      'dot-profiles',\n      dataSourceUid,\n      ...fetchParams.flatMap(({ query, timeRange }) => [query, timeRange.from.unix(), timeRange.to.unix()]),\n      MAX_NODES,\n    ],\n    queryFn: () => {\n      // TODO: pass a signal options to properly abort all in-flight requests\n      return Promise.all(\n        fetchParams.map(({ query, timeRange }) =>\n          profileApiClient\n            .get({ query, timeRange, format: 'dot', maxNodes: MAX_NODES })\n            .then((response) => cleanupDotResponse(response as string))\n        )\n      );\n    },\n  });\n\n  return {\n    isFetching,\n    error,\n    profiles: data || [],\n  };\n}\n","export function cleanupDotResponse(profile: string): string {\n  return profile\n    .replace(/fontsize=\\d+ /g, '')\n    .replace(/id=\"node\\d+\" /g, '')\n    .replace(/labeltooltip=\".*\\)\" /g, '')\n    .replace(/tooltip=\".*\\)\" /g, '')\n    .replace(/(N\\d+ -> N\\d+).*/g, '$1')\n    .replace(/N\\d+ \\[label=\"other.*\\n/, '')\n    .replace(/shape=box /g, '')\n    .replace(/fillcolor=\"#\\w{6}\"/g, '')\n    .replace(/color=\"#\\w{6}\" /g, '');\n}\n","import { openai } from '@grafana/llm';\nimport { useCallback, useEffect, useState } from 'react';\nimport { SubscriptionLike } from 'rxjs';\n\nimport { buildPrompts, model } from './buildLlmPrompts';\n\ntype Messages = openai.Message[];\n\nexport type OpenAiReply = {\n  reply: {\n    text: string;\n    hasStarted: boolean;\n    hasFinished: boolean;\n    messages: Messages;\n    askFollowupQuestion: (question: string) => void;\n  };\n  retry: () => void;\n  error: Error | null;\n};\n\nexport function useOpenAiChatCompletions(profileType: string, profiles: string[]): OpenAiReply {\n  const [reply, setReply] = useState('');\n  const [replyHasStarted, setReplyHasStarted] = useState(false);\n  const [replyHasFinished, setReplyHasFinished] = useState(false);\n  const [messages, setMessages] = useState<Messages>([]);\n  const [error, setError] = useState<Error | null>(null);\n  const [subscription, setSubscription] = useState<SubscriptionLike>();\n\n  const sendMessages = useCallback((messagesToSend: Messages) => {\n    setMessages(messagesToSend);\n\n    setError(null);\n\n    setReply('');\n    setReplyHasStarted(true);\n    setReplyHasFinished(false);\n\n    const stream = openai\n      .streamChatCompletions({\n        model,\n        messages: messagesToSend,\n      })\n      .pipe(\n        // Accumulate the stream content into a stream of strings, where each\n        // element contains the accumulated message so far.\n        openai.accumulateContent()\n      );\n\n    const subscription = stream.subscribe({\n      next: setReply,\n      error(e) {\n        setError(e);\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n        setSubscription(undefined);\n      },\n      complete() {\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n        setSubscription(undefined);\n      },\n    });\n\n    setSubscription(subscription);\n  }, []);\n\n  const askFollowupQuestion = useCallback(\n    (question: string): void => {\n      const messagesToAdd: Messages = [\n        {\n          role: 'assistant',\n          content: reply,\n        },\n        {\n          role: 'user',\n          content: question,\n        },\n      ];\n\n      try {\n        sendMessages([...messages, ...messagesToAdd]);\n      } catch (error) {\n        setError(error as Error);\n      }\n    },\n    [messages, reply, sendMessages]\n  );\n\n  useEffect(() => {\n    if (!profiles.length || messages.length > 0) {\n      return;\n    }\n\n    const prompts = buildPrompts({\n      system: 'empty',\n      user: profiles.length === 2 ? 'diff' : 'single',\n      profileType,\n      profiles,\n    });\n\n    try {\n      sendMessages([\n        {\n          role: 'system',\n          content: prompts.system,\n        },\n        {\n          role: 'system',\n          content: prompts.user,\n        },\n      ]);\n    } catch (error) {\n      setError(error as Error);\n    }\n  }, [messages.length, profileType, profiles, profiles.length, sendMessages]);\n\n  useEffect(() => {\n    return () => {\n      if (subscription) {\n        subscription.unsubscribe();\n        setSubscription(undefined);\n      }\n    };\n  }, [subscription]);\n\n  return {\n    reply: {\n      text: reply,\n      hasStarted: replyHasStarted,\n      hasFinished: replyHasFinished,\n      messages: messages,\n      askFollowupQuestion,\n    },\n    retry() {\n      if (messages.length > 0) {\n        try {\n          sendMessages(messages);\n        } catch (error) {\n          setError(error as Error);\n        }\n      }\n    },\n    error,\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventDiffAutoSelectPayload {\n  wholeRange: boolean;\n}\n\nexport class EventDiffAutoSelect extends BusEventWithPayload<EventDiffAutoSelectPayload> {\n  public static type = 'diff-auto-select';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventDiffChoosePresetPayload {}\n\nexport class EventDiffChoosePreset extends BusEventWithPayload<EventDiffChoosePresetPayload> {\n  public static type = 'diff-choose-preset';\n}\n","import { displayWarning } from '@shared/domain/displayStatus';\nimport { DEFAULT_SETTINGS } from '@shared/infrastructure/settings/PluginSettings';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { useUrlSearchParams } from './useUrlSearchParams';\n\nfunction useSetDefaultMaxNodes(hasMaxNodes: boolean, setMaxNodes: (newMaxNodes: number) => void) {\n  const { isFetching, error, settings } = useFetchPluginSettings({ enabled: !hasMaxNodes });\n\n  if (hasMaxNodes || isFetching) {\n    return;\n  }\n\n  if (error) {\n    displayWarning([\n      'Error while retrieving the plugin settings!',\n      'Some features might not work as expected (e.g. flame graph max nodes). Please try to reload the page, sorry for the inconvenience.',\n    ]);\n    logger.error(error);\n\n    setMaxNodes(DEFAULT_SETTINGS.maxNodes);\n\n    return;\n  }\n\n  setMaxNodes(settings!.maxNodes);\n}\n\nexport function useMaxNodesFromUrl(): [number | null, (newMaxNodes: number) => void] {\n  const { searchParams, pushNewUrl } = useUrlSearchParams();\n  const maxNodes = Number(searchParams.get('maxNodes') ?? '');\n\n  const setMaxNodes = (newMaxNodes: number) => {\n    pushNewUrl({ maxNodes: String(newMaxNodes) });\n  };\n\n  useSetDefaultMaxNodes(maxNodes > 0, setMaxNodes);\n\n  return [maxNodes, setMaxNodes];\n}\n","import { useLocation, useNavigate } from 'react-router-dom';\n\nexport function useUrlSearchParams() {\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  return {\n    searchParams: new URLSearchParams(location.search),\n    pushNewUrl: (newParams: Record<string, string>) => {\n      const newSearchParams = new URLSearchParams(window.location.search);\n\n      for (const [key, value] of Object.entries(newParams)) {\n        newSearchParams.set(key, value);\n      }\n\n      navigate({ search: newSearchParams.toString() }, { replace: true });\n    },\n  };\n}\n","import { TimeRange } from '@grafana/data';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\nimport { DataSourceProxyClient } from '../../../../../infrastructure/series/http/DataSourceProxyClient';\n\ntype DiffProfileResponse = FlamebearerProfile;\n\ntype GetParams = {\n  leftQuery: string;\n  leftTimeRange: TimeRange;\n  rightQuery: string;\n  rightTimeRange: TimeRange;\n  maxNodes: number | null;\n};\n\nexport class DiffProfileApiClient extends DataSourceProxyClient {\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n  }\n\n  async get(params: GetParams): Promise<DiffProfileResponse> {\n    const searchParams = new URLSearchParams({\n      leftQuery: params.leftQuery,\n      leftFrom: String(params.leftTimeRange.from.unix() * 1000),\n      leftUntil: String(params.leftTimeRange.to.unix() * 1000),\n      rightQuery: params.rightQuery,\n      rightFrom: String(params.rightTimeRange.from.unix() * 1000),\n      rightUntil: String(params.rightTimeRange.to.unix() * 1000),\n    });\n\n    if (params.maxNodes) {\n      searchParams.set('max-nodes', String(params.maxNodes));\n    }\n\n    const response = await this.fetch(`/pyroscope/render-diff?${searchParams.toString()}`);\n\n    const json = await response.json();\n\n    return json;\n  }\n}\n","import { TimeRange } from '@grafana/data';\nimport { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { useQuery } from '@tanstack/react-query';\n\nimport { DataSourceProxyClientBuilder } from '../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { DiffProfileApiClient } from './DiffProfileApiClient';\n\ntype FetchParams = {\n  enabled: boolean;\n  dataSourceUid: string;\n  baselineTimeRange: TimeRange;\n  baselineQuery: string;\n  comparisonTimeRange: TimeRange;\n  comparisonQuery: string;\n};\n\nexport function useFetchDiffProfile({\n  enabled,\n  dataSourceUid,\n  baselineTimeRange,\n  baselineQuery,\n  comparisonTimeRange,\n  comparisonQuery,\n}: FetchParams) {\n  const [maxNodes] = useMaxNodesFromUrl();\n\n  const diffProfileApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, DiffProfileApiClient);\n\n  const { isFetching, error, data, refetch } = useQuery({\n    // for UX: keep previous data while fetching -> profile does not re-render with empty panels when refreshing\n    placeholderData: (previousData) => previousData,\n    enabled: Boolean(enabled && maxNodes),\n    // eslint-disable-next-line @tanstack/query/exhaustive-deps\n    queryKey: [\n      'diff-profile',\n      dataSourceUid,\n      baselineQuery,\n      baselineTimeRange.from.unix(),\n      baselineTimeRange.to.unix(),\n      comparisonQuery,\n      comparisonTimeRange.from.unix(),\n      comparisonTimeRange.to.unix(),\n      maxNodes,\n    ],\n    queryFn: () => {\n      diffProfileApiClient.abort();\n\n      const params = {\n        leftQuery: baselineQuery,\n        leftTimeRange: baselineTimeRange,\n        rightQuery: comparisonQuery,\n        rightTimeRange: comparisonTimeRange,\n        maxNodes,\n      };\n\n      return diffProfileApiClient.get(params).then((json) => ({\n        profile: {\n          version: json.version,\n          flamebearer: json.flamebearer,\n          metadata: json.metadata,\n        },\n      }));\n    },\n  });\n\n  return {\n    isFetching,\n    error: diffProfileApiClient.isAbortError(error) ? null : error,\n    ...data,\n    refetch,\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Collapse, useStyles2 } from '@grafana/ui';\nimport DiffViewHowToImg from '@img/diff-view-how-to.gif';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport React, { useState } from 'react';\n\ntype MissingSelectionsBannerProps = {\n  onClickAutoSelect: () => void;\n  onClickChoosePreset: () => void;\n  onOpenLearnHow: () => void;\n};\n\nexport function MissingSelectionsBanner({\n  onClickAutoSelect,\n  onClickChoosePreset,\n  onOpenLearnHow,\n}: MissingSelectionsBannerProps) {\n  const styles = useStyles2(getStyles);\n\n  const [isCollapseOpen, setIsCollapseOpen] = useState(false);\n\n  const onToggleCollapse = () => {\n    if (!isCollapseOpen) {\n      onOpenLearnHow();\n    }\n    setIsCollapseOpen(!isCollapseOpen);\n  };\n\n  return (\n    <InlineBanner\n      severity=\"info\"\n      title=\"Select both the baseline and the comparison flame graph ranges to view the diff flame graph\"\n      message={\n        <div className={styles.infoMsg}>\n          <p>How?</p>\n          <p>\n            <Button variant=\"primary\" onClick={onClickAutoSelect}>\n              Auto-select\n            </Button>{' '}\n            or{' '}\n            <Button variant=\"primary\" fill=\"text\" className={styles.textButton} onClick={onClickChoosePreset}>\n              choose a preset\n            </Button>\n          </p>\n          <p>Alternatively:</p>\n          <Collapse\n            label=\"Click here to learn how to select the flame graph ranges with the mouse\"\n            collapsible\n            className={styles.collapse}\n            isOpen={isCollapseOpen}\n            onToggle={onToggleCollapse}\n          >\n            <div className={styles.collapseContent}>\n              <ol>\n                <li>Ensure that the &ldquo;Flame graph&rdquo; range selection mode is selected</li>\n                <li>\n                  Use your mouse to select the desired time ranges on both the baseline and the comparison time series\n                </li>\n              </ol>\n              <img src={DiffViewHowToImg} alt=\"How to view the diff flame graph\" />\n            </div>\n          </Collapse>\n        </div>\n      }\n    />\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  infoMsg: css`\n    padding: ${theme.spacing(2)} 0 0 0;\n  `,\n  textButton: css`\n    padding: 0;\n  `,\n  collapse: css`\n    background: transparent;\n    border: 0;\n  `,\n  collapseContent: css`\n    padding: 0 ${theme.spacing(5)};\n\n    & img {\n      max-width: 100%;\n      width: auto;\n      margin-top: ${theme.spacing(2)};\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport { FlameGraph } from '@shared/components/FlameGraph/FlameGraph';\nimport { displayWarning } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { useToggleSidePanel } from '@shared/domain/useToggleSidePanel';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport { PyroscopeLogo } from '@shared/ui/PyroscopeLogo';\nimport React, { useEffect, useMemo } from 'react';\n\nimport { useBuildPyroscopeQuery } from '../../../../domain/useBuildPyroscopeQuery';\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { getSceneVariableValue } from '../../../../helpers/getSceneVariableValue';\nimport { AIButton } from '../../../SceneAiPanel/components/AiButton/AIButton';\nimport { SceneAiPanel } from '../../../SceneAiPanel/SceneAiPanel';\nimport { EventDiffAutoSelect } from '../../domain/events/EventDiffAutoSelect';\nimport { EventDiffChoosePreset } from '../../domain/events/EventDiffChoosePreset';\nimport { SceneExploreDiffFlameGraph } from '../../SceneExploreDiffFlameGraph';\nimport { useFetchDiffProfile } from './infrastructure/useFetchDiffProfile';\nimport { MissingSelectionsBanner } from './ui/MissingSelectionsBanner';\n\ninterface SceneDiffFlameGraphState extends SceneObjectState {\n  aiPanel: SceneAiPanel;\n}\n\nexport class SceneDiffFlameGraph extends SceneObjectBase<SceneDiffFlameGraphState> {\n  constructor() {\n    super({\n      key: 'diff-flame-graph',\n      aiPanel: new SceneAiPanel(),\n    });\n  }\n\n  buildTitle() {\n    const serviceName = getSceneVariableValue(this, 'serviceName');\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const profileMetricType = getProfileMetric(profileMetricId as ProfileMetricId).type;\n\n    return (\n      <>\n        <PyroscopeLogo size=\"small\" />\n        Diff flame graph for {serviceName} ({profileMetricType})\n      </>\n    );\n  }\n\n  useSceneDiffFlameGraph = (): DomainHookReturnValue => {\n    const { aiPanel } = this.useState();\n    const { baselineTimeRange, comparisonTimeRange } = (this.parent as SceneExploreDiffFlameGraph).useDiffTimeRanges();\n\n    const baselineQuery = useBuildPyroscopeQuery(this, 'filtersBaseline');\n    const comparisonQuery = useBuildPyroscopeQuery(this, 'filtersComparison');\n\n    const { settings, error: fetchSettingsError } = useFetchPluginSettings();\n\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n\n    const isDiffQueryEnabled = Boolean(\n      baselineQuery &&\n        comparisonQuery &&\n        // warning: sending zero parameters values to the API would make the pods crash\n        // so we enable only when we have non-zero parameters values\n        baselineTimeRange.from.unix() &&\n        baselineTimeRange.to.unix() &&\n        comparisonTimeRange.from.unix() &&\n        comparisonTimeRange.to.unix()\n    );\n\n    const {\n      isFetching,\n      error: fetchProfileError,\n      profile,\n    } = useFetchDiffProfile({\n      enabled: isDiffQueryEnabled,\n      dataSourceUid,\n      baselineTimeRange,\n      baselineQuery,\n      comparisonTimeRange,\n      comparisonQuery,\n    });\n\n    const noProfileDataAvailable =\n      isDiffQueryEnabled && !isFetching && !fetchProfileError && profile?.flamebearer.numTicks === 0;\n\n    const shouldDisplayFlamegraph = Boolean(\n      isDiffQueryEnabled && !fetchProfileError && !noProfileDataAvailable && profile\n    );\n    const hasMissingSelections = !isDiffQueryEnabled;\n\n    return {\n      data: {\n        title: this.buildTitle(),\n        isLoading: isFetching,\n        fetchProfileError,\n        noProfileDataAvailable,\n        shouldDisplayFlamegraph,\n        hasMissingSelections,\n        profile: profile as FlamebearerProfile,\n        settings,\n        fetchSettingsError,\n        ai: {\n          panel: aiPanel,\n          fetchParams: [\n            { query: baselineQuery, timeRange: baselineTimeRange },\n            { query: comparisonQuery, timeRange: comparisonTimeRange },\n          ],\n        },\n      },\n      actions: {},\n    };\n  };\n\n  onClickAutoSelect = () => {\n    reportInteraction('g_pyroscope_app_diff_auto_select_clicked');\n\n    this.publishEvent(new EventDiffAutoSelect({ wholeRange: false }), true);\n  };\n\n  onClickChoosePreset = () => {\n    reportInteraction('g_pyroscope_app_diff_choose_preset_clicked');\n\n    this.publishEvent(new EventDiffChoosePreset({}), true);\n  };\n\n  onOpenLearnHow = () => {\n    reportInteraction('g_pyroscope_app_diff_learn_how_clicked');\n  };\n\n  static Component = ({ model }: SceneComponentProps<SceneDiffFlameGraph>) => {\n    const styles = useStyles2(getStyles);\n\n    const { data } = model.useSceneDiffFlameGraph();\n    const sidePanel = useToggleSidePanel();\n\n    const isAiButtonDisabled = data.isLoading || data.hasMissingSelections || data.noProfileDataAvailable;\n\n    useEffect(() => {\n      if (isAiButtonDisabled) {\n        sidePanel.close();\n      }\n    }, [isAiButtonDisabled, sidePanel]);\n\n    if (data.fetchSettingsError) {\n      displayWarning([\n        'Error while retrieving the plugin settings!',\n        'Some features might not work as expected (e.g. flamegraph export options). Please try to reload the page, sorry for the inconvenience.',\n      ]);\n    }\n\n    const panelTitle = useMemo(\n      () => (\n        <>\n          {data.title}\n          {data.isLoading && <Spinner inline className={styles.spinner} />}\n        </>\n      ),\n      [data.isLoading, data.title, styles.spinner]\n    );\n\n    return (\n      <div className={styles.flex}>\n        <Panel\n          dataTestId=\"diff-flame-graph-panel\"\n          className={styles.flamegraphPanel}\n          title={panelTitle}\n          isLoading={data.isLoading}\n          headerActions={\n            <AIButton\n              disabled={isAiButtonDisabled || sidePanel.isOpen('ai')}\n              onClick={() => sidePanel.open('ai')}\n              interactionName=\"g_pyroscope_app_explain_flamegraph_clicked\"\n            >\n              Explain Flame Graph\n            </AIButton>\n          }\n        >\n          {data.hasMissingSelections && (\n            <MissingSelectionsBanner\n              onClickAutoSelect={model.onClickAutoSelect}\n              onClickChoosePreset={model.onClickChoosePreset}\n              onOpenLearnHow={model.onOpenLearnHow}\n            />\n          )}\n\n          {data.fetchProfileError && (\n            <InlineBanner severity=\"error\" title=\"Error while loading profile data!\" error={data.fetchProfileError} />\n          )}\n\n          {data.noProfileDataAvailable && (\n            <InlineBanner\n              severity=\"warning\"\n              title=\"No profile data available\"\n              message=\"Please verify that you've selected adequate filters and time ranges.\"\n            />\n          )}\n\n          {data.shouldDisplayFlamegraph && (\n            <FlameGraph\n              diff={true}\n              profile={data.profile}\n              enableFlameGraphDotComExport={data.settings?.enableFlameGraphDotComExport}\n              collapsedFlamegraphs={data.settings?.collapsedFlamegraphs}\n            />\n          )}\n        </Panel>\n\n        {sidePanel.isOpen('ai') && (\n          <data.ai.panel.Component\n            model={data.ai.panel}\n            isDiff\n            fetchParams={data.ai.fetchParams}\n            onClose={sidePanel.close}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flex: css`\n    display: flex;\n  `,\n  flamegraphPanel: css`\n    min-width: 0;\n    flex-grow: 1;\n  `,\n  sidePanel: css`\n    flex: 1 0 50%;\n    margin-left: 8px;\n    max-width: calc(50% - 4px);\n  `,\n  spinner: css`\n    margin-left: ${theme.spacing(1)};\n  `,\n  aiButton: css`\n    margin-top: ${theme.spacing(1)};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport const FEEDBACK_FORM_URL = 'https://grafana.qualtrics.com/jfe/form/SV_6Gav4IUU6jcYfd4';\n\n// borrowed from https://github.com/grafana/explore-logs/blob/main/src/Components/IndexScene/GiveFeedbackButton.tsx\nexport const GiveFeedbackButton = () => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.wrapper}>\n      <a\n        href={FEEDBACK_FORM_URL}\n        className={styles.feedback}\n        title=\"Share your thoughts about Profiles in Grafana.\"\n        target=\"_blank\"\n        rel=\"noreferrer noopener\"\n      >\n        <Icon name=\"comment-alt-message\" /> Give feedback\n      </a>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      justifyContent: 'flex-end',\n      paddingTop: '4px',\n    }),\n    feedback: css({\n      alignSelf: 'center',\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport {\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VariableDependencyConfig,\n} from '@grafana/scenes';\nimport { Button, Modal, Select, useStyles2 } from '@grafana/ui';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport React from 'react';\n\nimport { FEEDBACK_FORM_URL } from '../../../GiveFeedbackButton';\nimport { EventDiffAutoSelect } from '../../domain/events/EventDiffAutoSelect';\nimport { CompareTarget } from '../../domain/types';\nimport { SceneComparePanel } from '../SceneComparePanel/SceneComparePanel';\n\ninterface ScenePresetsPickerState extends SceneObjectState {\n  name: string;\n  label: string;\n  isModalOpen: boolean;\n  isSelectOpen: boolean;\n  value: string | null;\n}\n\nexport type Preset = {\n  from: string;\n  to: string;\n  diffFrom: string;\n  diffTo: string;\n  label: string;\n};\n\nexport class ScenePresetsPicker extends SceneObjectBase<ScenePresetsPickerState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: ['dataSource', 'serviceName'],\n    onReferencedVariableValueChanged: () => {\n      this.reset();\n    },\n  });\n\n  static PRESETS = [\n    {\n      label: 'Built-in presets',\n      value: 'built-in',\n      options: [\n        {\n          value: 'last hour (30m-window)',\n          label: 'Last hour (30m-window)',\n          baseline: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-1h',\n            diffTo: 'now-30m',\n            label: 'last hour',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-30m',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: 'last hour (1h-window)',\n          label: 'Last hour (1h-window)',\n          baseline: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-1h',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-1h',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: '6h ago vs now',\n          label: '6h ago vs now (30m-window)',\n          baseline: {\n            from: 'now-375m',\n            to: 'now-315m',\n            diffFrom: 'now-375m',\n            diffTo: 'now-345m',\n            label: '6h ago',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-30m',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: '24h ago vs now',\n          label: '24h ago vs now (30m-window)',\n          baseline: {\n            from: 'now-1455m',\n            to: 'now-1395m',\n            diffFrom: 'now-1455m',\n            diffTo: 'now-1425m',\n            label: '24h ago',\n          },\n          comparison: {\n            from: 'now-1h',\n            to: 'now',\n            diffFrom: 'now-30m',\n            diffTo: 'now',\n            label: 'last hour',\n          },\n        },\n        {\n          value: 'auto-select-25',\n          label: 'Auto-select (25% range)',\n        },\n        {\n          value: 'auto-select-whole',\n          label: 'Auto-select (whole range)',\n        },\n      ],\n    },\n    {\n      label: 'My presets',\n      value: 'custom',\n      options: [\n        {\n          label: 'Dummy preset saved earlier',\n          value: 'dummy',\n        },\n      ],\n    },\n  ];\n\n  constructor() {\n    super({\n      name: 'compare-presets',\n      label: 'Comparison presets',\n      value: null,\n      isModalOpen: false,\n      isSelectOpen: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    [CompareTarget.BASELINE, CompareTarget.COMPARISON].forEach((compareTarget) => {\n      this._subs.add(\n        sceneGraph\n          .findByKeyAndType(this, `${compareTarget}-panel`, SceneComparePanel)\n          .state.$timeRange.subscribeToState((newState, prevState) => {\n            if (newState.from !== prevState.from || newState.to !== prevState.to) {\n              this.setState({ value: null });\n            }\n          })\n      );\n    });\n  }\n\n  onChangePreset = (option: SelectableValue<string>) => {\n    reportInteraction('g_pyroscope_app_diff_preset_selected', { value: option.value as string });\n\n    this.closeSelect();\n\n    if (option.value === 'dummy') {\n      this.setState({ value: null, isModalOpen: true });\n      return;\n    }\n\n    if (option.value?.startsWith('auto-select-')) {\n      this.setState({ value: null });\n\n      this.publishEvent(new EventDiffAutoSelect({ wholeRange: option.value === 'auto-select-whole' }), true);\n      return;\n    }\n\n    [CompareTarget.BASELINE, CompareTarget.COMPARISON].forEach((compareTarget) => {\n      const panel = sceneGraph.findByKeyAndType(this, `${compareTarget}-panel`, SceneComparePanel);\n\n      panel.toggleTimeRangeSync(false);\n      panel.applyPreset(option[compareTarget]);\n    });\n\n    this.setState({ value: option.value });\n  };\n\n  onClickSave = () => {\n    reportInteraction('g_pyroscope_app_diff_preset_save_clicked');\n\n    this.setState({ isModalOpen: true });\n  };\n\n  closeModal = () => {\n    this.setState({ isModalOpen: false });\n  };\n\n  openSelect() {\n    this.setState({ isSelectOpen: true });\n  }\n\n  closeSelect() {\n    this.setState({ isSelectOpen: false });\n  }\n\n  onOpenSelect = () => {\n    setTimeout(() => this.openSelect(), 0);\n  };\n\n  onCloseSelect = () => {\n    this.closeSelect();\n  };\n\n  reset() {\n    this.setState({ value: null, isSelectOpen: false, isModalOpen: false });\n  }\n\n  static Component({ model }: SceneComponentProps<ScenePresetsPicker & { onChange: any }>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { value, isSelectOpen, isModalOpen } = model.useState();\n\n    return (\n      <>\n        <div className={styles.presetsContainer}>\n          <Select\n            className={styles.select}\n            placeholder=\"Choose a preset\"\n            value={value}\n            options={ScenePresetsPicker.PRESETS}\n            onChange={model.onChangePreset}\n            isOpen={isSelectOpen}\n            onOpenMenu={model.onOpenSelect}\n            onCloseMenu={model.onCloseSelect}\n          />\n\n          <Button\n            icon=\"save\"\n            variant=\"secondary\"\n            tooltip=\"Save the current time ranges and filters as a custom preset\"\n            onClick={model.onClickSave}\n          />\n        </div>\n        <Modal\n          title=\"Custom user presets\"\n          isOpen={isModalOpen}\n          closeOnEscape={true}\n          closeOnBackdropClick={true}\n          onDismiss={model.closeModal}\n        >\n          <p>\n            This feature, which would allow you to save the current time ranges and filters, is currently not\n            implemented.\n          </p>\n          <p>\n            Please let us know if you would be interested to use it by{' '}\n            <a href={FEEDBACK_FORM_URL} target=\"_blank\" rel=\"noreferrer noopener\" className={styles.link}>\n              leaving us your feedback.\n            </a>\n          </p>\n          <p>Thank you!</p>\n          <Modal.ButtonRow>\n            <Button variant=\"secondary\" fill=\"outline\" onClick={model.closeModal}>\n              Cancel\n            </Button>\n            <Button onClick={model.closeModal} disabled>\n              Save\n            </Button>\n          </Modal.ButtonRow>\n        </Modal>\n      </>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  presetsContainer: css`\n    display: flex;\n  `,\n  select: css`\n    min-width: ${theme.spacing(24)};\n    text-align: left;\n  `,\n  link: css`\n    color: ${theme.colors.text.link};\n  `,\n});\n","import { sceneGraph, SceneObject, SceneObjectState, VizPanel } from '@grafana/scenes';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { cloneDeep, merge } from 'lodash';\n\nimport { EventTimeseriesDataReceived } from '../../../../domain/events/EventTimeseriesDataReceived';\n\nexport function syncYAxis() {\n  return (vizPanel: SceneObject<SceneObjectState>) => {\n    const maxima = new Map<string, number>();\n\n    const eventSub = vizPanel.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      const s = event.payload.series?.[0];\n      const refId = s?.refId;\n\n      if (!refId) {\n        logger.warn('Missing refId! Cannot sync y-axis on the timeseries.', event.payload.series);\n        return;\n      }\n\n      maxima.set(s.refId as string, Math.max(...s.fields[1].values));\n\n      updateTimeseriesAxis(vizPanel, Math.max(...maxima.values()));\n    });\n\n    return () => {\n      eventSub.unsubscribe();\n    };\n  };\n}\n\nfunction updateTimeseriesAxis(vizPanel: SceneObject, max: number) {\n  // findAllObjects searches down the full scene graph\n  const timeseries = sceneGraph.findAllObjects(\n    vizPanel,\n    (o) => o instanceof VizPanel && o.state.pluginId === 'timeseries'\n  ) as VizPanel[];\n\n  for (const t of timeseries) {\n    t.clearFieldConfigCache(); // required\n\n    t.setState({\n      fieldConfig: merge(cloneDeep(t.state.fieldConfig), { defaults: { max } }),\n    });\n  }\n}\n","import { css } from '@emotion/css';\nimport { AdHocVariableFilter, DashboardCursorSync, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport {\n  behaviors,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneTimeRangeState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { EventEnableSyncTimeRanges } from './components/SceneComparePanel/domain/events/EventEnableSyncTimeRanges';\nimport { EventSyncRefresh } from './components/SceneComparePanel/domain/events/EventSyncRefresh';\nimport { EventSyncTimeRanges } from './components/SceneComparePanel/domain/events/EventSyncTimeRanges';\nimport { SceneComparePanel } from './components/SceneComparePanel/SceneComparePanel';\nimport { SceneDiffFlameGraph } from './components/SceneDiffFlameGraph/SceneDiffFlameGraph';\nimport { ScenePresetsPicker } from './components/ScenePresetsPicker/ScenePresetsPicker';\nimport { syncYAxis } from './domain/behaviours/syncYAxis';\nimport { EventDiffAutoSelect } from './domain/events/EventDiffAutoSelect';\nimport { EventDiffChoosePreset } from './domain/events/EventDiffChoosePreset';\nimport { CompareTarget } from './domain/types';\n\ninterface SceneExploreDiffFlameGraphState extends SceneObjectState {\n  baselinePanel: SceneComparePanel;\n  comparisonPanel: SceneComparePanel;\n  body: SceneDiffFlameGraph;\n  presetsPicker: ScenePresetsPicker;\n}\n\nexport class SceneExploreDiffFlameGraph extends SceneObjectBase<SceneExploreDiffFlameGraphState> {\n  constructor({\n    useAncestorTimeRange,\n    clearDiffRange,\n    baselineFilters,\n    comparisonFilters,\n  }: {\n    useAncestorTimeRange?: boolean;\n    clearDiffRange?: boolean;\n    baselineFilters?: AdHocVariableFilter[];\n    comparisonFilters?: AdHocVariableFilter[];\n  }) {\n    super({\n      key: 'explore-diff-flame-graph',\n      baselinePanel: new SceneComparePanel({\n        target: CompareTarget.BASELINE,\n        useAncestorTimeRange: Boolean(useAncestorTimeRange),\n        clearDiffRange: Boolean(clearDiffRange),\n        filters: baselineFilters || [],\n      }),\n      comparisonPanel: new SceneComparePanel({\n        target: CompareTarget.COMPARISON,\n        useAncestorTimeRange: Boolean(useAncestorTimeRange),\n        clearDiffRange: Boolean(clearDiffRange),\n        filters: comparisonFilters || [],\n      }),\n      $behaviors: [\n        new behaviors.CursorSync({\n          key: 'metricCrosshairSync',\n          sync: DashboardCursorSync.Crosshair,\n        }),\n        syncYAxis(),\n      ],\n      body: new SceneDiffFlameGraph(),\n      presetsPicker: new ScenePresetsPicker(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    // hack to force UrlSyncManager to handle a new location\n    // this will sync the state from the URL by calling updateFromUrl() on all the time ranges (`SceneTimeRange` and our custom `SceneTimeRangeWithAnnotations`) that are defined on `SceneComparePanel`\n    // if not, landing on this view will result in empty URL search parameters (to/from and diffTo/diffFrom) which will make shareable links useless\n    locationService.partial({}, true); // replace to avoid creating history items\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n\n    profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT });\n    profileMetricVariable.update(true);\n\n    this.subscribeToEvents();\n\n    return () => {\n      profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_DEFAULT });\n      profileMetricVariable.update(true);\n    };\n  }\n\n  subscribeToEvents() {\n    this._subs.add(\n      this.subscribeToEvent(EventDiffAutoSelect, (event) => {\n        const selectWholeRange = event.payload.wholeRange;\n        const { baselinePanel, comparisonPanel } = this.state;\n\n        baselinePanel.toggleTimeRangeSync(false);\n        comparisonPanel.toggleTimeRangeSync(false);\n\n        baselinePanel.autoSelectDiffRange(selectWholeRange);\n        comparisonPanel.autoSelectDiffRange(selectWholeRange);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventDiffChoosePreset, () => {\n        this.state.presetsPicker.openSelect();\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventEnableSyncTimeRanges, (event) => {\n        const { source, enable, timeRange, annotationTimeRange } = event.payload;\n        const { baselinePanel, comparisonPanel } = this.state;\n        const targetPanel = source === CompareTarget.BASELINE ? comparisonPanel : baselinePanel;\n\n        if (enable) {\n          this.syncTimeRanges(targetPanel, timeRange, annotationTimeRange);\n        }\n\n        comparisonPanel.toggleTimeRangeSync(enable);\n        baselinePanel.toggleTimeRangeSync(enable);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventSyncTimeRanges, (event) => {\n        const { source, timeRange, annotationTimeRange } = event.payload;\n        const { baselinePanel, comparisonPanel } = this.state;\n        const targetPanel = source === CompareTarget.BASELINE ? comparisonPanel : baselinePanel;\n\n        this.syncTimeRanges(targetPanel, timeRange, annotationTimeRange);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventSyncRefresh, (event) => {\n        const { source } = event.payload;\n        const { baselinePanel, comparisonPanel } = this.state;\n        const targetPanel = source === CompareTarget.BASELINE ? comparisonPanel : baselinePanel;\n\n        targetPanel.refreshTimeseries();\n      })\n    );\n  }\n\n  syncTimeRanges(targetPanel: SceneComparePanel, timeRange?: SceneTimeRangeState, annotationTimeRange?: TimeRange) {\n    if (timeRange) {\n      targetPanel.setTimeRange(timeRange);\n    }\n\n    if (annotationTimeRange) {\n      targetPanel.setDiffRange({\n        from: annotationTimeRange.from.toISOString(),\n        to: annotationTimeRange.to.toISOString(),\n      });\n    }\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [\n        sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable),\n        sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable),\n        this.state.presetsPicker,\n      ],\n      gridControls: [],\n    };\n  }\n\n  useDiffTimeRanges = () => {\n    const { baselinePanel, comparisonPanel } = this.state;\n\n    const { annotationTimeRange: baselineTimeRange } = baselinePanel.useDiffTimeRange();\n    const { annotationTimeRange: comparisonTimeRange } = comparisonPanel.useDiffTimeRange();\n\n    return {\n      baselineTimeRange,\n      comparisonTimeRange,\n    };\n  };\n\n  static Component({ model }: SceneComponentProps<SceneExploreDiffFlameGraph>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n\n    const { baselinePanel, comparisonPanel, body } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.columns}>\n          <baselinePanel.Component model={baselinePanel} />\n          <comparisonPanel.Component model={comparisonPanel} />\n        </div>\n\n        <body.Component model={body} />\n      </div>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n  `,\n  columns: css`\n    display: flex;\n    flex-direction: row;\n    gap: ${theme.spacing(1)};\n    margin-bottom: ${theme.spacing(1)};\n\n    & > div {\n      flex: 1 1 0;\n    }\n  `,\n});\n","import { DataSourceProxyClient } from '../../../../../infrastructure/series/http/DataSourceProxyClient';\n\ntype GithubLoginResponse = {\n  cookie: string;\n};\n\nexport class VcsClient extends DataSourceProxyClient {\n  async githubLogin(authorizationCode: string): Promise<GithubLoginResponse> {\n    const response = await this.fetch('/vcs.v1.VCSService/GithubLogin', {\n      method: 'POST',\n      body: JSON.stringify({\n        authorizationCode,\n      }),\n    });\n\n    const json = await response.json();\n\n    return json;\n  }\n\n  // TODO: return json + rename?\n  async githubApp(): Promise<string> {\n    const response = await this.fetch('/vcs.v1.VCSService/GithubApp', {\n      method: 'POST',\n      body: JSON.stringify({}),\n    });\n\n    const json = await response.json();\n\n    return json.clientID;\n  }\n}\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\n/** The maximum Unix ms timestamp that can be stored in a JS Date object. */\nconst MAX_UNIX_TS_MS = 8640000000000000;\n\n/**\n * This is a value class representing a GitSession cookie value in the browser.\n * It provides APIs to decode a GitSession cookie value and to check if the the\n * underlying user token is expired.\n */\nexport class GitSessionCookie {\n  private readonly oauthTokenMetadata: string;\n  private readonly expiry: Date;\n\n  constructor(metadata: string, expiry: number) {\n    this.oauthTokenMetadata = metadata;\n    this.expiry = new Date(expiry);\n  }\n\n  /**\n   * Checks if the session cookie is expired. If the optional `biasMs` is\n   * provided, then the expiry is biased to expire sooner by `biasMs`\n   * milliseconds.\n   *\n   * @param biasMs Offset in milliseconds\n   * @returns True if the session cookie is expired.\n   */\n  isUserTokenExpired(biasMs = 0): boolean {\n    return Date.now() >= this.expiry.getTime() - biasMs;\n  }\n\n  /**\n   * Decodes the base64 encoded value portion of a session cookie.\n   *\n   * @param value The value portion of a session cookie\n   * @returns A valid `GitSessionCookie` if the string can be decoded, otherwise\n   * undefined.\n   */\n  static decode(value: string | undefined): GitSessionCookie | undefined {\n    if (value === undefined || value === '') {\n      return undefined;\n    }\n\n    let decoded;\n    try {\n      decoded = atob(value);\n    } catch (error) {\n      logger.error(error as Error, { info: 'Failed to base64 decode GitSession value' });\n      return undefined;\n    }\n\n    const { payload, isLegacy } = GitSessionCookie.tryDecode(decoded);\n    if (isLegacy) {\n      // This is a legacy cookie value, which does not expose a plaintext\n      // expiry. The expiry is set to a maximum date value and we rely on a 401\n      // response from the server to indicate expiration.\n      return new GitSessionCookie(value, MAX_UNIX_TS_MS);\n    }\n\n    return new GitSessionCookie(payload.metadata, Number(payload.expiry));\n  }\n\n  /**\n   * Attempts to decode the plaintext value portion of a session cookie.\n   *\n   * @param input Plaintext representation of a session cookie value\n   * @returns The payload of the session cookie if it's not a legacy cookie. If\n   * it is a legacy cookie, isLegacy is set to true.\n   */\n  private static tryDecode(input: string): { payload: any; isLegacy: boolean } {\n    try {\n      const payload = JSON.parse(input);\n      return { payload, isLegacy: false };\n    } catch {\n      return { payload: undefined, isLegacy: true };\n    }\n  }\n}\n","import { GitSessionCookie } from './GitSessionCookie';\n\nconst LEGACY_GITHUB_SESSION_COOKIE_NAME = 'GitSession';\nconst GITHUB_SESSION_COOKIE_NAME = 'pyroscope_git_session';\n\nexport interface GitSessionCookieManager {\n  getCookie(): GitSessionCookie | undefined;\n  setCookie(cookie: string): void;\n  deleteCookie(): void;\n}\n\ntype Cookie = {\n  key: string;\n  value: string;\n};\n\nclass InternalGitSessionCookieManager implements GitSessionCookieManager {\n  private rawCookie: Cookie | undefined;\n  private sessionCookie: GitSessionCookie | undefined;\n\n  getCookie(): GitSessionCookie | undefined {\n    // To make sure we're using a cookie that accurately reflects the browser\n    // state, let's be paranoid and make sure our cached cookie is accurate.\n    this.syncCookieWithBrowser();\n    return this.sessionCookie;\n  }\n\n  setCookie(cookie: string): void {\n    if (!cookie.startsWith(`${GITHUB_SESSION_COOKIE_NAME}=`)) {\n      cookie = `${GITHUB_SESSION_COOKIE_NAME}=${cookie}`;\n    }\n\n    const rawCookie = InternalGitSessionCookieManager.getCookieFromJar(cookie, GITHUB_SESSION_COOKIE_NAME);\n    if (rawCookie === undefined) {\n      // If we can't parse the key-value pair out of [cookie], let's return now\n      // to avoid corrupting the state of the manager or browser cookie.\n      return;\n    }\n\n    this.deleteLegacyCookie();\n    this.rawCookie = rawCookie;\n    this.sessionCookie = GitSessionCookie.decode(rawCookie.value);\n    document.cookie = `${cookie}; path=/`;\n  }\n\n  deleteCookie(): void {\n    document.cookie = `${GITHUB_SESSION_COOKIE_NAME}=; Path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`;\n    this.deleteLegacyCookie();\n    this.rawCookie = undefined;\n    this.sessionCookie = undefined;\n  }\n\n  private deleteLegacyCookie(): void {\n    document.cookie = `${LEGACY_GITHUB_SESSION_COOKIE_NAME}=; Path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`;\n  }\n\n  private syncCookieWithBrowser(): void {\n    const cookie = InternalGitSessionCookieManager.getCookieFromJar(document.cookie, GITHUB_SESSION_COOKIE_NAME);\n    if (cookie?.key === this.rawCookie?.key && cookie?.value === this.rawCookie?.value) {\n      return;\n    }\n\n    cookie !== undefined ? this.setCookie(`${cookie.key}=${cookie.value}`) : this.deleteCookie();\n  }\n\n  private static getCookieFromJar(jar: string, name: string): Cookie | undefined {\n    return jar\n      .split(';')\n      .map((ck) => {\n        // Just doing split('=') results in the trailing padding to be dropped.\n        // While `btoa` seems to handle this case without problem, being\n        // pedantic with padding isn't a bad thing. Doing this song and dance\n        // allows us to keep the trailing padding.\n        const [key, ...rest] = ck.trim().split('=');\n        const value = rest.join('=');\n        return { key: key.trim(), value: value?.trim() };\n      })\n      .find(({ key }) => key === name);\n  }\n}\n\nexport const gitSessionCookieManager: GitSessionCookieManager = new InternalGitSessionCookieManager();\n","import { config } from '@grafana/runtime';\n\nimport { PLUGIN_BASE_URL, ROUTES } from '../../../../../../../../../constants';\n\nfunction stripTrailingSlash(str: string): string {\n  return str.endsWith('/') ? str.slice(0, -1) : str;\n}\n\nfunction buildGitHubAuthURL(clientID: string, nonce: string): string {\n  const appSubUrl = stripTrailingSlash(config.appSubUrl || '/');\n  const redirectUri = `${window.location.origin}${appSubUrl}${PLUGIN_BASE_URL}${ROUTES.GITHUB_CALLBACK}`;\n\n  const url = new URL('/login/oauth/authorize', 'https://github.com');\n  url.searchParams.set('client_id', clientID);\n  url.searchParams.set('scope', 'repo');\n  url.searchParams.set(\n    'state',\n    btoa(\n      JSON.stringify({\n        redirect_uri: redirectUri,\n        nonce,\n      })\n    )\n  );\n\n  return url.toString();\n}\n\nconst POPUP_WIDTH = 800;\nconst POPUP_HEIGHT = 950;\n\nexport function openLoginPopup(clientId: string, nonce: string): Window | null {\n  const oauthURL = buildGitHubAuthURL(clientId, nonce);\n\n  const { top } = window;\n  const x = (top?.outerWidth ?? 0) / 2 + (top?.screenX ?? 0) - POPUP_WIDTH / 2;\n  const y = (top?.outerHeight ?? 0) / 2 + (top?.screenY ?? 0) - POPUP_HEIGHT / 2;\n\n  return window.open(\n    oauthURL,\n    'GitHub Login',\n    `toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=${POPUP_WIDTH}, height=${POPUP_HEIGHT}, top=${y}, left=${x}`\n  );\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport React from 'react';\n\nimport { VcsClient } from '../../../infrastructure/VcsClient';\nimport { PrivateVcsClient } from '../../GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { nonce } from '../GitHubContextProvider';\nimport { GitSessionCookie } from '../infrastructure/GitSessionCookie';\nimport { gitSessionCookieManager } from '../infrastructure/GitSessionCookieManager';\nimport { openLoginPopup } from './openLoginPopup';\n\nexport async function githubLogin(\n  vcsClient: VcsClient,\n  privateVcsClient: PrivateVcsClient,\n  sessionCookie: GitSessionCookie | undefined,\n  externalWindow: Window | null | undefined,\n  setExternalWindow: React.Dispatch<React.SetStateAction<Window | null | undefined>>\n): Promise<void> {\n  if (externalWindow) {\n    externalWindow.close();\n  }\n\n  if (sessionCookie?.isUserTokenExpired()) {\n    // A session already exists, but it's expired. Refresh the session.\n    try {\n      await privateVcsClient.refresh();\n      return;\n    } catch (error) {\n      // This error isn't fatal and we can recover from it by restarting the\n      // oauth login flow.\n      logger.error(error as Error, { info: 'Failed to refresh GitHub user token' });\n\n      // Failed to refresh the token. Delete the old token and enter the\n      // follow login flow to get a completely new token.\n      gitSessionCookieManager.deleteCookie();\n    }\n  }\n\n  // No session cookie exists, begin the complete login flow.\n  try {\n    const clientId = await vcsClient.githubApp();\n    setExternalWindow(openLoginPopup(clientId, nonce));\n  } catch (error) {\n    displayError(error as Error, ['Failed to start login flow.', (error as Error).message]);\n  }\n}\n","import { VcsClient } from '../../../infrastructure/VcsClient';\n\nexport async function authFromUrl(\n  vcsClient: VcsClient,\n  urlSearchParams: URLSearchParams,\n  nonce: string\n): Promise<string> {\n  const code = urlSearchParams.get('code');\n  if (!code) {\n    return '';\n  }\n\n  const stateValue = urlSearchParams.get('state');\n  if (!stateValue) {\n    throw new Error('Invalid state parameter!');\n  }\n\n  let state;\n\n  try {\n    state = JSON.parse(atob(stateValue));\n  } catch (error) {\n    throw new Error('Invalid state parameter!');\n  }\n\n  if (state.nonce !== nonce) {\n    throw new Error('Invalid nonce parameter!');\n  }\n\n  const res = await vcsClient.githubLogin(code);\n  return res.cookie;\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport { useEffect } from 'react';\n\nimport { VcsClient } from '../../../infrastructure/VcsClient';\nimport { authFromUrl } from './authFromUrl';\n\ntype PollGithubPopupParams = {\n  vcsClient: VcsClient;\n  externalWindow: Window | null | undefined;\n  setExternalWindow: (window: Window | null) => void;\n  setSessionCookie: (sessionCookie: string) => void;\n  nonce: string;\n};\n\nfunction tryGetWindowSearchParams(window: Window): URLSearchParams | null {\n  try {\n    return new URL(window.location.href).searchParams;\n  } catch {\n    return null;\n  }\n}\n\nexport function usePollGitHubPopup({\n  vcsClient,\n  externalWindow,\n  setExternalWindow,\n  setSessionCookie,\n  nonce,\n}: PollGithubPopupParams) {\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  useEffect(() => {\n    const checkPopup = async () => {\n      if (!externalWindow || externalWindow.closed) {\n        setExternalWindow(null);\n        return;\n      }\n\n      try {\n        const searchParams = tryGetWindowSearchParams(externalWindow);\n\n        if (searchParams !== null) {\n          const sessionCookie = await authFromUrl(vcsClient, searchParams, nonce);\n\n          if (sessionCookie) {\n            setSessionCookie(sessionCookie);\n            externalWindow.close();\n            setExternalWindow(null);\n            return;\n          }\n        }\n      } catch (error) {\n        displayError(error as Error, ['Error while login in with GitHub!', (error as Error).message]);\n        externalWindow.close();\n        setExternalWindow(null);\n        return;\n      }\n\n      // keep checking for the popup to close\n      window.setTimeout(checkPopup, 700);\n    };\n\n    if (externalWindow) {\n      checkPopup();\n    }\n\n    return () => {\n      if (externalWindow) {\n        externalWindow.close();\n        setExternalWindow(null);\n      }\n    };\n  }, [externalWindow, setExternalWindow, setSessionCookie, nonce, vcsClient]);\n}\n","import { createContext } from 'react';\n\nexport type TGitHubContext = {\n  isLoggedIn: boolean;\n  isSessionExpired: boolean;\n  isLoginInProgress: boolean;\n  login: () => Promise<void>;\n};\n\nexport const DEFAULT_GITHUB_CONTEXT: TGitHubContext = {\n  isLoginInProgress: false,\n  isLoggedIn: false,\n  isSessionExpired: false,\n  login: async () => {},\n};\n\nexport const GitHubContext = createContext(DEFAULT_GITHUB_CONTEXT);\n","import { logger } from '@shared/infrastructure/tracking/logger';\n\nimport { DataSourceProxyClient } from '../../../../../../../infrastructure/series/http/DataSourceProxyClient';\nimport { GitSessionCookieManager, gitSessionCookieManager } from './GitSessionCookieManager';\n\ntype GetFileResponse = {\n  content: string;\n  URL: string;\n};\n\ntype Commit = {\n  repositoryUrl: string;\n  gitRef: string;\n};\n\ntype GetCommitResponse = {\n  author: {\n    avatarURL: string;\n    login: string;\n  };\n  date?: Date;\n  message: string;\n  sha: string;\n  URL: string;\n};\n\nexport const PLACEHOLDER_COMMIT_DATA = Object.freeze({\n  sha: '<unknown>',\n  date: undefined,\n  author: {\n    login: 'unknown author',\n    avatarURL: '',\n  },\n  message: '',\n  URL: '',\n});\n\n/**\n * Exposes VCSService endpoints which are protected by token authentication. It\n * implements middleware to try auto-refresh expired tokens. While an\n * auto-refresh is in progress, subsequent requests are queued. Once the token\n * is refreshed, the queued requests will be dispatched using the new token.\n *\n * WARNING: Only one instance of this class should be instantiated because it\n * needs to keep a singleton reference to the `GitSession` cookie. This class\n * will refresh the `GitSession` cookie whenever it expires and multiple\n * instances will cause unexpected errors and race conditions.\n */\nexport class PrivateVcsClient extends DataSourceProxyClient {\n  private sessionManager: GitSessionCookieManager;\n\n  private pendingQueue: Array<(err: Error | undefined) => void>;\n  private isRefreshing: boolean;\n\n  /** Time interval where the session should be considered expired. */\n  private static readonly BIAS_MS = 5 * 60 * 1000; // 5 minutes\n\n  constructor(options: { dataSourceUid: string }) {\n    super(options);\n\n    this.sessionManager = gitSessionCookieManager;\n    this.isRefreshing = false;\n    this.pendingQueue = [];\n  }\n\n  /**\n   * Fetches a file from GitHub.\n   *\n   * @param repositoryUrl A repository url\n   * @param gitRef A ref of the file version\n   * @param localPath A file path relative to the repository root\n   * @returns Base64 encoded file contents.\n   */\n  async getFile(repositoryUrl: string, gitRef: string, localPath: string, rootPath: string): Promise<GetFileResponse> {\n    const response = await this.postWithRefresh(\n      '/vcs.v1.VCSService/GetFile',\n      JSON.stringify({\n        repositoryURL: repositoryUrl,\n        ref: gitRef,\n        localPath,\n        rootPath,\n      })\n    );\n\n    return response.json();\n  }\n\n  /**\n   * Fetches a series of commit metadata (author, date, etc) for a list of\n   * commit refs.\n   *\n   * @param commits A list of commits\n   * @returns GitHub commit metadata for the commits\n   */\n  async getCommits(commits: Commit[]): Promise<GetCommitResponse[]> {\n    return await Promise.all(\n      commits.map(({ repositoryUrl, gitRef }) => {\n        if (!repositoryUrl || !gitRef) {\n          return PLACEHOLDER_COMMIT_DATA;\n        }\n\n        return this.getCommit(repositoryUrl, gitRef).catch((error) => {\n          logger.error(error, {\n            info: `Error while fetching commit from repo \"${repositoryUrl}\" (${gitRef})!'`,\n          });\n\n          return PLACEHOLDER_COMMIT_DATA;\n        });\n      })\n    );\n  }\n\n  async refresh(): Promise<void> {\n    return this.refreshSession();\n  }\n\n  /**\n   * Gets commit metadata (author, date, etc) for a single commit ref.\n   *\n   * @param repositoryUrl A repository url\n   * @param gitRef A commit ref\n   * @returns Metadata for a single GitHub commit.\n   */\n  private async getCommit(repositoryUrl: string, gitRef: string): Promise<GetCommitResponse> {\n    const response = await this.postWithRefresh(\n      '/vcs.v1.VCSService/GetCommit',\n      JSON.stringify({\n        repositoryURL: repositoryUrl,\n        ref: gitRef,\n      })\n    );\n\n    const json = await response.json();\n    json.date &&= new Date(json.date);\n    return json;\n  }\n\n  /**\n   * Makes an HTTP POST request. If the session cookie is expired, this method\n   * will auto-refresh the session cookie. During this time, all subsequent\n   * requests will be queued until the refresh is complete.\n   *\n   * @param path An API route path\n   * @param body Request body contents\n   * @returns A promise for the HTTP POST request.\n   */\n  private async postWithRefresh(path: string, body: string): Promise<Response> {\n    // Check if the session is refreshing.\n    if (this.isRefreshing) {\n      return this.queueRequest(path, body);\n    }\n\n    // Check if session is expired.\n    if (this.sessionManager.getCookie()?.isUserTokenExpired(PrivateVcsClient.BIAS_MS)) {\n      this.isRefreshing = true;\n\n      // Refresh the session.\n      try {\n        await this.refreshSession();\n      } catch (e) {\n        this.sessionManager.deleteCookie();\n        this.flushQueue(e as Error);\n      }\n\n      // Resolve the request that triggered the refresh.\n      this.flushQueue();\n      this.isRefreshing = false;\n    }\n\n    return this.post(path, body);\n  }\n\n  /**\n   * Makes an HTTP POST request. This method assumes a valid session cookie.\n   *\n   * @param path An API route path\n   * @param body Request body contents\n   * @returns A response of the resulting HTTP POST request.\n   */\n  private async post(path: string, body: string): Promise<Response> {\n    return this.fetch(path, {\n      method: 'POST',\n      body: body,\n    });\n  }\n\n  /**\n   * Exchanges the current session cookie for a new one, then saves the cookie\n   * in the session manager.\n   */\n  private async refreshSession(): Promise<void> {\n    const response = await this.fetch('/vcs.v1.VCSService/GithubRefresh', {\n      method: 'POST',\n      body: JSON.stringify({}),\n    });\n\n    const body = await response.json();\n    this.sessionManager.setCookie(body.cookie);\n  }\n\n  /**\n   * Queues an HTTP request to the provided path with the provided body. The\n   * request will be executed when the queue gets flushed.\n   *\n   * @param path An API route path\n   * @param body Request body contents\n   * @returns A response of the resulting HTTP POST request.\n   */\n  private async queueRequest(path: string, body: string): Promise<Response> {\n    return new Promise((resolve, reject) => {\n      this.pendingQueue.push((err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n\n        resolve(this.post(path, body));\n      });\n    });\n  }\n\n  /**\n   * Flushes a queue of requests in the order in which they were received. If\n   * an error occurred while the requests were queued, it is passed to each\n   * request callback.\n   *\n   * This function also resets the internal queue.\n   *\n   * @param err An optional error\n   */\n  private flushQueue(err: Error | undefined = undefined) {\n    this.pendingQueue.forEach((callback) => callback(err));\n    this.pendingQueue = [];\n  }\n}\n","import { displayError } from '@shared/domain/displayStatus';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { DataSourceProxyClientBuilder } from 'src/pages/ProfilesExplorerView/infrastructure/series/http/DataSourceProxyClientBuilder';\n\nimport { VcsClient } from '../../infrastructure/VcsClient';\nimport { generateNonce } from './domain/generateNonce';\nimport { githubLogin } from './domain/githubLogin';\nimport { useGithubSessionCookie } from './domain/useGithubSessionCookie';\nimport { usePollGitHubPopup } from './domain/usePollGitHubPopup';\nimport { DEFAULT_GITHUB_CONTEXT, GitHubContext } from './GitHubContext';\nimport { PrivateVcsClient } from './infrastructure/PrivateVcsClient';\n\ntype GitHubContextProviderProps = {\n  dataSourceUid: string;\n  children: React.ReactNode;\n};\n\nexport const nonce = generateNonce();\n\nexport function GitHubContextProvider({ dataSourceUid, children }: GitHubContextProviderProps) {\n  const vcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, VcsClient);\n  const privateVcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, PrivateVcsClient);\n\n  const [isLoginInProgress, setIsLoginInProgress] = useState(DEFAULT_GITHUB_CONTEXT.isLoginInProgress);\n  const [sessionCookie, setSessionCookie] = useGithubSessionCookie();\n  const [externalWindow, setExternalWindow] = useState<Window | null>();\n\n  // hack to prevent failures impossible to fix for the user (unless they know they have to delete the cookie)\n  // when logged in and changing data source\n  // TODO: provide a better way\n  useEffect(() => {\n    setSessionCookie('');\n  }, [dataSourceUid]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  usePollGitHubPopup({ vcsClient, externalWindow, setExternalWindow, setSessionCookie, nonce });\n\n  // Check if login window is open and toggle the login state accordingly. For\n  // example, if the login window IS open and the login state is not\n  // \"in progress\", then update the state to be \"in progress\".\n  const newIsLoginInProgress = externalWindow ? !externalWindow.closed : false;\n  if (newIsLoginInProgress !== isLoginInProgress) {\n    setIsLoginInProgress(newIsLoginInProgress);\n  }\n\n  const login = useCallback(async () => {\n    try {\n      await githubLogin(vcsClient, privateVcsClient, sessionCookie, externalWindow, setExternalWindow);\n    } catch (error) {\n      displayError(error as Error, ['Failed to login to GitHub', (error as Error).message]);\n    }\n  }, [vcsClient, privateVcsClient, sessionCookie, externalWindow]);\n\n  return (\n    <GitHubContext.Provider\n      value={{\n        isLoginInProgress,\n        isLoggedIn: Boolean(sessionCookie && !sessionCookie.isUserTokenExpired()),\n        isSessionExpired: Boolean(sessionCookie?.isUserTokenExpired()),\n        login,\n      }}\n    >\n      {children}\n    </GitHubContext.Provider>\n  );\n}\n","export function generateNonce(): string {\n  // https://stackoverflow.com/questions/76825670/how-to-generate-and-use-random-value-for-nonce-in-inline-script-in-javascript\n  return btoa(String.fromCharCode(...crypto.getRandomValues(new Uint8Array(32))));\n}\n","import { useState } from 'react';\n\nimport { gitSessionCookieManager } from '../infrastructure/GitSessionCookieManager';\n\nexport function useGithubSessionCookie() {\n  const [cookie, setCookie] = useState(gitSessionCookieManager.getCookie());\n\n  const setNextCookie = (nextValue: string) => {\n    if (!nextValue) {\n      gitSessionCookieManager.deleteCookie();\n      setCookie(undefined);\n    } else {\n      gitSessionCookieManager.setCookie(nextValue);\n      setCookie(gitSessionCookieManager.getCookie());\n    }\n  };\n\n  return [cookie, setNextCookie] as const;\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface RemoveSpanSelectorPayload {}\n\nexport class RemoveSpanSelector extends BusEventWithPayload<RemoveSpanSelectorPayload> {\n  public static type = 'remove-span-selector';\n}\n","import { config } from '@grafana/runtime';\n\nexport const featureToggles = {\n  // @ts-ignore Remove after upgrading grafana/runtime to version including the toggle type\n  metricsFromProfiles: !!config.featureToggles['metricsFromProfiles'],\n};\n","import { SceneQueryRunner } from '@grafana/scenes';\n\nimport { PYROSCOPE_DATA_SOURCE } from '../pyroscope-data-sources';\nimport { TimeSeriesQueryRunnerParams } from '../timeseries/TimeSeriesQueryRunnerParams';\nimport { withPreventInvalidQuery } from '../withPreventInvalidQuery';\n\ntype FlameGraphQueryRunnerParams = TimeSeriesQueryRunnerParams & {\n  maxNodes?: number;\n  spanSelector?: string;\n};\n\nexport function buildFlameGraphQueryRunner({ filters, maxNodes, spanSelector }: FlameGraphQueryRunnerParams) {\n  const completeFilters = filters ? [...filters] : [];\n  completeFilters.unshift({ key: 'service_name', operator: '=', value: '$serviceName' });\n\n  const selector = completeFilters.map(({ key, operator, value }) => `${key}${operator}\"${value}\"`).join(',');\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: PYROSCOPE_DATA_SOURCE,\n    queries: [\n      {\n        refId: 'profile',\n        queryType: 'profile',\n        profileTypeId: '$profileMetricId',\n        labelSelector: `{${selector},$filters}`,\n        maxNodes,\n        ...(spanSelector && { spanSelector: [spanSelector] }),\n      },\n    ],\n  });\n\n  return withPreventInvalidQuery(queryRunner);\n}\n","import { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport {\n  ListRecordingRulesResponse,\n  RecordingRule,\n  UpsertRecordingRuleRequest,\n} from '@shared/pyroscope-api/settings/v1/recording_rules_pb';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\n\nfunction mapRuleToRecordingRuleViewModel(rule: RecordingRule): RecordingRuleViewModel {\n  let serviceName = '';\n  for (let matcher of rule.matchers || []) {\n    if (matcher.includes('service_name=')) {\n      serviceName = matcher?.match(/service_name=\"([^\"]+)\"/)?.[1] || '';\n      break;\n    }\n  }\n  return {\n    id: rule.id,\n    metricName: rule.metricName,\n    serviceName,\n    profileType: rule.profileType,\n    matchers: rule.matchers,\n    groupBy: rule.groupBy || [],\n  };\n}\n\nclass RecordingRulesApiClient extends ApiClient {\n  async get(): Promise<RecordingRuleViewModel[]> {\n    return super\n      .fetch('/settings.v1.RecordingRulesService/ListRecordingRules', {\n        method: 'POST',\n        body: JSON.stringify({}),\n      })\n      .then((response) => response.json())\n      .then((json: ListRecordingRulesResponse) => {\n        if (!json.rules) {\n          return [];\n        }\n        return json.rules.map((rule: RecordingRule) => {\n          return mapRuleToRecordingRuleViewModel(rule);\n        });\n      });\n  }\n\n  async create(rule: RecordingRuleViewModel): Promise<void> {\n    return super\n      .fetch('/settings.v1.RecordingRulesService/UpsertRecordingRule', {\n        method: 'POST',\n        body: JSON.stringify({\n          metricName: rule.metricName,\n          matchers: [\n            `{ service_name=\"${rule.serviceName}\" }`,\n            `{ __profile_type__=\"${rule.profileType}\"}`,\n            ...(rule.matchers || []),\n          ],\n          groupBy: rule.groupBy || [],\n        } as UpsertRecordingRuleRequest),\n      })\n      .then((response) => response.json());\n  }\n\n  async remove(rule: RecordingRuleViewModel): Promise<void> {\n    return super\n      .fetch('/settings.v1.RecordingRulesService/DeleteRecordingRule', {\n        method: 'POST',\n        body: JSON.stringify({\n          id: rule.id,\n        }),\n      })\n      .then((response) => response.json());\n  }\n}\n\nexport const recordingRulesApiClient = new RecordingRulesApiClient();\n","import { HttpClientError } from '@shared/infrastructure/http/HttpClientError';\nimport { recordingRulesApiClient } from '@shared/infrastructure/recording-rules/recordingRulesApiClient';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\n\ntype FetchParams = {\n  enabled?: boolean;\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: HttpClientError | null;\n  recordingRules?: RecordingRuleViewModel[];\n  mutate: (rule: RecordingRuleViewModel) => Promise<void>;\n  remove: (rule: RecordingRuleViewModel) => Promise<void>;\n};\n\nexport function useFetchRecordingRules({ enabled }: FetchParams = {}): FetchResponse {\n  const queryClient = useQueryClient();\n\n  const { isFetching, error, data } = useQuery<RecordingRuleViewModel[], HttpClientError>({\n    enabled,\n    queryKey: ['recording_rules'],\n    queryFn: () => recordingRulesApiClient.get(),\n  });\n\n  const { mutateAsync: mutate } = useMutation({\n    mutationFn: (rule: RecordingRuleViewModel) => recordingRulesApiClient.create(rule),\n    networkMode: 'always',\n  });\n\n  const { mutateAsync: remove } = useMutation({\n    mutationFn: async (rule: RecordingRuleViewModel) => {\n      await recordingRulesApiClient.remove(rule);\n      await queryClient.invalidateQueries({ queryKey: ['recording_rules'] });\n    },\n    networkMode: 'always',\n  });\n\n  return {\n    isFetching,\n    error: recordingRulesApiClient.isAbortError(error) ? null : error,\n    recordingRules: data,\n    mutate,\n    remove,\n  };\n}\n","import { displayError, displaySuccess } from '@shared/domain/displayStatus';\nimport { useFetchRecordingRules } from '@shared/infrastructure/recording-rules/useFetchRecordingRules';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\n\nexport function useCreateRecordingRule() {\n  const { recordingRules, error: fetchError, mutate } = useFetchRecordingRules();\n\n  return {\n    data: {\n      recordingRules,\n      fetchError,\n    },\n    actions: {\n      async save(rule: RecordingRuleViewModel) {\n        try {\n          await mutate(rule);\n          displaySuccess([`Recording rule ${rule.metricName} created successfully!`]);\n        } catch (e) {\n          displayError(e as Error, [`Failed to save recording rule ${rule.metricName}.`]);\n        }\n      },\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, Divider, Field, Input, Modal, MultiSelect, useStyles2 } from '@grafana/ui';\nimport { labelsRepository } from '@shared/infrastructure/labels/labelsRepository';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\nimport React, { useEffect, useState } from 'react';\nimport { Controller, FieldError, SubmitHandler, useForm } from 'react-hook-form';\n\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\n\ninterface RecordingRuleForm {\n  metricName: string;\n  labels: Array<SelectableValue<string>>;\n  serviceName: string;\n  profileType: string;\n  matcher: string;\n}\n\ninterface SceneCreateRecordingRuleModalState extends SceneObjectState {}\n\nexport class SceneCreateRecordingRuleModal extends SceneObjectBase<SceneCreateRecordingRuleModalState> {\n  constructor() {\n    super({});\n  }\n\n  static Component = ({\n    model,\n    isModalOpen,\n    onDismiss,\n    onCreate,\n  }: SceneComponentProps<SceneCreateRecordingRuleModal> & {\n    isModalOpen: boolean;\n    onDismiss: () => void;\n    onCreate: (rule: RecordingRuleViewModel) => Promise<void>;\n  }) => {\n    const {\n      register,\n      handleSubmit,\n      control,\n      formState: { errors },\n    } = useForm<RecordingRuleForm>({ mode: 'onChange', shouldUnregister: true });\n\n    const [options, setOptions] = useState<string[]>([]);\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(model, 'profileMetricId', ProfileMetricVariable);\n    const profileMetric = getProfileMetric(profileMetricVariable.state.value as ProfileMetricId);\n\n    const serviceNameVariable = sceneGraph.findByKeyAndType(model, 'serviceName', ServiceNameVariable);\n    const serviceName = serviceNameVariable.state.value;\n\n    const filtersVariable = sceneGraph.findByKeyAndType(model, 'filters', FiltersVariable);\n    const filters = filtersVariable.state.filters;\n    const filterQuery = filters.map((filter) => `${filter.key}${filter.operator}\"${filter.value}\"`).join(', ');\n\n    const onSubmit: SubmitHandler<RecordingRuleForm> = (data) =>\n      onCreate({\n        id: '',\n        metricName: data.metricName,\n        serviceName: data.serviceName,\n        profileType: data.profileType,\n        matchers: [`{${filterQuery}}`],\n        groupBy: data.labels ? data.labels.map((label) => label.value ?? '') : [],\n      });\n\n    useEffect(() => {\n      const timeRange = sceneGraph.getTimeRange(model).state.value;\n      labelsRepository\n        .listLabels({\n          query: `{${filterQuery}}`,\n          from: timeRange.from.unix() * 1000,\n          to: timeRange.to.unix() * 1000,\n        })\n        .then((suggestions) => {\n          setOptions(suggestions.map((s) => s.value));\n        });\n    }, [filterQuery, model]);\n\n    return (\n      <Modal title=\"Create recording rule\" isOpen={isModalOpen} onDismiss={onDismiss}>\n        <form onSubmit={handleSubmit(onSubmit)}>\n          <Field\n            label=\"Metric name\"\n            description=\"The name of the Prometheus metric\"\n            error={MetricNameErrorComponent(errors.metricName)}\n            invalid={!!errors.metricName}\n          >\n            <Input\n              placeholder={`pyroscope_metric_${profileMetric.type}_${serviceName\n                .toString()\n                .replace(/[^a-zA-Z0-9_]/g, '_')}`}\n              required\n              autoFocus\n              {...register('metricName', {\n                required: 'Metric name is required.',\n                // This pattern was pulled from here: https://prometheus.io/docs/concepts/data_model/#metric-names-and-labels\n                pattern: {\n                  value: /^[a-zA-Z_][a-zA-Z0-9_]*$/,\n                  message: 'Invalid metric name.',\n                },\n              })}\n            />\n          </Field>\n\n          <Field label=\"Additional labels\" description=\"Additional profiling labels to forward to the metric\">\n            <Controller\n              name=\"labels\"\n              control={control}\n              render={({ field }) => (\n                <MultiSelect\n                  {...field}\n                  options={options.map((opt) => ({ label: opt, value: opt }))}\n                  toggleAllOptions={{\n                    enabled: true,\n                  }}\n                  closeMenuOnSelect={false}\n                  hideSelectedOptions={false}\n                />\n              )}\n            />\n          </Field>\n\n          <Divider />\n\n          <Field label=\"Service name\">\n            <div>{`${serviceName}`}</div>\n          </Field>\n          <input type=\"text\" value={serviceName.toString()} hidden {...register('serviceName')} />\n\n          <Field label=\"Profile type\">\n            <div>{`${profileMetric.group}/${profileMetric.type}`}</div>\n          </Field>\n          <input type=\"text\" value={profileMetric.id} hidden {...register('profileType')} />\n\n          <Field label=\"Filters\" description=\"Filters selected in the main view will be applied to this rule\">\n            <div>{filters.length === 0 ? 'No filters selected' : filterQuery}</div>\n          </Field>\n\n          <Modal.ButtonRow>\n            <Button variant=\"secondary\" fill=\"outline\" onClick={onDismiss}>\n              Cancel\n            </Button>\n            <Button variant=\"primary\" type=\"submit\">\n              Create\n            </Button>\n          </Modal.ButtonRow>\n        </form>\n      </Modal>\n    );\n  };\n}\n\nconst MetricNameErrorComponent = (error: FieldError | undefined) => {\n  const styles = useStyles2(getStyles);\n\n  if (error === undefined || error.message === undefined) {\n    return undefined;\n  }\n\n  if (error.type === 'pattern') {\n    return (\n      <span>\n        <span>Metric name is invalid, it must have the following properties:</span>\n        <ul className={styles.errorList}>\n          <li>Only contain alphanumeric characters or underscores</li>\n          <li>Must not begin with a number</li>\n        </ul>\n      </span>\n    );\n  }\n\n  return <span>{error.message}</span>;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  errorList: css`\n    padding-left: ${theme.spacing(2)};\n  `,\n});\n","import { Field, Message } from 'protobufjs/light';\n\nexport class PprofRequest extends Message<PprofRequest> {\n    constructor(\n        profile_typeID: string,\n        label_selector: string,\n        start: number,\n        end: number,\n        max_nodes: number\n    ) {\n        super();\n        this.profile_typeID = profile_typeID;\n        this.label_selector = label_selector;\n        this.start = start;\n        this.end = end;\n        this.max_nodes = max_nodes;\n    }\n\n    @Field.d(1, 'string')\n    profile_typeID: string;\n\n    @Field.d(2, 'string')\n    label_selector: string;\n\n    @Field.d(3, 'int64')\n    start: number;\n\n    @Field.d(4, 'int64')\n    end: number;\n\n    @Field.d(5, 'int64')\n    max_nodes: number;\n}\n","import { TimeRange } from '@grafana/data';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { PprofProfile } from '@shared/types/PprofProfile';\n\nimport { DataSourceProxyClient } from '../../../infrastructure/series/http/DataSourceProxyClient';\nimport { PprofRequest } from './PprofRequest';\n\ntype SelectMergeProfileParams = {\n  query: string;\n  timeRange: TimeRange;\n  maxNodes: number;\n};\n\ntype SelectMergeProfileJsonParams = {\n  profileMetricId: string;\n  labelsSelector: string;\n  start: number;\n  end: number;\n  stackTrace: string[];\n  maxNodes: number;\n};\n\nexport class PprofApiClient extends DataSourceProxyClient {\n  static buildPprofRequest(query: string, timeRange: TimeRange, maxNodes: number): Uint8Array {\n    const { profileMetricId, labelsSelector } = parseQuery(query);\n\n    const start = timeRange.from.unix() * 1000;\n    const end = timeRange.to.unix() * 1000;\n\n    const message = new PprofRequest(profileMetricId, labelsSelector, start, end, maxNodes);\n\n    return PprofRequest.encode(message).finish();\n  }\n\n  async selectMergeProfile({ query, timeRange, maxNodes }: SelectMergeProfileParams): Promise<Blob> {\n    const response = await this.fetch('/querier.v1.QuerierService/SelectMergeProfile', {\n      method: 'POST',\n      headers: { 'content-type': 'application/proto' },\n      body: new Blob([PprofApiClient.buildPprofRequest(query, timeRange, maxNodes)]),\n    });\n\n    return response.blob();\n  }\n\n  async selectMergeProfileJson({\n    profileMetricId,\n    labelsSelector,\n    start,\n    end,\n    stackTrace,\n    maxNodes,\n  }: SelectMergeProfileJsonParams): Promise<PprofProfile> {\n    const response = await this.fetch('/querier.v1.QuerierService/SelectMergeProfile', {\n      method: 'POST',\n      body: JSON.stringify({\n        profile_typeID: profileMetricId,\n        label_selector: labelsSelector,\n        start: start * 1000,\n        end: end * 1000,\n        stackTraceSelector: {\n          call_site: stackTrace.map((name) => ({ name })),\n        },\n        maxNodes,\n      }),\n    });\n\n    return response.json();\n  }\n}\n","import { TimeRange } from '@grafana/data';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\n\nexport function getExportFilename(query: string, timeRange: TimeRange) {\n  const { serviceId, profileMetricId } = parseQuery(query);\n  const dateString = `${timeRange.from.format('YYYY-MM-DD_HHmm')}-to-${timeRange.to.format('YYYY-MM-DD_HHmm')}`;\n  return `${serviceId.replace(/\\//g, '-')}_${profileMetricId}_${dateString}`;\n}\n","import { HttpClient } from '@shared/infrastructure/http/HttpClient';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\n\ntype UploadResponse = {\n  key: string;\n  url: string;\n  subProfiles: any[]; // TODO: define them, what are they?\n};\n\nclass FlamegraphDotComApiClient extends HttpClient {\n  constructor() {\n    super('https://flamegraph.com/api', {\n      'content-type': 'application/json',\n    });\n  }\n\n  async upload(name: string, profile: FlamebearerProfile): Promise<UploadResponse> {\n    const response = await this.fetch('/upload/v1', {\n      method: 'POST',\n      body: JSON.stringify({\n        name,\n        profile: btoa(JSON.stringify(profile)),\n        fileTypeData: {\n          units: profile.metadata.units,\n          spyName: profile.metadata.spyName,\n        },\n        type: 'json',\n      }),\n    });\n\n    const json = await response.json();\n\n    return json;\n  }\n}\n\nexport const flamegraphDotComApiClient = new FlamegraphDotComApiClient();\n","import { TimeRange } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, Dropdown, Menu } from '@grafana/ui';\nimport { displayError } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { DEFAULT_SETTINGS } from '@shared/infrastructure/settings/PluginSettings';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { FlamebearerProfile } from '@shared/types/FlamebearerProfile';\nimport 'compression-streams-polyfill';\nimport saveAs from 'file-saver';\nimport React from 'react';\n\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { ProfileApiClient } from '../../../../infrastructure/profiles/ProfileApiClient';\nimport { DataSourceProxyClientBuilder } from '../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PprofApiClient } from '../../infrastructure/PprofApiClient';\nimport { getExportFilename } from './domain/getExportFilename';\nimport { flamegraphDotComApiClient } from './infrastructure/flamegraphDotComApiClient';\n\ninterface SceneExportMenuState extends SceneObjectState {}\n\ntype ExtraProps = {\n  query: string;\n  timeRange: TimeRange;\n};\n\nexport class SceneExportMenu extends SceneObjectBase<SceneExportMenuState> {\n  constructor() {\n    super({ key: 'export-flame-graph-menu' });\n  }\n\n  async fetchFlamebearerProfile({\n    dataSourceUid,\n    query,\n    timeRange,\n    maxNodes,\n  }: ExtraProps & { dataSourceUid: string; maxNodes: number | null }): Promise<FlamebearerProfile | null> {\n    const profileApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, ProfileApiClient);\n\n    let profile;\n\n    try {\n      profile = await profileApiClient.get({\n        query,\n        timeRange,\n        format: 'json',\n        maxNodes: maxNodes || DEFAULT_SETTINGS.maxNodes,\n      });\n    } catch (error) {\n      displayError(error as Error, ['Error while loading flamebearer profile data!', (error as Error).message]);\n      return null;\n    }\n\n    return profile as FlamebearerProfile;\n  }\n\n  async fetchPprofProfile({\n    dataSourceUid,\n    query,\n    timeRange,\n    maxNodes,\n  }: ExtraProps & { dataSourceUid: string; maxNodes: number | null }): Promise<Blob | null> {\n    const pprofApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, PprofApiClient);\n\n    let profile;\n\n    try {\n      const blob = await pprofApiClient.selectMergeProfile({\n        query,\n        timeRange,\n        maxNodes: maxNodes || DEFAULT_SETTINGS.maxNodes,\n      });\n      profile = await new Response(blob.stream().pipeThrough(new CompressionStream('gzip'))).blob();\n    } catch (error) {\n      displayError(error as Error, ['Failed to export to pprof!', (error as Error).message]);\n      return null;\n    }\n\n    return profile;\n  }\n\n  useSceneExportMenu = ({ query, timeRange }: ExtraProps): DomainHookReturnValue => {\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n\n    const [maxNodes] = useMaxNodesFromUrl();\n    const { settings } = useFetchPluginSettings();\n\n    const downloadPng = () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'png' });\n\n      const filename = `${getExportFilename(query, timeRange)}.png`;\n\n      (document.querySelector('canvas[data-testid=\"flameGraph\"]') as HTMLCanvasElement).toBlob((blob) => {\n        if (!blob) {\n          const error = new Error('Error while creating the image, no blob.');\n          displayError(error, ['Failed to export to png!', error.message]);\n          return;\n        }\n\n        saveAs(blob, filename);\n      }, 'image/png');\n    };\n\n    const downloadJson = async () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'json' });\n\n      const profile = await this.fetchFlamebearerProfile({ dataSourceUid, query, timeRange, maxNodes });\n      if (!profile) {\n        return;\n      }\n\n      const filename = `${getExportFilename(query, timeRange)}.json`;\n      const data = `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(profile))}`;\n\n      saveAs(data, filename);\n    };\n\n    const downloadPprof = async () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'pprof' });\n\n      const profile = await this.fetchPprofProfile({ dataSourceUid, query, timeRange, maxNodes });\n      if (!profile) {\n        return;\n      }\n\n      const filename = `${getExportFilename(query, timeRange)}.pb.gz`;\n\n      saveAs(profile, filename);\n    };\n\n    const uploadToFlamegraphDotCom = async () => {\n      reportInteraction('g_pyroscope_app_export_profile', { format: 'flamegraph.com' });\n\n      const profile = await this.fetchFlamebearerProfile({ dataSourceUid, query, timeRange, maxNodes });\n      if (!profile) {\n        return;\n      }\n\n      try {\n        const response = await flamegraphDotComApiClient.upload(getExportFilename(query, timeRange), profile);\n\n        if (!response.url) {\n          throw new Error('Empty URL received.');\n        }\n\n        const dlLink = document.createElement('a');\n        dlLink.target = '_blank';\n        dlLink.href = response.url;\n        document.body.appendChild(dlLink);\n        dlLink.click();\n        document.body.removeChild(dlLink);\n      } catch (error) {\n        displayError(error as Error, ['Failed to export to flamegraph.com!', (error as Error).message]);\n        return;\n      }\n    };\n\n    return {\n      data: {\n        shouldDisplayFlamegraphDotCom: Boolean(settings?.enableFlameGraphDotComExport),\n      },\n      actions: {\n        downloadPng,\n        downloadJson,\n        downloadPprof,\n        uploadToFlamegraphDotCom,\n      },\n    };\n  };\n\n  static Component = ({ model, query, timeRange }: SceneComponentProps<SceneExportMenu> & ExtraProps) => {\n    const { actions } = model.useSceneExportMenu({ query, timeRange });\n\n    return (\n      <Dropdown\n        overlay={\n          <Menu>\n            <Menu.Item label=\"png\" onClick={actions.downloadPng} />\n            <Menu.Item label=\"json\" onClick={actions.downloadJson} />\n            <Menu.Item label=\"pprof\" onClick={actions.downloadPprof} />\n          </Menu>\n        }\n      >\n        <Button\n          icon=\"download-alt\"\n          size=\"sm\"\n          variant=\"secondary\"\n          fill=\"outline\"\n          aria-label=\"Export profile data\"\n          tooltip=\"Export profile data\"\n        />\n      </Dropdown>\n    );\n  };\n}\n","import { useContext } from 'react';\n\nimport { GitHubContext, TGitHubContext } from './GitHubContext';\n\nexport function useGitHubContext(): TGitHubContext {\n  return useContext(GitHubContext);\n}\n","import { IconName } from '@grafana/data';\nimport { Props as FlameGraphProps } from '@grafana/flamegraph';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useCallback, useState } from 'react';\n\nimport { useGitHubContext } from '../components/GitHubContextProvider/useGitHubContext';\nimport { buildStackTrace } from './buildStackTrace';\n\nexport function useGitHubIntegration(sidePanel: any): DomainHookReturnValue {\n  const { login, isSessionExpired } = useGitHubContext();\n  const { settings } = useFetchPluginSettings();\n\n  const isFunctionDetailsEnabled = settings?.enableFunctionDetails;\n\n  const [stacktrace, setStacktrace] = useState<string[]>([]);\n\n  const getExtraFlameGraphMenuItems: FlameGraphProps['getExtraContextMenuButtons'] = useCallback(\n    ({ item }: any, data: Record<string, any>) => {\n      // clicking on the top-level \"total\" node doesn't add \"Function details\" as an extra contextual menu item\n      if (!isFunctionDetailsEnabled || item.level === 0) {\n        return [];\n      }\n\n      return [\n        {\n          label: 'Function details',\n          icon: 'info-circle' as IconName,\n          onClick: () => {\n            reportInteraction('g_pyroscope_app_function_details_clicked');\n\n            setStacktrace(buildStackTrace(item, data));\n\n            sidePanel.open('function-details');\n\n            // login can only happen as a consequence of a user action\n            // this is why we check if the session is expired here and not whenever we make a request to the API\n            if (isSessionExpired) {\n              login();\n            }\n          },\n        },\n      ];\n    },\n    [isFunctionDetailsEnabled, isSessionExpired, login, sidePanel]\n  );\n\n  return {\n    data: {\n      stacktrace,\n    },\n    actions: {\n      getExtraFlameGraphMenuItems,\n    },\n  };\n}\n","import { createTheme, getDisplayProcessor } from '@grafana/data';\n\nimport { StackTrace } from './types/StackTrace';\n\nexport function buildStackTrace(levelItem: any, data: Record<string, any>): StackTrace {\n  let stacktrace: string[] = [];\n\n  const labels = data.fields.find(({ name }: { name: string }) => name === 'label');\n  if (!labels) {\n    return stacktrace;\n  }\n\n  const dp = getDisplayProcessor({ field: labels, theme: createTheme() });\n  let node = levelItem;\n\n  while (node && node.level > 0) {\n    for (const idx of node.itemIndexes) {\n      stacktrace.unshift(dp(labels.values[idx]).text);\n    }\n\n    node = node.parents?.[0];\n  }\n\n  return stacktrace;\n}\n","/* https://platform.openai.com/docs/models/overview */\nimport { FunctionDetails, LineProfile } from '../../../domain/types/FunctionDetails';\n\nexport const model = 'gpt-4-1106-preview';\n\n/* https://platform.openai.com/docs/guides/prompt-engineering/tactics */\n\nexport type SuggestionPromptInputs = {\n  functionDetails: FunctionDetails;\n  lines: LineProfile[];\n};\n\nexport const buildSuggestionPrompts = ({\n  functionDetails,\n  lines,\n}: // dotProfile,\nSuggestionPromptInputs) => {\n  const userPrompt = `\nYou are a code optimization expert. I will give you source code file where each line is annotated with profiling information. The annotation has the following format:\n\n\\`\\`\\`\n(<cost>) <source code line>\n\\`\\`\\`\n\nThe \\`\\`\\`<source code line>\\`\\`\\` is the exact line of source code.\n\nThe \\`\\`\\`<cost>\\`\\`\\` field will contain the resource cost of the given resource cost. This field will also contain the unit of the cost (e.g. seconds, bytes, etc). If \\`\\`\\`<cost>\\`\\`\\` is \\`-\\` that means there is no profiling data available.\n\nI want you to write back a new improved code for this function and explain why you made changes.\n\nMake sure to take annotations into strong consideration. If a suggested performance improvement isn't backed up by information from the annotations, do not include it. Prioritize lines annotated with a higher cost.\n\nDo not mention the actual numbers from the annotations, users can already see how much time was spent on each line. Do not list various lines and their time spent. When you mention functions or lines, do not mention the time spent on them.\n\nIf you can't find any meaningful performance optimizations, say so. Ask for context if you think other context might help make decisions. If you think the problem is with user input and not the actual code itself, say so.\n\nWhen you output code in markdown, please don't specify language after 3 backticks (e.g instead of saying \"\\`\\`\\`go\" say \"\\`\\`\\`\"), and always add a new line after 3 backticks.\n\nFunction name is \\`${functionDetails.name}\\`. Do not mention the function name, users can already see it.\n\nWhen posting a response, follow the outline below:\n* give a brief explanation of things that could be improve\n* print new code if it's possible\n* explain each change in more details\n\n\nAnnotated code is below:\n\\`\\`\\`\n${codeInfoToAnnotatedCode(functionDetails, lines)}\n\\`\\`\\`\n`;\n\n  return {\n    user: userPrompt,\n  };\n};\n\nfunction codeInfoToAnnotatedCode(functionDetails: FunctionDetails, lines: LineProfile[]): string {\n  return lines\n    .map((line) => {\n      if (line.cum === 0) {\n        return `(-) ${line.line}`;\n      }\n      return `(${line.cum} ${functionDetails.unit}) ${line.line}`;\n    })\n    .join('\\n');\n}\n","import { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\n\nimport { SuggestionPromptInputs } from './buildLlmSuggestionPrompts';\nimport { useOpenAiSuggestions } from './useOpenAiSuggestions';\n\nexport function useAiSuggestionsPanel(suggestionPromptInputs: SuggestionPromptInputs): DomainHookReturnValue {\n  const { reply, error: llmError } = useOpenAiSuggestions(suggestionPromptInputs);\n\n  return {\n    data: {\n      isLoading: !llmError && !reply.text.trim(),\n      llmError,\n      reply,\n      shouldDisplayReply: Boolean(reply?.hasStarted || reply?.hasFinished),\n      shouldDisplayFollowUpForm: !llmError && Boolean(reply?.hasFinished),\n    },\n    actions: {\n      submitFollowupQuestion(question: string) {\n        reply.askFollowupQuestion(question);\n      },\n    },\n  };\n}\n","import { openai } from '@grafana/llm';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { buildSuggestionPrompts, model, SuggestionPromptInputs } from './buildLlmSuggestionPrompts';\n\ntype Messages = openai.Message[];\n\n// TODO(@petethepig): this is largely same function as useOpenAiChatCompletions, maybe we should merge them somehow\nexport function useOpenAiSuggestions(suggestionPromptInputs: SuggestionPromptInputs) {\n  const [reply, setReply] = useState('');\n  const [replyHasStarted, setReplyHasStarted] = useState(false);\n  const [replyHasFinished, setReplyHasFinished] = useState(false);\n  const [messages, setMessages] = useState<Messages>([]);\n  const [error, setError] = useState<Error | null>(null);\n\n  const sendMessages = useCallback((messagesToSend: Messages) => {\n    setMessages(messagesToSend);\n\n    setError(null);\n\n    setReply('');\n    setReplyHasStarted(true);\n    setReplyHasFinished(false);\n\n    const stream = openai\n      .streamChatCompletions({\n        model,\n        messages: messagesToSend,\n      })\n      .pipe(\n        // Accumulate the stream content into a stream of strings, where each\n        // element contains the accumulated message so far.\n        openai.accumulateContent()\n      );\n\n    stream.subscribe({\n      next: setReply,\n      error(e) {\n        setError(e);\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n      },\n      complete() {\n        setReplyHasStarted(false);\n        setReplyHasFinished(true);\n      },\n    });\n  }, []);\n\n  const askFollowupQuestion = useCallback(\n    (question: string): void => {\n      const messagesToAdd: Messages = [\n        {\n          role: 'assistant',\n          content: reply,\n        },\n        {\n          role: 'user',\n          content: question,\n        },\n      ];\n\n      try {\n        sendMessages([...messages, ...messagesToAdd]);\n      } catch (error) {\n        setError(error as Error);\n      }\n    },\n    [messages, reply, sendMessages]\n  );\n\n  useEffect(() => {\n    if (messages.length > 0) {\n      return;\n    }\n\n    const prompts = buildSuggestionPrompts(suggestionPromptInputs);\n\n    try {\n      sendMessages([\n        {\n          role: 'system',\n          content: prompts.user,\n        },\n      ]);\n    } catch (error) {\n      setError(error as Error);\n    }\n  }, [messages.length, suggestionPromptInputs, sendMessages]);\n\n  return {\n    reply: {\n      text: reply,\n      hasStarted: replyHasStarted,\n      hasFinished: replyHasFinished,\n      messages: messages,\n      askFollowupQuestion,\n    },\n    error,\n  };\n}\n","import { css } from '@emotion/css';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport React from 'react';\n\nimport { AiReply } from '../../../../../../components/SceneAiPanel/components/AiReply';\nimport { FollowUpForm } from '../../../../../../components/SceneAiPanel/components/FollowUpForm';\nimport { SuggestionPromptInputs } from './domain/buildLlmSuggestionPrompts';\nimport { useAiSuggestionsPanel } from './domain/useAiSuggestionsPanel';\n\nconst getStyles = () => ({\n  title: css`\n    margin: -4px 0 4px 0;\n  `,\n  content: css``,\n});\n\ntype AiSuggestionsPanelProps = {\n  suggestionPromptInputs: SuggestionPromptInputs;\n};\n\nexport function AiSuggestionsPanel({ suggestionPromptInputs }: AiSuggestionsPanelProps) {\n  const styles = useStyles2(getStyles);\n  const { data, actions } = useAiSuggestionsPanel(suggestionPromptInputs);\n\n  return (\n    <>\n      <h6 className={styles.title}>Code Optimization Suggestions</h6>\n      <div className={styles.content}>\n        {data.isLoading && (\n          <>\n            <Spinner inline />\n            &nbsp;Analyzing...\n          </>\n        )}\n\n        {data.fetchError && (\n          <InlineBanner\n            severity=\"error\"\n            title=\"Error while fetching profiles!\"\n            message=\"Sorry for any inconvenience, please try again later.\"\n          />\n        )}\n\n        {data.llmError && (\n          <InlineBanner\n            severity=\"error\"\n            title=\"Failed to generate content using OpenAI!\"\n            error={data.llmError}\n            message=\"Sorry for any inconvenience, please try again later or if the problem persists, contact your organization admin.\"\n          />\n        )}\n\n        {data.shouldDisplayReply && <AiReply reply={data.reply} />}\n\n        {data.shouldDisplayFollowUpForm && <FollowUpForm onSubmit={actions.submitFollowupQuestion} />}\n      </div>\n    </>\n  );\n}\n","import { CallSiteProps, LineProfile } from '../../../domain/types/FunctionDetails';\n\nconst VERTICAL_LINES_PADDING = 5;\n\ntype CallSitesMap = Map<number, CallSiteProps>;\n\ninterface AnnotatedLines {\n  snippetLines: LineProfile[];\n  allLines: LineProfile[];\n}\n\nexport function annotatePlaceholderLines(callSitesMap: CallSitesMap): AnnotatedLines {\n  if (!callSitesMap.size) {\n    return {\n      snippetLines: [],\n      allLines: [],\n    };\n  }\n\n  const callSites = Array.from(callSitesMap.values()).sort((a, b) => a.line - b.line);\n\n  const firstLineIndex = Math.max(0, callSites[0].line - VERTICAL_LINES_PADDING - 1);\n  const lastLineIndex = callSites[callSites.length - 1].line + VERTICAL_LINES_PADDING + 1;\n\n  const annotatedSnippet = [];\n  for (let lineNumber = firstLineIndex + 1; lineNumber < lastLineIndex; lineNumber++) {\n    const callSite = callSitesMap.get(lineNumber);\n\n    annotatedSnippet.push({\n      line: undefined,\n      number: lineNumber,\n      cum: callSite?.cum ?? 0,\n      flat: callSite?.flat ?? 0,\n    });\n  }\n\n  // With no file contents, we return only a dummy annotated snippet which shows\n  // the appropriate line numbers, but no content.\n  return {\n    snippetLines: annotatedSnippet,\n    allLines: [],\n  };\n}\n\nexport function annotateLines(fileContent: string, callSitesMap: CallSitesMap): AnnotatedLines {\n  const callSites = Array.from(callSitesMap.values()).sort((a, b) => a.line - b.line);\n  const lines = fileContent.split('\\n');\n\n  const annotatedLines = lines.map((line, index) => {\n    const lineNumber = index + 1;\n    const callSite = callSitesMap.get(lineNumber);\n\n    return {\n      line,\n      number: lineNumber,\n      cum: callSite?.cum ?? 0,\n      flat: callSite?.flat ?? 0,\n    };\n  });\n\n  if (callSitesMap.size === 0) {\n    // If the call site map is empty, there's no snippet to render.\n    return {\n      snippetLines: [],\n      allLines: annotatedLines,\n    };\n  }\n\n  const firstLineIndex = Math.max(0, callSites[0].line - VERTICAL_LINES_PADDING - 1);\n  const lastLineIndex = Math.min(lines.length, callSites[callSites.length - 1].line + VERTICAL_LINES_PADDING);\n  const annotatedSnippet = annotatedLines.slice(firstLineIndex, lastLineIndex);\n\n  return {\n    snippetLines: annotatedSnippet,\n    allLines: annotatedLines,\n  };\n}\n","/**\n * Converts raw.githubusercontent.com URLS to github.com URLs.\n *\n * E.g. https://raw.githubusercontent.com/golang/go/master/src/runtime/netpoll_kqueue.go\n * needs to be to transformed to: https://github.com/{org}/{repo}/blob/{filepath}\n */\nexport function buildGithubUrlForFunction(url: string, startLine: unknown): string {\n  let newUrl = url;\n\n  const matches = url.match(/raw\\.githubusercontent\\.com\\/([^/]+)\\/([^/]+)\\/(.+)/);\n  if (matches) {\n    const [, org, repo, rest] = matches;\n    newUrl = `https://github.com/${org}/${repo}/blob/${rest}`;\n  }\n\n  if (startLine !== undefined && !url.includes('#')) {\n    // link to the specific line this function exists at\n    newUrl += `#L${startLine}`;\n  }\n\n  return newUrl;\n}\n","import { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useMemo, useState } from 'react';\n\nimport { FunctionDetails, LineProfile } from '../../../domain/types/FunctionDetails';\nimport { useGitHubContext } from '../../GitHubContextProvider/useGitHubContext';\nimport { useFetchVCSFile } from '../infrastructure/useFetchVCSFile';\nimport { annotateLines, annotatePlaceholderLines } from './annotateLines';\nimport { buildGithubUrlForFunction } from './buildGithubUrlForFunction';\n\n/**\n * View model for Code component\n */\nexport type CodeLine = LineProfile & { line: string };\n\ntype CodeContainerDomainValue = DomainHookReturnValue & { data: { snippetLines: CodeLine[]; allLines: CodeLine[] } };\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function useCodeContainer(dataSourceUid: string, functionDetails: FunctionDetails): CodeContainerDomainValue {\n  const { isLoggedIn } = useGitHubContext();\n  const { version } = functionDetails;\n\n  const [openAiSuggestions, setOpenAiSuggestions] = useState<boolean>(false);\n\n  const {\n    fileInfo,\n    error: fetchError,\n    isFetching,\n  } = useFetchVCSFile({\n    enabled: isLoggedIn,\n    dataSourceUid,\n    localPath: functionDetails.fileName,\n    repository: version?.repository ?? '',\n    gitRef: version?.git_ref ?? '',\n    rootPath: version?.root_path ?? '',\n  });\n\n  // might be a bit costly so we memoize it\n  const { snippetLines, allLines } = useMemo(\n    () =>\n      fileInfo?.content\n        ? annotateLines(fileInfo.content, functionDetails.callSites)\n        : annotatePlaceholderLines(functionDetails.callSites),\n    [fileInfo?.content, functionDetails.callSites]\n  );\n\n  return {\n    data: {\n      fetchError,\n      openAiSuggestions,\n      isLoadingCode: isFetching,\n      unit: functionDetails.unit,\n      githubUrl: fileInfo?.URL ? buildGithubUrlForFunction(fileInfo.URL, functionDetails.startLine) : undefined,\n      snippetLines: snippetLines.map((annotatedLine) => ({ ...annotatedLine, line: annotatedLine.line ?? '???' })),\n      allLines: allLines.map((annotateLine) => ({ ...annotateLine, line: annotateLine.line ?? '???' })),\n      noCodeAvailable: Boolean(fetchError) || !allLines.some((line) => line.line),\n    },\n    actions: {\n      setOpenAiSuggestions,\n    },\n  };\n}\n","import { useQuery } from '@tanstack/react-query';\n\nimport { DataSourceProxyClientBuilder } from '../../../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PrivateVcsClient } from '../../GitHubContextProvider/infrastructure/PrivateVcsClient';\n\ntype FetchParams = {\n  enabled: boolean;\n  dataSourceUid: string;\n  repository: string;\n  gitRef: string;\n  localPath: string;\n  rootPath: string;\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: Error | null;\n  fileInfo?: {\n    content: string;\n    URL: string;\n  };\n};\n\nexport function useFetchVCSFile({\n  enabled,\n  dataSourceUid,\n  repository,\n  gitRef,\n  localPath,\n  rootPath,\n}: FetchParams): FetchResponse {\n  const privateVcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, PrivateVcsClient);\n  const { isFetching, error, data } = useQuery({\n    enabled: Boolean(enabled && localPath),\n    queryKey: ['vcs-file', repository, gitRef, localPath, rootPath],\n    queryFn: () =>\n      privateVcsClient\n        .getFile(repository, gitRef, localPath, rootPath)\n        .then((code) => ({\n          content: code.content,\n          URL: code.URL,\n        }))\n        .then((json) => ({ URL: json.URL, content: atob(json.content) })),\n  });\n\n  return {\n    isFetching,\n    error: privateVcsClient.isAbortError(error) ? null : error,\n    fileInfo: data,\n  };\n}\n","import { getValueFormat, ValueFormatter } from '@grafana/data';\n\ntype FormatUnit = 'nanoseconds' | 'microseconds' | 'milliseconds' | 'seconds' | 'count' | string;\n\nexport function buildUnitFormatter(unit: FormatUnit): ValueFormatter {\n  switch (unit) {\n    case 'nanoseconds':\n      return getValueFormat('ns');\n    case 'microseconds':\n      return getValueFormat('µs');\n    case 'milliseconds':\n      return getValueFormat('ms');\n    case 'seconds':\n      return getValueFormat('s');\n    case 'count':\n      return getValueFormat('short');\n    default:\n      return getValueFormat(unit);\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { LinkButton, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { AIButton } from '../../../../../../../components/SceneAiPanel/components/AiButton/AIButton';\nimport { buildUnitFormatter } from '../../../domain/buildUnitFormatter';\nimport { CodeLine } from '../domain/useCodeContainer';\n\ntype CodeProps = {\n  lines: CodeLine[];\n  unit: string;\n  githubUrl?: string;\n  isLoadingCode: boolean;\n  noCodeAvailable: boolean;\n  onOptimizeCodeClick: () => void;\n};\n\nexport const Code = ({ lines, unit, githubUrl, isLoadingCode, noCodeAvailable, onOptimizeCodeClick }: CodeProps) => {\n  const styles = useStyles2(getStyles);\n\n  const fmt = buildUnitFormatter(unit);\n  const formatValue = (n: number): string => {\n    if (n <= 0) {\n      return '.';\n    }\n\n    const formatted = fmt(n);\n    if (!formatted.suffix) {\n      return formatted.text;\n    }\n    return formatted.text + formatted.suffix;\n  };\n\n  // TODO: memoize\n  // Trim common indent prefixes from each line, if possible. This prevents us\n  // from rendering deeply indented code where the user would have to\n  // immediately scroll right to read the code.\n  trimIndentPrefix(lines);\n\n  // TODO: move to useCodeContainer()?\n  const [sumSelf, sumTotal] = lines.reduce(\n    ([accSelf, accTotal], { flat, cum }) => [accSelf + flat, accTotal + cum],\n    [0, 0]\n  );\n\n  return (\n    <div data-testid=\"function-details-code-container\">\n      <div className={styles.container}>\n        <div className={styles.header}>\n          <div className={styles.breakdownLabel}>\n            <h6>Breakdown per line</h6>\n            <span>\n              {isLoadingCode && <Spinner inline />}\n              {!isLoadingCode && noCodeAvailable && '(file information unavailable)'}\n            </span>\n          </div>\n\n          <div className={styles.buttons}>\n            <LinkButton\n              disabled={Boolean(isLoadingCode || !githubUrl)}\n              href={githubUrl}\n              target=\"_blank\"\n              icon=\"github\"\n              fill=\"text\"\n            >\n              View on GitHub\n            </LinkButton>\n\n            <AIButton\n              onClick={onOptimizeCodeClick}\n              disabled={isLoadingCode || noCodeAvailable}\n              interactionName=\"g_pyroscope_app_optimize_code_clicked\"\n            >\n              Optimize Code\n            </AIButton>\n          </div>\n        </div>\n      </div>\n\n      <pre className={styles.codeBlock} data-testid=\"function-details-code\">\n        <div className={cx(styles.highlighted, styles.codeBlockHeader)}>\n          {formatLine('Total:', formatValue(sumSelf), formatValue(sumTotal), ' (self, total)')}\n        </div>\n        {lines.map(({ line, number, cum: total, flat: self }) => (\n          <div key={line + number + total + self} className={self + total > 0 ? styles.highlighted : ''}>\n            {\n              // The space after `number` is relevant. It aligns the line\n              // number with the `Total:` header to mimic the pprof tool.\n              formatLine(`${number} `, formatValue(self), formatValue(total), line)\n            }\n          </div>\n        ))}\n      </pre>\n    </div>\n  );\n};\n\nconst formatLine = (lineNumber: string, self: string, total: string, rest?: string): string => {\n  // The length of each column is important. In order for tabs to render to\n  // their full width, the length of all the column widths must be one less than\n  // a multiple of 8.\n  const cols = lineNumber.padStart(7, ' ') + self.padStart(12, ' ') + total.padStart(12, ' ');\n\n  if (!rest) {\n    return cols;\n  }\n  return `${cols} ${rest}`;\n};\n\nconst trimIndentPrefix = (lines: CodeLine[]) => {\n  if (lines.length === 0) {\n    return;\n  }\n\n  let commonPrefix = getIndentPrefix(lines[0].line);\n  for (let i = 1; i < lines.length; i++) {\n    const { line } = lines[i];\n    if (line.trim() === '') {\n      // Don't count blank lines or lines with only whitespace.\n      continue;\n    }\n\n    const prefix = getIndentPrefix(line);\n    commonPrefix = longestCommonPrefix(commonPrefix, prefix);\n  }\n\n  if (!commonPrefix) {\n    // No common prefixes were found.\n    return;\n  }\n\n  // Trim the common prefix.\n  for (let i = 0; i < lines.length; i++) {\n    lines[i].line = lines[i].line.substring(commonPrefix.length);\n  }\n};\n\nconst getIndentPrefix = (text: string): string => {\n  const matches = text.match(/^[ \\t]*/);\n  return matches?.[0] ?? '';\n};\n\nconst longestCommonPrefix = (a: string, b: string): string => {\n  let prefixLen = 0;\n  for (let i = 0; i < Math.min(a.length, b.length); i++) {\n    if (a[i] !== b[i]) {\n      break;\n    }\n\n    prefixLen++;\n  }\n  return a.substring(0, prefixLen);\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    width: 100%;\n  `,\n  header: css`\n    display: flex;\n    justify-content: space-between;\n    align-items: end;\n    width: 100%;\n  `,\n  breakdownLabel: css`\n    & > h6 {\n      display: inline-block;\n      margin-top: ${theme.spacing(1)};\n    }\n\n    & > span {\n      margin-left: ${theme.spacing(1)};\n      font-size: ${theme.typography.bodySmall.fontSize};\n    }\n\n    & > svg {\n      margin-left: ${theme.spacing(1)};\n    }\n  `,\n  buttons: css`\n    display: flex;\n    flex-wrap: no-wrap;\n  `,\n  codeBlock: css`\n    position: relative;\n    min-height: 240px;\n    font-size: 12px;\n    overflow-x: auto;\n    white-space: pre;\n    color: ${theme.colors.text.secondary};\n  `,\n  highlighted: css`\n    color: ${theme.colors.text.maxContrast};\n  `,\n  codeBlockHeader: css`\n    margin-bottom: 8px;\n  `,\n});\n","import { displayError } from '@shared/domain/displayStatus';\nimport { HttpClientError } from '@shared/infrastructure/http/HttpClientError';\nimport React from 'react';\n\nimport { FunctionDetails } from '../../domain/types/FunctionDetails';\nimport { AiSuggestionsPanel } from '../AiSuggestionsPanel/AiSuggestionsPanel';\nimport { useCodeContainer } from './domain/useCodeContainer';\nimport { Code } from './ui/Code';\n\ntype CodeContainerProps = {\n  dataSourceUid: string;\n  functionDetails: FunctionDetails;\n};\n\nexport function CodeContainer({ dataSourceUid, functionDetails }: CodeContainerProps) {\n  const { data, actions } = useCodeContainer(dataSourceUid, functionDetails);\n\n  if (data.fetchError && (data.fetchError as HttpClientError)?.response?.status !== 404) {\n    displayError(data.fetchError, ['Failed to fetch file information!', (data.fetchError as Error).message]);\n  }\n\n  return (\n    <>\n      <Code\n        lines={data.snippetLines}\n        unit={data.unit}\n        githubUrl={data.githubUrl}\n        isLoadingCode={data.isLoadingCode}\n        noCodeAvailable={data.noCodeAvailable}\n        onOptimizeCodeClick={() => {\n          actions.setOpenAiSuggestions(true);\n          document.getElementById('ai-suggestions-panel')?.scrollIntoView({\n            behavior: 'smooth',\n          });\n        }}\n      />\n      <h6 id=\"ai-suggestions-panel\" style={{ height: 0, marginBottom: 0 }}></h6>\n      {data.openAiSuggestions ? (\n        <AiSuggestionsPanel\n          suggestionPromptInputs={{\n            functionDetails: functionDetails,\n            lines: data.allLines,\n          }}\n        />\n      ) : null}\n    </>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Icon, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { useGitHubContext } from './GitHubContextProvider/useGitHubContext';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  ellipsis: css`\n    color: ${theme.colors.primary.text};\n    text-overflow: ellipsis;\n    overflow: hidden;\n    direction: rtl;\n    white-space: nowrap;\n  `,\n});\n\ntype GitHubRepositoryProps = {\n  enableIntegration: boolean;\n  repository: {\n    name: string;\n    commitUrl: string;\n    commitName: string;\n  };\n};\n\nexport const GitHubRepository = ({ enableIntegration, repository }: GitHubRepositoryProps) => {\n  const styles = useStyles2(getStyles);\n  const { isLoginInProgress, isLoggedIn, login } = useGitHubContext();\n\n  if (!enableIntegration) {\n    return <>-</>;\n  }\n\n  // enableIntegration=true\n  if (isLoginInProgress) {\n    return (\n      <>\n        <Spinner />\n        <span>Connecting to GitHub...</span>\n      </>\n    );\n  }\n\n  // enableIntegration=true, isLoginInProgress=false\n  if (!isLoggedIn) {\n    return (\n      <Button\n        icon=\"github\"\n        variant=\"primary\"\n        onClick={login}\n        tooltip=\"Once connected, the GitHub code will be accessible only from this browser session.\"\n        tooltipPlacement=\"top\"\n      >\n        Connect to {repository.name}\n      </Button>\n    );\n  }\n\n  // enableIntegration=true, isLoginInProgress=false, isLoggedIn=true\n  return (\n    <>\n      <Icon name=\"github\" size=\"lg\" />\n      <a className={styles.ellipsis} href={repository.commitUrl} target=\"_blank\" rel=\"noreferrer\" title=\"View commit\">\n        <Icon name=\"external-link-alt\" />\n        &nbsp;\n        {repository.commitName}\n      </a>\n    </>\n  );\n};\n","import { Commit, FunctionDetails } from './types/FunctionDetails';\n\nexport type CommitWithSamples = Commit & {\n  samples: {\n    unit: string;\n    current: number;\n    total: number;\n  };\n};\n\nexport function getCommitsWithSamples(functionsDetails: FunctionDetails[], totalSamples: number): CommitWithSamples[] {\n  const commits = functionsDetails.map((details) => ({\n    ...details.commit,\n    samples: {\n      unit: details.unit ?? 'count',\n      current: Array.from(details.callSites.values()).reduce((acc, { cum }) => acc + cum, 0),\n      total: totalSamples,\n    },\n  }));\n\n  return commits;\n}\n","export const GITHUB_URL = 'https://github.com/';\n\nexport const isGitHubRepository = (repositoryUrl: string): boolean => repositoryUrl.startsWith(GITHUB_URL);\n","import { GITHUB_URL } from './isGitHubRepository';\nimport { FunctionVersion } from './types/FunctionDetails';\n\nexport function getRepositoryDetails(isGitHub: boolean, functionVersion?: FunctionVersion) {\n  if (!functionVersion?.repository) {\n    return null;\n  }\n\n  const url = functionVersion.repository;\n  const name = url.replace(GITHUB_URL, '');\n  const gitRef = functionVersion.git_ref;\n\n  return {\n    isGitHub,\n    url,\n    name,\n    commitUrl: gitRef ? `${url}/commit/${gitRef}` : url,\n    commitName: gitRef ? `${name}@${gitRef.substring(0, 7)}` : name,\n  };\n}\n","import { Function, Line, Location, Mapping, PprofProfile, Sample } from '@shared/types/PprofProfile';\n\nimport { PLACEHOLDER_COMMIT_DATA } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { CallSiteProps, FunctionDetails } from './types/FunctionDetails';\n\nconst buildDetails = (profile: PprofProfile, func: Function, mapping?: Mapping) => {\n  let version;\n\n  try {\n    version = mapping ? JSON.parse(profile.stringTable[Number(mapping.buildId)]) : undefined;\n  } catch {}\n\n  return {\n    name: profile.stringTable[Number(func.name)],\n    version,\n    startLine: !Number.isNaN(Number(func.startLine)) ? Number(func.startLine) : undefined,\n    fileName: profile.stringTable[Number(func.filename)],\n    callSites: new Map<number, CallSiteProps>(),\n    unit: profile.stringTable[Number(profile.sampleType[0].unit)],\n    commit: PLACEHOLDER_COMMIT_DATA,\n  };\n};\n\n// sums up the value for a particular callsite\nfunction addCallSiteValue(details: FunctionDetails, line: Line, value: number, index: number): FunctionDetails {\n  const lineNumber = Number(line.line);\n  const callSite = details.callSites.get(lineNumber) || {\n    line: Number(line.line),\n    flat: 0,\n    cum: 0,\n  };\n\n  // if the function we're interested in is at the leaf node (index=0), we have its flat value...\n  const flat = index === 0 ? value : 0; // value of the location itself\n\n  // ...if not, that's its cum value\n  // locations above the leaf node don't contribute to the sample value (their self is 0)\n  // this is what the API returns\n  const cum = value; // value of the location plus all its descendants\n\n  callSite.flat += flat;\n  callSite.cum += cum;\n\n  details.callSites.set(lineNumber, callSite);\n\n  return details;\n}\n\n// This reimplements functionality simliar to the upstream project:\n// https://github.com/google/pprof/blob/997b0b79cac0f8c2f2566c506212de67a6edc5ff/internal/report/source.go#L318\nfunction convertSample(\n  fnName: string,\n  profile: PprofProfile,\n  locations: Map<string, Location>,\n  functions: Map<string, Function>,\n  mappings: Map<string, Mapping>,\n  sample: Sample,\n  versions: Map<string, FunctionDetails>\n) {\n  const locationIdSet = new Set();\n\n  sample.locationId.forEach((locationId, index) => {\n    const location = locations.get(locationId);\n    if (!location) {\n      return;\n    }\n\n    location.line.forEach((line) => {\n      const func = functions.get(line.functionId);\n      if (!func) {\n        return;\n      }\n\n      if (profile.stringTable[Number(func.name)] !== fnName) {\n        return;\n      }\n\n      // https://github.com/google/pprof/blob/main/doc/README.md#details\n      if (locationIdSet.has(locationId)) {\n        return;\n      }\n\n      locationIdSet.add(locationId);\n\n      const details = versions.get(location.mappingId) || buildDetails(profile, func, mappings.get(location.mappingId));\n\n      versions.set(location.mappingId, addCallSiteValue(details, line, Number(sample.value[0]), index));\n    });\n  });\n}\n\nexport function convertPprofToFunctionDetails(fnName: string, profile: PprofProfile): FunctionDetails[] {\n  const versions = new Map<string, FunctionDetails>();\n\n  const locations = new Map(profile.location?.map((l) => [l.id, l]));\n  const functions = new Map(profile.function?.map((f) => [f.id, f]));\n  const mappings = new Map(profile.mapping?.map((m) => [m.id, m]));\n\n  profile.sample\n    // Sometimes a sample may not have a stack trace associated with it. This\n    // may be a bug in the Pyroscope API or it may be an idiosyncrasy of the pprof format.\n    // While it may cause some counting errors, let's skip these for now.\n    ?.filter((sample) => sample.locationId !== undefined)\n    .forEach((sample) => convertSample(fnName, profile, locations, functions, mappings, sample, versions));\n\n  return Array.from(versions.values());\n}\n","import { DataSourceProxyClientBuilder } from '../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PrivateVcsClient } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { FunctionDetails } from '../domain/types/FunctionDetails';\n\nexport async function fetchCommitsInfo(\n  dataSourceUid: string,\n  functionsDetails: FunctionDetails[]\n): Promise<FunctionDetails[]> {\n  const privateVcsClient = DataSourceProxyClientBuilder.build(dataSourceUid, PrivateVcsClient);\n\n  const commits = functionsDetails.map((details) => ({\n    repositoryUrl: details?.version?.repository || '',\n    gitRef: details?.version?.git_ref || 'HEAD',\n    rootPath: details?.version?.root_path || '',\n  }));\n\n  // TODO: extract to its own hook and simplify useSceneFunctionDetailsPanel()?\n  const commitsInfo = await privateVcsClient.getCommits(commits);\n\n  commitsInfo.forEach((commit, i) => {\n    functionsDetails[i].commit = commit;\n  });\n\n  return functionsDetails;\n}\n","import { FunctionDetails } from '../../domain/types/FunctionDetails';\n\nexport const getTotalSum = (fd: FunctionDetails): number =>\n  Array.from(fd.callSites.values()).reduce((acc, { cum }) => acc + cum, 0);\n","import { FunctionDetails } from '../../domain/types/FunctionDetails';\nimport { getTotalSum } from './getTotalSum';\n\nexport const sortByTotal = (a: FunctionDetails, b: FunctionDetails) => getTotalSum(b) - getTotalSum(a);\n","import { TimeRange } from '@grafana/data';\nimport { parseQuery } from '@shared/domain/url-params/parseQuery';\nimport { useQuery } from '@tanstack/react-query';\nimport { useMemo } from 'react';\n\nimport { DataSourceProxyClientBuilder } from '../../../../../infrastructure/series/http/DataSourceProxyClientBuilder';\nimport { PprofApiClient } from '../../../infrastructure/PprofApiClient';\nimport { PLACEHOLDER_COMMIT_DATA } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { useGitHubContext } from '../components/GitHubContextProvider/useGitHubContext';\nimport { convertPprofToFunctionDetails } from '../domain/convertPprofToFunctionDetails';\nimport { FunctionDetails } from '../domain/types/FunctionDetails';\nimport { fetchCommitsInfo } from './fetchCommitsInfo';\nimport { sortByTotal } from './helpers/sortByTotal';\n\ntype FetchParams = {\n  dataSourceUid: string;\n  query: string;\n  timeRange: TimeRange;\n  stackTrace: string[];\n};\n\ntype FetchResponse = {\n  isFetching: boolean;\n  error: Error | null;\n  functionsDetails: FunctionDetails[];\n};\n\n// We don't expect more than 500 nodes after the selected node.\n// This will avoid downloading too much data by removing leaf nodes.\n// TODO: This could be a setting in the UI.\nconst MAX_NODES = 500;\n\n// eslint-disable-next-line sonarjs/cognitive-complexity\nexport function useFetchFunctionsDetails({ dataSourceUid, query, timeRange, stackTrace }: FetchParams): FetchResponse {\n  const { profileMetricId, labelsSelector } = parseQuery(query);\n  const [start, end] = [timeRange.from.unix(), timeRange.to.unix()];\n  const { isLoggedIn: isGitHubLogged } = useGitHubContext();\n\n  const pprofApiClient = DataSourceProxyClientBuilder.build(dataSourceUid, PprofApiClient);\n\n  const {\n    isFetching,\n    error: queryError,\n    data,\n  } = useQuery({\n    enabled: Boolean(profileMetricId && labelsSelector && stackTrace.length > 0 && start > 0 && end > 0),\n    // eslint-disable-next-line @tanstack/query/exhaustive-deps\n    queryKey: ['function-details', profileMetricId, labelsSelector, start, end, stackTrace, isGitHubLogged],\n    queryFn: async () => {\n      const pprof = await pprofApiClient.selectMergeProfileJson({\n        profileMetricId,\n        labelsSelector,\n        start,\n        end,\n        stackTrace,\n        maxNodes: MAX_NODES,\n      });\n\n      const functionsDetails = convertPprofToFunctionDetails(stackTrace[stackTrace.length - 1], pprof).sort(\n        sortByTotal\n      );\n\n      return isGitHubLogged ? fetchCommitsInfo(dataSourceUid, functionsDetails) : functionsDetails;\n    },\n  });\n\n  const functionsDetails = useMemo(\n    () =>\n      data?.length\n        ? data\n        : [\n            {\n              name: stackTrace.at(-1) as string,\n              startLine: undefined,\n              fileName: '',\n              callSites: new Map(),\n              unit: '',\n              commit: PLACEHOLDER_COMMIT_DATA,\n            },\n          ],\n    [data, stackTrace]\n  );\n\n  return {\n    isFetching,\n    error: pprofApiClient.isAbortError(queryError) ? null : queryError,\n    functionsDetails,\n  };\n}\n","// Array reprsenting one minute, hour, day, week, month, etc in seconds\nconst CUTOFFS = [60, 3600, 86400, 86400 * 7, 86400 * 30, 86400 * 365, Infinity];\n\n// Array equivalent to the above but in the string representation of the units\nconst UNITS: Intl.RelativeTimeFormatUnit[] = ['second', 'minute', 'hour', 'day', 'week', 'month', 'year'];\n\n// Intl.RelativeTimeFormat do its magic\nconst RTF = new Intl.RelativeTimeFormat('en-US', { numeric: 'auto' });\n\n/**\n * Convert a date to a relative time string, such as \"a minute ago\", \"in 2 hours\", \"yesterday\", \"3 months ago\", etc.\n *\n * Adapted from https://www.builder.io/blog/relative-time\n */\nexport function getRelativeTimeString(date: Date): string {\n  const timeMs = date.getTime();\n\n  // Get the amount of seconds between the given date and now\n  const deltaSeconds = Math.round((timeMs - Date.now()) / 1000);\n\n  // Grab the ideal cutoff unit\n  const unitIndex = CUTOFFS.findIndex((cutoff) => cutoff > Math.abs(deltaSeconds));\n\n  // Get the divisor to divide from the seconds. E.g. if our unit is \"day\" our divisor\n  // is one day in seconds, so we can divide our seconds by this to get the # of days\n  const divisor = unitIndex ? CUTOFFS[unitIndex - 1] : 1;\n\n  // Intl.RelativeTimeFormat do its magic\n  return RTF.format(Math.floor(deltaSeconds / divisor), UNITS[unitIndex]);\n}\n","import { getRelativeTimeString } from './getRelativeTimeString';\n\nconst DTF = new Intl.DateTimeFormat('en-US', {\n  year: 'numeric',\n  month: 'long',\n  day: '2-digit',\n});\n\nexport function formatCommitDate(commitDate?: Date) {\n  return commitDate ? `${DTF.format(commitDate)} (${getRelativeTimeString(commitDate)})` : '?';\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { buildUnitFormatter } from '../domain/buildUnitFormatter';\nimport { formatCommitDate } from '../domain/formatCommitDate';\nimport { CommitWithSamples } from '../domain/getCommitsWithSamples';\nimport { getCommitShortMessage, getCommitShortSha } from './CommitSelect';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n  `,\n  firstLine: css`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 1em;\n  `,\n  sha: css`\n    font-family: monospace;\n  `,\n  sample: css`\n    font-size: 12px;\n  `,\n  secondLine: css`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    font-size: 12px;\n    color: ${theme.colors.text.secondary};\n  `,\n  avatar: css`\n    display: inline-block;\n    margin-right: 4px;\n    border-radius: 50%;\n    background: grey;\n    width: 16px;\n    height: 16px;\n  `,\n  message: css`\n    font-size: 12px;\n    color: ${theme.colors.text.secondary};\n  `,\n});\n\ntype CommitOptionProps = {\n  commit: CommitWithSamples;\n};\n\nexport function CommitOption({ commit }: CommitOptionProps) {\n  const styles = useStyles2(getStyles);\n\n  const { author, samples } = commit;\n\n  const commitAuthor = author.login;\n  const commitAuthorAvatarUrl = author.avatarURL;\n\n  const total = buildUnitFormatter(samples.unit)(samples.current);\n  const samplePercent = Math.round((samples.current / samples.total) * 100);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.firstLine}>\n        <span className={styles.sha}>{getCommitShortSha(commit.sha)}</span>\n        <span className={styles.sample}>\n          {total.text}\n          {total.suffix} ({samplePercent}%)\n        </span>\n      </div>\n\n      <div className={styles.secondLine}>\n        {commitAuthorAvatarUrl && <img className={styles.avatar} src={commitAuthorAvatarUrl} alt={commitAuthor} />}\n        <span>\n          {commitAuthor} on {formatCommitDate(commit.date)}\n        </span>\n      </div>\n\n      <span className={styles.message}>{getCommitShortMessage(commit.message)}</span>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { Commit } from '../domain/types/FunctionDetails';\nimport { getCommitShortMessage, getCommitShortSha } from './CommitSelect';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    gap: 1em;\n  `,\n  sha: css`\n    font-family: monospace;\n  `,\n  message: css`\n    color: ${theme.colors.text.secondary};\n  `,\n});\n\ntype CommitOptionSelectedProps = {\n  commit: Commit;\n};\n\nexport function CommitOptionSelected({ commit }: CommitOptionSelectedProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <span className={styles.sha}>{getCommitShortSha(commit.sha)}</span>\n      <div className={styles.message}>\n        <span>{getCommitShortMessage(commit.message)}</span>\n      </div>\n    </div>\n  );\n}\n","import { SelectableValue } from '@grafana/data';\nimport { FormatOptionLabelMeta, Select } from '@grafana/ui';\nimport React from 'react';\n\nimport { PLACEHOLDER_COMMIT_DATA } from '../components/GitHubContextProvider/infrastructure/PrivateVcsClient';\nimport { CommitWithSamples } from '../domain/getCommitsWithSamples';\nimport { CommitOption } from './CommitOption';\nimport { CommitOptionSelected } from './CommitOptionSelected';\n\ntype CommitSelectProps = {\n  commits: CommitWithSamples[];\n  selectedCommit: CommitWithSamples;\n  onChange: (commit: CommitWithSamples) => void;\n};\n\nexport function CommitSelect({ commits, selectedCommit, onChange }: CommitSelectProps) {\n  return (\n    <Select\n      options={commits.map((commit) => ({\n        label: commit.sha,\n        value: commit,\n      }))}\n      value={{\n        label: selectedCommit.sha,\n        value: selectedCommit,\n      }}\n      hideSelectedOptions\n      isSearchable={false}\n      noOptionsMessage=\"No commits found\"\n      formatOptionLabel={formatOption}\n      onChange={(item) => {\n        if (item.value) {\n          onChange(item.value);\n        }\n      }}\n    />\n  );\n}\n\nfunction formatOption(\n  item: SelectableValue<CommitWithSamples>,\n  formatOptionMeta: FormatOptionLabelMeta<CommitWithSamples>\n) {\n  const { value: commit } = item;\n\n  if (!commit) {\n    return null;\n  }\n\n  const isSelected = formatOptionMeta.selectValue[0]?.value === commit;\n\n  return isSelected ? <CommitOptionSelected commit={commit} /> : <CommitOption commit={commit} />;\n}\n\nexport const getCommitShortSha = (sha: string): string => {\n  return sha === PLACEHOLDER_COMMIT_DATA.sha ? sha : sha.substring(0, 7);\n};\n\nexport const getCommitShortMessage = (message: string): string => {\n  return message.split('\\n')[0];\n};\n","import { Alert, Icon, TextLink } from '@grafana/ui';\nimport React from 'react';\n\ntype GitHubIntegrationBannerProps = {\n  onDismiss: () => void;\n};\n\nexport const GitHubIntegrationBanner = ({ onDismiss }: GitHubIntegrationBannerProps) => {\n  return (\n    <Alert severity=\"info\" title=\"Integrate with Github\" buttonContent=\"Dismiss\" onRemove={onDismiss}>\n      <p>\n        This language supports integration with <Icon name=\"github\" /> GitHub.\n      </p>\n      <p>\n        To activate this feature, you will need to add two new labels when sending profiles{' '}\n        <code>service_repository</code> and <code>service_git_ref</code>.{' '}\n      </p>\n      <p>\n        They should respectively be set to the full repository GitHub URL and the current{' '}\n        <TextLink href=\"https://docs.github.com/en/rest/git/refs?apiVersion=2022-11-28#about-git-references\" external>\n          git ref\n        </TextLink>{' '}\n        of the running service.\n      </p>\n      <Icon name=\"document-info\" />{' '}\n      <TextLink\n        href=\"https://grafana.com/docs/grafana-cloud/monitor-applications/profiles/pyroscope-github-integration/\"\n        external\n      >\n        Learn more\n      </TextLink>\n    </Alert>\n  );\n};\n","import { Spinner } from '@grafana/ui';\nimport React, { memo } from 'react';\n\ntype InlineSpinnerProps = {\n  isLoading: boolean;\n  children: React.ReactNode;\n};\n\nfunction InlineSpinnerComponent({ isLoading, children }: InlineSpinnerProps) {\n  return isLoading ? <Spinner inline /> : <>{children}</>;\n}\n\nexport const InlineSpinner = memo(InlineSpinnerComponent);\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { IconButton, InlineLabel, TextLink, Tooltip, useStyles2 } from '@grafana/ui';\nimport { displaySuccess } from '@shared/domain/displayStatus';\nimport { userStorage } from '@shared/infrastructure/userStorage';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport React, { useMemo, useState } from 'react';\n\nimport { useBuildPyroscopeQuery } from '../../../../domain/useBuildPyroscopeQuery';\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { CodeContainer } from './components/CodeContainer/CodeContainer';\nimport { GitHubRepository } from './components/GitHubRepository';\nimport { formatFileName } from './domain/formatFileName';\nimport { CommitWithSamples, getCommitsWithSamples } from './domain/getCommitsWithSamples';\nimport { getRepositoryDetails } from './domain/getRepositoryDetails';\nimport { isGitHubRepository } from './domain/isGitHubRepository';\nimport { FunctionDetails } from './domain/types/FunctionDetails';\nimport { StackTrace } from './domain/types/StackTrace';\nimport { useFetchFunctionsDetails } from './infrastructure/useFetchFunctionsDetails';\nimport { CommitSelect } from './ui/CommitSelect';\nimport { GitHubIntegrationBanner } from './ui/GitHubIntegrationBanner';\nimport { InlineSpinner } from './ui/InlineSpinner';\n\ninterface SceneFunctionDetailsPanelState extends SceneObjectState {}\n\nexport class SceneFunctionDetailsPanel extends SceneObjectBase<SceneFunctionDetailsPanelState> {\n  static LABEL_WIDTH = 16;\n\n  constructor() {\n    super({ key: 'function-details-panel' });\n  }\n\n  // eslint-disable-next-line sonarjs/cognitive-complexity\n  useSceneFunctionDetailsPanel = (stackTrace: StackTrace, timeRange: TimeRange): DomainHookReturnValue => {\n    const dataSourceUid = sceneGraph.findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable).useState()\n      .value as string;\n    const query = useBuildPyroscopeQuery(this, 'filters');\n\n    const {\n      functionsDetails,\n      error: fetchFunctionDetailsError,\n      isFetching,\n    } = useFetchFunctionsDetails({ dataSourceUid, query, timeRange, stackTrace });\n\n    const [prevFunctionsDetails, setPrevFunctionsDetails] = useState<FunctionDetails[]>();\n    const [currentFunctionDetails, setCurrentFunctionDetails] = useState<FunctionDetails>(functionsDetails[0]);\n    const [isGitHubBannerDismissed, setIsGitHubBannerDismissed] = useState(\n      userStorage.has(userStorage.KEYS.GITHUB_INTEGRATION)\n    );\n\n    if (functionsDetails && prevFunctionsDetails !== functionsDetails) {\n      setPrevFunctionsDetails(functionsDetails);\n\n      if (currentFunctionDetails !== functionsDetails[0]) {\n        setCurrentFunctionDetails(functionsDetails[0]);\n      }\n    }\n\n    const isGitHubRepo = isGitHubRepository(currentFunctionDetails?.version?.repository || '');\n    const isGitHubSupported = currentFunctionDetails?.fileName?.endsWith('.go');\n    const shouldDisplayGitHubBanner = !isGitHubBannerDismissed && !isGitHubRepo && isGitHubSupported;\n\n    // TODO: massage in useFetchFunctionsDetails?\n    const totalSamples = useMemo(\n      () =>\n        functionsDetails\n          .map((details) => Array.from(details.callSites.values()).reduce((acc, { cum }) => acc + cum, 0))\n          .reduce((acc, total) => acc + total, 0),\n      [functionsDetails]\n    );\n    const commits = getCommitsWithSamples(functionsDetails, totalSamples);\n    const selectedCommit = commits.find(({ sha }) => sha === currentFunctionDetails?.commit?.sha);\n\n    return {\n      data: {\n        isLoading: isFetching,\n        fetchFunctionDetailsError,\n        functionDetails: currentFunctionDetails,\n        // TODO: massage in useFetchFunctionsDetails?\n        repository: getRepositoryDetails(isGitHubRepo, currentFunctionDetails?.version),\n        commits,\n        selectedCommit,\n        isGitHubSupported,\n        shouldDisplayGitHubBanner,\n        dataSourceUid,\n      },\n      actions: {\n        selectCommit(selectedCommit: CommitWithSamples) {\n          const details = functionsDetails.find(({ commit }) => commit.sha === selectedCommit.sha);\n          setCurrentFunctionDetails(details as FunctionDetails);\n        },\n        async copyFilePathToClipboard() {\n          try {\n            if (currentFunctionDetails?.fileName) {\n              await navigator.clipboard.writeText(currentFunctionDetails.fileName);\n              displaySuccess(['File path copied to clipboard!']);\n            }\n          } catch {}\n        },\n        dismissGitHubBanner() {\n          userStorage.set(userStorage.KEYS.GITHUB_INTEGRATION, {});\n          setIsGitHubBannerDismissed(true);\n        },\n      },\n    };\n  };\n\n  static Component = ({\n    model,\n    timeRange,\n    stackTrace,\n    onClose,\n  }: SceneComponentProps<SceneFunctionDetailsPanel> & {\n    timeRange: TimeRange;\n    stackTrace: StackTrace;\n    onClose: () => void;\n  }) => {\n    const styles = useStyles2(getStyles);\n    const { data, actions } = model.useSceneFunctionDetailsPanel(stackTrace, timeRange);\n\n    return (\n      <Panel\n        className={styles.sidePanel}\n        title=\"Function Details\"\n        isLoading={false}\n        headerActions={<IconButton name=\"times-circle\" variant=\"secondary\" aria-label=\"close\" onClick={onClose} />}\n        dataTestId=\"function-details-panel\"\n      >\n        <div className={styles.content}>\n          {data.fetchFunctionDetailsError && (\n            <InlineBanner\n              severity=\"error\"\n              title=\"Error while fetching function details!\"\n              error={data.fetchFunctionDetailsError}\n            />\n          )}\n\n          <div className={styles.container}>\n            <div className={styles.row} data-testid=\"row-function-name\">\n              <InlineLabel width={SceneFunctionDetailsPanel.LABEL_WIDTH}>Function name</InlineLabel>\n              <Tooltip content={data.functionDetails.name} placement=\"top\">\n                <span className={styles.textValue}>{data.functionDetails.name}</span>\n              </Tooltip>\n            </div>\n\n            <div className={styles.row} data-testid=\"row-start-line\">\n              <InlineLabel\n                tooltip=\"The line where this function definition starts\"\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n              >\n                Start line\n              </InlineLabel>\n              <span className={styles.textValue}>\n                <InlineSpinner isLoading={data.isLoading}>\n                  {data.functionDetails.startLine !== undefined ? data.functionDetails.startLine : '-'}\n                </InlineSpinner>\n              </span>\n            </div>\n\n            <div className={styles.row} data-testid=\"row-file-path\">\n              <InlineLabel\n                tooltip=\"File path where that function is defined\"\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n              >\n                File\n              </InlineLabel>\n              <InlineSpinner isLoading={data.isLoading}>\n                {data.functionDetails.fileName ? (\n                  <>\n                    <Tooltip content={data.functionDetails.fileName} placement=\"top\">\n                      {/* adding LRM to prevent ellipsis with RTL to fail when the file name starts with non-alpha chars (e.g. \"$\")  */}\n                      <span className={styles.textValue}>&lrm;{formatFileName(data.functionDetails.fileName)}</span>\n                    </Tooltip>\n                    <IconButton\n                      name=\"clipboard-alt\"\n                      tooltip=\"Copy to clipboard\"\n                      onClick={actions.copyFilePathToClipboard}\n                    />\n                  </>\n                ) : (\n                  '-'\n                )}\n              </InlineSpinner>\n            </div>\n\n            {data.shouldDisplayGitHubBanner && (\n              <div className={styles.row} data-testid=\"row-github-banner\">\n                <GitHubIntegrationBanner onDismiss={actions.dismissGitHubBanner} />\n              </div>\n            )}\n\n            <div className={styles.row} data-testid=\"row-repository\">\n              <InlineLabel\n                tooltip=\"The repository configured for the selected service\"\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n              >\n                Repository\n              </InlineLabel>\n              <InlineSpinner isLoading={data.isLoading}>\n                {data.repository ? (\n                  data.repository.isGitHub ? (\n                    <GitHubRepository enableIntegration={data.isGitHubSupported} repository={data.repository} />\n                  ) : (\n                    <TextLink href={data.repository} external>\n                      {data.repository}\n                    </TextLink>\n                  )\n                ) : (\n                  '-'\n                )}\n              </InlineSpinner>\n            </div>\n\n            <div className={styles.row} data-testid=\"row-commit\">\n              <InlineLabel\n                width={SceneFunctionDetailsPanel.LABEL_WIDTH}\n                tooltip=\"The version of the application (commit) where the function is defined. Use the dropdown menu to target a specific commit.\"\n              >\n                Commit\n              </InlineLabel>\n              <InlineSpinner isLoading={data.isLoading}>\n                <CommitSelect\n                  commits={data.commits}\n                  selectedCommit={data.selectedCommit}\n                  onChange={actions.selectCommit}\n                />\n              </InlineSpinner>\n            </div>\n          </div>\n\n          <CodeContainer dataSourceUid={data.dataSourceUid} functionDetails={data.functionDetails} />\n        </div>\n      </Panel>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  sidePanel: css`\n    flex: 1 0 50%;\n    margin-left: 8px;\n    max-width: calc(50% - 4px);\n  `,\n  title: css`\n    margin: -4px 0 4px 0;\n  `,\n  content: css`\n    padding: ${theme.spacing(1)};\n  `,\n  container: css`\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n  `,\n  row: css`\n    width: 100%;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding-bottom: 10px;\n    > * {\n      margin-right: 10px !important;\n    }\n  `,\n  textValue: css`\n    // hack to have the ellipsis appear at the start of the string\n    direction: rtl;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n  `,\n});\n","// when using direction=rtl, the first / is ending up at the end of the string\n// so we add a / at the end of the string to make it look better\nexport const formatFileName = (fileName: string): string =>\n  fileName?.[0] === '/' ? fileName.substring(1) + '/' : fileName;\n","import { css } from '@emotion/css';\nimport { Button, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype Props = {\n  spanSelector: string;\n  removeSpanSelector: () => void;\n};\n\nexport function SpanSelectorLabel(props: Props) {\n  const { spanSelector, removeSpanSelector } = props;\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.container}>\n      <Tooltip content={`You have added a span selector to the flamegraph query (${spanSelector}).`} placement=\"top\">\n        <span>Span selector added</span>\n      </Tooltip>\n      <Button\n        size=\"md\"\n        fill=\"text\"\n        variant=\"secondary\"\n        icon=\"times\"\n        tooltip={`Remove span selector from query`}\n        tooltipPlacement=\"top\"\n        onClick={() => {\n          removeSpanSelector();\n        }}\n      />\n    </div>\n  );\n}\n\nconst getStyles = () => ({\n  container: css`\n    padding: 0 4px;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { createTheme, GrafanaTheme2, LoadingState, TimeRange } from '@grafana/data';\nimport { FlameGraph, Props as FlameGraphProps } from '@grafana/flamegraph';\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState, SceneQueryRunner } from '@grafana/scenes';\nimport { Spinner, useStyles2, useTheme2 } from '@grafana/ui';\nimport { displayWarning } from '@shared/domain/displayStatus';\nimport { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { useToggleSidePanel } from '@shared/domain/useToggleSidePanel';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { featureToggles } from '@shared/infrastructure/settings/featureToggles';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { Panel } from '@shared/ui/Panel/Panel';\nimport { PyroscopeLogo } from '@shared/ui/PyroscopeLogo';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { Unsubscribable } from 'rxjs';\n\nimport { useBuildPyroscopeQuery } from '../../domain/useBuildPyroscopeQuery';\nimport { getSceneVariableValue } from '../../helpers/getSceneVariableValue';\nimport { buildFlameGraphQueryRunner } from '../../infrastructure/flame-graph/buildFlameGraphQueryRunner';\nimport { PYROSCOPE_DATA_SOURCE } from '../../infrastructure/pyroscope-data-sources';\nimport { AIButton } from '../SceneAiPanel/components/AiButton/AIButton';\nimport { SceneAiPanel } from '../SceneAiPanel/SceneAiPanel';\nimport { useCreateRecordingRule } from '../SceneCreateMetricModal/domain/useCreateRecordingRule';\nimport { useCreateRecordingRulesMenu } from '../SceneCreateMetricModal/domain/useMenuOption';\nimport { SceneCreateRecordingRuleModal } from '../SceneCreateMetricModal/SceneCreateRecordingRuleModal';\nimport { SceneExportMenu } from './components/SceneExportMenu/SceneExportMenu';\nimport { useGitHubIntegration } from './components/SceneFunctionDetailsPanel/domain/useGitHubIntegration';\nimport { SceneFunctionDetailsPanel } from './components/SceneFunctionDetailsPanel/SceneFunctionDetailsPanel';\nimport { RemoveSpanSelector } from './domain/events/RemoveSpanSelector';\nimport { SpanSelectorLabel } from './SpanSelectorLabel';\n\ninterface SceneFlameGraphState extends SceneObjectState {\n  $data: SceneQueryRunner;\n  lastTimeRange?: TimeRange;\n  exportMenu: SceneExportMenu;\n  aiPanel: SceneAiPanel;\n  functionDetailsPanel: SceneFunctionDetailsPanel;\n  createRecordingRuleModal: SceneCreateRecordingRuleModal;\n}\n\n// I've tried to use a SplitLayout for the body without any success (left: flame graph, right: explain flame graph content)\n// without success: the flame graph dimensions are set in runtime and do not change when the user resizes the layout\nexport class SceneFlameGraph extends SceneObjectBase<SceneFlameGraphState> {\n  constructor() {\n    super({\n      key: 'flame-graph',\n      $data: new SceneQueryRunner({\n        datasource: PYROSCOPE_DATA_SOURCE,\n        queries: [],\n      }),\n      lastTimeRange: undefined,\n      exportMenu: new SceneExportMenu(),\n      aiPanel: new SceneAiPanel(),\n      functionDetailsPanel: new SceneFunctionDetailsPanel(),\n      createRecordingRuleModal: new SceneCreateRecordingRuleModal(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    let dataSubscription: Unsubscribable | undefined;\n\n    const stateSubscription = this.subscribeToState((newState, prevState) => {\n      if (newState.$data === prevState.$data) {\n        return;\n      }\n\n      if (dataSubscription) {\n        dataSubscription.unsubscribe();\n      }\n\n      dataSubscription = newState.$data?.subscribeToState((newDataState) => {\n        if (newDataState.data?.state === LoadingState.Done) {\n          this.setState({ lastTimeRange: newDataState.data.timeRange });\n        }\n      });\n    });\n\n    return () => {\n      stateSubscription.unsubscribe();\n      dataSubscription?.unsubscribe();\n    };\n  }\n\n  buildTitle() {\n    const serviceName = getSceneVariableValue(this, 'serviceName');\n    const profileMetricId = getSceneVariableValue(this, 'profileMetricId');\n    const profileMetricType = getProfileMetric(profileMetricId as ProfileMetricId).type;\n\n    return (\n      <>\n        <PyroscopeLogo size=\"small\" />\n        Flame graph for {serviceName} ({profileMetricType})\n      </>\n    );\n  }\n\n  useSceneFlameGraph = (spanSelector: string): DomainHookReturnValue => {\n    const { isLight } = useTheme2();\n    const getTheme = useMemo(() => () => createTheme({ colors: { mode: isLight ? 'light' : 'dark' } }), [isLight]);\n\n    const [maxNodes] = useMaxNodesFromUrl();\n    const { settings, error: isFetchingSettingsError } = useFetchPluginSettings();\n    const { $data, lastTimeRange, exportMenu, aiPanel, functionDetailsPanel, createRecordingRuleModal } =\n      this.useState();\n\n    if (isFetchingSettingsError) {\n      displayWarning([\n        'Error while retrieving the plugin settings!',\n        'Some features might not work as expected (e.g. collapsed flame graphs). Please try to reload the page, sorry for the inconvenience.',\n      ]);\n    }\n\n    useEffect(() => {\n      if (maxNodes) {\n        this.setState({\n          $data: buildFlameGraphQueryRunner({ maxNodes, spanSelector }),\n        });\n      }\n    }, [maxNodes, spanSelector]);\n\n    const $dataState = $data.useState();\n    const loadingState = $dataState?.data?.state;\n\n    const fetchProfileError =\n      loadingState === LoadingState.Error\n        ? ($dataState?.data?.errors?.[0] as Error) || new Error('Unknown error!')\n        : null;\n\n    const isFetchingProfileData = loadingState === LoadingState.Loading;\n    const profileData = $dataState?.data?.series?.[0];\n    const hasProfileData = Number(profileData?.length) > 1;\n\n    const query = useBuildPyroscopeQuery(this, 'filters');\n\n    return {\n      data: {\n        title: this.buildTitle(),\n        isLoading: isFetchingProfileData,\n        isFetchingProfileData,\n        hasProfileData,\n        profileData,\n        spanSelector,\n        fetchProfileError,\n        settings,\n        export: {\n          menu: exportMenu,\n          query,\n          timeRange: lastTimeRange,\n        },\n        ai: {\n          panel: aiPanel,\n          fetchParams: [{ query, timeRange: lastTimeRange }],\n        },\n        gitHub: {\n          panel: functionDetailsPanel,\n          timeRange: lastTimeRange,\n        },\n        recordingRules: {\n          modal: createRecordingRuleModal,\n        },\n      },\n      actions: {\n        getTheme,\n      },\n    };\n  };\n\n  removeSpanSelector() {\n    this.publishEvent(new RemoveSpanSelector({}), true);\n  }\n\n  static Component = ({ model }: SceneComponentProps<SceneFlameGraph>) => {\n    const styles = useStyles2(getStyles);\n\n    const spanSelector = getSceneVariableValue(model, 'spanSelector');\n    const { data, actions } = model.useSceneFlameGraph(spanSelector);\n    const sidePanel = useToggleSidePanel();\n    const gitHubIntegration = useGitHubIntegration(sidePanel);\n\n    const { settings } = useFetchPluginSettings();\n\n    const { actions: recordingRulesActions } = useCreateRecordingRule();\n    const [recordingRulesModelOpen, setIsRecordingRulesModalOpen] = useState(false);\n    const recordingRulesMenu = useCreateRecordingRulesMenu(() => setIsRecordingRulesModalOpen(true));\n\n    const isAiButtonDisabled = data.isLoading || !data.hasProfileData;\n\n    useEffect(() => {\n      if (isAiButtonDisabled) {\n        sidePanel.close();\n      }\n    }, [isAiButtonDisabled, sidePanel]);\n\n    const panelTitle = useMemo(\n      () => (\n        <>\n          {data.title}\n          {data.isLoading && <Spinner inline className={styles.spinner} />}\n        </>\n      ),\n      [data.isLoading, data.title, styles.spinner]\n    );\n\n    const extraContextMenuButtons: FlameGraphProps['getExtraContextMenuButtons'] = (clickedItemData, data) => {\n      const ghButtons = gitHubIntegration.actions.getExtraFlameGraphMenuItems(clickedItemData, data);\n      const recordingRulesButtons =\n        settings?.enableMetricsFromProfiles && featureToggles.metricsFromProfiles\n          ? recordingRulesMenu.actions.getExtraFlameGraphMenuItems(clickedItemData, data)\n          : [];\n\n      return [...ghButtons, ...recordingRulesButtons];\n    };\n\n    return (\n      <div className={styles.flex}>\n        <Panel\n          dataTestId=\"flame-graph-panel\"\n          className={styles.flamegraphPanel}\n          title={panelTitle}\n          isLoading={data.isLoading}\n          headerActions={\n            <>\n              {spanSelector && (\n                <SpanSelectorLabel spanSelector={spanSelector} removeSpanSelector={() => model.removeSpanSelector()} />\n              )}\n              <AIButton\n                disabled={isAiButtonDisabled || sidePanel.isOpen('ai')}\n                onClick={() => sidePanel.open('ai')}\n                interactionName=\"g_pyroscope_app_explain_flamegraph_clicked\"\n              >\n                Explain Flame Graph\n              </AIButton>\n            </>\n          }\n        >\n          {data.fetchProfileError && (\n            <InlineBanner severity=\"error\" title=\"Error while loading profile data!\" error={data.fetchProfileError} />\n          )}\n\n          {!data.fetchProfileError && (\n            <FlameGraph\n              data={data.profileData as any}\n              disableCollapsing={!data.settings?.collapsedFlamegraphs}\n              getTheme={actions.getTheme as any}\n              getExtraContextMenuButtons={extraContextMenuButtons}\n              extraHeaderElements={\n                <data.export.menu.Component\n                  model={data.export.menu}\n                  query={data.export.query}\n                  timeRange={data.export.timeRange}\n                />\n              }\n              keepFocusOnDataChange\n            />\n          )}\n        </Panel>\n\n        {sidePanel.isOpen('ai') && (\n          <data.ai.panel.Component model={data.ai.panel} fetchParams={data.ai.fetchParams} onClose={sidePanel.close} />\n        )}\n\n        {sidePanel.isOpen('function-details') && (\n          <data.gitHub.panel.Component\n            model={data.gitHub.panel}\n            timeRange={data.gitHub.timeRange}\n            stackTrace={gitHubIntegration.data.stacktrace}\n            onClose={sidePanel.close}\n          />\n        )}\n\n        <data.recordingRules.modal.Component\n          model={data.recordingRules.modal}\n          isModalOpen={recordingRulesModelOpen}\n          onDismiss={() => setIsRecordingRulesModalOpen(false)}\n          onCreate={(rule: RecordingRuleViewModel) => {\n            recordingRulesActions.save(rule);\n            setIsRecordingRulesModalOpen(false);\n          }}\n        />\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flex: css`\n    display: flex;\n  `,\n  flamegraphPanel: css`\n    min-width: 0;\n    flex-grow: 1;\n  `,\n  spinner: css`\n    margin-left: ${theme.spacing(1)};\n  `,\n});\n","import { IconName } from '@grafana/data';\nimport { Props as FlameGraphProps } from '@grafana/flamegraph';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport { useCallback } from 'react';\n\nexport function useCreateRecordingRulesMenu(setModalOpen: () => void): DomainHookReturnValue {\n  const getExtraFlameGraphMenuItems: FlameGraphProps['getExtraContextMenuButtons'] = useCallback(\n    ({ item }: any) => {\n      // NOTE(bryanhuhta): For now, only enable creating recording rules when\n      // clicking on the root node. Eventually this can be removed when we\n      // support creating recording rules for functions.\n      if (item.level !== 0) {\n        return [];\n      }\n\n      return [\n        {\n          label: 'Create recording rule',\n          icon: 'download-alt' as IconName,\n          onClick: setModalOpen,\n        },\n      ];\n    },\n    [setModalOpen]\n  );\n\n  return {\n    data: {},\n    actions: {\n      getExtraFlameGraphMenuItems,\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { FavAction } from '../../domain/actions/FavAction';\nimport { SelectAction } from '../../domain/actions/SelectAction';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneMainServiceTimeseries } from '../SceneMainServiceTimeseries';\nimport { SceneFlameGraph } from './SceneFlameGraph';\n\ninterface SceneExploreServiceFlameGraphState extends SceneObjectState {\n  mainTimeseries: SceneMainServiceTimeseries;\n  body: SceneFlameGraph;\n}\n\nexport class SceneExploreServiceFlameGraph extends SceneObjectBase<SceneExploreServiceFlameGraphState> {\n  constructor({ item }: { item?: GridItemData }) {\n    super({\n      key: 'explore-service-flame-graph',\n      mainTimeseries: new SceneMainServiceTimeseries({\n        item,\n        headerActions: (item) => [new SelectAction({ type: 'view-labels', item }), new FavAction({ item })],\n      }),\n      body: new SceneFlameGraph(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, item));\n  }\n\n  onActivate(item?: GridItemData) {\n    if (item) {\n      this.initVariables(item);\n    }\n\n    const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n\n    profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_SERVICE_NAME_DEPENDENT });\n    profileMetricVariable.update(true);\n\n    return () => {\n      profileMetricVariable.setState({ query: ProfileMetricVariable.QUERY_DEFAULT });\n      profileMetricVariable.update(true);\n    };\n  }\n\n  initVariables(item: GridItemData) {\n    const { serviceName, profileMetricId, filters } = item.queryRunnerParams;\n\n    if (serviceName) {\n      const serviceNameVariable = sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable);\n      serviceNameVariable.changeValueTo(serviceName);\n    }\n\n    if (profileMetricId) {\n      const profileMetricVariable = sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable);\n      profileMetricVariable.changeValueTo(profileMetricId);\n    }\n\n    if (filters) {\n      const filtersVariable = sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable);\n      filtersVariable.setState({ filters });\n    }\n  }\n\n  // see SceneProfilesExplorer\n  getVariablesAndGridControls() {\n    return {\n      variables: [\n        sceneGraph.findByKeyAndType(this, 'serviceName', ServiceNameVariable),\n        sceneGraph.findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable),\n        sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable),\n      ],\n      gridControls: [],\n    };\n  }\n\n  static Component({ model }: SceneComponentProps<SceneExploreServiceFlameGraph>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { mainTimeseries, body } = model.useState();\n\n    // we use CSS here and Scenes Flex layout because we encountered a problem where the Flamegraph would not respect each panel width,\n    // resulting in a cropped flame graph when opening the side panel\n    return (\n      <div className={styles.flex}>\n        <div className={styles.mainTimeseries}>\n          <mainTimeseries.Component model={mainTimeseries} />\n        </div>\n        <body.Component model={body} />\n      </div>\n    );\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flex: css`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    gap: ${theme.spacing(1)};\n  `,\n  mainTimeseries: css`\n    height: ${SceneMainServiceTimeseries.MIN_HEIGHT}px;\n  `,\n});\n","import { SceneObject, SceneVariable } from '@grafana/scenes';\nimport { displaySuccess } from '@shared/domain/displayStatus';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { logger } from '@shared/infrastructure/tracking/logger';\nimport { useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { PLUGIN_BASE_URL, ROUTES } from 'src/constants';\n\nimport { ProfilesDataSourceVariable } from '../../../../domain/variables/ProfilesDataSourceVariable';\nimport { ExplorationType } from '../../SceneProfilesExplorer';\nimport { HeaderProps } from '../Header';\nimport { builsShareableUrl } from './builsShareableUrl';\n\nasync function onClickShareLink() {\n  reportInteraction('g_pyroscope_app_share_link_clicked');\n\n  try {\n    await navigator.clipboard.writeText(builsShareableUrl().toString());\n\n    displaySuccess(['Link copied to clipboard!']);\n  } catch (error) {\n    logger.error(error as Error, { info: 'Error while creating the shareable link!' });\n  }\n}\n\nexport function useHeader({ explorationType, controls, body, $variables, onChangeExplorationType }: HeaderProps) {\n  const [timePickerControl, refreshPickerControl] =\n    explorationType === ExplorationType.DIFF_FLAME_GRAPH ? [] : (controls as [SceneObject, SceneObject]);\n\n  const dataSourceVariable = $variables.state.variables[0] as ProfilesDataSourceVariable;\n\n  const bodySceneObject = body?.state.primary as any;\n\n  if (typeof bodySceneObject.getVariablesAndGridControls !== 'function') {\n    throw new Error(\n      `Error while rendering \"${bodySceneObject.constructor.name}\": the \"getVariablesAndGridControls\" method is missing! Please implement it.`\n    );\n  }\n\n  const { variables: sceneVariables, gridControls } = bodySceneObject.getVariablesAndGridControls() as {\n    variables: SceneVariable[];\n    gridControls: SceneObject[];\n  };\n\n  const dataSourceUid = dataSourceVariable.useState().value as string;\n\n  const navigate = useNavigate();\n\n  return {\n    data: {\n      explorationType,\n      dataSourceVariable,\n      timePickerControl,\n      refreshPickerControl,\n      sceneVariables,\n      gridControls,\n      body,\n      dataSourceUid,\n    },\n    actions: {\n      onChangeExplorationType,\n      onClickShareLink,\n      onClickRecordingRules: useCallback(() => {\n        reportInteraction('g_pyroscope_app_open_recording_rules_view');\n\n        navigate(`${PLUGIN_BASE_URL}${ROUTES.RECORDING_RULES}`, { state: { referrer: window.location.href } });\n      }, [navigate]),\n      onClickAdHoc: useCallback(() => {\n        reportInteraction('g_pyroscope_app_upload_ad_hoc_clicked');\n\n        navigate(`${PLUGIN_BASE_URL}${ROUTES.ADHOC}`, { state: { referrer: window.location.href } });\n      }, [navigate]),\n      onClickUserSettings: useCallback(() => {\n        reportInteraction('g_pyroscope_app_user_settings_clicked');\n\n        navigate(`${PLUGIN_BASE_URL}${ROUTES.SETTINGS}`, { state: { referrer: window.location.href } });\n      }, [navigate]),\n    },\n  };\n}\n","import { dateMath } from '@grafana/data';\n\nimport { getDefaultTimeRange } from '../../../..//domain/buildTimeRange';\n\nexport function builsShareableUrl(): URL {\n  const shareableUrl = new URL(window.location.toString());\n  const { searchParams } = shareableUrl;\n\n  if (!searchParams.get('from')) {\n    searchParams.set('from', getDefaultTimeRange().from);\n  }\n  if (!searchParams.get('to')) {\n    searchParams.set('to', getDefaultTimeRange().to);\n  }\n\n  ['from', 'to', 'from-2', 'to-2', 'from-3', 'to-3', 'diffFrom', 'diffTo', 'diffFrom-2', 'diffTo-2'].forEach((name) => {\n    const value = searchParams.get(name);\n    if (value) {\n      searchParams.set(name, String(dateMath.parse(value)!.valueOf()));\n    }\n  });\n\n  return shareableUrl;\n}\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { noOp } from '@shared/domain/noOp';\nimport React, { Fragment } from 'react';\n\ntype ExplorationTypeSelectorProps = {\n  options: Array<SelectableValue<string>>;\n  value: string;\n  onChange: (newValue: string) => void;\n};\n\nexport function ExplorationTypeSelector({ options, value, onChange }: ExplorationTypeSelectorProps) {\n  const styles = useStyles2(getStyles);\n\n  const activeIndex = options.findIndex((o) => o.value === value);\n\n  const getButtonVariant = (currentIndex: number) => {\n    if (activeIndex === options.length - 1) {\n      // \"Favorites\" is the last option, so in this case we don't want all the previous buttons to be active\n      return currentIndex === activeIndex ? 'primary' : 'secondary';\n    }\n\n    return currentIndex <= activeIndex ? 'primary' : 'secondary';\n  };\n\n  return (\n    <div className={styles.explorationTypeContainer} data-testid=\"exploration-types\">\n      <div className={styles.label}>Exploration</div>\n\n      <div className={styles.breadcrumb}>\n        {options.map((option, i) => {\n          const isActive = value === option.value;\n          const variant = getButtonVariant(i);\n          const isPrimary = variant === 'primary';\n          const extraClasses = [isActive && 'active', isPrimary && 'primary'];\n\n          return (\n            <Fragment key={option.value}>\n              <Button\n                className={cx(styles.button, ...extraClasses)}\n                variant={variant}\n                size=\"sm\"\n                aria-label={option.label}\n                icon={option.icon as any}\n                onClick={isActive ? noOp : () => onChange(option.value as string)}\n                tooltip={option.description}\n                tooltipPlacement=\"top\"\n                data-testid={isActive ? 'is-active' : undefined}\n              >\n                {option.label}\n              </Button>\n\n              {/* add a connection only for buttons before \"Diff flame graph\" and \"Favorites\" */}\n              {i < options.length - 3 && (\n                <div\n                  className={\n                    activeIndex !== options.length - 1 && i <= activeIndex - 1\n                      ? cx(styles.arrow, 'arrow', ...extraClasses)\n                      : styles.arrow\n                  }\n                />\n              )}\n            </Fragment>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  explorationTypeContainer: css`\n    display: flex;\n    align-items: center;\n  `,\n  label: css`\n    display: flex;\n    gap: 2px;\n    align-items: center;\n    font-size: 14px;\n    margin-right: ${theme.spacing(1)};\n\n    ${theme.breakpoints.down('xxl')} {\n      display: none;\n    }\n  `,\n  breadcrumb: css`\n    display: flex;\n    align-items: center;\n    height: 32px;\n    line-height: 32px;\n\n    .active {\n      background-color: ${theme.colors.primary.main};\n    }\n\n    .arrow.primary {\n      background-color: ${theme.colors.primary.main};\n    }\n\n    & button.primary:not(.active),\n    & .arrow.primary:not(.active) {\n      opacity: 0.7;\n    }\n\n    & button.primary:not(.active):hover {\n      opacity: 1;\n      background-color: ${theme.colors.primary.main};\n    }\n  `,\n  button: css`\n    height: 27px;\n    line-height: 27px;\n    border-radius: 15px;\n\n    &:hover {\n      border-color: ${theme.colors.primary.main};\n    }\n\n    &.active:hover {\n      cursor: default;\n      background-color: ${theme.colors.primary.main};\n    }\n\n    &:nth-last-child(2) {\n      margin-left: ${theme.spacing(1)};\n    }\n\n    &:nth-last-child(1) {\n      margin-left: ${theme.spacing(2)};\n    }\n  `,\n  arrow: css`\n    background-color: ${theme.colors.text.disabled};\n    width: 10px;\n    height: 2px;\n  `,\n});\n","import { css, cx } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport { Field, Icon, IconButton, useStyles2 } from '@grafana/ui';\nimport { featureToggles } from '@shared/infrastructure/settings/featureToggles';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { PluginInfo } from '@shared/ui/PluginInfo';\nimport React from 'react';\n\nimport { GiveFeedbackButton } from '../../GiveFeedbackButton';\nimport { SceneProfilesExplorer, SceneProfilesExplorerState } from '../SceneProfilesExplorer';\nimport { useHeader } from './domain/useHeader';\nimport { ExplorationTypeSelector } from './ui/ExplorationTypeSelector';\n\nexport type HeaderProps = {\n  explorationType: SceneProfilesExplorerState['explorationType'];\n  controls: SceneProfilesExplorerState['controls'];\n  body: SceneProfilesExplorerState['body'];\n  $variables: SceneProfilesExplorerState['$variables'];\n  onChangeExplorationType: (explorationType: string) => void;\n};\n\nexport function Header(props: HeaderProps) {\n  const chromeHeaderHeight = useChromeHeaderHeight?.();\n  const styles = useStyles2(getStyles, chromeHeaderHeight ?? 0);\n\n  const { data, actions } = useHeader(props);\n\n  const { settings } = useFetchPluginSettings();\n\n  const { explorationType, dataSourceVariable, timePickerControl, refreshPickerControl, sceneVariables, gridControls } =\n    data;\n\n  return (\n    <div className={styles.header} data-testid=\"allControls\">\n      <GiveFeedbackButton />\n\n      <div className={styles.appControls} data-testid=\"appControls\">\n        <div className={styles.appControlsLeft}>\n          <ExplorationTypeSelector\n            options={SceneProfilesExplorer.EXPLORATION_TYPE_OPTIONS}\n            value={explorationType as string}\n            onChange={actions.onChangeExplorationType}\n          />\n        </div>\n\n        <div className={styles.appControlsRight}>\n          {timePickerControl && (\n            <timePickerControl.Component key={timePickerControl.state.key} model={timePickerControl} />\n          )}\n          {refreshPickerControl && (\n            <refreshPickerControl.Component key={refreshPickerControl.state.key} model={refreshPickerControl} />\n          )}\n\n          <div className={styles.appMiscButtons}>\n            {settings?.enableMetricsFromProfiles && featureToggles.metricsFromProfiles && (\n              <IconButton\n                name=\"gf-prometheus\"\n                tooltip=\"View recording rules\"\n                aria-label=\"View recording rules\"\n                onClick={actions.onClickRecordingRules}\n              />\n            )}\n\n            <IconButton name=\"upload\" tooltip=\"Upload ad hoc profiles\" onClick={actions.onClickAdHoc} />\n\n            <IconButton name=\"cog\" tooltip=\"View/edit tenant settings\" onClick={actions.onClickUserSettings} />\n\n            <IconButton\n              name=\"share-alt\"\n              tooltip=\"Copy shareable link to the clipboard\"\n              onClick={actions.onClickShareLink}\n            />\n\n            <PluginInfo />\n          </div>\n        </div>\n      </div>\n\n      <div id={`scene-controls-${explorationType}`} className={styles.sceneControls} data-testid=\"sceneControls\">\n        <Field\n          label={dataSourceVariable.state.label}\n          className={cx(styles.sceneVariable, dataSourceVariable.state.name)}\n          data-testid={dataSourceVariable.state.name}\n        >\n          <dataSourceVariable.Component model={dataSourceVariable} />\n        </Field>\n\n        {sceneVariables.map((variable) => (\n          <Field\n            key={variable.state.name}\n            label={\n              variable.state.label === 'Filters' ? (\n                <div className={styles.sceneVariableLabel}>\n                  <Icon name=\"filter\" className={styles.icon} />\n                  {variable.state.label}\n                </div>\n              ) : (\n                variable.state.label\n              )\n            }\n            className={cx(styles.sceneVariable, variable.state.name)}\n            data-testid={variable.state.name}\n          >\n            <variable.Component model={variable} />\n          </Field>\n        ))}\n\n        {gridControls.map((control) => (\n          <Field key={control.state.key} id={control.state.key} className={styles.gridControl} label=\"\">\n            <control.Component model={control} />\n          </Field>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2, chromeHeaderHeight: number) => ({\n  header: css`\n    background-color: ${theme.colors.background.canvas};\n    position: sticky;\n    top: ${chromeHeaderHeight}px;\n    z-index: 1;\n    padding-bottom: ${theme.spacing(2)};\n  `,\n  appControls: css`\n    display: flex;\n    padding: ${theme.spacing(1)} 0;\n    justify-content: space-between;\n    gap: ${theme.spacing(2)};\n  `,\n  appControlsLeft: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n  `,\n  appControlsRight: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n  `,\n  appMiscButtons: css`\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    border: 1px solid ${theme.colors.border.weak};\n    background-color: ${theme.colors.background.secondary};\n    height: 32px;\n    padding: 0 ${theme.spacing(1)};\n\n    & svg {\n      width: 18px;\n      height: 18px;\n    }\n  `,\n  sceneControls: css`\n    display: flex;\n    flex-wrap: wrap;\n    gap: ${theme.spacing(1)};\n    padding: 0;\n    margin-top: 20px;\n  `,\n  sceneVariable: css`\n    display: flex;\n    margin-bottom: 0;\n\n    & #dataSource {\n      width: ${theme.spacing(32)};\n    }\n\n    &.filters {\n      flex-grow: 1;\n    }\n\n    &.compare-presets {\n      margin-left: auto;\n      text-align: right;\n    }\n  `,\n  sceneVariableLabel: css`\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 15px;\n    height: 15px;\n    margin-bottom: 4px;\n    color: ${theme.colors.text.primary};\n    max-width: 480px;\n  `,\n  icon: css`\n    display: inline-block;\n    margin-right: 4px;\n  `,\n  gridControl: css`\n    margin-bottom: 0;\n\n    &#quick-filter {\n      flex: 1;\n      min-width: 112px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport {\n  EmbeddedSceneState,\n  getUrlSyncManager,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  sceneUtils,\n  SceneVariableSet,\n  SplitLayout,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport { displayError } from '@shared/domain/displayStatus';\nimport { prepareHistoryEntry } from '@shared/domain/prepareHistoryEntry';\nimport { reportInteraction } from '@shared/domain/reportInteraction';\nimport { DomainHookReturnValue } from '@shared/types/DomainHookReturnValue';\nimport React from 'react';\n\nimport { SceneExploreAllServices } from '../../components/SceneExploreAllServices/SceneExploreAllServices';\nimport { SceneExploreFavorites } from '../../components/SceneExploreFavorites/SceneExploreFavorites';\nimport { SceneExploreServiceLabels } from '../../components/SceneExploreServiceLabels/SceneExploreServiceLabels';\nimport { SceneExploreServiceProfileTypes } from '../../components/SceneExploreServiceProfileTypes/SceneExploreServiceProfileTypes';\nimport { getDefaultTimeRange } from '../../domain/buildTimeRange';\nimport { EventViewDiffFlameGraph } from '../../domain/events/EventViewDiffFlameGraph';\nimport { EventViewServiceFlameGraph } from '../../domain/events/EventViewServiceFlameGraph';\nimport { EventViewServiceLabels } from '../../domain/events/EventViewServiceLabels';\nimport { EventViewServiceProfiles } from '../../domain/events/EventViewServiceProfiles';\nimport { FiltersVariable } from '../../domain/variables/FiltersVariable/FiltersVariable';\nimport { GroupByVariable } from '../../domain/variables/GroupByVariable/GroupByVariable';\nimport { ProfileMetricVariable } from '../../domain/variables/ProfileMetricVariable';\nimport { ProfilesDataSourceVariable } from '../../domain/variables/ProfilesDataSourceVariable';\nimport { ServiceNameVariable } from '../../domain/variables/ServiceNameVariable/ServiceNameVariable';\nimport { SpanSelectorVariable } from '../../domain/variables/SpanSelectorVariable';\nimport { FavoritesDataSource } from '../../infrastructure/favorites/FavoritesDataSource';\nimport { LabelsDataSource } from '../../infrastructure/labels/LabelsDataSource';\nimport { SeriesDataSource } from '../../infrastructure/series/SeriesDataSource';\nimport { SceneLayoutSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneLayoutSwitcher';\nimport { SceneNoDataSwitcher } from '../SceneByVariableRepeaterGrid/components/SceneNoDataSwitcher';\nimport { ScenePanelTypeSwitcher } from '../SceneByVariableRepeaterGrid/components/ScenePanelTypeSwitcher';\nimport { SceneQuickFilter } from '../SceneByVariableRepeaterGrid/components/SceneQuickFilter';\nimport { GridItemData } from '../SceneByVariableRepeaterGrid/types/GridItemData';\nimport { SceneExploreDiffFlameGraph } from '../SceneExploreDiffFlameGraph/SceneExploreDiffFlameGraph';\nimport { GitHubContextProvider } from '../SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/components/GitHubContextProvider/GitHubContextProvider';\nimport { RemoveSpanSelector } from '../SceneExploreServiceFlameGraph/domain/events/RemoveSpanSelector';\nimport { SceneExploreServiceFlameGraph } from '../SceneExploreServiceFlameGraph/SceneExploreServiceFlameGraph';\nimport { Header } from './components/Header';\n\nexport interface SceneProfilesExplorerState extends Partial<EmbeddedSceneState> {\n  $timeRange: SceneTimeRange;\n  $variables: SceneVariableSet;\n  gridControls: Array<SceneObject & { key?: string }>;\n  explorationType?: ExplorationType;\n  body?: SplitLayout;\n}\n\nexport enum ExplorationType {\n  ALL_SERVICES = 'all',\n  PROFILE_TYPES = 'profiles',\n  LABELS = 'labels',\n  FLAME_GRAPH = 'flame-graph',\n  DIFF_FLAME_GRAPH = 'diff-flame-graph',\n  FAVORITES = 'favorites',\n}\n\nexport class SceneProfilesExplorer extends SceneObjectBase<SceneProfilesExplorerState> {\n  static EXPLORATION_TYPE_OPTIONS = [\n    {\n      value: ExplorationType.ALL_SERVICES,\n      label: 'All services',\n      description: 'Overview of all services, for any given profile type',\n    },\n    {\n      value: ExplorationType.PROFILE_TYPES,\n      label: 'Profile types',\n      description: 'Overview of all the profile types for a single service',\n    },\n    {\n      value: ExplorationType.LABELS,\n      label: 'Labels',\n      description: 'Single service label exploration and filtering',\n    },\n    {\n      value: ExplorationType.FLAME_GRAPH,\n      label: 'Flame graph',\n      description: 'Single service flame graph',\n    },\n    {\n      value: ExplorationType.DIFF_FLAME_GRAPH,\n      label: 'Diff flame graph',\n      description: 'Compare the differences between two flame graphs',\n    },\n    {\n      value: ExplorationType.FAVORITES,\n      label: 'Favorites',\n      description: 'Overview of favorited visualizations',\n      icon: 'favorite',\n    },\n  ];\n\n  static DEFAULT_EXPLORATION_TYPE = SceneProfilesExplorer.EXPLORATION_TYPE_OPTIONS[0].value;\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['explorationType'] });\n\n  constructor() {\n    super({\n      key: 'profiles-explorer',\n      explorationType: undefined,\n      body: undefined,\n      $timeRange: new SceneTimeRange(getDefaultTimeRange()),\n      $variables: new SceneVariableSet({\n        // in order to sync with the URL and...\n        // ...because of a limitation of the Scenes library, we have to create them now, once, and not every time we set a new exploration type\n        // also, we prevent re-creating all variables when switching exploration type, which would lead to unecessary work and layout shifts in the UI\n        // (because values would be empty before loading, then populated after fetched)\n        // see setExplorationType() for dynamic updates\n        variables: [\n          new ProfilesDataSourceVariable(),\n          new ServiceNameVariable(),\n          new ProfileMetricVariable(),\n          new FiltersVariable({ key: 'filters' }),\n          new FiltersVariable({ key: 'filtersBaseline' }),\n          new FiltersVariable({ key: 'filtersComparison' }),\n          new GroupByVariable(),\n          new SpanSelectorVariable(),\n        ],\n      }),\n      controls: [new SceneTimePicker({ isOnCanvas: true }), new SceneRefreshPicker({ isOnCanvas: true })],\n      // these scenes also sync with the URL so...\n      // ...because of a limitation of the Scenes library, we have to create them now, once, and not every time we set a new exploration type\n      gridControls: [\n        new SceneQuickFilter({ placeholder: '' }),\n        new ScenePanelTypeSwitcher(),\n        new SceneLayoutSwitcher(),\n        new SceneNoDataSwitcher(),\n      ],\n    });\n\n    getUrlSyncManager().initSync(this);\n\n    this.registerRuntimeDataSources();\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const varSub = this.subscribeToVariableChanges();\n    const eventsSub = this.subscribeToEvents();\n\n    if (!this.state.explorationType) {\n      this.setExplorationType({\n        type: SceneProfilesExplorer.DEFAULT_EXPLORATION_TYPE,\n      });\n    }\n\n    return () => {\n      eventsSub.unsubscribe();\n      varSub.unsubscribe();\n    };\n  }\n\n  getUrlState() {\n    return {\n      explorationType: this.state.explorationType,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    if (typeof values.explorationType === 'string' && values.explorationType !== this.state.explorationType) {\n      const type = values.explorationType as ExplorationType;\n      this.setExplorationType({\n        type: Object.values(ExplorationType).includes(type) ? type : SceneProfilesExplorer.DEFAULT_EXPLORATION_TYPE,\n      });\n    }\n  }\n\n  registerRuntimeDataSources() {\n    // wrapped in a try-catch to prevent error when registered twice, which can easily happen if we go back & forth to the Profiles Explorer page\n    try {\n      sceneUtils.registerRuntimeDataSource({ dataSource: new SeriesDataSource() });\n      sceneUtils.registerRuntimeDataSource({ dataSource: new FavoritesDataSource() });\n      sceneUtils.registerRuntimeDataSource({ dataSource: new LabelsDataSource() });\n    } catch (error) {\n      const { message } = error as Error;\n\n      if (!/A runtime data source with uid (.+) has already been registered/.test(message)) {\n        displayError(error as Error, [\n          'Fail to register all the runtime data sources!',\n          'The application cannot work as expected, please try reloading the page or if the problem persists, contact your organization admin.',\n        ]);\n      }\n    }\n  }\n\n  subscribeToVariableChanges() {\n    const dataSourceSub = sceneGraph\n      .findByKeyAndType(this, 'dataSource', ProfilesDataSourceVariable)\n      .subscribeToState((newState, prevState) => {\n        if (newState.value && newState.value !== prevState.value) {\n          FiltersVariable.resetAll(this);\n          this.resetSpanSelector();\n        }\n      });\n\n    const serviceNameSub = sceneGraph\n      .findByKeyAndType(this, 'serviceName', ServiceNameVariable)\n      .subscribeToState((newState, prevState) => {\n        if (newState.value && newState.value !== prevState.value) {\n          FiltersVariable.resetAll(this);\n          // This is to prevent removing the span selector if the previous service name was not correct\n          // This way a user can still select the service name for selected span in case there's a mismatch\n          // in the service name that was provided from the trace\n          if (newState.options.some((option) => option.value === prevState.value)) {\n            this.resetSpanSelector();\n          }\n        }\n      });\n\n    const profileTypeSub = sceneGraph\n      .findByKeyAndType(this, 'profileMetricId', ProfileMetricVariable)\n      .subscribeToState((newState, prevState) => {\n        if (newState.value && newState.value !== prevState.value) {\n          this.resetSpanSelector();\n        }\n      });\n\n    const filtersSub = sceneGraph\n      .findByKeyAndType(this, 'filters', FiltersVariable)\n      .subscribeToState((newState, prevState) => {\n        if (JSON.stringify(newState.filters) !== JSON.stringify(prevState.filters)) {\n          this.resetSpanSelector();\n        }\n      });\n\n    return {\n      unsubscribe() {\n        serviceNameSub.unsubscribe();\n        dataSourceSub.unsubscribe();\n        filtersSub.unsubscribe();\n        profileTypeSub.unsubscribe();\n      },\n    };\n  }\n\n  subscribeToEvents() {\n    const profilesSub = this.subscribeToEvent(EventViewServiceProfiles, (event) => {\n      this.setExplorationType({\n        type: ExplorationType.PROFILE_TYPES,\n        comesFromUserAction: true,\n        item: event.payload.item,\n      });\n    });\n\n    const labelsSub = this.subscribeToEvent(EventViewServiceLabels, (event) => {\n      this.setExplorationType({\n        type: ExplorationType.LABELS,\n        comesFromUserAction: true,\n        item: event.payload.item,\n      });\n    });\n\n    const flameGraphSub = this.subscribeToEvent(EventViewServiceFlameGraph, (event) => {\n      this.setExplorationType({\n        type: ExplorationType.FLAME_GRAPH,\n        comesFromUserAction: true,\n        item: event.payload.item,\n      });\n    });\n\n    const diffFlameGraphSub = this.subscribeToEvent(EventViewDiffFlameGraph, (event) => {\n      const { useAncestorTimeRange, clearDiffRange, baselineFilters, comparisonFilters } = event.payload;\n\n      this.setExplorationType({\n        type: ExplorationType.DIFF_FLAME_GRAPH,\n        comesFromUserAction: true,\n        bodySceneOptions: {\n          useAncestorTimeRange,\n          clearDiffRange,\n          baselineFilters,\n          comparisonFilters,\n        },\n      });\n    });\n\n    const removeSpanSelectorSub = this.subscribeToEvent(RemoveSpanSelector, () => {\n      this.resetSpanSelector();\n    });\n\n    return {\n      unsubscribe() {\n        diffFlameGraphSub.unsubscribe();\n        flameGraphSub.unsubscribe();\n        labelsSub.unsubscribe();\n        profilesSub.unsubscribe();\n        removeSpanSelectorSub.unsubscribe();\n      },\n    };\n  }\n\n  setExplorationType({\n    type,\n    comesFromUserAction,\n    item,\n    bodySceneOptions,\n  }: {\n    type: ExplorationType;\n    comesFromUserAction?: boolean;\n    item?: GridItemData;\n    bodySceneOptions?: Record<string, any>;\n  }) {\n    if (comesFromUserAction) {\n      prepareHistoryEntry();\n      this.resetVariables(type);\n    }\n\n    this.setState({\n      explorationType: type,\n      body: this.buildBodyScene(type, item, bodySceneOptions),\n    });\n  }\n\n  resetSpanSelector() {\n    sceneGraph.findByKeyAndType(this, 'spanSelector', SpanSelectorVariable).reset();\n  }\n\n  resetVariables(nextExplorationType: string) {\n    sceneGraph.findByKeyAndType(this, 'quick-filter', SceneQuickFilter).reset();\n    sceneGraph.findByKeyAndType(this, 'groupBy', GroupByVariable).changeValueTo(GroupByVariable.DEFAULT_VALUE);\n    sceneGraph.findByKeyAndType(this, 'panel-type-switcher', ScenePanelTypeSwitcher).reset();\n    this.resetSpanSelector();\n\n    // preserve existing filters only when switching to \"Labels\", \"Flame graph\" or \"Diff flame graph\"\n    // if not, they will be added to the queries without any notice on the UI\n    if (\n      ![ExplorationType.LABELS, ExplorationType.FLAME_GRAPH, ExplorationType.DIFF_FLAME_GRAPH].includes(\n        nextExplorationType as ExplorationType\n      )\n    ) {\n      sceneGraph.findByKeyAndType(this, 'filters', FiltersVariable).reset();\n    }\n  }\n\n  buildBodyScene(explorationType: ExplorationType, item?: GridItemData, bodySceneOptions?: Record<string, any>) {\n    let primary;\n\n    switch (explorationType) {\n      case ExplorationType.PROFILE_TYPES:\n        primary = new SceneExploreServiceProfileTypes({ item });\n        break;\n\n      case ExplorationType.LABELS:\n        primary = new SceneExploreServiceLabels({ item });\n        break;\n\n      case ExplorationType.FLAME_GRAPH:\n        primary = new SceneExploreServiceFlameGraph({ item });\n        break;\n\n      case ExplorationType.DIFF_FLAME_GRAPH:\n        primary = new SceneExploreDiffFlameGraph(bodySceneOptions || {});\n        break;\n\n      case ExplorationType.FAVORITES:\n        primary = new SceneExploreFavorites();\n        break;\n\n      case ExplorationType.ALL_SERVICES:\n      default:\n        primary = new SceneExploreAllServices();\n    }\n\n    return new SplitLayout({\n      direction: 'column',\n      primary,\n    });\n  }\n\n  onChangeExplorationType = (explorationType: string) => {\n    reportInteraction('g_pyroscope_app_exploration_type_clicked', { explorationType });\n\n    this.setExplorationType({\n      type: explorationType as ExplorationType,\n      comesFromUserAction: true,\n    });\n  };\n\n  useProfilesExplorer = (): DomainHookReturnValue => {\n    const { explorationType, controls, body, $variables } = this.useState();\n\n    const dataSourceVariable = $variables.state.variables[0] as ProfilesDataSourceVariable;\n    const dataSourceUid = dataSourceVariable.useState().value as string;\n\n    return {\n      data: {\n        explorationType,\n        controls,\n        body,\n        $variables,\n        dataSourceUid,\n      },\n      actions: {\n        onChangeExplorationType: this.onChangeExplorationType,\n      },\n    };\n  };\n\n  static Component({ model }: SceneComponentProps<SceneProfilesExplorer>) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n\n    const { data, actions } = model.useProfilesExplorer();\n    const { explorationType, controls, body, $variables, dataSourceUid } = data;\n\n    return (\n      <GitHubContextProvider dataSourceUid={dataSourceUid}>\n        <Header\n          explorationType={explorationType}\n          controls={controls}\n          body={body}\n          $variables={$variables}\n          onChangeExplorationType={actions.onChangeExplorationType}\n        />\n\n        <div className={styles.body} data-testid=\"sceneBody\">\n          {body && <body.Component model={body} />}\n        </div>\n      </GitHubContextProvider>\n    );\n  }\n}\n\nconst getStyles = () => ({\n  body: css`\n    position: relative;\n    z-index: 0;\n    background: transparent;\n  `,\n});\n","import { useReportPageInitialized } from '@shared/infrastructure/tracking/useReportPageInitialized';\nimport React, { useMemo } from 'react';\n\nimport { SceneProfilesExplorer } from './components/SceneProfilesExplorer/SceneProfilesExplorer';\n\nexport default function ProfilesExplorerView() {\n  const sceneProfilesExplorer = useMemo(() => new SceneProfilesExplorer(), []);\n  useReportPageInitialized('explore');\n\n  return <sceneProfilesExplorer.Component model={sceneProfilesExplorer} />;\n}\n","import { ConfirmModal, IconButton } from '@grafana/ui';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\nimport React from 'react';\n\ntype Props = {\n  rule: RecordingRuleViewModel;\n  confirm: () => void;\n};\n\nexport function DeleteRecordingRuleButton({ rule, confirm }: Props) {\n  const [isOpen, setIsOpen] = React.useState(false);\n  return (\n    <>\n      <IconButton\n        name=\"trash-alt\"\n        onClick={() => setIsOpen(true)}\n        variant=\"destructive\"\n        aria-label=\"Delete recording rule\"\n      />\n      <ConfirmModal\n        isOpen={isOpen}\n        title={'Delete recording rule'}\n        body={`Are you sure you want to delete ${rule.metricName} recording rule?`}\n        confirmText=\"Yes\"\n        onConfirm={() => {\n          confirm();\n          setIsOpen(false);\n        }}\n        onDismiss={() => setIsOpen(false)}\n      />\n    </>\n  );\n}\n","import { displayError, displaySuccess } from '@shared/domain/displayStatus';\nimport { useFetchRecordingRules } from '@shared/infrastructure/recording-rules/useFetchRecordingRules';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\n\nexport function useRecordingRulesView() {\n  const { recordingRules, error: fetchError, remove, isFetching } = useFetchRecordingRules();\n\n  return {\n    data: {\n      recordingRules,\n      fetchError,\n      isFetching,\n    },\n    actions: {\n      async removeRecordingRule(rule: RecordingRuleViewModel) {\n        try {\n          await remove(rule);\n          displaySuccess([`Recording rule ${rule.metricName} deleted!`]);\n        } catch (e) {\n          displayError(e as Error, [`Failed to delete recording rule ${rule.metricName}.`]);\n        }\n      },\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport { Column, EmptyState, InteractiveTable, TagList, Text, useStyles2 } from '@grafana/ui';\nimport { BackButton } from '@shared/components/Common/BackButton';\nimport { HttpClientError } from '@shared/infrastructure/http/HttpClientError';\nimport { getProfileMetric, ProfileMetricId } from '@shared/infrastructure/profile-metrics/getProfileMetric';\nimport { RecordingRuleViewModel } from '@shared/types/RecordingRuleViewModel';\nimport { PageTitle } from '@shared/ui/PageTitle';\nimport React from 'react';\n\nimport { EmptyLoadingPage } from '../../app/components/Onboarding/ui/EmptyLoadingPage';\nimport { DeleteRecordingRuleButton } from './DeleteRecordingRuleButton';\nimport { useRecordingRulesView } from './domain/useRecordingRulesView';\n\nexport default function RecordingRulesView() {\n  const styles = useStyles2(getStyles);\n  const { data, actions } = useRecordingRulesView();\n  const { recordingRules } = data;\n\n  if (data.isFetching) {\n    return <EmptyLoadingPage />;\n  }\n\n  const columns: Array<Column<RecordingRuleViewModel>> = [\n    {\n      id: 'metricName',\n      header: 'Name',\n      sortType: 'alphanumeric',\n    },\n    {\n      id: 'serviceName',\n      header: 'Service Name',\n      sortType: 'alphanumeric',\n    },\n    {\n      id: 'profileType',\n      header: 'Profile Type',\n      sortType: 'alphanumeric',\n    },\n    {\n      id: 'groupBy',\n      header: 'Labels',\n      cell: (props) => {\n        // Exclude hidden labels.\n        const rule: RecordingRuleViewModel = props.row.original;\n        const labels = rule.groupBy?.filter((label: string) => !label.match(/^__\\S+__$/));\n\n        if (!labels || labels.length === 0) {\n          return (\n            <Text element=\"span\" color=\"secondary\">\n              None\n            </Text>\n          );\n        }\n\n        return <TagList className={styles.tagList} displayMax={4} tags={labels} />;\n      },\n    },\n    {\n      id: 'actions',\n      header: 'Actions',\n      disableGrow: true,\n      cell: (props) => {\n        const rule: RecordingRuleViewModel = props.row.original;\n        return <DeleteRecordingRuleButton rule={rule} confirm={() => actions.removeRecordingRule(rule)} />;\n      },\n    },\n  ];\n\n  const formattedRules = (recordingRules || []).map((rule) => {\n    const profileType = getProfileMetric(rule.profileType as ProfileMetricId);\n    return {\n      ...rule,\n      profileType: `${profileType.group}/${profileType.type}`,\n    };\n  });\n\n  const isEmpty = !formattedRules || formattedRules.length === 0;\n\n  let component = null;\n\n  if (data.fetchError) {\n    component = <RecordingRulesViewError error={data.fetchError} />;\n  } else if (isEmpty) {\n    component = (\n      <EmptyState message={'No recording rules'} variant=\"not-found\" button={<BackButton />}>\n        Open a flame graph, click on the &quot;total&quot; block at the top and select &quot;Create recording rule&quot;\n        from the context menu to define a new rule.\n      </EmptyState>\n    );\n  } else {\n    component = (\n      <div>\n        <InteractiveTable\n          className={css({ marginBottom: '32px' })}\n          columns={columns}\n          pageSize={10}\n          data={formattedRules || []}\n          getRowId={(rule) => rule.metricName}\n        ></InteractiveTable>\n        <BackButton />\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <PageTitle title=\"Recording rules\" />\n      {component}\n    </>\n  );\n}\n\nconst getStyles = () => ({\n  tagList: css`\n    flex-direction: row;\n    justify-content: start;\n  `,\n});\n\nfunction RecordingRulesViewError({ error }: { error: HttpClientError }) {\n  let errorMessage = 'Error while retrieving recording rules';\n  if (error.response?.status === 404) {\n    errorMessage = 'This feature requires Pyroscope with recording_rules flag enabled.';\n  } else if (error.message) {\n    errorMessage = error.message;\n  }\n  return (\n    <EmptyState message=\"Error while retrieving recording rules\" variant=\"not-found\" button={<BackButton />}>\n      {errorMessage}\n    </EmptyState>\n  );\n}\n","import { displayError, displaySuccess } from '@shared/domain/displayStatus';\nimport { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { DEFAULT_SETTINGS, PluginSettings } from '@shared/infrastructure/settings/PluginSettings';\nimport { useFetchPluginSettings } from '@shared/infrastructure/settings/useFetchPluginSettings';\nimport { useEffect, useState } from 'react';\n\nexport function useUISettingsView() {\n  const { settings, error: fetchError, mutate } = useFetchPluginSettings();\n  const setMaxNodes = useMaxNodesFromUrl()[1];\n  const [currentSettings, setCurrentSettings] = useState<PluginSettings>(settings ?? DEFAULT_SETTINGS);\n\n  useEffect(() => {\n    if (settings) {\n      setCurrentSettings(settings);\n    }\n  }, [settings]);\n\n  return {\n    data: {\n      ...currentSettings,\n      fetchError,\n    },\n    actions: {\n      toggleCollapsedFlamegraphs() {\n        setCurrentSettings((s) => ({\n          ...s,\n          collapsedFlamegraphs: !s.collapsedFlamegraphs,\n        }));\n      },\n      updateMaxNodes(event: React.ChangeEvent<HTMLInputElement>) {\n        setCurrentSettings((s) => ({\n          ...s,\n          maxNodes: Number(event.target.value),\n        }));\n      },\n      toggleEnableFlameGraphDotComExport() {\n        setCurrentSettings((s) => ({\n          ...s,\n          enableFlameGraphDotComExport: !s.enableFlameGraphDotComExport,\n        }));\n      },\n      toggleEnableFunctionDetails() {\n        setCurrentSettings((s) => ({\n          ...s,\n          enableFunctionDetails: !s.enableFunctionDetails,\n        }));\n      },\n      toggleEnableMetricsFromProfiles() {\n        setCurrentSettings((s) => ({\n          ...s,\n          enableMetricsFromProfiles: !s.enableMetricsFromProfiles,\n        }));\n      },\n      async saveSettings() {\n        setMaxNodes(currentSettings.maxNodes);\n\n        try {\n          await mutate(currentSettings);\n\n          displaySuccess(['Plugin settings successfully saved!']);\n        } catch (error) {\n          displayError(error as Error, [\n            'Error while saving the plugin settings!',\n            'Please try again later, sorry for the inconvenience.',\n          ]);\n        }\n      },\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { FieldSet, InlineField, InlineFieldRow, InlineSwitch, Input, useStyles2 } from '@grafana/ui';\nimport { displayError } from '@shared/domain/displayStatus';\nimport { featureToggles } from '@shared/infrastructure/settings/featureToggles';\nimport React from 'react';\n\nimport { useUISettingsView } from './domain/useUISettingsView';\n\nexport function UISettingsView({ children }: { children: React.ReactNode }) {\n  const styles = useStyles2(getStyles);\n  const { data, actions } = useUISettingsView();\n\n  if (data.fetchError) {\n    displayError(data.fetchError, [\n      'Error while retrieving the plugin settings!',\n      'Please try to reload the page, sorry for the inconvenience.',\n    ]);\n  }\n\n  function onSubmit(event: React.FormEvent) {\n    event.preventDefault();\n    actions.saveSettings();\n  }\n\n  return (\n    <form className={styles.settingsForm} onSubmit={onSubmit}>\n      <FieldSet label=\"Flame graph\" data-testid=\"flamegraph-settings\">\n        <InlineFieldRow>\n          <InlineField label=\"Collapsed flame graphs\" labelWidth={24}>\n            <InlineSwitch\n              label=\"Toggle collapsed flame graphs\"\n              name=\"collapsed-flamegraphs\"\n              value={data.collapsedFlamegraphs}\n              onChange={actions.toggleCollapsedFlamegraphs}\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Maximum number of nodes\" tooltip=\"\" labelWidth={24}>\n            <Input name=\"max-nodes\" type=\"number\" min=\"1\" value={data.maxNodes} onChange={actions.updateMaxNodes} />\n          </InlineField>\n        </InlineFieldRow>\n      </FieldSet>\n      <FieldSet label=\"Function details\" data-testid=\"function-details-settings\">\n        <InlineFieldRow>\n          <InlineField\n            label=\"Enable function details\"\n            labelWidth={24}\n            tooltip={\n              <div className={styles.tooltip}>\n                <p>\n                  The function details feature enables mapping of resource usage to lines of source code. If the GitHub\n                  integration is configured, then the source code will be downloaded from GitHub.\n                </p>\n                <p>\n                  <a\n                    href=\"https://grafana.com/docs/grafana-cloud/monitor-applications/profiles/pyroscope-github-integration/\"\n                    target=\"_blank\"\n                    rel=\"noreferrer noopener\"\n                  >\n                    Learn more\n                  </a>\n                </p>\n              </div>\n            }\n            interactive\n          >\n            <InlineSwitch\n              label=\"Toggle function details\"\n              name=\"function-details-feature\"\n              value={data.enableFunctionDetails}\n              onChange={actions.toggleEnableFunctionDetails}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      </FieldSet>\n\n      {featureToggles.metricsFromProfiles && (\n        <FieldSet label=\"Experimental features\" data-testid=\"experimental-features\">\n          <InlineFieldRow>\n            <InlineField\n              label=\"Metrics from profiles\"\n              tooltip=\"Allows creating Prometheus recording rules from profiles\"\n              labelWidth={24}\n            >\n              <InlineSwitch\n                label=\"Enable metrics from profiles\"\n                name=\"metrics-from-profiles\"\n                value={data.enableMetricsFromProfiles}\n                onChange={actions.toggleEnableMetricsFromProfiles}\n              />\n            </InlineField>\n          </InlineFieldRow>\n        </FieldSet>\n      )}\n\n      {children}\n    </form>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  settingsForm: css`\n    & > fieldset {\n      border: 0 none;\n      border-bottom: 1px solid ${theme.colors.border.weak};\n      padding-left: 0;\n    }\n\n    & > fieldset > legend {\n      font-size: ${theme.typography.h4.fontSize};\n    }\n  `,\n  buttons: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n    margin-top: ${theme.spacing(3)};\n  `,\n  tooltip: css`\n    p {\n      margin: ${theme.spacing(1)};\n    }\n\n    a {\n      color: ${theme.colors.text.link};\n    }\n\n    em {\n      font-style: normal;\n      font-weight: ${theme.typography.fontWeightBold};\n    }\n  `,\n});\n","import { usePluginComponents } from '@grafana/runtime';\n\nconst SETTINGS_EXTENSION_POINT_ID = 'grafana-pyroscope-app/settings/v1';\n\nexport type SettingsExtensionProps = {\n  datasourceUid: string; // the datasource uid currently in use, extensions might not use it\n  backButton: React.ReactNode; // the back button component\n};\n\ntype UseSettingsExtensionsResult<Props = {}> = {\n  components: Array<React.ComponentType<Props>>;\n  isLoading: boolean;\n};\n\nexport function useSettingsExtensions(): UseSettingsExtensionsResult<SettingsExtensionProps> {\n  return usePluginComponents<SettingsExtensionProps>({\n    extensionPointId: SETTINGS_EXTENSION_POINT_ID,\n  });\n}\n","import { useMaxNodesFromUrl } from '@shared/domain/url-params/useMaxNodesFromUrl';\nimport { useRef, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { PLUGIN_BASE_URL, ROUTES } from '../../../constants';\nimport { useSettingsExtensions } from './useSettingsExtensions';\n\nexport function useSettingsView() {\n  const [maxNodesFromUrl] = useMaxNodesFromUrl();\n  const [activeTab, setActiveTab] = useState(0);\n\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  const referrerRef = useRef(location.state?.referrer);\n\n  const { components, isLoading } = useSettingsExtensions();\n\n  return {\n    data: {\n      activeTab,\n      components,\n      isLoading,\n    },\n    actions: {\n      setActiveTab(tab: number) {\n        setActiveTab(tab);\n      },\n      goBack() {\n        if (!referrerRef.current) {\n          navigate(`${PLUGIN_BASE_URL}${ROUTES.EXPLORE}`);\n          return;\n        }\n\n        const backUrl = new URL(referrerRef.current);\n\n        // when calling saveSettings() above, the new maxNodes value is set and the URL search parameter is updated (see useMaxNodesFromUrl.ts)\n        if (maxNodesFromUrl) {\n          backUrl.searchParams.set('maxNodes', String(maxNodesFromUrl));\n        }\n\n        navigate(`${backUrl.pathname}${backUrl.search}`);\n      },\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Space, Tab, TabsBar, useStyles2 } from '@grafana/ui';\nimport { BackButton } from '@shared/components/Common/BackButton';\nimport { ApiClient } from '@shared/infrastructure/http/ApiClient';\nimport { useReportPageInitialized } from '@shared/infrastructure/tracking/useReportPageInitialized';\nimport { PageTitle } from '@shared/ui/PageTitle';\nimport React from 'react';\n\nimport { UISettingsView } from './components/UISettingsView/UISettingsView';\nimport { useSettingsView } from './domain/useSettingsView';\n\ninterface ComponentWithMeta {\n  meta?: {\n    title: string;\n  };\n}\n\nexport default function SettingsView() {\n  const styles = useStyles2(getStyles);\n  const { data, actions } = useSettingsView();\n\n  useReportPageInitialized('settings');\n\n  if (data.isLoading) {\n    return <div>Loading...</div>;\n  }\n\n  // Define the build in tabs\n  const builtInTabs = [\n    {\n      // Standard UI settings tab\n      title: 'UI Settings',\n      content: (\n        <UISettingsView>\n          <div className={styles.buttons}>\n            <Button variant=\"primary\" type=\"submit\">\n              Save settings\n            </Button>\n            <BackButton onClick={actions.goBack} />\n          </div>\n        </UISettingsView>\n      ),\n    },\n  ];\n\n  const pyroscopeDataSource = ApiClient.selectDefaultDataSource();\n  const pluginProps = {\n    datasourceUid: pyroscopeDataSource.uid,\n    backButton: (\n      <div className={styles.buttons}>\n        <BackButton onClick={actions.goBack} />\n      </div>\n    ),\n  };\n  const pluginTabs = data.components.map((Component) => {\n    // get title from plugin meta (works in Grafana 11.6+)\n    const title = (Component as ComponentWithMeta).meta?.title || 'Unknown Extension';\n\n    return {\n      title: title,\n      content: <Component {...pluginProps} />,\n    };\n  });\n\n  const allTabs = [...builtInTabs, ...pluginTabs];\n\n  return (\n    <>\n      <PageTitle title=\"Profiles settings (tenant)\" />\n      {/* if there is only one tab, don't render tab bar */}\n      {allTabs.length > 1 && (\n        <>\n          <TabsBar>\n            {allTabs.map((tab, index) => (\n              <Tab\n                key={`settings-tab-${index}`}\n                label={tab.title}\n                active={data.activeTab === index}\n                onChangeTab={() => actions.setActiveTab(index)}\n              />\n            ))}\n          </TabsBar>\n          <Space v={2} />\n        </>\n      )}\n      {allTabs[data.activeTab].content}\n    </>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  buttons: css`\n    display: flex;\n    gap: ${theme.spacing(1)};\n    margin-top: ${theme.spacing(3)};\n  `,\n});\n","import React from 'react';\nimport { Navigate, Routes as ReactRouterRoutes, Route } from 'react-router-dom';\n\nimport { PLUGIN_BASE_URL, ROUTES } from '../constants';\nimport AdHocView from '../pages/AdHocView/AdHocView';\nimport GitHubCallback from '../pages/ProfilesExplorerView/components/SceneExploreServiceFlameGraph/components/SceneFunctionDetailsPanel/ui/GitHubCallbackView';\nimport ProfilesExplorerView from '../pages/ProfilesExplorerView/ProfilesExplorerView';\nimport RecordingRulesView from '../pages/RecordingRulesView/RecordingRulesView';\nimport SettingsView from '../pages/SettingsView/SettingsView';\n\nexport function Routes() {\n  return (\n    <ReactRouterRoutes>\n      <Route path={ROUTES.EXPLORE} element={<ProfilesExplorerView />} />\n      <Route path={ROUTES.ADHOC} element={<AdHocView />} />\n      <Route path={ROUTES.SETTINGS} element={<SettingsView />} />\n      <Route path={ROUTES.RECORDING_RULES} element={<RecordingRulesView />} />\n      <Route path={ROUTES.GITHUB_CALLBACK} element={<GitHubCallback />} />\n      {/* Default Route */}\n      <Route path=\"/*\" element={<Navigate to={`${PLUGIN_BASE_URL}${ROUTES.EXPLORE}`} replace />} />\n    </ReactRouterRoutes>\n  );\n}\n","import { PageLayoutType } from '@grafana/data';\nimport { PluginPage } from '@grafana/runtime';\nimport { InlineBanner } from '@shared/ui/InlineBanner';\nimport { PageTitle } from '@shared/ui/PageTitle';\nimport React from 'react';\n\nexport function ErrorPage({ error }: { error: Error }) {\n  return (\n    <PluginPage layout={PageLayoutType.Canvas}>\n      <div className=\"pyroscope-app\">\n        <PageTitle title=\"Grafana Profiles Drilldown\" />\n\n        <InlineBanner\n          severity=\"error\"\n          title=\"Fatal error!\"\n          message=\"Please try reloading the page or, if the problem persists, contact your organization admin. Sorry for the inconvenience.\"\n          error={error}\n          errorContext={{ handheldBy: 'React error boundary' }}\n        />\n      </div>\n    </PluginPage>\n  );\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, PageLayoutType } from '@grafana/data';\nimport { PluginPage } from '@grafana/runtime';\nimport { ErrorBoundary, useStyles2 } from '@grafana/ui';\nimport { queryClient } from '@shared/infrastructure/react-query/queryClient';\nimport { initFaro } from '@shared/infrastructure/tracking/faro/faro';\nimport { QueryClientProvider } from '@tanstack/react-query';\nimport React, { useState } from 'react';\n\nimport { Onboarding } from './components/Onboarding/Onboarding';\nimport { Routes } from './Routes';\nimport { ErrorPage } from './ui/ErrorPage';\n\ninitFaro();\n\nexport function App() {\n  const styles = useStyles2(getStyles);\n  const [error, setError] = useState<Error>();\n\n  if (error) {\n    return <ErrorPage error={error} />;\n  }\n\n  return (\n    <ErrorBoundary onError={setError}>\n      {() => (\n        <QueryClientProvider client={queryClient}>\n          <Onboarding>\n            <div className={styles.pageContainer}>\n              <PluginPage layout={PageLayoutType.Custom}>\n                <div className=\"pyroscope-app\">\n                  <Routes />\n                </div>\n              </PluginPage>\n            </div>\n          </Onboarding>\n        </QueryClientProvider>\n      )}\n    </ErrorBoundary>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  pageContainer: css`\n    display: flex;\n    flex-direction: column;\n    padding: ${theme.spacing(1)} ${theme.spacing(2)} ${theme.spacing(2)} ${theme.spacing(2)};\n    flex-basis: 100%;\n    flex-grow: 1;\n  `,\n});\n","import { Environment, getEnvironment } from '../getEnvironment';\nimport { FARO_ENVIRONMENTS } from './faro-environments';\n\nexport type FaroEnvironment = { environment: Environment; appName: string; faroUrl: string };\n\nexport function getFaroEnvironment() {\n  const environment = getEnvironment();\n\n  if (!environment || !FARO_ENVIRONMENTS.has(environment)) {\n    return;\n  }\n\n  return FARO_ENVIRONMENTS.get(environment) as FaroEnvironment;\n}\n","// shims/react-use-usePrevious-default.js\nimport { useDebounce } from 'react-use';\n\nexport default useDebounce;\n","// shims/react-use-usePrevious-default.js\nimport { usePrevious } from 'react-use';\n\nexport default usePrevious;\n"],"names":["queryClient","QueryClient","defaultOptions","queries","networkMode","retry","refetchOnWindowFocus","PYROSCOPE_APP_ID","plugin","PLUGIN_BASE_URL","ROUTES","GIT_COMMIT","MATCHERS","regExp","environment","getEnvironment","window","location","host","found","find","test","FARO_ENVIRONMENTS","Map","appName","faroUrl","faro","getFaro","methodName","args","this","console","logger","trace","api","pushLog","level","LogLevel","TRACE","debug","DEBUG","info","INFO","log","LOG","warn","WARN","error","context","pushError","constructor","userStorage","has","itemName","hasOwnProperty","get","JSON","parse","getItem","set","value","setItem","stringify","localStorage","KEYS","SETTINGS","GITHUB_INTEGRATION","PROFILES_EXPLORER","noOp","HttpClientError","Error","response","responseJson","message","status","statusText","super","reason","HttpClient","fetch","pathname","options","abortController","AbortController","signal","fullUrl","baseUrl","headers","defaultHeaders","fullOptions","ok","json","catch","isAbortError","abort","DOMException","name","Object","freeze","ApiClient","getPyroscopeDataSources","values","config","datasources","filter","ds","type","selectDefaultDataSource","pyroscopeDataSources","uidFromUrl","URL","href","searchParams","uidFromLocalStorage","dataSource","defaultDataSource","uid","jsonData","overridesDefault","isDefault","getBaseUrl","pyroscopeDataSource","appSubUrl","at","toString","String","bootData","user","orgId","statsApiClient","method","body","hasIngestedData","dataIngested","oldestProfileTime","Number","newestProfileTime","useOnboarding","isModalClosed","setIsModalClosed","useState","pyroscopeDataSourcesCount","length","isFetching","stats","enabled","data","refetch","useQuery","placeholderData","queryKey","queryFn","useFetchTenantStats","hasNoUserData","shouldShowLoadingPage","shouldShowOnboardingPage","shouldShowNoDataSourceBanner","actions","closeModal","getStyles","theme","row","css","display","flexDirection","justifyContent","alignItems","headerColumn","minWidth","column","tooltip","color","colors","text","secondary","fontSize","typography","bodySmall","contentWithIcon","styleMixins","mediaUp","v1","breakpoints","sm","formatSize","size","formattedValueToString","getValueFormat","formatCount","count","QueryAnalysisTooltip","props","styles","useStyles2","totalBytesInTimeRange","queryImpact","queryAnalysisTooltip","useMemo","div","data-testid","className","undefined","totalQueriedSeries","deduplicationNeeded","Divider","queryScopes","map","s","i","key","strong","componentType","componentCount","blockCount","seriesCount","profileCount","sampleCount","indexBytes","profileBytes","symbolBytes","Toggletip","content","fitContent","span","IconButton","aria-label","PyroscopeLogoComponent","img","cx","logo","src","PyroscopeLogo","React","pluginCommitSha","pluginCommitURL","buildInfo","grafanaBuildInfo","InfoMenuHeader","meta","version","updated","usePluginContext","menuHeader","h5","subTitle","InfoMenu","isDev","shortCommitSha","slice","Menu","header","Item","label","icon","onClick","open","disabled","edition","env","commit","PluginInfo","Dropdown","overlay","placement","title","spacing","PageTitleComponent","queryAnalysis","fullTitle","Helmet","titleContainer","Stack","h1","infoArea","h2","PageTitle","memo","EmptyLoadingPage","PluginPage","layout","PageLayoutType","Canvas","Icon","link","StyledLink","children","a","target","rel","NoDataSourcePage","Alert","severity","useOnboardingModal","instances","then","useFetchInstances","settingsUrl","setSettingsUrl","isCloud","orgSlug","hpInstanceId","newSettingsUrl","onboardingRow","background","onboardingParagraph","onboardingPanel","onboardingPanelHeader","onboardingPanelImage","hero","heroTitles","heroImage","onboardingPanelNumber","color2","color3","onboardingPanelNumberSpan","onboardingPanelDescription","subtitle","OnboardingModal","HeroImage","h3","ReduceCosts","p","DecreaseLatency","ResolveIncidents","br","onboardingPage","primary","closeButton","pageNav","OnboardingPage","onCloseModal","Custom","button","Onboarding","BackButton","callback","history","back","Button","variant","PROFILES_EXPLORER_PAGE_NAME","EXPLORE","getCurrentPage","split","pop","getMetaProperties","appRelease","apps","appVersion","page","view","URLSearchParams","search","reportInteraction","interactionName","grafanaReportInteraction","useReportPageInitialized","initialized","setInitialized","useEffect","container","AdHocColumns","left","right","displayError","msgs","reduce","acc","msg","handheldBy","getAppEvents","publish","AppEvents","alertError","payload","displayWarning","alertWarning","displaySuccess","alertSuccess","adHocProfileClient","profileId","profileType","id","profile_type","profileTypes","profile","flamebearerProfile","uploadSingle","file","_readProfileFile","uploadDiff","Promise","resolve","reject","fileReader","FileReader","addEventListener","fileContent","base64Content","stripBase64Prefix","result","readAsDataURL","DEFAULT_PROFILE_DATA","useUploadFile","isLoading","setIsLoading","profileData","setProfileData","removeFile","useCallback","processFile","selectProfileType","option","includes","prevData","accept","multiple","onError","AdHocFileDropZone","onFileDropped","onFileRemove","onDropAccepted","files","FileDropzone","flamegraphDotComApiClient","upload","btoa","fileTypeData","units","metadata","spyName","CompareTarget","DATETIME_FORMATTER","Intl","DateTimeFormat","year","month","day","hour12","hour","minute","second","format","date","parts","formatToParts","dateForExportFilename","timeRange","from","Date","Math","round","unix","to","getTimeRange","fromKey","toKey","BASELINE","raw","dateTimeParse","getExportFilename","timeRanges","COMPARISON","join","useExportMenu","enableFlameGraphDotComExport","uploadToFlamegraphDotCom","customExportName","dlLink","document","createElement","url","appendChild","click","removeChild","shouldDisplayFlamegraphDotCom","Boolean","downloadPng","filename","querySelector","toBlob","blob","saveAs","downloadJson","dataStr","encodeURIComponent","ExportMenu","ExportDataComponent","fill","ExportData","getNodes","names","diff","nodes","itemOffset","push","offset","val","self","selfRight","valRight","valTotal","offsetRight","offsetTotal","FlameGraphComponent","vertical","collapsedFlamegraphs","getExtraContextMenuButtons","isLight","useTheme2","dataFrame","levels","unit","nodeLevels","node","currentNodeStart","n","prevLevel","prevLevelOffset","prevLevelNode","parentNodeStart","parentNodeEnd","stack","labelValues","levelValues","selfValues","valueValues","selfRightValues","valueRightValues","shift","unshift","valueUnit","fields","FieldType","string","frame","preferredVisualisationType","createDataFrame","flamebearerToDataFrameDTO","flamebearer","GrafanaFlameGraph","disableCollapsing","extraHeaderElements","getTheme","createTheme","mode","keepFocusOnDataChange","FlameGraph","flamegraph","AdHocFlameGraph","selectorContainer","AdHocProfileTypeSelector","onChange","setOption","_onChange","o","InlineFieldRow","InlineField","Select","width","spinner","AdHocSpinner","Spinner","AdHocSingleComponent","fileType","AdHocSingle","AdHocComparison","tabContent","AdHocTabs","activeTabIndex","setActiveTabIndex","TabsBar","Tab","active","onChangeTab","TabContent","AdHocView","loadingIcon","main","loadingMessage","h4","fullScreenModal","GitHubCallbackView","isModalOpen","setIsModalOpen","Modal","isOpen","onDismiss","close","closeOnEscape","closeOnBackdropClick","prepareHistoryEntry","pushState","EventTimeseriesDataReceived","BusEventWithPayload","FilterKind","OperatorKind","FilterPartKind","SuggestionKind","DataSourceProxyClient","dataSourceUid","LabelsApiClient","queryToMatchers","query","labelsIndex","indexOf","substring","fetchLabels","_post","matchers","start","end","fetchLabelValues","labelId","MemoryCacheClient","buildCacheKey","arg","store","delete","invariant","check","AbstractRepository","setApiClient","apiClient","setCacheClient","cacheClient","cancel","LabelsRepository","parseLabelsResponse","Array","isArray","Set","isNotMetaLabelOrServiceName","parseLabelValuesResponse","assertParams","listLabels","cacheParams","labelsFromCacheP","labels","fetchP","listLabelValues","labelValuesFromCacheP","labelsRepository","areFiltersEqual","newFilters","previousFilters","newFiltersWithoutPartial","partial","previousFiltersWithoutPartial","every","attribute","operator","IsEmptyFilter","buildIsEmptyFilter","filtersToQuery","filters","labelsList","in","serviceNameLabel","match","replace","getLastFilter","isMultipleValuesOperator","isPartialFilter","isEditingOperatorMode","currentOperator","newOperator","isSwitchingOperatorMode","filterUnderEdition","parseRawFilters","rawFilters","matches","matchAll","LABELS_REGEX","REGEX_CHARS_REGEX","queryToFilters","rawLabels","nanoid","v","trim","toggleCompleteFilters","updateFiltersAndQuery","isQueryUpToDate","inputParams","cancelAllLoad","setFilterAttribute","assign","event","editFilterAttribute","filterId","setFilterOperator","editFilterOperator","newEdition","previousOperator","part","setFilterValue","editFilterValue","removeFilter","removeLastFilter","lastFilter","concat","setEdition","changeInputParams","activateFilters","getFilterUnderEdition","guards","shouldSuggestAttributes","shouldSuggestOperators","shouldSuggestValues","isEditing","shouldSuggestValuesAfterOperatorEdition","shouldNotSuggestValuesAfterOperatorEdition","hasPartialFilter","shouldEditAttribute","shouldEditOperator","shouldEditValue","operatorsRepository","list","description","isPrivateLabel","startsWith","handleError","services","publicLabels","privateLabels","forEach","fetchOperators","targetFilter","suggestions","autoSuggestProxy","always","cond","MESSAGES","FILTER_ADD","SELECT_LABEL","SELECT_OPERATOR","SELECT_VALUE","SELECT_VALUES","TYPE_VALUE","LOADING","ERROR_LOAD","SUGGESTIONS_NONE","SUGGESTIONS_DISABLED","isRegexOperator","idle","entry","placeholder","allowCustomValue","defaultContext","on","START_INPUT","EDIT_FILTER","REMOVE_FILTER","REMOVE_LAST_FILTER","CHANGE_INPUT_PARAMS","EXECUTE_QUERY","loadLabels","isVisible","invoke","onDone","items","some","DISCARD_SUGGESTIONS","displayLabels","SELECT_SUGGESTION","loadLabelValues","displayLabelValues","targetOperator","noOptionsMessage","loadOperators","displayOperators","initial","predictableActionArguments","states","buildStateMachine","initialContext","stateMachine","createMachine","actor","interpret","localeCompare","Collator","sensitivity","compare","placeSelectedValuesFirst","b","aIsSelected","bIsSelected","MultipleEditionSelect","selection","onCloseMenu","defaultValue","selectionValues","selectionLabels","setValues","sortedOptions","sort","newValues","onInternalCloseMenu","MultiSelect","editionSelect","closeMenuOnSelect","hideSelectedOptions","backspaceRemovesValue","autoFocus","invalid","SingleEditionInput","onFocus","onBlur","inputRef","useRef","setInvalid","current","focus","Input","ref","onKeyUp","e","code","SingleEditionSelect","ChicletAttributeOperator","onRemove","chiclet","inactiveChiclet","Tag","chicletAttribute","chicletOperator","tabIndex","chicletRemoveButton","ChicletAttributeOperatorValue","Tooltip","chicletValue","PartialChiclet","partialChiclet","colorIndex","activeBackgroundColor","inactiveBorderColor","maxContrast","ChicletComponent","TypeError","Chiclet","prevProps","nextProps","chicletsList","editChicletContainer","ChicletsListComponent","onClickChiclet","onRemoveChiclet","onChangeSingleSuggestion","onCloseSingleSuggestionsMenu","onCloseMultipleSuggestionsMenu","ChicletsList","select","SingleSelect","onKeyDown","setIsOpen","setTimeout","useEnsureIsOpenHack","DisabledSelect","MultipleSelect","onInternalKeyDown","queryBuilder","controls","executeButton","QueryBuilderComponent","internalProps","onChangeQuery","send","setInternalProps","subscribe","stop","useStateMachine","useChicletHandlers","onSingleSelectKeyDown","onCloseSingleMenu","onMultipleSelectKeyDown","onCloseMultipleMenu","queryBuilderId","suggestion","previousSuggestionsIsVisible","state","usePrevious","blur","useSelectHandlers","onClickExecute","autoExecute","onTransition","off","QueryBuilder","getProfileMetric","profileMetricId","PROFILE_METRICS","group","PYROSCOPE_DATA_SOURCE","PYROSCOPE_SERIES_DATA_SOURCE","PYROSCOPE_FAVORITES_DATA_SOURCE","PYROSCOPE_LABELS_DATA_SOURCE","ProfileMetricVariable","QueryVariable","onActivate","setState","DEFAULT_VALUE","update","force","loading","lastValueFrom","getValueOptions","buildCascaderOptions","optionsMap","profileMetric","nameSpaceServices","datasource","QUERY_DEFAULT","refresh","VariableRefresh","onTimeRangeChanged","onSelect","newValue","skipUrlSync","changeValueTo","bind","addActivationHandler","QUERY_SERVICE_NAME_DEPENDENT","Component","model","cascaderOptions","iconError","Cascader","separator","displayAllSelectedLevels","initialValue","changeOnSelect","ServiceNameVariable","serviceName","serviceNameFromStorage","subscribeToState","newState","prevState","storage","selectNewValue","QUERY_PROFILE_METRIC_DEPENDENT","serviceNames","sortedServiceNames","rootElements","hierarchy","serviceId","currentPath","previousPath","isComplete","parent","buildServiceNameCascaderOptions","useBuildPyroscopeQuery","sceneObject","filterKey","sceneGraph","findByKeyAndType","filterExpression","FiltersVariable","ProfilesDataSourceVariable","DataSourceVariable","pluginId","convertPyroscopeToVariableFilter","searchForFilter","filtersWithoutFound","f","addToFilters","filterToAdd","includeLabelValue","filterForInclude","foundValues","add","excludeLabelValue","filterForExclude","clearLabelValue","filterForClear","filteredValues","isFilterValid","AdHocFiltersVariable","reset","resetAll","dataSourceSub","unsubscribe","expressionBuilder","operators","uniq","getSceneVariableValue","variableName","lookupVariable","getValue","PanelType","ScenePanelTypeSwitcher","SceneObjectBase","getUrlState","panelType","updateFromUrl","stateUpdate","DEFAULT_PANEL_TYPE","_urlSync","SceneObjectUrlSyncConfig","keys","OPTIONS","RadioButtonGroup","fullWidth","getColorByIndex","index","visTheme","theme2","visualization","getColorByName","palette","getSeriesLabelFieldName","metricField","getSeriesStatsValue","series","displayName","parseQuery","labelsSelector","m","withPreventInvalidQuery","queryRunner","profileTypeId","labelSelector","refId","buildErrorData","interpolate","errorMsg","LoadingState","errors","buildTimeSeriesQueryRunner","groupBy","limit","completeFilters","selector","SceneQueryRunner","queryType","addRefId","source","pipe","d","merge","addStats","totalSeriesCount","maxValue","NEGATIVE_INFINITY","allValuesSum","field","SceneLabelValuesBarGauge","item","sub","$data","Done","getConfig","publishEvent","max","groupByLabel","queryRunnerParams","reduceOptions","calcs","orientation","VizOrientation","Horizontal","displayMode","BarGaugeDisplayMode","Gradient","valueMode","BarGaugeValueMode","Text","showUnfilled","sizing","BarGaugeSizing","Manual","titleSize","valueSize","namePlacement","BarGaugeNamePlacement","Top","minVizHeight","maxVizHeight","legend","showLegend","fieldConfig","defaults","min","thresholds","ThresholdsMode","Percentage","steps","overrides","getOverrides","startColorIndex","matcher","FieldMatcherID","byFrameRefID","properties","fixedColor","headerActions","PanelBuilders","bargauge","setTitle","setData","SceneDataTransformer","transformations","setHeaderActions","build","formatSingleSeriesDisplayName","metricFieldUnit","allValuesSumFormatted","maxValueFormatted","suffix","SceneLabelValuesHistogram","legendPlacement","TooltipDisplayMode","Single","SortOrder","None","LegendDisplayMode","List","custom","lineWidth","histogram","SceneLabelValuesTable","cardinality","unitValue","filterable","cellOptions","table","DataTransformerID","reducers","labelsToFields","filterFieldsByName","exclude","renameByRegex","regex","renamePattern","sortBy","desc","computeRoundedTimeRange","floor","valueOf","pLimit","LabelsDataSource","RuntimeDataSource","other","getParams","scopedVars","range","__sceneObject","labelName","metricFindQuery","_","isActive","variable","labelsWithValuesAndCount","all","sortedLabels","testDatasource","MAX_TIMESERIES_LABEL_VALUES","getProfileMetricLabel","SCALE_TYPES","scaleDistribution","ScaleDistribution","Linear","Log","SceneTimeseriesMenu","buildMenuItems","addToInvestigationLink","scaleType","menuItems","subMenu","onClickScaleOption","iconClassName","onClickExplore","existingAddToInvestigationItem","scale","getAncestor","SceneLabelValuesTimeseries","changeScale","exploreUrl","rawTimeRange","exploreState","toURLRange","panelsState","subUrl","urlUtil","renderUrl","panes","schemaVersion","getExploreUrl","getInterpolatedQuery","timeseries","nonInterpolatedQuery","entries","useGetInvestigationPluginLinkContext","parsedQuery","titleParts","origin","logoPath","useUpdateMenuItems","extensionPointId","pluginLinks","usePluginLinks","links","useGetPluginExtensionLink","VizPanelMenu","annotations","displayAllValues","getAllValuesConfig","buildDescription","fillOpacity","gradientMode","GraphGradientMode","Opacity","pointSize","updateItem","partialItem","updatedItem","isEqual","runQueries","axisLabel","clearFieldConfigCache","setMenu","vizPanelBuilder","BARGAUGE","TABLE","HISTOGRAM","TIMESERIES","throttleInterval","mousePosition","setMousePosition","x","y","updateMousePosition","throttle","clientX","clientY","removeEventListener","GrotNotFound","height","show404","useMousePosition","SVG","isDark","dark404","light404","svg","xPos","yPos","innerWidth","innerHeight","heightRatio","widthRatio","rotation","getIntermediateValue","translation","transform","transformOrigin","transition","ratio","EmptyState","Box","paddingY","direction","gap","SceneEmptyState","SceneErrorState","LayoutType","SceneLayoutSwitcher","DEFAULT_LAYOUT","SceneNoDataSwitcher","hideNoData","InlineSwitch","showLabel","checked","SceneQuickFilter","setPlaceholder","setResultsCount","resultsCount","searchText","DEFAULT_SEARCH_TEXT","clearSearchText","DEBOUNCE_DELAY","prefix","FavoritesDataSource","getAllFavorites","favorites","areFavoritesEqual","f1","f2","exists","favorite","addFavorite","removeFavorite","textParts","interpolateQueryRunnerVariables","interpolatedParams","clone","parsedFilters","uniqBy","FavAction","isFav","isStored","buildFavorite","skipVariablesInterpolation","_variableDependency","VariableDependencyConfig","variableNames","onReferencedVariableValueChanged","favAfterClick","favedButton","notFavedbutton","tooltipPlacement","sortFavGridItems","aIsFav","bIsFav","GRID_AUTO_ROWS","SceneByVariableRepeaterGrid","buildGridItemKey","getGridColumnsTemplate","ROWS","variableSub","renderGridItems","refreshSub","subscribeToRefreshClick","quickFilterSub","subscribeToQuickFilterChange","layoutChangeSub","subscribeToLayoutChange","hideNoDataSub","subscribeToHideNoDataChange","filtersSub","subscribeToFiltersChange","originalRefresh","never","onClickRefresh","refreshButton","setAttribute","removeAttribute","quickFilter","debounce","layoutSwitcher","onChangeState","templateColumns","noDataSwitcher","filtersVariable","buildItemsData","mapOptionToItem","variableValues","filterItems","sortItemsFn","shouldRenderItems","newItems","forceRender","renderErrorState","renderEmptyState","gridItems","vizPanel","setupHideNoData","SceneCSSGridItem","autoRows","subscribeToEvent","gridItem","gridItemKey","grid","SceneCSSGridLayout","filteredChildren","c","quickFilterScene","regexes","t","r","RegExp","isLazy","$behaviors","behaviors","sync","DashboardCursorSync","Crosshair","EventExpandPanel","EventSelectLabel","EventViewServiceFlameGraph","EventViewServiceLabels","EventViewServiceProfiles","Events","ariaLabel","EventConstructor","SelectAction","buildEvent","lookup","selectButton","SceneExploreAllServices","getVariablesAndGridControls","variables","gridControls","$variables","SceneVariableSet","SceneDrawer","Drawer","closeOnMaskClick","onClose","FavoriteVariable","SceneExploreFavorites","expandPanelSub","openExpandedPanelDrawer","drawer","GroupBySelector","mainLabels","onRefresh","labelSelectorRequiredWidth","setLabelSelectorRequiredWidth","availableWidth","setAvailableWidth","useHorizontalLabelSelector","controlsContainer","useResizeObserver","onResize","element","clientWidth","mainOptions","otherOptions","textWidth","measureText","Field","selected","isClearable","GroupByVariable","RefreshPicker","noIntervalPicker","isOnCanvas","onIntervalChanged","findCurrentOption","parsedValue","MAX_MAIN_LABELS","groupByOptions","groupByErrorContainer","getMainLabels","SceneMainServiceTimeseries","supportGroupBy","initVariables","buildTimeseries","subscribeToGroupByStateChanges","timeseriesItem","buildTitle","groupByVariable","_subs","onGroupByChanged","resetTimeseries","resetFilters","MIN_HEIGHT","EventViewDiffFlameGraph","EventSelectForCompare","CompareAction","checkboxRef","showTooltip","setShowTooltip","closest","onMouseEnter","onMouseLeave","show","tooltipAnchor","Checkbox","checkbox","StatsPanel","itemStats","statsDescription","compareActionChecks","onChangeCompareTarget","total","inline","style","compareActions","canvas","border","weak","SceneStatsPanel","SceneGroupByLabels","getCompare","updateCompareActions","getStatsDescription","baselineItem","comparisonItem","getStats","updateStats","compareTarget","WIDTH_IN_PIXELS","SceneLabelValuePanel","buildPanelKey","statsPanel","timeseriesPanel","timeseriesSub","isSelected","buildLabelValuesGridQueryRunner","SceneLabelValuesGrid","subscribeOnceToDataChange","groupBySub","subscribeToGroupByChange","dataSub","Loading","refetchData","labelValue","loadingState","buildVizPanel","marginBottom","EventClearLabelFromFilters","EventExcludeLabelFromFilters","EventIncludeLabelInFilters","FilterButtonsComponent","include","onInclude","onExclude","onClear","isIncludeSelected","isExcludeSelected","getStatus","aria-selected","includeButton","excludeButton","FilterButtons","shape","radius","default","IncludeExcludeAction","CompareControls","onClickCompare","onClickClear","compareIsDisabled","hasSelection","arial-label","compareButton","clearButton","clearButtonActive","medium","initVariablesAndControls","renderBody","panelEventsSub","subscribeToPanelEvents","panelTypeChangeSub","selectLabelSub","selectLabel","selectForCompareSub","selectForCompare","includeFilterSub","includeLabelValueInFilters","excludeFilterSub","excludeLabelValueFromFilters","clearFilterSub","clearLabelValueFromFilters","subscribeToPanelTypeChange","switchToLabelNamesGrid","switchToLabelValuesGrid","buildSceneLabelNamesGrid","clearCompare","buildSceneLabelValuesGrid","groupByValue","filterToInclude","filterToExclude","filterToClear","updateStatsPanels","statsPanels","findAllObjects","panel","onClickCompareButton","baselineFilters","comparisonFilters","useAncestorTimeRange","clearDiffRange","onClickClearCompareButton","groupByVariableValue","SceneProfilesExplorer","sceneControls","wrap","control","SceneExploreServiceLabels","profileMetricVariable","timeseriesTitle","SceneFlexLayout","SceneFlexItem","minHeight","SceneExploreServiceProfileTypes","buildTimeRange","getDefaultTimeRange","SpanSelectorVariable","CustomVariable","formatSeriesToProfileMetrics","pyroscopeSeries","profileMetricsMap","profileMetrics","formatSeriesToServices","servicesSet","DataSourceProxyClientBuilder","ApiClientClass","cacheKey","cachedInstance","cache","clientInstance","findServiceNameAndProfileMetricId","formatSeriesResponse","labelsSet","serviceProfileMetrics","profileMetricServices","SeriesApiClient","labelNames","seriesRepository","responseFromCacheP","SeriesDataSource","fetchSeries","EventEnableSyncTimeRanges","EventSyncRefresh","EventSyncTimeRanges","SceneTimePickerWithoutSync","SceneTimePicker","hidePicker","timeZone","getTimeZone","timeRangeState","TimeRangePicker","onTimeRangeChange","fiscalYearStartMonth","onMoveBackward","onMoveForward","onZoom","onChangeTimeZone","onTimeZoneChange","onChangeFiscalYearStartMonth","isSynced","INTERVAL_STRING_REGEX","parseUrlParam","utcValue","toUtc","isValid","toISOString","epoch","parseInt","isNaN","RangeAnnotation","MutableDataFrame","addRange","isRegion","time","boolean","addField","TimeRangeWithAnnotationsMode","TIMERANGE_NIL","dateTime","SceneTimeRangeWithAnnotations","omit","getAncestorTimeRange","getTimeseries","updateTimeseriesAnnotation","VizPanel","annotationTimeRange","annotationColor","annotationTitle","annotation","timeEnd","setAnnotationTimeRange","updateTimeseries","nullifyAnnotationTimeRange","diffFrom","diffTo","buildAnnotationTimeRange","delay","hasDelay","dateMath","evaluateTimeRange","UNSAFE_nowDelay","EventSwitchTimerangeSelectionMode","TimerangeSelectionMode","SwitchTimeRangeSelectionModeAction","newMode","dl","dt","dd","buildCompareTimeSeriesQueryRunner","BASELINE_COLORS","COLOR","Color","OVERLAY","alpha","COMPARISON_COLORS","SceneComparePanel","$timeRange","setDiffRange","findByKey","buildTimeseriesTitle","eventSub","subscribeToEvents","buildTimeSeriesPanel","formattedValue","getDiffRange","dateTimeFormat","systemDateFormats","fullDate","ANNOTATIONS","$annotationTimeRange","switchSub","FLAMEGRAPH","DEFAULT","annotationTimeRangeSub","timeRangeSyncEnabled","timeRangeSub","updateTitle","useDiffTimeRange","applyPreset","setTimeRange","newTimeRange","isSame","$diffTimeRange","newAnnotationTimeRange","autoSelectDiffRange","selectWholeRange","subtract","newTitle","toggleTimeRangeSync","refreshTimeseries","SceneTimeRange","timePicker","refreshPicker","SceneRefreshPicker","onClickTimeRangeSync","enable","panelHeader","h6","colorCircle","timeControls","syncButton","shade","useToggleSidePanel","openPanelId","setOpenPanelId","onOpenHandler","setOnOpenHandler","onOpen","handler","panelId","DEFAULT_SETTINGS","maxNodes","enableFunctionDetails","enableMetricsFromProfiles","SettingsApiClient","setting","settings","PLUGIN_SETTING_NAME","newSettings","useSettingsApiClient","useFetchPluginSettings","settingsApiClient","mutateAsync","mutate","useMutation","mutationFn","InlineBanner","errorContext","DelayRender","shouldRender","setShouldRender","PanelMenu","menu","dragClassCancel","menuButtonClass","onVisibleChange","onOpenMenu","testId","selectors","components","Panels","Panel","handleVisibility","ToolbarButton","iconSize","narrow","HoverWidget","dragClass","draggableRef","e2eSelectors","onPointerDown","setPointerCapture","pointerId","onPointerUp","releasePointerCapture","menuOpen","setMenuOpen","top","square","draggable","dragIcon","draggableIcon","untitled","menuButton","hidden","visibility","opacity","position","zIndex","boxSizing","borderRadius","boxShadow","shadows","z1","cursor","down","fontStyle","padding","TitleItem","forwardRef","rest","linkItem","headerHeight","getFocusStyles","outline","outlineOffset","transitionTimingFunction","transitionDuration","transitionProperty","PanelDescription","interactive","panelDescription","dangerouslySetInnerHTML","__html","whiteSpace","wordWrap","PanelStatus","buttonStyles","GrafanaPanelBox","titleItems","hoverHeader","hoverHeaderOffset","statusMessage","statusMessageOnClick","onCancelQuery","setWidth","childrenContainerRef","offsetWidth","hasHeader","getHeaderHeight","contentStyle","getContentStyle","headerStyles","containerStyles","backgroundColor","testid","headerContent","Streaming","streaming","pointer","rightAligned","rightActions","itemsRenderer","loadingBarContainer","LoadingBar","errorContainerFloating","headerContainer","menuItem","renderer","toRender","toArray","gridSize","borderColor","action","overflow","flexGrow","marginRight","success","textOverflow","fontWeight","hiddenMenu","marginLeft","panelWrap","dataTestId","AIButton","isEnabled","openai","useFetchLlmPluginStatus","aiButton","onClickSearchTerm","searchInputElement","valueSetter","getOwnPropertyDescriptor","prototypeValueSetter","getPrototypeOf","call","setNativeValue","textContent","dispatchEvent","Event","bubbles","MARKDOWN_OPTIONS","component","searchLink","AiReply","reply","messages","role","Markdown","hr","textarea","sendButton","FollowUpForm","onSubmit","question","onChangeInput","onClickSend","setQuestion","questionToSend","useFollowUpForm","TextArea","shiftKey","prompts","system","empty","single","profiles","anton","buildPrompts","systemPrompt","userPrompt","ProfileApiClient","params","until","SceneAiPanel","validateFetchParams","isDiff","fetchParams","useSceneAiPanel","validationError","fetchError","profileApiClient","flatMap","useFetchDotProfiles","llmError","setReply","replyHasStarted","setReplyHasStarted","replyHasFinished","setReplyHasFinished","setMessages","setError","subscription","setSubscription","sendMessages","messagesToSend","next","complete","askFollowupQuestion","messagesToAdd","hasStarted","hasFinished","useOpenAiChatCompletions","shouldDisplayReply","shouldDisplayFollowUpForm","submitFollowupQuestion","sidePanel","retryButton","EventDiffAutoSelect","EventDiffChoosePreset","useMaxNodesFromUrl","pushNewUrl","navigate","useNavigate","useLocation","newParams","newSearchParams","useUrlSearchParams","setMaxNodes","newMaxNodes","hasMaxNodes","useSetDefaultMaxNodes","DiffProfileApiClient","leftQuery","leftFrom","leftTimeRange","leftUntil","rightQuery","rightFrom","rightTimeRange","rightUntil","useFetchDiffProfile","baselineTimeRange","baselineQuery","comparisonTimeRange","comparisonQuery","diffProfileApiClient","previousData","MissingSelectionsBanner","onClickAutoSelect","onClickChoosePreset","onOpenLearnHow","isCollapseOpen","setIsCollapseOpen","infoMsg","textButton","Collapse","collapsible","collapse","onToggle","collapseContent","ol","li","alt","SceneDiffFlameGraph","profileMetricType","aiPanel","useSceneDiffFlameGraph","useDiffTimeRanges","fetchSettingsError","isDiffQueryEnabled","fetchProfileError","noProfileDataAvailable","numTicks","shouldDisplayFlamegraph","hasMissingSelections","ai","wholeRange","isAiButtonDisabled","panelTitle","flex","flamegraphPanel","FEEDBACK_FORM_URL","GiveFeedbackButton","wrapper","feedback","paddingTop","alignSelf","ScenePresetsPicker","openSelect","isSelectOpen","closeSelect","presetsContainer","PRESETS","onChangePreset","onOpenSelect","onCloseSelect","onClickSave","ButtonRow","baseline","comparison","syncYAxis","maxima","cloneDeep","updateTimeseriesAxis","SceneExploreDiffFlameGraph","locationService","baselinePanel","comparisonPanel","presetsPicker","targetPanel","syncTimeRanges","columns","VcsClient","githubLogin","authorizationCode","githubApp","clientID","GitSessionCookie","isUserTokenExpired","biasMs","now","expiry","getTime","decode","decoded","atob","isLegacy","tryDecode","input","oauthTokenMetadata","GITHUB_SESSION_COOKIE_NAME","InternalGitSessionCookieManager","getCookie","syncCookieWithBrowser","sessionCookie","setCookie","cookie","rawCookie","getCookieFromJar","deleteLegacyCookie","deleteCookie","jar","ck","gitSessionCookieManager","POPUP_WIDTH","POPUP_HEIGHT","openLoginPopup","clientId","nonce","oauthURL","str","endsWith","redirectUri","GITHUB_CALLBACK","redirect_uri","buildGitHubAuthURL","outerWidth","screenX","outerHeight","screenY","vcsClient","privateVcsClient","externalWindow","setExternalWindow","authFromUrl","urlSearchParams","stateValue","usePollGitHubPopup","setSessionCookie","checkPopup","closed","tryGetWindowSearchParams","DEFAULT_GITHUB_CONTEXT","isLoginInProgress","isLoggedIn","isSessionExpired","login","GitHubContext","createContext","PLACEHOLDER_COMMIT_DATA","sha","author","avatarURL","PrivateVcsClient","repositoryUrl","gitRef","localPath","rootPath","postWithRefresh","repositoryURL","commits","getCommit","refreshSession","path","isRefreshing","queueRequest","sessionManager","BIAS_MS","flushQueue","post","pendingQueue","err","fromCharCode","crypto","getRandomValues","Uint8Array","GitHubContextProvider","setIsLoginInProgress","nextValue","useGithubSessionCookie","newIsLoginInProgress","Provider","RemoveSpanSelector","featureToggles","metricsFromProfiles","buildFlameGraphQueryRunner","spanSelector","recordingRulesApiClient","rules","rule","metricName","mapRuleToRecordingRuleViewModel","create","remove","useFetchRecordingRules","useQueryClient","invalidateQueries","recordingRules","useCreateRecordingRule","save","SceneCreateRecordingRuleModal","onCreate","register","handleSubmit","formState","useForm","shouldUnregister","setOptions","filterQuery","form","MetricNameErrorComponent","required","pattern","Controller","render","opt","toggleAllOptions","ul","errorList","PprofRequest","Message","profile_typeID","label_selector","max_nodes","PprofApiClient","buildPprofRequest","encode","finish","selectMergeProfile","Blob","selectMergeProfileJson","stackTrace","stackTraceSelector","call_site","dateString","SceneExportMenu","fetchFlamebearerProfile","fetchPprofProfile","pprofApiClient","Response","stream","pipeThrough","CompressionStream","useSceneExportMenu","downloadPprof","useGitHubContext","useContext","useGitHubIntegration","isFunctionDetailsEnabled","stacktrace","setStacktrace","getExtraFlameGraphMenuItems","levelItem","dp","getDisplayProcessor","idx","itemIndexes","parents","buildStackTrace","buildSuggestionPrompts","functionDetails","lines","line","cum","codeInfoToAnnotatedCode","useAiSuggestionsPanel","suggestionPromptInputs","useOpenAiSuggestions","AiSuggestionsPanel","VERTICAL_LINES_PADDING","buildGithubUrlForFunction","startLine","newUrl","org","repo","useCodeContainer","openAiSuggestions","setOpenAiSuggestions","fileInfo","repository","getFile","useFetchVCSFile","fileName","git_ref","root_path","snippetLines","allLines","callSitesMap","callSites","annotatedLines","lineNumber","callSite","number","flat","firstLineIndex","lastLineIndex","annotateLines","annotatedSnippet","annotatePlaceholderLines","isLoadingCode","githubUrl","annotatedLine","annotateLine","noCodeAvailable","buildUnitFormatter","Code","onOptimizeCodeClick","fmt","formatValue","formatted","trimIndentPrefix","sumSelf","sumTotal","accSelf","accTotal","breakdownLabel","buttons","LinkButton","pre","codeBlock","highlighted","codeBlockHeader","formatLine","cols","padStart","commonPrefix","getIndentPrefix","longestCommonPrefix","prefixLen","CodeContainer","getElementById","scrollIntoView","behavior","ellipsis","GitHubRepository","enableIntegration","commitUrl","commitName","getCommitsWithSamples","functionsDetails","totalSamples","details","samples","GITHUB_URL","getRepositoryDetails","isGitHub","functionVersion","buildDetails","func","mapping","stringTable","buildId","sampleType","convertSample","fnName","locations","functions","mappings","sample","versions","locationIdSet","locationId","functionId","mappingId","addCallSiteValue","fetchCommitsInfo","getCommits","getTotalSum","fd","sortByTotal","useFetchFunctionsDetails","isGitHubLogged","queryError","pprof","l","function","convertPprofToFunctionDetails","CUTOFFS","Infinity","UNITS","RTF","RelativeTimeFormat","numeric","DTF","formatCommitDate","commitDate","timeMs","deltaSeconds","unitIndex","findIndex","cutoff","abs","divisor","getRelativeTimeString","firstLine","secondLine","avatar","CommitOption","commitAuthor","commitAuthorAvatarUrl","samplePercent","getCommitShortSha","getCommitShortMessage","CommitOptionSelected","CommitSelect","selectedCommit","isSearchable","formatOptionLabel","formatOption","formatOptionMeta","selectValue","GitHubIntegrationBanner","buttonContent","TextLink","external","InlineSpinnerComponent","InlineSpinner","SceneFunctionDetailsPanel","useSceneFunctionDetailsPanel","currentFunctionDetails","fetchFunctionDetailsError","prevFunctionsDetails","setPrevFunctionsDetails","setCurrentFunctionDetails","isGitHubBannerDismissed","setIsGitHubBannerDismissed","isGitHubRepo","isGitHubSupported","shouldDisplayGitHubBanner","selectCommit","copyFilePathToClipboard","navigator","clipboard","writeText","dismissGitHubBanner","LABEL_WIDTH","InlineLabel","textValue","SpanSelectorLabel","removeSpanSelector","SceneFlameGraph","dataSubscription","stateSubscription","newDataState","lastTimeRange","exportMenu","functionDetailsPanel","createRecordingRuleModal","useSceneFlameGraph","$dataState","isFetchingSettingsError","isFetchingProfileData","hasProfileData","export","gitHub","modal","gitHubIntegration","recordingRulesActions","recordingRulesModelOpen","setIsRecordingRulesModalOpen","recordingRulesMenu","setModalOpen","clickedItemData","SceneExploreServiceFlameGraph","mainTimeseries","onClickShareLink","shareableUrl","builsShareableUrl","ExplorationTypeSelector","activeIndex","explorationTypeContainer","breadcrumb","currentIndex","extraClasses","Fragment","arrow","Header","chromeHeaderHeight","useChromeHeaderHeight","explorationType","onChangeExplorationType","timePickerControl","refreshPickerControl","ExplorationType","DIFF_FLAME_GRAPH","dataSourceVariable","bodySceneObject","sceneVariables","onClickRecordingRules","RECORDING_RULES","referrer","onClickAdHoc","ADHOC","onClickUserSettings","useHeader","appControls","appControlsLeft","EXPLORATION_TYPE_OPTIONS","appControlsRight","appMiscButtons","sceneVariable","sceneVariableLabel","gridControl","varSub","subscribeToVariableChanges","eventsSub","setExplorationType","DEFAULT_EXPLORATION_TYPE","registerRuntimeDataSources","sceneUtils","registerRuntimeDataSource","resetSpanSelector","serviceNameSub","profileTypeSub","profilesSub","comesFromUserAction","labelsSub","flameGraphSub","diffFlameGraphSub","bodySceneOptions","removeSpanSelectorSub","resetVariables","buildBodyScene","nextExplorationType","SplitLayout","useProfilesExplorer","getUrlSyncManager","initSync","ProfilesExplorerView","sceneProfilesExplorer","DeleteRecordingRuleButton","confirm","ConfirmModal","confirmText","onConfirm","useRecordingRulesView","removeRecordingRule","RecordingRulesView","sortType","cell","original","TagList","tagList","displayMax","tags","disableGrow","formattedRules","isEmpty","RecordingRulesViewError","InteractiveTable","pageSize","getRowId","errorMessage","useUISettingsView","currentSettings","setCurrentSettings","toggleCollapsedFlamegraphs","updateMaxNodes","toggleEnableFlameGraphDotComExport","toggleEnableFunctionDetails","toggleEnableMetricsFromProfiles","saveSettings","UISettingsView","settingsForm","preventDefault","FieldSet","labelWidth","fontWeightBold","SETTINGS_EXTENSION_POINT_ID","useSettingsView","maxNodesFromUrl","activeTab","setActiveTab","referrerRef","usePluginComponents","tab","goBack","backUrl","SettingsView","builtInTabs","pluginProps","datasourceUid","backButton","allTabs","Space","Routes","ReactRouterRoutes","Route","GitHubCallback","Navigate","ErrorPage","App","ErrorBoundary","QueryClientProvider","client","pageContainer","faroEnvironment","getFaroEnvironment","userEmail","email","grafanaVersion","instance","initializeFaro","app","release","namespace","instrumentations","getWebInstrumentations","captureConsole","isolate","beforeSend","initFaro","useDebounce"],"sourceRoot":""}